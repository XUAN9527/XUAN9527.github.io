<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>ESP32å¼€å‘å°è´´å£«</title>
    <url>/2024/02/22/ESP32%E5%B0%8F%E8%B4%B4%E5%A3%AB/</url>
    <content><![CDATA[<h2 id="ESP32-ESP-IDFè‡ªå®šä¹‰ç»„ä»¶"><a href="#ESP32-ESP-IDFè‡ªå®šä¹‰ç»„ä»¶" class="headerlink" title="ESP32 ESP-IDFè‡ªå®šä¹‰ç»„ä»¶"></a>ESP32 ESP-IDFè‡ªå®šä¹‰ç»„ä»¶</h2><h3 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h3><h4 id="å®˜æ–¹æ–‡æ¡£"><a href="#å®˜æ–¹æ–‡æ¡£" class="headerlink" title="å®˜æ–¹æ–‡æ¡£"></a>å®˜æ–¹æ–‡æ¡£</h4><p><a href="https://link.zhihu.com/?target=https://docs.espressif.com/projects/esp-idf/en/latest/esp32/api-guides/build-system.html%23component-cmakelists-files">è‹±æ–‡å®˜æ–¹æ–‡æ¡£é“¾æ¥</a><br><a href="https://link.zhihu.com/?target=https://docs.espressif.com/projects/esp-idf/zh_CN/latest/esp32/api-guides/build-system.html%23id21">ä¸­æ–‡å®˜æ–¹æ–‡æ¡£é“¾æ¥</a></p>
<h4 id="ç¤ºä¾‹è¯´æ˜"><a href="#ç¤ºä¾‹è¯´æ˜" class="headerlink" title="ç¤ºä¾‹è¯´æ˜"></a>ç¤ºä¾‹è¯´æ˜</h4><p>æ­¤ç¤ºä¾‹åœ¨ã€Š<strong>ESP32 smart_configå’Œairkissé…ç½‘</strong>ã€‹<br><a href="https://zhuanlan.zhihu.com/p/440454542">https://zhuanlan.zhihu.com/p/440454542</a><br><a href="https://link.zhihu.com/?target=https://blog.csdn.net/chentuo2000/article/details/121687760">https://link.zhihu.com/?target=https%3A//blog.csdn.net/chentuo2000/article/details/121687760</a><br>åŸºç¡€ä¸Šï¼Œå¢åŠ è¿æ¥æˆåŠŸåç‚¹äº®æ¿è½½LEDåŠŸèƒ½ã€‚<br>å®ç°æ‰€éœ€åŠŸèƒ½åå°†å„åŠŸèƒ½ä»£ç åˆ†ç¦»ï¼Œå†å°†åˆ†ç¦»åçš„ä»£ç æ„é€ æˆç»„ä»¶ï¼Œä½¿å¾—é¡¹ç›®æœ‰æ¸…æ™°çš„ç»“æ„ï¼Œæ–¹ä¾¿åŠŸèƒ½ä»£ç ç§»æ¤.</p>
<h3 id="å¼€å‘ç¯å¢ƒ"><a href="#å¼€å‘ç¯å¢ƒ" class="headerlink" title="å¼€å‘ç¯å¢ƒ"></a>å¼€å‘ç¯å¢ƒ</h3><p>ä»¥ä¸‹æœ‰ä¸‰ç§æ–¹æ³•ï¼š</p>
<ol>
<li><p>ã€ŠWin10å¯ç”¨Linuxå­ç³»ç»Ÿå®‰è£…Ubuntuã€‹<br><a href="https://link.zhihu.com/?target=https://blog.csdn.net/chentuo2000/article/details/112131624">https://link.zhihu.com/?target=https%3A//blog.csdn.net/chentuo2000/article/details/112131624</a></p>
</li>
<li><p>ã€Šç”¨ä¹é‘«å›½å†…Giteeé•œåƒæ­å»ºESP32å¼€å‘ç¯å¢ƒã€‹<br><a href="https://link.zhihu.com/?target=https://blog.csdn.net/chentuo2000/article/details/113424934">https://link.zhihu.com/?target=https%3A//blog.csdn.net/chentuo2000/article/details/113424934</a></p>
</li>
<li><p>ã€ŠESP32ç¯å¢ƒæ­å»ºã€‹ï¼ˆè‡ªå·±å†™çš„ç¯å¢ƒæ­å»ºï¼‰<br><a href="https://xuan9527.github.io/2024/02/19/ESP32%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/">https://xuan9527.github.io/2024/02/19/ESP32%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/</a></p>
</li>
</ol>
<h3 id="æ„å»ºé¡¹ç›®"><a href="#æ„å»ºé¡¹ç›®" class="headerlink" title="æ„å»ºé¡¹ç›®"></a>æ„å»ºé¡¹ç›®</h3><h4 id="æ‹·è´-åˆå§‹åŒ–ä¾‹ç¨‹"><a href="#æ‹·è´-åˆå§‹åŒ–ä¾‹ç¨‹" class="headerlink" title="æ‹·è´ &amp;&amp; åˆå§‹åŒ–ä¾‹ç¨‹"></a>æ‹·è´ &amp;&amp; åˆå§‹åŒ–ä¾‹ç¨‹</h4><p>å°†ä¾‹å­é¡¹ç›®<code>hello_world</code>å¤åˆ¶åˆ°<code>ESP-IDF</code>å¼€å‘å·¥å…·ä¹‹å¤–,æ›´åä¸º<code>components_demo</code>:</p>
<pre><code>cd ~/esp
cp -r ~/esp/esp-adf/esp-idf/examples/get-started/hello_world ./components_demo
</code></pre>
<p>æ¸…ç©º<code>build</code>ç›®å½•:</p>
<pre><code>cd ~/esp/components_demo
rm -r build/*
</code></pre>
<p>æ³¨æ„ï¼Œæ¯å½“æ·»åŠ äº†æ–°ç»„ä»¶å°±è¦åˆ é™¤<code>build</code>ç›®å½•ä¸‹çš„å…¨éƒ¨å†…å®¹ï¼Œæˆ–è€…æ‰§è¡Œä¸‹é¢è¿™æ¡å‘½ä»¤ï¼š</p>
<pre><code>idf.py fullclean
</code></pre>
<p>æ¸…é™¤ä»¥å‰çš„æ„å»ºã€‚</p>
<h4 id="æ·»åŠ ç»„ä»¶letter-shell"><a href="#æ·»åŠ ç»„ä»¶letter-shell" class="headerlink" title="æ·»åŠ ç»„ä»¶letter_shell"></a>æ·»åŠ ç»„ä»¶letter_shell</h4><pre><code>idf.py -C components create-component letter_shell
</code></pre>
<p>è¯¥å‘½ä»¤ä¼šåˆ›å»ºä¸€ä¸ªæ–°ç»„ä»¶,æ–°ç»„ä»¶å°†åŒ…å«æ„å»ºç»„ä»¶æ‰€éœ€çš„ä¸€ç»„ç©ºæ–‡ä»¶ã€‚æˆ‘ä»¬çš„å·¥ä½œå°±æ˜¯åœ¨è¿™ä¸€ç»„ç©ºæ–‡ä»¶ä¸­å†™ä¸Šæˆ‘ä»¬çš„ä»£ç ã€‚<br>å¦‚æœç†Ÿæ‚‰äº†ç»„ä»¶ç»“æ„ï¼Œä¹Ÿå¯ä»¥ç›´æ¥åœ¨é¡¹ç›®ä¸­æ‰‹å·¥åˆ›å»ºã€‚</p>
<h4 id="é¡¹ç›®æ ‘"><a href="#é¡¹ç›®æ ‘" class="headerlink" title="é¡¹ç›®æ ‘"></a>é¡¹ç›®æ ‘</h4><p>æ„å»ºå¥½çš„é¡¹ç›®ç»“æ„å¦‚ä¸‹:</p>
<p><img src="/../pictures/component_demo%E8%AE%BE%E5%A4%87%E6%A0%91.png" alt="component_demoè®¾å¤‡æ ‘"></p>
<p><strong>æ³¨æ„ï¼š</strong></p>
<ul>
<li>ç»„ä»¶ç›®å½•<code>components</code>åå­—ä¸èƒ½æ”¹ï¼Œå…¶ä¸‹çš„ç»„ä»¶åå¯ä»¥éšæ„å–ã€‚<code>build</code>ç›®å½•æ˜¯ç¼–è¯‘æ—¶ç”Ÿæˆçš„ï¼Œç¼–è¯‘çš„ç»“æœéƒ½æ”¾åœ¨å…¶ä¸­ã€‚<code>dependencies.lock</code>æ˜¯éšåŸæ¥çš„é¡¹ç›®å¤åˆ¶è¿‡æ¥çš„ä¸è¦æ”¹ã€‚<code>sdkconfig</code>æ–‡ä»¶å¯ä»¥ç”¨<code>idf.py menuconfig</code>å‘½ä»¤ä¿®æ”¹ã€‚</li>
<li><code>idf_component.yml</code>æ˜¯æ–°ç‰ˆè‡ªåŠ¨é“¾æ¥ä¸‹è½½æ–‡ä»¶ï¼Œä»¥ä¸‹æ˜¯<code>esp32-camera</code>ä¾èµ–ç»„ä»¶ï¼Œä¸‹æ‹‰åœ¨<code>managed_components</code>é‡Œã€‚<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">dependencies:</span><br><span class="line">  esp32-camera:</span><br><span class="line">    git: git@github.com:espressif/esp32-camera.git</span><br></pre></td></tr></table></figure>
<br></li>
</ul>
<h3 id="ä»£ç å’Œè¯´æ˜"><a href="#ä»£ç å’Œè¯´æ˜" class="headerlink" title="ä»£ç å’Œè¯´æ˜"></a>ä»£ç å’Œè¯´æ˜</h3><p>å„æ–‡ä»¶çš„ä½ç½®å…³ç³»å¾ˆé‡è¦ï¼Œè¯·å¯¹ç…§å‰é¢çš„é¡¹ç›®æ ‘çœ‹ä»£ç æ–‡ä»¶ã€‚</p>
<h4 id="é¡¹ç›®çš„æ ¹CMakeLists-txtæ–‡ä»¶"><a href="#é¡¹ç›®çš„æ ¹CMakeLists-txtæ–‡ä»¶" class="headerlink" title="é¡¹ç›®çš„æ ¹CMakeLists.txtæ–‡ä»¶"></a>é¡¹ç›®çš„æ ¹CMakeLists.txtæ–‡ä»¶</h4><pre><code># The following lines of boilerplate have to be in your project&#39;s
# CMakeLists in this exact order for cmake to work correctly
cmake_minimum_required(VERSION 3.16)

include($ENV&#123;IDF_PATH&#125;/tools/cmake/project.cmake)
project(components_demo)
</code></pre>
<p>åªéœ€è¦ä¿®æ”¹<code>project</code>ä¸­çš„é¡¹ç›®åç§°ã€‚</p>
<h4 id="mainç›®å½•"><a href="#mainç›®å½•" class="headerlink" title="mainç›®å½•"></a>mainç›®å½•</h4><p><strong>CMakeLists.txt</strong></p>
<pre><code>idf_component_register(SRCS &quot;main.c&quot;
            INCLUDE_DIRS &quot;.&quot;
            PRIV_REQUIRES letter_shell
            REQUIRES nvs_flash)
</code></pre>
<p><strong>main.c</strong></p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;freertos/FreeRTOS.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;freertos/task.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;freertos/queue.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;esp_log.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;shell_port.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;log.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;nvs_flash.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">const</span> <span class="type">char</span> *TAG = <span class="string">&quot;sample test&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">app_main</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">esp_err_t</span> ret;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Initialize NVS.</span></span><br><span class="line">    ret = nvs_flash_init();</span><br><span class="line">    <span class="keyword">if</span> (ret == ESP_ERR_NVS_NO_FREE_PAGES || ret == ESP_ERR_NVS_NEW_VERSION_FOUND) &#123;</span><br><span class="line">        ESP_ERROR_CHECK(nvs_flash_erase());</span><br><span class="line">        ret = nvs_flash_init();</span><br><span class="line">    &#125;</span><br><span class="line">    ESP_ERROR_CHECK( ret );</span><br><span class="line"></span><br><span class="line">	esp_log_level_set(TAG, ESP_LOG_INFO);</span><br><span class="line">	ESP_LOGI(TAG,<span class="string">&quot;this is a test program&quot;</span>);</span><br><span class="line">    </span><br><span class="line">	userShellInit();</span><br><span class="line"></span><br><span class="line">	logInfo(<span class="string">&quot;log info!&quot;</span>);</span><br><span class="line">	logDebug(<span class="string">&quot;log debug!&quot;</span>);</span><br><span class="line">	logWarning(<span class="string">&quot;log warning!&quot;</span>);</span><br><span class="line">	logError(<span class="string">&quot;log error!&quot;</span>);</span><br><span class="line">	<span class="keyword">while</span>(<span class="number">1</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		logDebug(<span class="string">&quot;log loop!&quot;</span>);</span><br><span class="line">		vTaskDelay(pdMS_TO_TICKS(<span class="number">2000</span>));</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¤´æ–‡ä»¶<code>nvs_flash.h</code>æ˜¯å¯¹ç³»ç»Ÿç»„ä»¶çš„å¼•ç”¨ï¼Œ<code>shell_port.h</code>æ˜¯å¯¹è‡ªå®šä¹‰ç»„ä»¶çš„å¼•ç”¨ã€‚</p>
<h4 id="letter-shellç»„ä»¶"><a href="#letter-shellç»„ä»¶" class="headerlink" title="letter_shellç»„ä»¶"></a>letter_shellç»„ä»¶</h4><p><strong>CMakeLists.txt</strong>:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">idf_component_register(</span><br><span class="line">	SRCS &quot;shell.c&quot;</span><br><span class="line">		&quot;shell_ext.c&quot;</span><br><span class="line">		&quot;log.c&quot;</span><br><span class="line">		&quot;shell_port.c&quot;</span><br><span class="line">	INCLUDE_DIRS &quot;include&quot;</span><br><span class="line">	LDFRAGMENTS &quot;shell.lf&quot;</span><br><span class="line">	REQUIRES driver</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h5 id="è¯´æ˜ï¼š"><a href="#è¯´æ˜ï¼š" class="headerlink" title="è¯´æ˜ï¼š"></a>è¯´æ˜ï¼š</h5><p>1ã€<strong>PRIV_REQUIRES</strong><br>è¯¥å‚æ•°æŒ‡å®šå¯¹å…¶å®ƒè‡ªå®šä¹‰ç»„ä»¶çš„ä¾èµ–ï¼Œå³ç§æœ‰ä¾èµ–é¡¹ã€‚</p>
<p><code>PRIV_REQUIRES led</code>è¡¨ç¤ºæŒ‡å‡ºåœ¨<code>smart_config</code>ç»„ä»¶ä¸­è¦ç”¨åˆ°è‡ªå®šä¹‰çš„<code>led</code>ç»„ä»¶ã€‚ç»„ä»¶åå­—å¯ä»¥åŠ å¼•å·ï¼Œä¹Ÿå¯ä»¥ä¸åŠ ã€‚å¤šä¸ªç»„ä»¶ç”¨ç©ºæ ¼åˆ†å¼€ã€‚</p>
<p>2ã€ <strong>REQUIRES</strong><br>è¯¥å‚æ•°æŒ‡å®šå¯¹ç³»ç»Ÿç»„ä»¶çš„ä¾èµ–ï¼Œå³å…¬å…±ä¾èµ–é¡¹ã€‚</p>
<p><code>REQUIRES esp_driver_uart</code> è¡¨ç¤ºåœ¨<code>letter_shell</code>ç»„ä»¶ä¸­è¦ç”¨åˆ°ç³»ç»Ÿç»„ä»¶<code>esp_driver_uart</code>ã€‚</p>
<p>3ã€ç³»ç»Ÿç»„ä»¶çš„ç¡®å®š</p>
<p>å¯¹äºè¦ä¾èµ–çš„ç³»ç»Ÿç»„ä»¶ä¸åƒç§æœ‰ä¾èµ–é¡¹é‚£æ ·ä¸€ç›®äº†ç„¶ï¼Œæœ‰æ—¶æˆ‘ä»¬å¹¶ä¸æ¸…æ¥šæ‰€è¦çš„ç³»ç»Ÿç»„ä»¶åç§°ã€‚æ¯”å¦‚æˆ‘ä»¬ä¸çŸ¥é“éœ€è¦ç»„ä»¶wpa_supplicantï¼Œè¿™æ—¶æˆ‘ä»¬å¯ä»¥å…ˆç¼–è¯‘ä¸€æ¬¡ï¼Œçœ‹çœ‹é”™è¯¯ä¿¡æ¯ï¼š</p>
<p><img src="/../pictures/requires_error.png" alt="requires_error"></p>
<p>åœ¨<code>CMakeLists.txt</code>ä¸­æ·»åŠ ä¾èµ–ç»„ä»¶<code>REQUIRES esp_driver_uart</code>ï¼Œç¼–è¯‘é€šè¿‡ã€‚</p>
<h4 id="å…³äºCMakeLists-txtæ–‡ä»¶"><a href="#å…³äºCMakeLists-txtæ–‡ä»¶" class="headerlink" title="å…³äºCMakeLists.txtæ–‡ä»¶"></a>å…³äºCMakeLists.txtæ–‡ä»¶</h4><p>æ ¹å’Œæ¯ä¸ªç›®å½•éƒ½æœ‰ä¸€ä¸ª<code>CMakeLists.txt</code>æ–‡ä»¶ï¼Œå¼€å§‹é‡åˆ°çš„é—®é¢˜æ˜¯ä¸çŸ¥é“ç›®å½•ç»“æ„å’Œæ€æ ·å†™<code>CMakeLists.txt</code>æ–‡ä»¶ï¼Œè¦æ³¨æ„æ¯ä¸€å±‚ç›®å½•ä¸­<code>CMakeLists.txt</code>æ–‡ä»¶çš„å†™æ³•ï¼Œæœ¬æ–‡çš„ä¾‹å­ç»™å‡ºäº†ä¸€ä¸ªç®€å•çš„ç¤ºèŒƒã€‚å¯¹äºå¤æ‚çš„é¡¹ç›®è¿˜éœ€è¦æ›´å¤šç¼–å†™<code>CMakeLists.txt</code>æ–‡ä»¶çš„çŸ¥è¯†ï¼Œè¯·çœ‹ç®€ä»‹ä¸­ç»™å‡ºçš„å®˜æ–¹æ–‡æ¡£ã€‚</p>
<br>

<h2 id="ESP32ç§»æ¤Letter-shellé—®é¢˜"><a href="#ESP32ç§»æ¤Letter-shellé—®é¢˜" class="headerlink" title="ESP32ç§»æ¤Letter_shellé—®é¢˜"></a>ESP32ç§»æ¤Letter_shellé—®é¢˜</h2><h3 id="æ·»åŠ shellç»„ä»¶åŠå…¶logï¼Œç¼–è¯‘å‡ºé”™"><a href="#æ·»åŠ shellç»„ä»¶åŠå…¶logï¼Œç¼–è¯‘å‡ºé”™" class="headerlink" title="æ·»åŠ shellç»„ä»¶åŠå…¶logï¼Œç¼–è¯‘å‡ºé”™"></a>æ·»åŠ shellç»„ä»¶åŠå…¶logï¼Œç¼–è¯‘å‡ºé”™</h3><h4 id="å¯èƒ½åŸå› "><a href="#å¯èƒ½åŸå› " class="headerlink" title="å¯èƒ½åŸå› :"></a>å¯èƒ½åŸå› :</h4><ol>
<li><p>å®ä½¿ç”¨ä¸æ­£ç¡®: å¦‚æœ <code>SHELL_FREE</code> æ—¨åœ¨å®é™…é‡Šæ”¾ä¸ <code>companions</code> å¯¹è±¡å…³è”çš„å†…å­˜æˆ–èµ„æºï¼Œåˆ™å½“å‰å®šä¹‰ä¸æ­£ç¡®ã€‚å®ƒåº”è¯¥è°ƒç”¨å†…å­˜ç®¡ç†å‡½æ•°æˆ–æ‰§è¡Œå…¶ä»–å¿…è¦çš„æ¸…ç†ä»»åŠ¡ã€‚</p>
</li>
<li><p>ç¼–è¯‘å™¨è­¦å‘Šè¢«è§†ä¸ºé”™è¯¯: <code>-Werror=unused-value</code> æ ‡å¿—å·²å¯ç”¨ï¼Œå®ƒå°†è­¦å‘Šè§†ä¸ºé”™è¯¯ã€‚å³ä½¿å®ä½¿ç”¨æœ¬èº«å¯èƒ½ä¸æ˜¯å…³é”®é—®é¢˜ï¼Œè¿™ä¹Ÿå¯èƒ½å¯¼è‡´ç¼–è¯‘å¤±è´¥ã€‚</p>
</li>
</ol>
<h4 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ:"></a>è§£å†³æ–¹æ¡ˆ:</h4><h5 id="ä¿®å¤-SHELL-FREE-å®šä¹‰"><a href="#ä¿®å¤-SHELL-FREE-å®šä¹‰" class="headerlink" title="ä¿®å¤ SHELL_FREE å®šä¹‰:"></a>ä¿®å¤ SHELL_FREE å®šä¹‰:</h5><ol>
<li>å¦‚æœ <code>companions</code> éœ€è¦å†…å­˜åˆ†é…ï¼Œè¯·æ›´æ–° <code>shell_cfg.h</code> ä¸­çš„ SHELL_FREE å®ä»¥è°ƒç”¨é€‚å½“çš„å†…å­˜ç®¡ç†å‡½æ•°ï¼Œä¾‹å¦‚ <code>free()</code>ã€‚</li>
<li>å¦‚æœ <code>companions</code> ä¸éœ€è¦å†…å­˜ç®¡ç†ï¼Œè¯·ä» <code>shell_companion.c</code> ä¸­çš„ç¬¬ 57 è¡Œåˆ é™¤ <code>SHELL_FREE</code> è°ƒç”¨ï¼›æˆ–è€…å°†<code>shell_cfg.h</code> ä¸­çš„ç¬¬ 36 è¡Œ <code>SHELL_USING_COMPANION</code> çš„å®å®šä¹‰æ”¹ä¸º 0ã€‚</li>
</ol>
<h5 id="ç¦ç”¨-Werror-unused-value-å¦‚æœé€‚ç”¨"><a href="#ç¦ç”¨-Werror-unused-value-å¦‚æœé€‚ç”¨" class="headerlink" title="ç¦ç”¨ -Werror&#x3D;unused-value (å¦‚æœé€‚ç”¨):"></a>ç¦ç”¨ -Werror&#x3D;unused-value (å¦‚æœé€‚ç”¨):</h5><p>å¦‚æœæ‚¨å¸Œæœ›å°†æœªä½¿ç”¨çš„å€¼è­¦å‘Šè§†ä¸ºè­¦å‘Šè€Œä¸æ˜¯é”™è¯¯ï¼Œæ‚¨å¯ä»¥æš‚æ—¶åœ¨ç¼–è¯‘æœŸé—´ç¦ç”¨ <code>-Werror=unused-value</code> æ ‡å¿—ã€‚ä½†æ˜¯ï¼Œé€šå¸¸å»ºè®®ä¿®å¤åº•å±‚é—®é¢˜ä»¥é¿å…æ½œåœ¨çš„å†…å­˜æ³„æ¼æˆ–èµ„æºç®¡ç†é—®é¢˜ã€‚</p>
<h5 id="å…¶ä»–æç¤º"><a href="#å…¶ä»–æç¤º" class="headerlink" title="å…¶ä»–æç¤º:"></a>å…¶ä»–æç¤º:</h5><ol>
<li>æä¾›æœ‰å…³æ‚¨çš„é¡¹ç›®æ›´å¤šä¿¡æ¯ï¼Œä¾‹å¦‚å…·ä½“çš„ ESP-IDF ç‰ˆæœ¬ã€æ¶‰åŠçš„ç»„ä»¶ä»¥åŠ <code>SHELL_FREE</code> å®çš„ç”¨é€”ã€‚è¿™å°†æœ‰åŠ©äºäº†è§£æ ¹æœ¬åŸå› å¹¶æä¾›æ›´å®šåˆ¶çš„æŒ‡å¯¼ã€‚</li>
<li>åˆ†äº« <code>shell_cfg.h</code> å¤´æ–‡ä»¶å’Œ <code>shell_companion.c</code> æ–‡ä»¶çš„ç›¸å…³éƒ¨åˆ†ï¼Œä»¥ä¾¿åˆ†æä»£ç ç»“æ„å’Œä¸Šä¸‹æ–‡ã€‚<br>è€ƒè™‘ä½¿ç”¨è°ƒè¯•å™¨é€æ­¥æ‰§è¡Œä»£ç å¹¶æ£€æŸ¥ <code>companions</code> åœ¨ <code>SHELL_FREE</code> è°ƒç”¨ä¹‹å‰å’Œä¹‹åçš„ å€¼ï¼Œä»¥äº†è§£å…¶ä½¿ç”¨æƒ…å†µå’Œæ½œåœ¨çš„å†…å­˜ç®¡ç†é—®é¢˜ã€‚</li>
<li>é€šè¿‡éµå¾ªè¿™äº›æ­¥éª¤å¹¶æä¾›æ›´å¤šä¿¡æ¯ï¼Œæˆ‘å¯ä»¥å¸®åŠ©æ‚¨æœ‰æ•ˆåœ°è§£å†³ç¼–è¯‘é”™è¯¯å¹¶ç¡®ä¿æ‚¨çš„ ESP-IDF é¡¹ç›®æˆåŠŸæ„å»ºã€‚</li>
</ol>
<h4 id="é…ç½®shellä¼˜å…ˆçº§"><a href="#é…ç½®shellä¼˜å…ˆçº§" class="headerlink" title="é…ç½®shellä¼˜å…ˆçº§"></a>é…ç½®shellä¼˜å…ˆçº§</h4><p>å°†shellçš„freertosä¼˜å…ˆçº§è®¾ç½®ä¸º <code>tskIDLE_PRIORITY</code>ï¼Œä¸º<code>0</code>çº§ï¼Œè·Ÿç©ºé—²å‡½æ•°ä¼˜å…ˆçº§ä¸€æ ·ï¼Œæ‰€æœ‰å…¶ä»–ä¼˜å…ˆçº§ä»»åŠ¡æ‰§è¡Œå®Œåæ‰ä¼šæ‰§è¡Œ <code>tskIDLE_PRIORITY</code>ä¼˜å…ˆçº§ä»»åŠ¡ã€‚</p>
<h4 id="æºä»£ç ä¾‹ç¨‹"><a href="#æºä»£ç ä¾‹ç¨‹" class="headerlink" title="æºä»£ç ä¾‹ç¨‹"></a>æºä»£ç ä¾‹ç¨‹</h4><p><a href="https://github.com/XUAN9527/components_demo">ESP32ç§»æ¤letter_shellç»„ä»¶ä¾‹ç¨‹</a></p>
<br>

<h2 id="ESP32å¯åŠ¨æµç¨‹è§£æ"><a href="#ESP32å¯åŠ¨æµç¨‹è§£æ" class="headerlink" title="ESP32å¯åŠ¨æµç¨‹è§£æ"></a>ESP32å¯åŠ¨æµç¨‹è§£æ</h2><br>

<h2 id="ESP32-IDFç»„ä»¶ä¸‹è½½å®‰è£…è·¯å¾„"><a href="#ESP32-IDFç»„ä»¶ä¸‹è½½å®‰è£…è·¯å¾„" class="headerlink" title="ESP32-IDFç»„ä»¶ä¸‹è½½å®‰è£…è·¯å¾„"></a>ESP32-IDFç»„ä»¶ä¸‹è½½å®‰è£…è·¯å¾„</h2><ul>
<li><p>å®‰è£…æ‰€éœ€ç»„ä»¶ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cd ~/esp/esp-adf/esp-idf</span><br><span class="line">./install.sh esp32,esp32s3 # å¯æŒ‰éœ€æ±‚å®‰è£…</span><br></pre></td></tr></table></figure>
</li>
<li><p>è‹¥ä¸‹è½½å¾ˆæ…¢ï¼Œå¯æŒ‰ä»¥ä¸‹è·¯å¾„åœ¨<code>Windows</code>&#x2F;<code>Linux</code>ä¸‹è½½:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cd ~/esp/esp-adf/esp-idf/tools</span><br><span class="line">vim tools.json</span><br><span class="line">&#123;</span><br><span class="line">  &quot;tools&quot;: [</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;description&quot;: &quot;GDB for Xtensa&quot;,</span><br><span class="line">      &quot;export_paths&quot;: [</span><br><span class="line">        [</span><br><span class="line">          &quot;xtensa-esp-elf-gdb&quot;,</span><br><span class="line">          &quot;bin&quot;</span><br><span class="line">        ]</span><br><span class="line">      ],</span><br><span class="line">      &quot;export_vars&quot;: &#123;&#125;,</span><br><span class="line">      &quot;info_url&quot;: &quot;https://github.com/espressif/binutils-gdb&quot;,</span><br><span class="line">      &quot;install&quot;: &quot;always&quot;,</span><br><span class="line">      &quot;license&quot;: &quot;GPL-3.0-or-later&quot;,</span><br><span class="line">      &quot;name&quot;: &quot;xtensa-esp-elf-gdb&quot;,</span><br><span class="line">      &quot;supported_targets&quot;: [</span><br><span class="line">        &quot;esp32&quot;,</span><br><span class="line">        &quot;esp32s2&quot;,</span><br><span class="line">        &quot;esp32s3&quot;</span><br><span class="line">      ],</span><br><span class="line">      &quot;version_cmd&quot;: [</span><br><span class="line">        &quot;xtensa-esp-elf-gdb-no-python&quot;,</span><br><span class="line">        &quot;--version&quot;</span><br><span class="line">      ],</span><br><span class="line">      &quot;version_regex&quot;: &quot;GNU gdb \\(esp-gdb\\) ([a-z0-9.-_]+)&quot;,</span><br><span class="line">      &quot;versions&quot;: [</span><br><span class="line">        &#123;</span><br><span class="line">          &quot;linux-amd64&quot;: &#123;</span><br><span class="line">            &quot;sha256&quot;: &quot;b5f7cc3e4b5a58db655754083ed9652e4953e71c3b4922fb624e7a034ec24a64&quot;,</span><br><span class="line">            &quot;size&quot;: 26947336,</span><br><span class="line">            &quot;url&quot;: &quot;https://github.com/espressif/binutils-gdb/releases/download/esp-gdb-v11.2_20220823/xtensa-esp-elf-gdb-11.2_20220823-x86_64-linux-gnu.tar.gz&quot;</span><br><span class="line">          &#125;,</span><br><span class="line">          &quot;linux-arm64&quot;: &#123;</span><br><span class="line">            &quot;sha256&quot;: &quot;816acfae38b6b443f4f1590395f68f079243539259d19c7772ae6416c6519444&quot;,</span><br><span class="line">            &quot;size&quot;: 27134508,</span><br><span class="line">            &quot;url&quot;: &quot;https://github.com/espressif/binutils-gdb/releases/download/esp-gdb-v11.2_20220823/xtensa-esp-elf-gdb-11.2_20220823-aarch64-linux-gnu.tar.gz&quot;</span><br><span class="line">          &#125;,</span><br><span class="line">          &quot;linux-armel&quot;: &#123;</span><br><span class="line">            &quot;sha256&quot;: &quot;4dd1bace0633196fddfdcef3cebcc4bbfce22f5a0d2d1e3d618f3d8a6cbfcacc&quot;,</span><br><span class="line">            &quot;size&quot;: 25205239,</span><br><span class="line">            &quot;url&quot;: &quot;https://github.com/espressif/binutils-gdb/releases/download/esp-gdb-v11.2_20220823/xtensa-esp-elf-gdb-11.2_20220823-arm-linux-gnueabi.tar.gz&quot;</span><br><span class="line">          &#125;,</span><br><span class="line">          &quot;linux-armhf&quot;: &#123;</span><br><span class="line">            &quot;sha256&quot;: &quot;53a142b9a508a8babe6b7edf3090bb49e3714380ba819b54052425fcf1ac6f9c&quot;,</span><br><span class="line">            &quot;size&quot;: 23491575,</span><br><span class="line">            &quot;url&quot;: &quot;https://github.com/espressif/binutils-gdb/releases/download/esp-gdb-v11.2_20220823/xtensa-esp-elf-gdb-11.2_20220823-arm-linux-gnueabihf.tar.gz&quot;</span><br><span class="line">...</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="ESP32ç½‘ç»œé—®é¢˜"><a href="#ESP32ç½‘ç»œé—®é¢˜" class="headerlink" title="ESP32ç½‘ç»œé—®é¢˜"></a>ESP32ç½‘ç»œé—®é¢˜</h2><p><strong>åŸºæœ¬å¤–è®¾</strong>ï¼š<code>camera: OV3660</code> + <code>LCD: ILI9341</code></p>
<ul>
<li>å½“å‰<code>IDF5.4</code>ç‰ˆæœ¬åœ¨é…ç½®æ—¶å¯ä»¥è¿æ¥ä¸‹è½½ç»„ä»¶ï¼Œä½†æ˜¯æœ‰æ—¶å€™ç½‘ç»œä¸å¥½ï¼Œè¿æ¥è¶…æ—¶ã€‚</li>
</ul>
<ol>
<li><p>ä¿®æ”¹ <code>Git</code> çš„ <code>URL</code> ä¸ºé•œåƒæºï¼ˆå¦‚ <code>Gitee</code>ï¼‰</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ä¿®æ”¹ Git çš„ URL ä¸ºé•œåƒæºï¼ˆå¦‚ Giteeï¼‰</span></span><br><span class="line">git config --global url.&quot;git@github.com:espressif/esp32-camera.git&quot;.insteadOf &quot;https://github.com/espressif/esp32-camera.git&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æŸ¥çœ‹å½“å‰ Git çš„ URL æ›¿æ¢è§„åˆ™</span></span><br><span class="line">git config --global --get-regexp &quot;url\..*\.insteadOf&quot;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">åˆ é™¤ Gitee é•œåƒçš„æ›¿æ¢è§„åˆ™</span></span><br><span class="line">git config --global --unset url.&quot;https://gitee.com/espressif/esp32-camera.git&quot;.insteadOf</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æˆ–è€…ç›´æ¥ä¿®æ”¹å› GitHub å®˜æ–¹æºï¼ˆå¯é€‰ï¼‰</span></span><br><span class="line">git config --global url.&quot;https://github.com/espressif/esp32-camera.git&quot;.insteadOf &quot;git@github.com:espressif/esp32-camera.git&quot;</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>GitHub</code> é™æµï¼šé¢‘ç¹å…‹éš†å¯èƒ½è§¦å‘é™æµï¼Œç¨åå†è¯•ã€‚</p>
</li>
<li><p>ä¸‹è½½ <code>esp32-camera</code></p>
</li>
</ol>
<ul>
<li>ä» <code>GitHub</code> ç›´æ¥ä¸‹è½½å‹ç¼©åŒ…ï¼š<a href="https://github.com/espressif/esp32-camera/archive/refs/heads/master.zip">https://github.com/espressif/esp32-camera/archive/refs/heads/master.zip</a></li>
<li>è§£å‹åæ”¾åˆ° <code>ESP-IDF</code> çš„ç»„ä»¶ç›®å½•ä¸­ï¼š<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">unzip esp32-camera-master.zip</span><br><span class="line">mv esp32-camera-master ~/esp/esp-adf/esp-idf/components/esp32-camera</span><br></pre></td></tr></table></figure></li>
</ul>
<p>ä¿®æ”¹é¡¹ç›®çš„ <code>CMakeLists.txt</code>, ç¡®ä¿é¡¹ç›®èƒ½æ‰¾åˆ°æœ¬åœ°ç»„ä»¶ï¼Œä¾‹å¦‚ï¼š</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">set</span>(EXTRA_COMPONENT_DIRS ~/esp/esp-adf/esp-idf/components/esp32-camera)</span><br></pre></td></tr></table></figure>

<p><strong>å¸¸è§é—®é¢˜å¤„ç†</strong></p>
<ul>
<li>ä¾èµ–æœªæ›´æ–°ï¼šä¿®æ”¹<code>idf_component.yml</code>åéœ€è¿è¡Œ<code>idf.py reconfigure</code>é‡æ–°è§£æã€‚</li>
<li>æœ¬åœ°ç»„ä»¶è¦†ç›–ï¼šè‹¥åŒæ—¶å­˜åœ¨æœ¬åœ°ç»„ä»¶å’Œæ³¨å†Œè¡¨åŒåç»„ä»¶ï¼Œä¼˜å…ˆä½¿ç”¨è·¯å¾„å¼•ç”¨çš„æœ¬åœ°ç‰ˆæœ¬ã€‚</li>
<li>é”æ–‡ä»¶å†²çªï¼šè‹¥<code>dependencies.lock</code>è¢«è¯¯æ”¹ï¼Œåˆ é™¤åé‡æ–°è¿è¡Œ<code>reconfigure</code>å³å¯æ¢å¤ã€‚</li>
</ul>
<h2 id="ESP32å¯¹sdkconfigçš„è§£é‡Š"><a href="#ESP32å¯¹sdkconfigçš„è§£é‡Š" class="headerlink" title="ESP32å¯¹sdkconfigçš„è§£é‡Š"></a>ESP32å¯¹sdkconfigçš„è§£é‡Š</h2><p>å½“<code>IDF</code>çš„ç‰ˆæœ¬ä¸ä¸€æ ·æ—¶ï¼Œ<code>sdkconfig</code>å¦‚æœä¸åŠ ä¿®æ”¹å°±ç›´æ¥ç”¨ï¼Œå¤§æ¦‚ç‡ä¼šè·‘é£ï¼Œéœ€è¦æ ¹æ®å®é™…æƒ…å†µè¿›è¡Œä¿®æ”¹ã€‚</p>
<ul>
<li><p><code>sdkconfig</code></p>
<ul>
<li>å®é™…æ„å»ºæ—¶ç”Ÿæˆçš„æœ€ç»ˆé…ç½®</li>
<li>åˆå¹¶äº†æ‰€æœ‰é»˜è®¤é…ç½®å’Œ<code>menuconfig</code>çš„ä¿®æ”¹</li>
<li>æ˜¯å®é™…ç¼–è¯‘ä½¿ç”¨çš„é…ç½®æ–‡ä»¶</li>
</ul>
</li>
<li><p><code>sdkconfig.defaults</code></p>
<ul>
<li>é¡¹ç›®çº§åˆ«çš„é»˜è®¤é…ç½®</li>
<li>åŒ…å«WiFiå‡­æ®ã€åˆ†åŒºè¡¨ã€ç½‘ç»œè®¾ç½®ç­‰åº”ç”¨å±‚é…ç½®</li>
<li>è¦†ç›–èŠ¯ç‰‡ç‰¹å®šé…ç½®ä¸­çš„éƒ¨åˆ†è®¾ç½®</li>
</ul>
</li>
<li><p><code>sdkconfig.defaults.esp32s3</code></p>
<ul>
<li>èŠ¯ç‰‡ç‰¹å®šçš„é»˜è®¤é…ç½®ï¼ˆé’ˆå¯¹<code>ESP32-S3</code>ï¼‰</li>
<li>åŒ…å«<code>PSRAM</code>é…ç½®ã€ç¼“å­˜è®¾ç½®ã€å¤–è®¾é…ç½®</li>
<li>ä¸»è¦ç”¨äºå®šä¹‰ç¡¬ä»¶ç›¸å…³çš„åŸºç¡€é…ç½®</li>
</ul>
</li>
</ul>
<h2 id="RTSPæ¨æµé—®é¢˜"><a href="#RTSPæ¨æµé—®é¢˜" class="headerlink" title="RTSPæ¨æµé—®é¢˜"></a>RTSPæ¨æµé—®é¢˜</h2><ul>
<li><code>VLC</code>å¯èƒ½è®¤ä¸º<code>192.168.4.2</code>æ˜¯ä¸»æœº<code>IP</code>ï¼Œæ²¡æœ‰è¯·æ±‚<code>192.168.4.1</code>ï¼Œéœ€è¦æ³¨æ„ä¿®æ”¹ã€‚</li>
</ul>
<br>

<h2 id="ESP32S3å¼€å‘æ‘„åƒå¤´æ¨¡ç»„"><a href="#ESP32S3å¼€å‘æ‘„åƒå¤´æ¨¡ç»„" class="headerlink" title="ESP32S3å¼€å‘æ‘„åƒå¤´æ¨¡ç»„"></a>ESP32S3å¼€å‘æ‘„åƒå¤´æ¨¡ç»„</h2><h3 id="ç¼–è¯‘ç¯å¢ƒ"><a href="#ç¼–è¯‘ç¯å¢ƒ" class="headerlink" title="ç¼–è¯‘ç¯å¢ƒ"></a>ç¼–è¯‘ç¯å¢ƒ</h3><ul>
<li><strong>Linux Ubuntu 22.04</strong></li>
<li><strong>ADF v2.7-105-g4200c64d</strong> </li>
<li><strong>IDF v5.4.1-851-gb3d3a82daa</strong></li>
</ul>
<h3 id="åˆ›å»ºä»“åº“ï¼Œè®¾è®¡æ¡†æ¶"><a href="#åˆ›å»ºä»“åº“ï¼Œè®¾è®¡æ¡†æ¶" class="headerlink" title="åˆ›å»ºä»“åº“ï¼Œè®¾è®¡æ¡†æ¶"></a>åˆ›å»ºä»“åº“ï¼Œè®¾è®¡æ¡†æ¶</h3><ul>
<li><p>å¤åˆ¶ä¸€ä¸ª<code>DEMO</code>åˆ›å»ºä»“åº“ï¼Œæœ‰<code>main.c</code>å‡½æ•°ï¼Œèƒ½è·‘é€šã€‚</p>
</li>
<li><p>æ·»åŠ <code>components</code>:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">idf.py -C components create-component lcd_camera</span><br><span class="line">// ä¸‹è½½esp32-cameraç»„ä»¶ï¼Œåœ°å€ï¼šgit@github.com:espressif/esp32-camera.git</span><br><span class="line">mv -rf esp32-camera $&#123;workspaceFolder&#125;/components</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>main</code>æ–‡ä»¶å¤¹é‡Œæ³¨é‡Šæ‰æ³¨é‡Šæ‰<code>idf_component.yml</code>å’Œ<code>Kconfig.projbuild</code>ï¼Œæˆ‘ä»¬è¿™é‡Œæš‚æ—¶ä¸ä½¿ç”¨è‡ªåŠ¨ä¸‹è½½ä¾èµ–å·¥å…·å’Œ<code>idf.py menuconfig</code>é…ç½®ï¼Œåå‘ç°å…¶ä»–ç»„ä»¶å¦‚<code>esp32-camera</code>ç»„ä»¶ä¸­ä¹Ÿä¼šæœ‰<code>.yml</code>æ–‡ä»¶ï¼Œæš‚æ—¶ä»ç½‘ä¸Šæ›´æ–°æ‹‰å–ä¾èµ–ï¼ŒåæœŸå†åšéš”ç¦»ã€‚</p>
</li>
<li><p>ç¼–å†™é¡¶å±‚<code>CmakeLists.txt</code>ï¼Œæ³¨æ„ï¼Œ<code>ESP-IDF</code>æ„å»ºç³»ç»Ÿå¹¶ä¸ä¼šè‡ªåŠ¨ä¸ºæ¯ä¸ªç»„ä»¶æ·»åŠ æ‰€æœ‰ä¾èµ–å…³ç³»ï¼Œéœ€è¦æ˜¾å¼åœ°å‘Šè¯‰<code>CMake</code>æ¯ä¸ªç»„ä»¶ä¾èµ–è°ï¼Œä»¥ä¸‹ä¾¿æ˜¯ä¼šæ‰«æè¿™äº›è·¯å¾„ï¼Œçœ‹çœ‹é‡Œé¢æœ‰æ²¡æœ‰ç»„ä»¶ï¼ˆ<code>components</code>ï¼‰,ä½†æ˜¯è¿˜éœ€è¦å†æ–‡ä»¶ä½¿ç”¨æ—¶æ·»åŠ ä¾èµ–çš„ç»„ä»¶ï¼Œå¦‚ï¼š<code>REQUIRES esp_wifi</code>ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">cmake_minimum_required(VERSION 3.5)</span><br><span class="line"></span><br><span class="line">include($ENV&#123;ADF_PATH&#125;/CMakeLists.txt)</span><br><span class="line">include($ENV&#123;IDF_PATH&#125;/tools/cmake/project.cmake)</span><br><span class="line"></span><br><span class="line"># file(GLOB_RECURSE SOURCES &quot;main/*.c&quot;)</span><br><span class="line"># set(EXTRA_COMPONENT_DIRS &quot;components&quot;)</span><br><span class="line"></span><br><span class="line">set(EXTRA_COMPONENT_DIRS</span><br><span class="line">    components</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">project(camera_test)</span><br></pre></td></tr></table></figure></li>
<li><p>ä»¥ä¸Šå¯åˆ†ä¸ºä¸‰æ­¥ï¼š</p>
<ul>
<li><code>set(EXTRA_COMPONENT_DIRS ...)</code>å‘Šè¯‰<code>CMake</code>å“ªé‡Œæœ‰ç»„ä»¶ç›®å½•ï¼Œä»…æ˜¯å¯è§èŒƒå›´ï¼Œä¸ä»£è¡¨ä½¿ç”¨ã€‚</li>
<li><code>idf_component_register()</code>å£°æ˜ä¸€ä¸ªç»„ä»¶ï¼ˆæ¨¡å—ï¼‰ï¼Œå¿…é¡»æœ‰ï¼Œæ‰èƒ½è¢«å½“æˆç»„ä»¶å¤„ç†ã€‚</li>
<li><code>PRIV_REQUIRES</code> &#x2F; <code>REQUIRES</code>æ˜¾å¼å£°æ˜æˆ‘ä¾èµ–è°ï¼Œå¿…é¡»æ‰‹åŠ¨å†™ï¼Œå¦åˆ™é“¾æ¥å¤±è´¥æˆ–å¤´æ–‡ä»¶æ‰¾ä¸åˆ°ã€‚</li>
</ul>
<p><strong>å»ºè®®</strong>ï¼šå¯ä»¥ä¿æŒ<code>EXTRA_COMPONENT_DIRS</code>å†™æ³•ç”¨äºç»„ä»¶æ‰«æï¼›ä½†æ¯ä¸€ä¸ª<code>.c</code>æ–‡ä»¶æ‰€åœ¨ç»„ä»¶ï¼Œéƒ½å¿…é¡»æœ‰è‡ªå·±æ˜ç¡®ä¾èµ–çš„ç»„ä»¶å£°æ˜ã€‚</p>
</li>
</ul>
<br>

<ul>
<li><code>main</code>ä¸»æ–‡ä»¶å¤¹çš„<code>CmakeLists.txt</code>:<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">idf_component_register(</span><br><span class="line">    SRCS &quot;main.c&quot;</span><br><span class="line">    INCLUDE_DIRS &quot;.&quot;</span><br><span class="line"></span><br><span class="line">    REQUIRES</span><br><span class="line">        lcd_camera</span><br><span class="line">        wifi_softap</span><br><span class="line">        rtsp_server</span><br><span class="line">        http_server</span><br><span class="line">        web_mjpeg_server</span><br><span class="line">)</span><br></pre></td></tr></table></figure></li>
</ul>
<br>

<p>âš¡ ä¸ºä»€ä¹ˆ <code>main</code> é‡Œä¸éœ€è¦ <code>REQUIRES</code>ï¼Œåœ¨å…¶ä»–ç»„ä»¶éœ€è¦æ‰‹åŠ¨æ·»åŠ ä¾èµ–ï¼Ÿ</p>
<ul>
<li>å› ä¸º <code>main</code> æ˜¯ç‰¹æ®Šç»„ä»¶ï¼Œå®ƒä¼šè‡ªåŠ¨çœ‹åˆ°æ•´ä¸ªå·¥ç¨‹çš„å…¬å…± <code>include path</code> å’Œé“¾æ¥åº“ã€‚</li>
<li>ä½†å•ç‹¬ç»„ä»¶è¦è®¿é—®å…¶å®ƒç»„ä»¶çš„ <code>API</code>ï¼Œå°±å¿…é¡»åœ¨ <code>idf_component_register</code> é‡Œ <code>REQUIRES</code> æŒ‡æ˜ä¾èµ–ã€‚</li>
</ul>
<p><strong>è‡ªåŠ¨ä¾èµ–ä¸æ˜¾å¼ä¾èµ–çš„åŒºåˆ«</strong>:</p>
<ul>
<li><code>main</code>é‡Œæ²¡å†™ <code>REQUIRES/PRIV_REQUIRES</code>ï¼Œå°±åƒâ€œæ”¾å¼€æ‰‹è„šï¼Œæ‰«ææ‰€æœ‰èƒ½æ‰¾åˆ°çš„ç»„ä»¶â€ï¼Œæ‰€ä»¥å¯èƒ½åŒ…å«äº† <code>esp_http_server</code>ã€‚</li>
<li><code>main</code>é‡Œå†™äº† <code>REQUIRES/PRIV_REQUIRES</code>ï¼Œå°±åƒâ€œé™å®šåªæ‰«æä½ æŒ‡å®šçš„ç»„ä»¶åŠä¾èµ–â€ï¼Œæ²¡å†™çš„ç»„ä»¶ä¸ä¼šè¢«æ‰«æã€‚</li>
</ul>
<p><strong>å¤§è‡´æŸ¥æ‰¾é¡ºåºæ˜¯è¿™æ ·</strong>ï¼š</p>
<ol>
<li>é¡¹ç›®æœ¬åœ°ç»„ä»¶ç›®å½•</li>
</ol>
<ul>
<li>é»˜è®¤æ˜¯é¡¹ç›®æ ¹ç›®å½•ä¸‹çš„ <code>components/</code> æ–‡ä»¶å¤¹ï¼Œ æ­¤ç›®å½•ä¸ºé»˜è®¤ç»„ä»¶ç›®å½•ï¼Œ<code>set(EXTRA_COMPONENT_DIRS xxx)</code>æ—¶å¯ä¸æ·»åŠ ã€‚</li>
<li>å¦‚æœè®¾ç½®äº† <code>EXTRA_COMPONENT_DIRS</code>ï¼Œä¹Ÿä¼šä¼˜å…ˆæŒ‰é¡ºåºåœ¨è¿™äº›è·¯å¾„é‡ŒæŸ¥æ‰¾</li>
</ul>
<ol start="2">
<li><code>ESP-IDF</code> è‡ªå¸¦ç»„ä»¶ç›®å½•</li>
</ol>
<ul>
<li>å³ <code>$IDF_PATH/components</code></li>
</ul>
<ol start="3">
<li>é€šè¿‡ <code>idf.py add-dependency</code> æˆ– <code>dependencies.lock</code> ä¸‹è½½çš„ <code>managed_components</code></li>
</ol>
<ul>
<li>å­˜æ”¾åœ¨ <code>managed_components/</code> ä¸­,è¿™äº›ä¼˜å…ˆçº§æ¯” <code>IDF</code> å†…ç½®é«˜ï¼Œä½†ä½äºé¡¹ç›®æœ¬åœ°ç»„ä»¶</li>
</ul>
<p><strong>ç°åœ¨æœ‰ä¸¤ç§æ–¹æ³•</strong>ï¼š</p>
<ol>
<li>åœ¨çº¿æ–¹æ³•ï¼šä¿ç•™<code>managed_components</code>ï¼Œåœ¨ç¼–è¯‘çš„æ—¶å€™ä¼šå¯¹æ¯”ç½‘ä¸Šæ‹‰å–çš„æœ€æ–°å›ºä»¶ç‰ˆæœ¬ï¼Œå¹¶æ›´æ–°ï¼Œæ— ç½‘ç»œæ—¶æœ‰é£é™©ã€‚</li>
<li>ç¦»çº¿æ–¹æ³•ï¼šæ–°å»º<code>offline_components</code>ï¼Œæ‹·è´<code>managed_components</code>çš„æ‰€æœ‰æ•°æ®åˆ°<code>offline_components</code>ï¼Œåˆ é™¤<code>managed_components</code>ï¼Œåœ¨é¡¶å±‚<code>CmakeLists.txt</code>ä¸­æ·»åŠ ï¼Œä½†å¯èƒ½ç»„ä»¶æ›´æ–°ä¸åŠæ—¶ï¼Œè½åä¸»åˆ†æ”¯ï¼š<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">set(EXTRA_COMPONENT_DIRS</span><br><span class="line">	&quot;components&quot;</span><br><span class="line">	&quot;offline_components&quot;		 # æ·»åŠ ç¦»çº¿ç»„ä»¶è·¯å¾„</span><br><span class="line">	&quot;$ENV&#123;ADF_PATH&#125;/components&quot;  # æ˜¾å¼æ·»åŠ ESP-ADFç»„ä»¶è·¯å¾„, ä¸Šé¢ include($ENV&#123;ADF_PATH&#125;/CMakeLists.txt) æœªç”Ÿæ•ˆ</span><br><span class="line">)</span><br></pre></td></tr></table></figure></li>
</ol>
<p>**ç‰¹åˆ«çš„è§£é‡Š(è§£é‡ŠADF_PATHç¯å¢ƒä¸­çš„componentsæœªç”Ÿæ•ˆ)**ï¼š</p>
<ul>
<li><code>ADF_PATH/CMakeLists.txt</code> â†’ åŠ è½½ <code>ADF</code> çš„æ„å»ºé€»è¾‘ï¼ˆä¸ä¸€å®šåŒ…å«ç»„ä»¶è·¯å¾„ï¼‰ã€‚</li>
<li><code>EXTRA_COMPONENT_DIRS += ADF_PATH/components</code> â†’ ç¡®ä¿ <code>ADF</code> ç»„ä»¶èƒ½è¢«æ‰¾åˆ°ã€‚</li>
<li>å¦‚æœå»æ‰ <code>ADF_PATH/components</code>ï¼Œå¯èƒ½ä¼šå¯¼è‡´ éƒ¨åˆ† <code>ADF</code> ç»„ä»¶æ— æ³•è¢«æ‰«æåˆ°ï¼Œç¼–è¯‘æ—¶æŠ¥é”™ã€‚</li>
</ul>
<br>

<h2 id="æµåª’ä½“åè®®å…¨è§£æï¼šRTSP-RTP-TCP-UDP"><a href="#æµåª’ä½“åè®®å…¨è§£æï¼šRTSP-RTP-TCP-UDP" class="headerlink" title="æµåª’ä½“åè®®å…¨è§£æï¼šRTSP&#x2F;RTP&#x2F;TCP&#x2F;UDP"></a>æµåª’ä½“åè®®å…¨è§£æï¼šRTSP&#x2F;RTP&#x2F;TCP&#x2F;UDP</h2><h2 id="æ‘„åƒå¤´æ¨æµé—®é¢˜æ±‡æ€»"><a href="#æ‘„åƒå¤´æ¨æµé—®é¢˜æ±‡æ€»" class="headerlink" title="æ‘„åƒå¤´æ¨æµé—®é¢˜æ±‡æ€»"></a>æ‘„åƒå¤´æ¨æµé—®é¢˜æ±‡æ€»</h2><ol>
<li><strong>å¯èƒ½çš„é—®é¢˜ç‚¹</strong>ï¼š</li>
</ol>
<ul>
<li>å¸§ç‡æ§åˆ¶é—®é¢˜ï¼š<ul>
<li>å½“å‰å®ç°æ²¡æœ‰ç¨³å®šçš„å¸§ç‡æ§åˆ¶</li>
<li>å¸§é—´éš”è®¡ç®—ä¸å‡†ç¡®å¯¼è‡´ç”»é¢æŠ–åŠ¨</li>
</ul>
</li>
<li>RTPæ—¶é—´æˆ³é”™è¯¯ï¼š<ul>
<li>æ—¶é—´æˆ³å•ä½ä¸æ­£ç¡®ï¼ˆåº”è¯¥æ˜¯<code>90kHz</code>ï¼‰</li>
<li>æ—¶é—´æˆ³å¢é‡ä¸å›ºå®šå¯¼è‡´ç”»é¢æŠ–åŠ¨</li>
</ul>
</li>
<li>JPEGå¤´æ ¼å¼é—®é¢˜ï¼š<ul>
<li>ç±»å‹ç‰¹å®š(<code>type specific</code>)å­—æ®µéœ€è¦æ­£ç¡®è®¾ç½®</li>
<li><code>Q</code>å› å­è®¾ç½®ä¸åˆç†</li>
</ul>
</li>
<li>ç½‘ç»œç¨³å®šæ€§:<ul>
<li><code>UDP</code>å‘é€ç¼“å†²åŒºä¸è¶³</li>
<li>ç¼ºå°‘é‡ä¼ æœºåˆ¶</li>
</ul>
</li>
</ul>
<br>

<ol start="2">
<li><strong>åˆ†æè°ƒè¯•</strong>ï¼š</li>
</ol>
<ul>
<li><p><code>frame2jpg(fb, 60, &amp;jpeg_buf, &amp;jpeg_len)</code>è¿™ä¸ªå‡½æ•°è½¬æ¢éœ€è¦<code>100ms~150ms</code>ï¼Œå¾ˆæ…¢ã€‚<code>PIXFORMAT_RGB565</code>é€‚åˆLCDæ˜¾ç¤ºï¼›<code>PIXFORMAT_JPEG</code>ï¼Œåªæ¨æµä¸æ˜¾ç¤ºé€Ÿåº¦ä¼šå¿«å¾ˆå¤šï¼ŒåŒæ—¶æœ‰ä»¥ä¸‹é—®é¢˜ã€‚</p>
<br>
</li>
<li><p><code>camera</code>ç¡¬ä»¶è§£ç ï¼ˆ<code>PIXFORMAT_JPEG</code>ï¼‰<code>VLC</code>æ˜¾ç¤ºé—ªå±ï¼š</p>
<ul>
<li>å·²æ’é™¤<code>errno=12</code> å¯¹åº” <code>ENOMEM</code>ï¼Œå³ç³»ç»Ÿå†…å­˜ä¸è¶³ï¼ˆå°¤å…¶æ˜¯ <code>LWIP UDP</code> å‘é€ç¼“å†²åŒºï¼‰ã€‚è¿™è¯´æ˜ <code>UDP</code> å‘é€ç¼“å†²åŒºæˆ–å †å†…å­˜å‹åŠ›è¿‡å¤§ï¼Œå¯¼è‡´ <code>RTP</code> æ•°æ®åŒ…å‘é€å¤±è´¥ï¼Œä»è€Œå®¢æˆ·ç«¯æ’­æ”¾æ—¶å¡é¡¿é—ªå±ã€‚</li>
<li>å·²æ’é™¤<code>Quant Table</code> ç¼ºå¤±<code>ï¼ˆqâ‰ 0ï¼‰</code></li>
<li>å·²æ’é™¤<code>VLC</code> æ’­æ”¾å™¨é—®é¢˜</li>
<li>å·²æ’é™¤<code>AP/UDP</code> ç½‘ç»œä¸ç¨³å®š</li>
<li>å·²æ’é™¤ <code>JPEG</code> æ•°æ®ä¸å®Œæ•´<br></li>
</ul>
</li>
<li><p>è°ƒè¯•å‘ç°ä¸<code>RTP JPEG Type</code>æœ‰å¾ˆå¤§å…³ç³»ï¼Œé—®é¢˜æµ‹è¯•è¿‡ç¨‹å¦‚ä¸‹ï¼š</p>
</li>
</ul>
<table>
<thead>
<tr>
<th>å›¾åƒæ¥æº</th>
<th>JPEG ç±»å‹å†…å®¹</th>
<th>RTP JPEG Type</th>
<th>æ˜¯å¦é—ªå±</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td>æ‘„åƒå¤´åŸç”Ÿ JPEG</td>
<td>åŒ…å« DQT&#x2F;DHT</td>
<td><code>Type = 0</code></td>
<td>âŒ ä¸é—ªå±</td>
<td>âœ… æ­£ç¡®</td>
</tr>
<tr>
<td>æ‘„åƒå¤´åŸç”Ÿ RGB565</td>
<td>æ—  JPEG</td>
<td><code>Type = 1</code></td>
<td>âŒ ä¸é—ªå±</td>
<td>âœ… æ­£ç¡®</td>
</tr>
<tr>
<td>JPEG â†’ RGB565 â†’ RTP</td>
<td>åŸå›¾æœ‰ DQT&#x2F;DHT</td>
<td><code>Type = 0</code></td>
<td>âš ï¸ é—ªå±</td>
<td>âŒ é”™è¯¯</td>
</tr>
<tr>
<td>JPEG â†’ RGB565 â†’ RTP</td>
<td>åŸå›¾æœ‰ DQT&#x2F;DHT</td>
<td><code>Type = 1</code></td>
<td>âŒ ä¸é—ªå±</td>
<td>âœ… æ­£ç¡®</td>
</tr>
<tr>
<td>RGB565 â†’ è½¯ä»¶ JPEG ç¼–ç </td>
<td>ç¼–ç åŒ…å« DQT&#x2F;DHT</td>
<td><code>Type = 0</code></td>
<td>âŒ ä¸é—ªå±</td>
<td>âœ… æ­£ç¡®</td>
</tr>
<tr>
<td>RGB565 â†’ è½¯ä»¶ JPEG ç¼–ç </td>
<td>ç¼–ç åŒ…å« DQT&#x2F;DHT</td>
<td><code>Type = 1</code></td>
<td>âš ï¸ é—ªå±</td>
<td>âŒ é”™è¯¯</td>
</tr>
</tbody></table>
<br>

<ul>
<li><code>RTP JPEG Type</code> è®¾ç½®é”™è¯¯å¸¦æ¥çš„è§£ç è¡Œä¸ºï¼š</li>
</ul>
<table>
<thead>
<tr>
<th>Type å€¼</th>
<th>VLC ç­‰æ’­æ”¾å™¨è¡Œä¸º</th>
</tr>
</thead>
<tbody><tr>
<td><code>Type = 0</code></td>
<td>æ’­æ”¾å™¨ä½¿ç”¨ JPEG å†…åµŒçš„ DQT&#x2F;DHT è¡¨è¿›è¡Œè§£ç ï¼ˆéœ€ JPEG åŒ…å«å®Œæ•´å¤´ï¼‰</td>
</tr>
<tr>
<td><code>Type = 1</code></td>
<td>æ’­æ”¾å™¨ä½¿ç”¨é»˜è®¤å†…ç½®è¡¨ï¼ˆRFC2435 é™„å½•ï¼‰è¿›è¡Œè§£ç ï¼Œå¿½ç•¥å›¾åƒä¸­ DQT</td>
</tr>
</tbody></table>
<p>âœ…<strong>æ ¸å¿ƒæ¨è®º</strong>ï¼šğŸš¨ ä¸ç®¡å›¾åƒæ¥æºæ˜¯å¦æ˜¯ <code>JPEG</code>ï¼Œå¦‚æœä½ ç”¨ <code>RTP Type = 0</code>ï¼Œå°±å¿…é¡»ç¡®ä¿ <code>JPEG</code> ä¸­åŒ…å« <code>DQT/DHT</code>ï¼å¦åˆ™ <code>VLC</code> ä¼šé—ªå±ï¼Ÿ</p>
<ul>
<li>æ·»åŠ æ‰“å°ä»¥éªŒè¯åˆ†æç†è®ºï¼š</li>
<li>å‰ç½®æ¡ä»¶ï¼š<code>RGB565</code> â†’ è½¯ä»¶ <code>JPEG</code> ç¼–ç ; <code>type = 0</code>ã€‚<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">// æ£€æµ‹ JPEG æ˜¯å¦åŒ…å« DQT æ®µ (0xFFDB)</span></span><br><span class="line"><span class="type">static</span> <span class="type">bool</span> <span class="title function_">jpeg_has_dqt</span><span class="params">(<span class="type">const</span> <span class="type">uint8_t</span> *data, <span class="type">size_t</span> len)</span> &#123;</span><br><span class="line">    <span class="type">size_t</span> i = <span class="number">2</span>; <span class="comment">// è·³è¿‡ SOI 0xFFD8</span></span><br><span class="line">    <span class="keyword">while</span> (i + <span class="number">4</span> &lt;= len) &#123;</span><br><span class="line">        <span class="keyword">if</span> (data[i] != <span class="number">0xFF</span>) &#123;</span><br><span class="line">            <span class="comment">// éæ³• marker</span></span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">uint8_t</span> marker = data[i + <span class="number">1</span>];</span><br><span class="line">        <span class="comment">// 0xFFDA æ˜¯ SOSï¼Œä¹‹åæ˜¯å‹ç¼©æ•°æ®æ®µï¼Œä¸å†æŸ¥æ‰¾</span></span><br><span class="line">        <span class="keyword">if</span> (marker == <span class="number">0xDA</span>) &#123;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è·³è¿‡å¡«å……çš„ 0xFFï¼ˆåˆæ³• JPEG å…è®¸å¤šä¸ªï¼‰</span></span><br><span class="line">        <span class="keyword">while</span> (marker == <span class="number">0xFF</span> &amp;&amp; i + <span class="number">2</span> &lt; len) &#123;</span><br><span class="line">            i++;</span><br><span class="line">            marker = data[i + <span class="number">1</span>];</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// marker é•¿åº¦å­—æ®µä½äº i+2ï¼Œ2 å­—èŠ‚</span></span><br><span class="line">        <span class="keyword">if</span> (i + <span class="number">4</span> &gt; len) <span class="keyword">break</span>;</span><br><span class="line">        <span class="type">uint16_t</span> segment_length = (data[i + <span class="number">2</span>] &lt;&lt; <span class="number">8</span>) | data[i + <span class="number">3</span>];</span><br><span class="line">        <span class="keyword">if</span> (segment_length &lt; <span class="number">2</span>) <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (marker == <span class="number">0xDB</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>; <span class="comment">// DQT æ‰¾åˆ°äº†</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        i += <span class="number">2</span> + segment_length;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">... ...</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ£€æµ‹æ˜¯å¦åŒ…å« DQTï¼Œå†³å®š RTP JPEG Type (åœ¨æ ¡éªŒå®ŒæŠ¥å¤´æ—¶æ‰“å°)</span></span><br><span class="line">	<span class="type">bool</span> has_dqt = jpeg_has_dqt(jpeg, len);</span><br><span class="line">	<span class="type">uint8_t</span> type = has_dqt ? <span class="number">0</span> : <span class="number">1</span>;</span><br><span class="line">	ESP_LOGI(TAG, <span class="string">&quot;JPEG header: %02X %02X, has_dqt=%s â†’ type=%d&quot;</span>, jpeg[<span class="number">0</span>], jpeg[<span class="number">1</span>], has_dqt ? <span class="string">&quot;YES&quot;</span> : <span class="string">&quot;NO&quot;</span>, type);</span><br><span class="line"></span><br><span class="line">... ...</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ‰“å°ç»“æœè¯´æ˜å…·æœ‰0xFFD8ï¼ŒåŒ…å«DQTã€‚</span></span><br><span class="line">I (<span class="number">19451</span>) RTSP_SERVER: JPEG header: FF D8, has_dqt=YES â†’ type=<span class="number">0</span></span><br></pre></td></tr></table></figure></li>
</ul>
<br>

<ul>
<li>å‰ç½®æ¡ä»¶ï¼š<code>RGB565</code> â†’ è½¯ä»¶ <code>JPEG</code> ç¼–ç ; <code>type = 1</code>ã€‚<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">// æ‰“å°ç»“æœè¯´æ˜å…·æœ‰0xFFD8ï¼ŒåŒ…å«DQTã€‚</span><br><span class="line">I (19451) RTSP_SERVER: JPEG header: FF D8, has_dqt=YES â†’ type=0</span><br></pre></td></tr></table></figure></li>
</ul>
<br>

<ul>
<li>ç»“è®ºï¼šæœ‰ <code>DQT â‰ </code> å¯ä»¥ç”¨ <code>type=0</code>ï¼Œåªæœ‰ æ‘„åƒå¤´ç”Ÿæˆçš„æ ‡å‡† <code>JPEG</code>ï¼ˆå®Œå…¨æŒ‰<code> MJPEG over RTP</code> è§„èŒƒå‹ç¼©çš„ï¼‰æ‰èƒ½ç¨³å®šä½¿ç”¨ <code>type=0</code>ï¼Œå¦åˆ™å¿…é¡»ä½¿ç”¨ <code>type=1</code>ã€‚</li>
</ul>
<br>

<ol start="3">
<li><strong>ç»“è®ºæ€»ç»“</strong>ï¼š</li>
</ol>
<br>

<h2 id="ESP32S3å¶å‘æ€§é‡å¯"><a href="#ESP32S3å¶å‘æ€§é‡å¯" class="headerlink" title="ESP32S3å¶å‘æ€§é‡å¯"></a>ESP32S3å¶å‘æ€§é‡å¯</h2><p><strong>idf.py menuconfig</strong>:</p>
<ul>
<li><p>Component config â†’ LWIP â†’ TCP -&gt; (65535) Default send buffer size</p>
</li>
<li><p>Component config â€”&gt; HTTP Server â€”&gt; [*] WebSocket server support (CONFIG_HTTPD_WS_SUPPORT&#x3D;y)</p>
</li>
<li><p>ä¼šå‡ºç°é‡å¯ã€ä¼ è¾“æ—¶é˜»å¡å¡æ­»ã€ç”»é¢å¡ä½ä»¥ä¸‹æ˜¯å¸¸è§çš„<code>error</code>æ—¥å¿—ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">I (782633) RTSP_SERVER: Streaming: 10 FPS, 50 pkts, 5619 bytes, 0 errs (0.0%)</span><br><span class="line">W (782833) RTSP_SERVER: Sendto failed at offset 2760, errno=12 (Not enough space)</span><br><span class="line">W (782833) RTSP_SERVER: Non-first packet failed at offset 2760, continuing</span><br><span class="line">W (782843) RTSP_SERVER: Sendto failed at offset 4140, errno=12 (Not enough space)</span><br><span class="line">W (782843) RTSP_SERVER: Non-first packet failed at offset 4140, continuing</span><br><span class="line">W (782853) RTSP_SERVER: Sendto failed at offset 5520, errno=12 (Not enough space)</span><br><span class="line">W (782863) RTSP_SERVER: Non-first packet failed at offset 5520, continuing</span><br><span class="line">W (782963) RTSP_SERVER: Sendto failed at offset 0, errno=12 (Not enough space)</span><br><span class="line">... ...</span><br><span class="line">E (560523) RTSP_SERVER: Fatal send error: errno=-1</span><br><span class="line">W (560523) RTSP_SERVER: Sendto failed at offset 0, errno=-1 ()</span><br><span class="line">W (560523) RTSP_SERVER: Drop frame due to send failure at offset 0 (critical)</span><br><span class="line">... ...</span><br><span class="line">W (1638) cam_hal: NO-SOI</span><br><span class="line">Guru Meditation Error: Core  0 panic&#x27;ed (LoadProhibited). Exception was unhandled.</span><br><span class="line"></span><br><span class="line">Core  0 register dump:</span><br><span class="line">PC      : 0x4037770b  PS      : 0x00060033  A0      : 0x8201981a  A1      : 0x3fc9e0c0  </span><br><span class="line">--- 0x4037770b: ll_cam_send_event at /home/ubuntu/esp/work/camera_test/managed_components/esp32-camera/driver/cam_hal.c:107</span><br><span class="line"></span><br><span class="line">A2      : 0x00060523  A3      : 0x00000001  A4      : 0x3fc9e0f0  A5      : 0x3fcad5f0  </span><br><span class="line">A6      : 0x00060d23  A7      : 0x00000000  A8      : 0x03c9bc78  A9      : 0x01ffffff  </span><br><span class="line">A10     : 0x3fc9bc78  A11     : 0x3fc9e0c0  A12     : 0x3fc9e0f0  A13     : 0x00000000  </span><br><span class="line">A14     : 0x3fc9c604  A15     : 0x0000cdcd  SAR     : 0x00000000  EXCCAUSE: 0x0000001c  </span><br><span class="line">EXCVADDR: 0x0006054b  LBEG    : 0x00000000  LEND    : 0x00000000  LCOUNT  : 0x00000000  </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Backtrace: 0x40377708:0x3fc9e0c0 0x42019817:0x3fc9e0f0 0x40376ae1:0x3fc9e120 0x40377d3d:0x3fc9e140 0x4037b66b:0x3fcad660 0x42004db6:0x3fcad680 0x403801f1:0x3fcad6a0 0x4037f04d:0x3fcad6c0</span><br><span class="line">--- 0x40377708: ll_cam_send_event at /home/ubuntu/esp/work/camera_test/managed_components/esp32-camera/driver/cam_hal.c:107</span><br><span class="line">--- 0x42019817: ll_cam_vsync_isr at /home/ubuntu/esp/work/camera_test/managed_components/esp32-camera/target/esp32s3/ll_cam.c:106</span><br><span class="line">--- 0x40376ae1: shared_intr_isr at /home/ubuntu/esp/esp-adf/esp-idf/components/esp_hw_support/intr_alloc.c:464</span><br><span class="line">--- 0x40377d3d: _xt_lowint1 at /home/ubuntu/esp/esp-adf/esp-idf/components/xtensa/xtensa_vectors.S:1240</span><br><span class="line">--- 0x4037b66b: xt_utils_wait_for_intr at /home/ubuntu/esp/esp-adf/esp-idf/components/xtensa/include/xt_utils.h:82</span><br><span class="line">---  (inlined by) esp_cpu_wait_for_intr at /home/ubuntu/esp/esp-adf/esp-idf/components/esp_hw_support/cpu.c:55</span><br><span class="line">--- 0x42004db6: esp_vApplicationIdleHook at /home/ubuntu/esp/esp-adf/esp-idf/components/esp_system/freertos_hooks.c:58</span><br><span class="line">--- 0x403801f1: prvIdleTask at /home/ubuntu/esp/esp-adf/esp-idf/components/freertos/FreeRTOS-Kernel/tasks.c:4341 (discriminator 1)</span><br><span class="line">--- 0x4037f04d: vPortTaskWrapper at /home/ubuntu/esp/esp-adf/esp-idf/components/freertos/FreeRTOS-Kernel/portable/xtensa/port.c:139</span><br><span class="line"></span><br><span class="line">ELF file SHA256: 6ae9a007e</span><br><span class="line"></span><br><span class="line">Rebooting...</span><br><span class="line">ï¿½ï¿½ï¿½ESP-ROM:esp32s3-20210327</span><br><span class="line">Build:Mar 27 2021</span><br><span class="line">rst:0xc (RTC_SW_CPU_RST),boot:0x28 (SPI_FAST_FLASH_BOOT)</span><br><span class="line">Saved PC:0x40375da1</span><br><span class="line">--- 0x40375da1: esp_restart_noos at /home/ubuntu/esp/esp-adf/esp-idf/components/esp_system/port/soc/esp32s3/system_internal.c:162</span><br><span class="line">... ...</span><br><span class="line"></span><br><span class="line">W (18220) cam_hal: FB-OVF</span><br><span class="line">W (18310) cam_hal: FB-OVF</span><br><span class="line">W (18320) cam_hal: NO-EOI</span><br><span class="line">E (18320) lcd_camera: hardware jpeg get failed!</span><br><span class="line">W (18330) cam_hal: FB-OVF</span><br><span class="line">W (18460) cam_hal: FB-OVF</span><br><span class="line">W (18460) cam_hal: NO-EOI</span><br><span class="line">W (18470) cam_hal: FB-OVF</span><br></pre></td></tr></table></figure>
</li>
<li><p>æ³¨é‡Šæ³•ï¼Œè½®æµæ³¨é‡Š<code>camera</code>å’Œ<code>ä½œå¯¹æ¯”</code>ã€‚</p>
<ul>
<li>ç”¨<code>JPEG</code>æ ¼å¼ï¼ˆ<code>PIXFORMAT_JPEG</code>ï¼‰é‡‡é›†æ•°æ®ä¼šæœ‰æ¦‚ç‡é‡å¯?</li>
</ul>
</li>
<li><p><code>jpeg</code>è½¬æ¢æˆ<code>rgb565</code>ï¼Œå‚æ•°è·Ÿ<code>demo</code>æœ‰ç‚¹ä¸åŒ.</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">// jpg2rgb565åŸå§‹å‡½æ•°æ˜¾ç¤ºèŠ±å±ï¼Œéœ€è¦.flags.swap_color_bytes = 1</span></span><br><span class="line"><span class="type">static</span> <span class="type">uint8_t</span> work[<span class="number">3100</span>];</span><br><span class="line"><span class="type">bool</span> <span class="title function_">myjpg2rgb565</span><span class="params">(<span class="type">const</span> <span class="type">uint8_t</span> *src, <span class="type">size_t</span> src_len, <span class="type">uint8_t</span> * out, <span class="type">esp_jpeg_image_scale_t</span> scale)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">esp_jpeg_image_cfg_t</span> jpeg_cfg = &#123;</span><br><span class="line">        .indata = (<span class="type">uint8_t</span> *)src,</span><br><span class="line">        .indata_size = src_len,</span><br><span class="line">        .outbuf = out,</span><br><span class="line">        .outbuf_size = UINT32_MAX, <span class="comment">// @todo: this is very bold assumption, keeping this like this for now, not to break existing code</span></span><br><span class="line">        .out_format = JPEG_IMAGE_FORMAT_RGB565,</span><br><span class="line">        .out_scale = scale,</span><br><span class="line">        .flags.swap_color_bytes = <span class="number">1</span>,</span><br><span class="line">        .advanced.working_buffer = work,</span><br><span class="line">        .advanced.working_buffer_size = <span class="keyword">sizeof</span>(work),</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="type">esp_jpeg_image_output_t</span> output_img = &#123;&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(esp_jpeg_decode(&amp;jpeg_cfg, &amp;output_img) != ESP_OK)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<br>

<h2 id="ESP32ç³»åˆ—åˆå§‹åŒ–"><a href="#ESP32ç³»åˆ—åˆå§‹åŒ–" class="headerlink" title="ESP32ç³»åˆ—åˆå§‹åŒ–"></a>ESP32ç³»åˆ—åˆå§‹åŒ–</h2><h3 id="NVSï¼ˆNon-Volatile-Storageï¼Œéæ˜“å¤±æ€§å­˜å‚¨ï¼‰åˆå§‹åŒ–ï¼š"><a href="#NVSï¼ˆNon-Volatile-Storageï¼Œéæ˜“å¤±æ€§å­˜å‚¨ï¼‰åˆå§‹åŒ–ï¼š" class="headerlink" title="NVSï¼ˆNon-Volatile Storageï¼Œéæ˜“å¤±æ€§å­˜å‚¨ï¼‰åˆå§‹åŒ–ï¼š"></a><code>NVS</code>ï¼ˆ<code>Non-Volatile Storage</code>ï¼Œéæ˜“å¤±æ€§å­˜å‚¨ï¼‰åˆå§‹åŒ–ï¼š</h3><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="type">esp_err_t</span> ret = nvs_flash_init(); </span><br><span class="line"><span class="keyword">if</span> (ret == ESP_ERR_NVS_NO_FREE_PAGES || ret == ESP_ERR_NVS_NEW_VERSION_FOUND) </span><br><span class="line">&#123; </span><br><span class="line">	ESP_ERROR_CHECK(nvs_flash_erase()); </span><br><span class="line">	ret = nvs_flash_init(); </span><br><span class="line">&#125;</span><br><span class="line">ESP_ERROR_CHECK(ret);</span><br></pre></td></tr></table></figure>

<ol>
<li>åˆå§‹åŒ– <code>NVS</code></li>
</ol>
<ul>
<li><code>nvs_flash_init()</code> ä¼šæŒ‚è½½ <code>NVS</code> åˆ†åŒºï¼ˆé€šå¸¸æ˜¯ <code>flash</code> é‡Œä¸€ä¸ªå« â€œ<code>nvs</code>â€œ çš„åˆ†åŒºï¼‰ã€‚</li>
<li><code>NVS</code> æ˜¯ä¸€ä¸ª <code>key-value</code> å­˜å‚¨ç³»ç»Ÿï¼Œå¯ä»¥ç”¨æ¥ä¿å­˜ <code>Wi-Fi</code> é…ç½®ã€è®¾å¤‡çŠ¶æ€ã€å‚æ•°ç­‰ï¼Œæ–­ç”µä¸ä¼šä¸¢å¤±ã€‚</li>
<li>ESP32 å†…éƒ¨å¾ˆå¤šç³»ç»Ÿç»„ä»¶ï¼ˆæ¯”å¦‚ <code>Wi-Fi</code>ï¼‰éƒ½ä¾èµ– <code>NVS</code> å­˜å‚¨ã€‚</li>
</ul>
<ol start="2">
<li>å¤„ç†ç‰ˆæœ¬æˆ–å®¹é‡å¼‚å¸¸</li>
</ol>
<ul>
<li><code>ESP_ERR_NVS_NO_FREE_PAGES</code>ï¼šè¡¨ç¤º <code>NVS</code> åˆ†åŒºç©ºé—´ä¸è¶³ï¼Œæ— æ³•å†å†™å…¥æ–°çš„ <code>key-value</code>ï¼ˆå¯èƒ½æ˜¯ç»“æ„å˜åŒ–åæ—§æ•°æ®æ— æ•ˆå ç”¨ç©ºé—´ï¼‰ã€‚</li>
<li><code>ESP_ERR_NVS_NEW_VERSION_FOUND</code>ï¼šè¡¨ç¤ºå›ºä»¶æ›´æ–°åï¼Œ<code>NVS</code> çš„ç»“æ„ç‰ˆæœ¬ä¸å½“å‰ <code>IDF</code> ç‰ˆæœ¬ä¸å…¼å®¹ï¼ˆæ¯”å¦‚å‡çº§äº† <code>ESP-IDF</code>ï¼‰ã€‚</li>
<li>è¿™ä¸¤ç§æƒ…å†µéƒ½éœ€è¦ æ“¦é™¤ <code>NVS</code> åˆ†åŒº å†é‡æ–°åˆå§‹åŒ–ã€‚</li>
</ul>
<ol start="3">
<li>è°ƒç”¨ <code>nvs_flash_erase()</code></li>
</ol>
<ul>
<li>ä¼šæ¸…ç©ºæ•´ä¸ª <code>NVS</code> åˆ†åŒºï¼ˆç›¸å½“äºæ¢å¤å‡ºå‚è®¾ç½®ï¼‰ã€‚</li>
<li>ç„¶åå†æ¬¡è°ƒç”¨ <code>nvs_flash_init()</code> å®Œæˆåˆå§‹åŒ–ã€‚</li>
</ul>
<ol start="4">
<li><code>ESP_ERROR_CHECK(ret)</code></li>
</ol>
<ul>
<li>å¦‚æœ <code>ret</code> ä¸æ˜¯ <code>ESP_OK</code>ï¼Œä¼šç›´æ¥æŠ¥é”™å¹¶ç»ˆæ­¢ç¨‹åºï¼ˆæ–¹ä¾¿è°ƒè¯•ï¼‰ã€‚</li>
</ul>
<p>ğŸ’¡ æ€»ç»“</p>
<ul>
<li>è¿™æ®µä»£ç çš„ç›®çš„æ˜¯ï¼š<strong>ç¡®ä¿ NVS å­˜å‚¨å¯ç”¨ä¸”ç»“æ„ç‰ˆæœ¬åŒ¹é…</strong>ï¼Œå¦åˆ™ä¼šè‡ªåŠ¨æ¸…ç©ºå¹¶é‡æ–°åˆå§‹åŒ–ã€‚</li>
<li>è¿™æ˜¯å¾ˆå¤š <code>ESP-IDF</code> é¡¹ç›®éƒ½ä¼šæ”¾åœ¨ <code>app_main()</code> å¼€å¤´çš„â€œæƒ¯ç”¨åˆå§‹åŒ–ä»£ç â€ï¼Œç‰¹åˆ«æ˜¯ <code>Wi-Fi</code> æˆ– <code>BLE</code> å·¥ç¨‹ã€‚</li>
<li>å¦‚æœä½ ä¸ç”¨ <code>NVS</code>ï¼Œå¯ä»¥ä¸åŠ ï¼Œä½† <code>ESP-IDF</code> å†…éƒ¨æœ‰äº› <code>API</code> ä¼šè‡ªåŠ¨ä¾èµ–å®ƒï¼Œæ¯”å¦‚ <code>esp_wifi_init()</code>ã€‚</li>
</ul>
<br>
## æ‘„åƒå¤´å¼€å‘

<h3 id="æ‘„åƒå¤´é…ç½®"><a href="#æ‘„åƒå¤´é…ç½®" class="headerlink" title="æ‘„åƒå¤´é…ç½®"></a>æ‘„åƒå¤´é…ç½®</h3><ul>
<li><code>OV3660</code>ï¼ˆ<code>30W</code>åƒç´ ï¼‰å’Œ <code>SC101</code>ï¼ˆ<code>100W</code>åƒç´ ï¼‰çš„é…ç½®æœ‰äº›ä¸åŒï¼š<ul>
<li><code>OV3660</code> åœ¨ <code>idf.py menuconfig</code> å‹¾é€‰é…ç½®å¥½å°±è¡Œäº†ã€‚</li>
<li><code>SC101</code> éœ€è¦å‹¾é€‰åŠ é…ç½® <code>Component config</code> â†’ <code>Camera configuration</code> -&gt; <code>Support SC101IOT HD</code> (<code>SC101iot default regs</code> (<code>xclk20M_720p_15fps</code>))ï¼Œ <code>xclk20M_720p_15fps</code> æ¨¡å¼æ¯” <code>VGA</code> æ¨¡å¼é‡‡æ ·é¢‘ç‡ä½ï¼Œä¸å®¹æ˜“è¶…æ—¶ã€‚</li>
</ul>
</li>
</ul>
<h3 id="ç¼“å­˜é…ç½®"><a href="#ç¼“å­˜é…ç½®" class="headerlink" title="ç¼“å­˜é…ç½®"></a>ç¼“å­˜é…ç½®</h3><ul>
<li><p>é»˜è®¤å‘é€ç¼“å­˜å¤ªå°ï¼Œéœ€è¦è°ƒæ•´<code>idf.py menuconfig</code>:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">Component config  ---&gt;</span><br><span class="line">LWIP  ---&gt;</span><br><span class="line">[*] Enable SO_RCVBUF option # æ‰“å¼€åæ‰èƒ½è®¾ç½®ç¼“å­˜å¤§å°(è¿™æ˜¯æ¥æ”¶çš„ï¼Œè®¾ç½®æ²¡ç”¨)</span><br><span class="line"></span><br><span class="line">LWIP â†’ UDP</span><br><span class="line">(256) Maximum active UDP control blocks</span><br><span class="line">(64) Default UDP receive mail box size</span><br><span class="line"></span><br><span class="line">LWIP â†’ TCP</span><br><span class="line">(32768) Default send buffer size</span><br><span class="line">(5760) Default receive window size</span><br><span class="line">(32) Default TCP receive mail box size</span><br><span class="line">(6) Default TCP accept mail box size</span><br></pre></td></tr></table></figure>
</li>
<li><p>ä»£ç é‡Œè®¾ç½®ç¼“å­˜</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">// âœ… è®¾ç½®å‘é€ç¼“å†²åŒºå¤§å°</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> UDP_SEND_BUF_SIZE  (64 * 1024)  <span class="comment">// UDPå‘é€ç¼“å†²åŒº</span></span></span><br><span class="line"><span class="type">int</span> send_buf_size = UDP_SEND_BUF_SIZE;</span><br><span class="line">setsockopt(udp_sock, SOL_SOCKET, SO_SNDBUF, &amp;send_buf_size, <span class="keyword">sizeof</span>(send_buf_size));</span><br></pre></td></tr></table></figure></li>
</ul>
]]></content>
      <categories>
        <category>ESP32è§£å†³æ–¹æ¡ˆ</category>
      </categories>
      <tags>
        <tag>ESP32</tag>
      </tags>
  </entry>
  <entry>
    <title>ESP32å¼€å‘ç¯å¢ƒæ­å»º</title>
    <url>/2024/02/19/ESP32%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/</url>
    <content><![CDATA[<h2 id="å¼€å‘ç¯å¢ƒæ­å»º"><a href="#å¼€å‘ç¯å¢ƒæ­å»º" class="headerlink" title="å¼€å‘ç¯å¢ƒæ­å»º"></a>å¼€å‘ç¯å¢ƒæ­å»º</h2><p><a href="https://espressif-docs.readthedocs-hosted.com/projects/esp-adf/zh-cn/latest/get-started/index.html#quick-start">ESP-ADFå¿«é€Ÿä¸Šæ‰‹è¿æ¥</a><br><a href="https://docs.espressif.com/projects/esp-idf/zh_CN/stable/esp32/get-started/linux-macos-setup.html#get-started-linux-macos-first-steps">ESP-IDFå¿«é€Ÿä¸Šæ‰‹è¿æ¥</a></p>
<br>

<h3 id="è·å–ESP-ADF"><a href="#è·å–ESP-ADF" class="headerlink" title="è·å–ESP-ADF"></a>è·å–ESP-ADF</h3><ul>
<li><p>æ‰“å¼€Linux or macOSç»ˆç«¯,æ–°å»ºæ­å»ºç¯å¢ƒæ‰€éœ€æ–‡ä»¶å¤¹ã€‚</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> ~/esp</span><br><span class="line"><span class="built_in">cd</span> ~/esp</span><br></pre></td></tr></table></figure></li>
<li><p>ç¼–è¯‘ ESP-IDF éœ€è¦ä»¥ä¸‹è½¯ä»¶åŒ…ã€‚è¯·æ ¹æ®ä½¿ç”¨çš„ Linux å‘è¡Œç‰ˆæœ¬ï¼Œé€‰æ‹©åˆé€‚çš„å®‰è£…ï¼š</p>
</li>
<li><p>Ubuntu å’Œ Debian:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo apt-get install git wget flex bison gperf python3 python3-pip python3-venv cmake ninja-build ccache libffi-dev libssl-dev dfu-util libusb-1.0-0</span><br></pre></td></tr></table></figure>
<p>CentOS 7 &amp; 8:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo yum -y update &amp;&amp; sudo yum install git wget flex bison gperf python3 python3-setuptools cmake ninja-build ccache dfu-util libusbx</span><br></pre></td></tr></table></figure>
<p>Arch:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo pacman -S --needed gcc git make flex bison gperf python cmake ninja ccache dfu-util libusb</span><br></pre></td></tr></table></figure>
</li>
<li><p>å…‹éš†æœ€æ–°ç‰ˆESP-ADFï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git <span class="built_in">clone</span> --recursive https://github.com/espressif/esp-adf.git</span><br></pre></td></tr></table></figure>
</li>
<li><p>è‹¥å…‹éš†å¤±è´¥ï¼Œå°è¯•ä»¥ä¸‹æŒ‡ä»¤ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git <span class="built_in">clone</span> --recursive git@github.com:espressif/esp-adf.git</span><br></pre></td></tr></table></figure>
</li>
<li><p>è‹¥å­æ¨¡å—æ‹‰å–å¤±è´¥ï¼Œå°è¯•æ‰‹åŠ¨é€ä¸ªæ‹‰å–å­æ¨¡å—ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> ~/esp/esp-adf/components</span><br><span class="line">git <span class="built_in">clone</span> git@github.com:espressif/esp-adf-libs.git </span><br><span class="line">æˆ–è€…</span><br><span class="line">git <span class="built_in">clone</span> https://github.com/espressif/esp-adf-libs.git</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> ~/esp/esp-adf/components</span><br><span class="line">git <span class="built_in">clone</span> git@github.com:espressif/esp-sr.git</span><br><span class="line">æˆ–è€…</span><br><span class="line">git <span class="built_in">clone</span> https://github.com/espressif/esp-sr.git</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> ~/esp/esp-adf</span><br><span class="line">git <span class="built_in">clone</span> git@github.com:espressif/esp-idf.git</span><br><span class="line">æˆ–è€…</span><br><span class="line">git <span class="built_in">clone</span> https://github.com/espressif/esp-idf.git</span><br></pre></td></tr></table></figure>
</li>
<li><p>å½“é‡åˆ°ç½‘ç»œæ¯”è¾ƒå¡æ—¶ï¼Œ<code>github</code>æºæ”¹ä¸º<code>gitee</code>æºï¼ˆä»¥è®¾ç½®<code>idf.py set-target esp32s3</code>çš„<code>esp32-wifi-lib</code>ä¸ºä¾‹ï¼‰ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> ~/esp/esp-adf/esp-idf</span><br><span class="line">git config submodule.<span class="string">&quot;components/esp_wifi/lib&quot;</span>.url https://gitee.com/EspressifSystems/esp32-wifi-lib.git</span><br><span class="line">git submodule <span class="built_in">sync</span></span><br><span class="line">git submodule update --init --depth 1 components/esp_wifi/lib</span><br></pre></td></tr></table></figure></li>
</ul>
<br>

<p><strong>é¢„é˜²æªæ–½</strong>ï¼š</p>
<ol>
<li><p>é…ç½®é•œåƒæºï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># å…¨å±€ä½¿ç”¨ Gitee é•œåƒ</span></span><br><span class="line">git config --global url.<span class="string">&quot;https://gitee.com/EspressifSystems&quot;</span>.insteadOf <span class="string">&quot;https://github.com/espressif&quot;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>å®šæœŸæ›´æ–°å­æ¨¡å—ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ç©ºé—²æ—¶æ›´æ–°æ‰€æœ‰å­æ¨¡å—</span></span><br><span class="line"><span class="built_in">cd</span> ~/esp/esp-adf</span><br><span class="line">git submodule update --init --recursive --depth 1</span><br></pre></td></tr></table></figure></li>
</ol>
<br>

<h3 id="è®¾ç½®ç¯å¢ƒå˜é‡"><a href="#è®¾ç½®ç¯å¢ƒå˜é‡" class="headerlink" title="è®¾ç½®ç¯å¢ƒå˜é‡"></a>è®¾ç½®ç¯å¢ƒå˜é‡</h3><p>æŒ‰è‡ªå·±å®é™…è·¯å¾„ï¼Œå¯æŒ‰è‡ªå·±å–œå¥½è®¾ç½®ï¼Œä¹Ÿå¯ä¸é…ç½®ï¼Œæ‰‹åŠ¨æ•²æŒ‡ä»¤ä¹Ÿå¯ã€‚</p>
<p><code>vi ~/.bashrc</code><br>åœ¨åé¢åŠ ä¸Šä»¥ä¸‹ä»£ç ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#å¼€å¯ESP32ç¼–è¯‘ç¯å¢ƒ</span></span><br><span class="line"><span class="built_in">alias</span> get-idf=<span class="string">&#x27;. $HOME/esp/esp-adf/esp-idf/export.sh&#x27;</span></span><br><span class="line"><span class="built_in">alias</span> get-adf=<span class="string">&#x27;. $HOME/esp/esp-adf/export.sh&#x27;</span></span><br><span class="line"><span class="comment"># çƒ§å½•åˆ°è®¾å¤‡ï¼Œå¹¶æ‰“å¼€ç›‘è§†å™¨ï¼Œ/dev/ttyS15ä¸ºUSBæŒ‚è½½ç«¯å£ï¼Œéœ€æµ‹è¯•åå¡«å†™ï¼Œ115200ä¸ºç›‘è§†å™¨æ³¢ç‰¹ç‡ï¼Œä¸è®¾å¤‡UART0æ³¢ç‰¹ç‡å¯¹åº”</span></span><br><span class="line"><span class="built_in">alias</span> esp-u0=<span class="string">&#x27;idf.py -p /dev/ttyUSB0 -b 1152000 flash &amp;&amp; idf.py -p /dev/ttyUSB0 monitor&#x27;</span></span><br><span class="line"><span class="built_in">alias</span> esp-u1=<span class="string">&#x27;idf.py -p /dev/ttyUSB1 -b 1152000 flash &amp;&amp; idf.py -p /dev/ttyUSB1 monitor&#x27;</span></span><br><span class="line"><span class="comment"># è‡ªå¸¦USB,å¦‚æœåªæƒ³è¦æœ€ç®€å•çš„ çƒ§å½• + ä¸²å£è°ƒè¯•ï¼Œæ¨èç›´æ¥ç”¨ ESP-IDF è‡ªå¸¦çš„ USB Serial/JTAG é©±åŠ¨æ¨¡å¼</span></span><br><span class="line"><span class="built_in">alias</span> esp-acm0=<span class="string">&#x27;idf.py -p /dev/ttyACM0 -b 1152000 flash &amp;&amp; idf.py -p /dev/ttyACM0 monitor&#x27;</span></span><br><span class="line"><span class="built_in">alias</span> esp-busid=<span class="string">&#x27;sudo usbip attach -r 192.168.104.29 -b&#x27;</span></span><br><span class="line"><span class="built_in">alias</span> esp-unbusid=<span class="string">&#x27;sudo usbip detach&#x27;</span>  <span class="comment"># æŸ¥çœ‹ç«¯å£å·ï¼šsudo usbip port</span></span><br><span class="line"><span class="built_in">export</span> PATH=/home/ubuntu/esp/esp-adf/esp-idf/tools:<span class="variable">$PATH</span></span><br><span class="line"><span class="built_in">export</span> IDF_PATH=/home/ubuntu/esp/esp-adf/esp-idf</span><br><span class="line"><span class="built_in">export</span> ADF_PATH=/home/ubuntu/esp/esp-adf</span><br></pre></td></tr></table></figure>
<p>ä¿å­˜é€€å‡º <code>:wq</code></p>
<h3 id="è®¾ç½®å·¥å…·"><a href="#è®¾ç½®å·¥å…·" class="headerlink" title="è®¾ç½®å·¥å…·"></a>è®¾ç½®å·¥å…·</h3><p>é™¤äº† ESP-IDF æœ¬èº«ï¼Œè¿˜éœ€è¦ä¸ºæ”¯æŒ ESP32 çš„é¡¹ç›®å®‰è£… ESP-IDF ä½¿ç”¨çš„å„ç§å·¥å…·ï¼Œæ¯”å¦‚ç¼–è¯‘å™¨ã€è°ƒè¯•å™¨ã€Python åŒ…ç­‰ã€‚</p>
<pre><code>cd ~/esp/esp-adf/esp-idf
</code></pre>
<p>å®‰è£…esp32ï¼Œesp32s2å·¥å…·ï¼Œè¿è¡Œä»¥ä¸‹æŒ‡ä»¤ï¼šï¼ˆæŒ‰éœ€æ±‚å®‰è£…ï¼‰</p>
<pre><code>./install.sh esp32,esp32s2
</code></pre>
<p>è‹¥éœ€è¦å®‰è£…æ‰€æœ‰å·¥å…·ï¼Œè¿è¡Œä»¥ä¸‹æŒ‡ä»¤ï¼š</p>
<pre><code>./install.sh all
</code></pre>
<p>ä»¥ä¸‹ä¸ºESP-IDFç¼–è¯‘æ‰€éœ€ç¯å¢ƒï¼Œè¯·åœ¨éœ€è¦è¿è¡ŒESP-IDFçš„ç»ˆç«¯çª—å£è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</p>
<pre><code>. $HOME/esp/esp-adf/esp-idf/export.sh   
</code></pre>
<p>æˆ–è€…ä½¿ç”¨å¿«æ·æŒ‡ä»¤ï¼š</p>
<pre><code>get-idf
</code></pre>
<br>

<h2 id="ESP32å·¥ç¨‹ç¤ºä¾‹"><a href="#ESP32å·¥ç¨‹ç¤ºä¾‹" class="headerlink" title="ESP32å·¥ç¨‹ç¤ºä¾‹"></a>ESP32å·¥ç¨‹ç¤ºä¾‹</h2><h3 id="å¼€å§‹åˆ›å»ºå·¥ç¨‹"><a href="#å¼€å§‹åˆ›å»ºå·¥ç¨‹" class="headerlink" title="å¼€å§‹åˆ›å»ºå·¥ç¨‹"></a>å¼€å§‹åˆ›å»ºå·¥ç¨‹</h3><p>ç°åœ¨ï¼Œå¯ä»¥å‡†å¤‡å¼€å‘ ESP32 åº”ç”¨ç¨‹åºäº†ã€‚<br>ä» ESP-IDF ä¸­ examples ç›®å½•ä¸‹çš„ <code>get-started/hello_world</code> å·¥ç¨‹å¼€å§‹ï¼Œå°† <code>get-started/hello_world</code> å·¥ç¨‹å¤åˆ¶è‡³æœ¬åœ°çš„ ~&#x2F;esp ç›®å½•ä¸‹ï¼š</p>
<pre><code>cd ~/esp
get-idf
cp -r $IDF_PATH/examples/get-started/hello_world .
</code></pre>
<br>

<h3 id="é…ç½®å·¥ç¨‹"><a href="#é…ç½®å·¥ç¨‹" class="headerlink" title="é…ç½®å·¥ç¨‹"></a>é…ç½®å·¥ç¨‹</h3><pre><code>cd ~/esp/hello_world
idf.py set-target esp32
</code></pre>
<p>ç”±äºESP32æ˜¯å•æ ¸ï¼Œé»˜è®¤é…ç½®æ˜¯åŒæ ¸æ¨¡å¼ï¼Œéœ€è¦é…ç½®å‚æ•°ï¼š</p>
<pre><code>idf.py menuconfig
Component config -&gt; FreeRTOS -&gt;  [*]Run FreeRTOS only on first core
</code></pre>
<p>ä¿å­˜é€€å‡º</p>
<h3 id="ç¼–è¯‘å·¥ç¨‹"><a href="#ç¼–è¯‘å·¥ç¨‹" class="headerlink" title="ç¼–è¯‘å·¥ç¨‹"></a>ç¼–è¯‘å·¥ç¨‹</h3><pre><code>idf.py build
</code></pre>
<h3 id="çƒ§å½•å·¥ç¨‹"><a href="#çƒ§å½•å·¥ç¨‹" class="headerlink" title="çƒ§å½•å·¥ç¨‹"></a>çƒ§å½•å·¥ç¨‹</h3><pre><code>idf.py -p PORT flash
</code></pre>
<p>è¯·å°† PORT æ›¿æ¢ä¸º ESP32 å¼€å‘æ¿çš„ä¸²å£åç§°ã€‚å¦‚æœ PORT æœªç»å®šä¹‰ï¼Œ<code>idf.py</code> å°†å°è¯•ä½¿ç”¨å¯ç”¨çš„ä¸²å£è‡ªåŠ¨è¿æ¥ã€‚</p>
<h3 id="åˆå¹¶æ‰§è¡Œæ„å»ºã€çƒ§å½•å’Œç›‘è§†è¿‡ç¨‹ï¼š"><a href="#åˆå¹¶æ‰§è¡Œæ„å»ºã€çƒ§å½•å’Œç›‘è§†è¿‡ç¨‹ï¼š" class="headerlink" title="åˆå¹¶æ‰§è¡Œæ„å»ºã€çƒ§å½•å’Œç›‘è§†è¿‡ç¨‹ï¼š"></a>åˆå¹¶æ‰§è¡Œæ„å»ºã€çƒ§å½•å’Œç›‘è§†è¿‡ç¨‹ï¼š</h3><pre><code>idf.py -p PORT [-b BAUD] flash monitor
é€€å‡º monitor: Ctrl + ]
</code></pre>
<p>æ³¨ï¼š[-b BAUD] å’Œ monitor é…åˆä½¿ç”¨ï¼ŒBAUDä¸ºç¨‹åºä¸­UART0çš„æ³¢ç‰¹ç‡	</p>
<pre><code>idf.py -p /dev/ttyS15 -b  115200  flash monitor	
idf.py -p [æŒ‚è½½ç«¯å£]   -b [æ³¢ç‰¹ç‡] flash monitor
</code></pre>
<h3 id="æ“¦é™¤flash"><a href="#æ“¦é™¤flash" class="headerlink" title="æ“¦é™¤flash"></a>æ“¦é™¤flash</h3><pre><code>idf.py -p PORT erase-flash
</code></pre>
<p>è‹¥å­˜åœ¨éœ€è¦æ“¦é™¤çš„ OTA æ•°æ®ï¼Œè¯·è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</p>
<pre><code>idf.py -p PORT erase-otadata
</code></pre>
<h3 id="æŒ‚è½½ç«¯å£"><a href="#æŒ‚è½½ç«¯å£" class="headerlink" title="æŒ‚è½½ç«¯å£"></a>æŒ‚è½½ç«¯å£</h3><h4 id="windows-å­ç³»ç»Ÿ-wsl"><a href="#windows-å­ç³»ç»Ÿ-wsl" class="headerlink" title="windows å­ç³»ç»Ÿ wsl"></a>windows å­ç³»ç»Ÿ wsl</h4><p>è¾“å…¥çƒ§å½•æŒ‡ä»¤ï¼š</p>
<pre><code>idf.py flash
</code></pre>
<p>è§‚å¯Ÿç»ˆç«¯è®¾å¤‡æ˜¯æŒ‚è½½åœ¨å“ªä¸ªç«¯å£ä¸Šï¼Œæœ‰ERRORå¿½ç•¥ï¼Œé€‰æ‹©ç«¯å£ä¾‹å¦‚ <code>/dev/ttyS15</code>ï¼Œç¨‹åºä¸­<code>UART0</code>çš„æ³¢ç‰¹ç‡115200ï¼Œä¸‹æ¬¡å°±å¯ä»¥ç›´æ¥è¾“æ­¤ç«¯å£å°±å¯ä»¥çƒ§å½•å•¦ã€‚</p>
<pre><code>idf.py -p /dev/ttyS15 -b 115200 flash monitor	
</code></pre>
<p>å¦‚æœ ESP-IDF ç›‘è§†å™¨åœ¨çƒ§å½•åå¾ˆå¿«å‘ç”Ÿé”™è¯¯ï¼Œæˆ–æ‰“å°ä¿¡æ¯å…¨æ˜¯ä¹±ç ï¼ˆå¦‚ä¸‹ï¼‰ï¼Œå¾ˆæœ‰å¯èƒ½æ˜¯å› ä¸ºå¼€å‘æ¿é‡‡ç”¨äº† 26 MHz æ™¶æŒ¯ï¼Œè€Œ ESP-IDF é»˜è®¤æ”¯æŒå¤§å¤šæ•°å¼€å‘æ¿ä½¿ç”¨çš„ 40 MHz æ™¶æŒ¯ã€‚</p>
<pre><code>xï¿½ï¿½ï¿½ffï¿½fï¿½ï¿½ï¿½ï¿½ï¿½`ï¿½~ï¿½~ï¿½ï¿½ï¿½fï¿½ï¿½ï¿½xï¿½ï¿½fï¿½fï¿½ï¿½ï¿½ï¿½ï¿½ffï¿½ï¿½`ï¿½ï¿½ï¿½fï¿½ï¿½ï¿½ï¿½`ï¿½ï¿½~xï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ffï¿½fï¿½ï¿½ï¿½ï¿½ï¿½`ï¿½~ï¿½~ï¿½fï¿½ï¿½ï¿½ï¿½fï¿½ï¿½ï¿½ï¿½f`ï¿½ï¿½ï¿½xï¿½ï¿½fï¿½fï¿½ï¿½ï¿½ï¿½ï¿½ffï¿½ï¿½`ï¿½ï¿½ï¿½f
</code></pre>
<p>æ­¤æ—¶ï¼Œå¯ä»¥ï¼š<br>1ã€é€€å‡ºç›‘è§†å™¨ã€‚<br>2ã€è¿”å› idf.py menuconfigã€‚<br>3ã€è¿›å…¥ Component config â€“&gt; Hardware Settings â€“&gt; Main XTAL Config â€“&gt; Main XTAL frequency è¿›è¡Œé…ç½®ï¼Œå°† CONFIG_XTAL_FREQ_SEL è®¾ç½®ä¸º 26 MHzã€‚<br>4ã€é‡æ–°ç¼–è¯‘å’Œçƒ§å½•åº”ç”¨ç¨‹åºã€‚</p>
<h4 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h4><p>å¯åŠ¨ç»ˆç«¯ESP32ç¼–è¯‘åªéœ€è¦è¿›è¡Œä»¥ä¸‹æ­¥éª¤ï¼š</p>
<pre><code>. $HOME/esp/esp-adf/esp-idf/export.sh	//å¼€å¯ç¼–è¯‘ç¯å¢ƒ
idf.py set-target esp32			//é¦–æ¬¡æ­å»ºé¡¹ç›®æ—¶é…ç½®
idf.py menuconfig   			//é€‰æ‹©éœ€è¦çš„é…ç½®
idf.py build
idf.py flash
</code></pre>
<p>å¿«æ·æ–¹å¼ï¼š</p>
<pre><code>get-idf
idf.py set-target esp32
idf.py menuconfig
idf.py build
esp-download
</code></pre>
<br>

<h2 id="é€šè¿‡SSHè¿œç¨‹è®¿é—®æœ¬åœ°çš„USBè®¾å¤‡"><a href="#é€šè¿‡SSHè¿œç¨‹è®¿é—®æœ¬åœ°çš„USBè®¾å¤‡" class="headerlink" title="é€šè¿‡SSHè¿œç¨‹è®¿é—®æœ¬åœ°çš„USBè®¾å¤‡"></a>é€šè¿‡SSHè¿œç¨‹è®¿é—®æœ¬åœ°çš„USBè®¾å¤‡</h2><h3 id="å¼€å‘ç¯å¢ƒé…ç½®"><a href="#å¼€å‘ç¯å¢ƒé…ç½®" class="headerlink" title="å¼€å‘ç¯å¢ƒé…ç½®"></a>å¼€å‘ç¯å¢ƒé…ç½®</h3><h4 id="æœ¬åœ°æœºå™¨é…ç½®ï¼ˆä»¥Windowsä¸ºä¾‹ï¼‰"><a href="#æœ¬åœ°æœºå™¨é…ç½®ï¼ˆä»¥Windowsä¸ºä¾‹ï¼‰" class="headerlink" title="æœ¬åœ°æœºå™¨é…ç½®ï¼ˆä»¥Windowsä¸ºä¾‹ï¼‰"></a>æœ¬åœ°æœºå™¨é…ç½®ï¼ˆä»¥Windowsä¸ºä¾‹ï¼‰</h4><ol>
<li>å®‰è£…USB&#x2F;IPå·¥å…·</li>
</ol>
<ul>
<li><p>ä¸‹è½½å¹¶å®‰è£… <code>usbipd-win</code>ï¼ˆ<code>Windows</code>çš„<code>USB/IP</code>æœåŠ¡ç«¯ï¼‰ï¼š</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">winget install <span class="literal">--interactive</span> dorssel.usbipd<span class="literal">-win</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>æ’å…¥<code>ESP32</code>å¼€å‘æ¿ï¼Œç¡®è®¤è®¾å¤‡ç®¡ç†å™¨ä¸­å‡ºç°å¯¹åº”çš„ä¸²å£ï¼ˆå¦‚ <code>COM3</code> æˆ– <code>/dev/ttyUSB0</code>ï¼‰ã€‚</p>
</li>
</ul>
<ol start="2">
<li>ç»‘å®šå¹¶å…±äº«<code>USB</code>è®¾å¤‡</li>
</ol>
<ul>
<li><p>ç®¡ç†å‘˜æƒé™æ‰“å¼€<code>PowerShell</code>ï¼ŒæŸ¥çœ‹<code>ESP32</code>çš„æ€»çº¿<code>ID</code>ï¼š</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">usbipd list</span><br></pre></td></tr></table></figure>
</li>
<li><p>è¾“å‡ºç¤ºä¾‹ï¼š</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">BUSID  VID:PID   DEVICE 							STATE</span><br><span class="line"><span class="number">3</span><span class="literal">-1</span>    <span class="number">10</span>c4:ea60  Silicon Labs CP210x USB to UART Bridge (COM17)                Not Shared</span><br></pre></td></tr></table></figure>
</li>
<li><p>ç»‘å®šå¹¶å…±äº«è®¾å¤‡ï¼š</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">usbipd bind <span class="literal">--busid</span> <span class="number">3</span><span class="literal">-1</span>  <span class="comment"># æ›¿æ¢ä¸ºå®é™…æ€»çº¿ID</span></span><br></pre></td></tr></table></figure></li>
</ul>
<ol start="3">
<li>é…ç½®<code>Windows</code>é˜²ç«å¢™</li>
</ol>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="built_in">New-NetFirewallRule</span> <span class="literal">-DisplayName</span> <span class="string">&quot;USB/IP&quot;</span> <span class="literal">-Direction</span> Inbound <span class="literal">-Action</span> Allow <span class="literal">-Protocol</span> TCP <span class="literal">-LocalPort</span> <span class="number">3240</span> <span class="comment"># å…³é—­é˜²ç«å¢™</span></span><br><span class="line">æˆ–è€…ï¼š</span><br><span class="line"><span class="built_in">Set-NetFirewallProfile</span> <span class="literal">-Profile</span> Domain,Public,Private <span class="literal">-Enabled</span> False <span class="comment"># ä¸´æ—¶å…³é—­é˜²ç«å¢™æµ‹è¯•</span></span><br></pre></td></tr></table></figure>

<ol start="4">
<li>ç¡®ä¿<code>USB/IP</code>æœåŠ¡å·²å¯åŠ¨</li>
</ol>
<ul>
<li><p>å¦‚æœæœåŠ¡æœªå¯åŠ¨ï¼Œæ‰‹åŠ¨å¯åŠ¨ï¼š</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">usbipd server	<span class="comment"># éœ€è¦ä¿æŒpowershell</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>éªŒè¯æœåŠ¡æ˜¯å¦å¯åŠ¨:</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">usbipd list</span><br></pre></td></tr></table></figure></li>
<li><p>å¦‚æœè¾“å‡ºè®¾å¤‡åˆ—è¡¨ï¼ˆå¦‚<code>ESP32</code>ï¼‰ï¼Œè¯´æ˜æœåŠ¡å·²æˆåŠŸå¯åŠ¨ã€‚</p>
</li>
</ul>
<ol start="5">
<li>æ£€æŸ¥ç«¯å£ç›‘å¬</li>
</ol>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">netstat <span class="literal">-ano</span> | findstr :<span class="number">3240</span></span><br></pre></td></tr></table></figure>

<ul>
<li><p>æ­£å¸¸åº”è¾“å‡ºç±»ä¼¼ä»¥ä¸‹å†…å®¹ï¼š</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">TCP    <span class="number">0.0</span>.<span class="number">0.0</span>:<span class="number">3240</span>           <span class="number">0.0</span>.<span class="number">0.0</span>:<span class="number">0</span>              LISTENING</span><br></pre></td></tr></table></figure>
</li>
<li><p>å¸¸ç”¨ä¿¡æ¯</p>
</li>
</ul>
<ol start="6">
<li>è·å–æœ¬æœº<code>ip</code></li>
</ol>
<ul>
<li><code>powershell</code>è¾“å…¥<code>ipconfig</code>æŒ‡ä»¤è·å–æœ¬æœº<code>ip</code>:<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">Ethernet adapter ä»¥å¤ªç½‘:</span><br><span class="line"></span><br><span class="line">   Connection<span class="literal">-specific</span> DNS Suffix  . : breo.vip</span><br><span class="line">   Link<span class="literal">-local</span> IPv6 Address . . . . . : fe80::a2cf:<span class="number">7</span>a4:df39:<span class="number">7032</span>%<span class="number">7</span></span><br><span class="line">   IPv4 Address. . . . . . . . . . . : <span class="number">192.168</span>.<span class="number">104.29</span> <span class="comment"># è·å–æ­¤IP</span></span><br></pre></td></tr></table></figure></li>
</ul>
<ol start="7">
<li><p>å…¶ä»–å¸¸ç”¨å‘½ä»¤</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">usbipd state 				<span class="comment"># æŸ¥çœ‹å½“å‰å…±äº«çŠ¶æ€</span></span><br><span class="line"><span class="built_in">sc</span> query usbipd 			<span class="comment"># æŸ¥çœ‹æœåŠ¡çŠ¶æ€</span></span><br><span class="line">net stop usbipd 			<span class="comment"># åœæ­¢æœåŠ¡</span></span><br><span class="line">usbipd unbind <span class="literal">--all</span> 		<span class="comment"># åœæ­¢å…±äº«æ‰€æœ‰è®¾å¤‡</span></span><br><span class="line">usbipd bind <span class="literal">--busid</span>=<span class="number">2</span><span class="literal">-1</span>    	<span class="comment"># å…±äº« COM18</span></span><br><span class="line">usbipd unbind <span class="literal">--busid</span>=<span class="number">2</span><span class="literal">-1</span>  	<span class="comment"># å–æ¶ˆå…±äº«</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>é‡åˆ°é—®é¢˜åŠè§£å†³æ–¹å¼</p>
</li>
</ol>
<ul>
<li><p><code>powershell</code>ä¸­è¾“å…¥<code>usbipd server</code>æ—¶å‡ºç°<code>usbipd: error: Another instance is already running</code></p>
<figure class="highlight cmd"><table><tr><td class="code"><pre><span class="line">tasklist | <span class="built_in">findstr</span> &quot;usbipd&quot;		// æ£€æŸ¥æ˜¯å¦æœ‰è¿›ç¨‹æ­£åœ¨è¿è¡Œ</span><br></pre></td></tr></table></figure>
</li>
<li><p>è‹¥å‡ºç° <code>usbipd.exe</code></p>
<figure class="highlight cmd"><table><tr><td class="code"><pre><span class="line">usbipd.exe                   <span class="number">27428</span> Services                   <span class="number">0</span>     <span class="number">18</span>,<span class="number">684</span> K</span><br></pre></td></tr></table></figure>
</li>
<li><p>ç»ˆæ­¢ <code>usbipd.exe</code> è¿›ç¨‹, é‡æ–°å¯åŠ¨</p>
<figure class="highlight cmd"><table><tr><td class="code"><pre><span class="line"><span class="built_in">taskkill</span> /F /IM usbipd.exe</span><br><span class="line">usbipd server</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="è¿œç¨‹UbuntuæœåŠ¡å™¨é…ç½®"><a href="#è¿œç¨‹UbuntuæœåŠ¡å™¨é…ç½®" class="headerlink" title="è¿œç¨‹UbuntuæœåŠ¡å™¨é…ç½®"></a>è¿œç¨‹UbuntuæœåŠ¡å™¨é…ç½®</h4><ol>
<li>å®‰è£…<code>USB/IP</code>å®¢æˆ·ç«¯å·¥å…·</li>
</ol>
<ul>
<li><p>å®‰è£…USB&#x2F;IPå®¢æˆ·ç«¯å·¥å…·</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo apt install linux-tools-generic hwdata</span><br><span class="line">sudo update-alternatives --install /usr/local/bin/usbip usbip /usr/lib/linux-tools/*-generic/usbip 20</span><br></pre></td></tr></table></figure>
</li>
<li><p>è‹¥ä¸å…¼å®¹ï¼Œå®‰è£…ä¸å†…æ ¸<code>5.15.0-126</code>å…¼å®¹çš„<code>usbipd</code>å·¥å…·åŠæ€§èƒ½è°ƒè¯•å·¥å…·</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo apt install linux-tools-5.15.0-126-generic linux-cloud-tools-5.15.0-126-generic</span><br></pre></td></tr></table></figure>
</li>
<li><p>éªŒè¯å®‰è£…ï¼šå®‰è£…åæ£€æŸ¥ <code>usbipd</code> æ˜¯å¦å­˜åœ¨:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">which usbipd   # è¾“å‡ºè·¯å¾„</span><br></pre></td></tr></table></figure>
</li>
<li><p>ä¸ºé¿å…æœªæ¥å†…æ ¸å‡çº§åå†æ¬¡å‡ºç°ç‰ˆæœ¬ä¸å…¼å®¹é—®é¢˜ï¼Œå®‰è£…é€šç”¨å·¥å…·åŒ…ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo apt install linux-tools-generic linux-cloud-tools-generic</span><br></pre></td></tr></table></figure></li>
</ul>
<ol start="2">
<li>é™„åŠ è¿œç¨‹<code>USB</code>è®¾å¤‡</li>
</ol>
<ul>
<li>åœ¨<code>Ubuntu</code>æœåŠ¡å™¨æ‰§è¡Œï¼ˆéœ€ä¸æœ¬åœ°ç½‘ç»œäº’é€šï¼‰ï¼š<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo modprobe usbip-core # å¯ä»¥ä¸éœ€è¦</span><br><span class="line">sudo modprobe vhci-hcd</span><br><span class="line">sudo usbip attach -r &lt;æœ¬åœ°æœºå™¨IP&gt; -b &lt;æ€»çº¿ID&gt; # æ›¿æ¢ä¸ºå®é™…IPå’Œæ€»çº¿ID</span><br></pre></td></tr></table></figure></li>
<li>éªŒè¯è®¾å¤‡æ˜¯å¦æŒ‚è½½æˆåŠŸï¼š<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ls /dev/tty*  # åº”å‡ºç°ç±»ä¼¼/dev/ttyUSB0çš„è®¾å¤‡èŠ‚ç‚¹</span><br><span class="line">dmesg | tail  # æŸ¥çœ‹å†…æ ¸æ—¥å¿—ç¡®è®¤è®¾å¤‡è¯†åˆ«</span><br></pre></td></tr></table></figure></li>
</ul>
<ol start="3">
<li>é…ç½®è®¾å¤‡æƒé™<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo usermod -aG dialout $USER  # å°†ç”¨æˆ·åŠ å…¥ä¸²å£ç»„,éœ€æ³¨é”€é‡æ–°ç™»å½•</span><br><span class="line">sudo chmod a+rw /dev/ttyUSB0    # ä¸´æ—¶æƒé™ï¼ˆå¯é€‰ï¼‰</span><br></pre></td></tr></table></figure></li>
</ol>
<h4 id="ä¿®æ”¹ubuntuç¯å¢ƒå˜é‡"><a href="#ä¿®æ”¹ubuntuç¯å¢ƒå˜é‡" class="headerlink" title="ä¿®æ”¹ubuntuç¯å¢ƒå˜é‡"></a>ä¿®æ”¹ubuntuç¯å¢ƒå˜é‡</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">vim ~/.bashrc</span><br></pre></td></tr></table></figure>

<p>æ·»åŠ ä»¥ä¸‹ä»£ç ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">å¼€å¯ESP32ç¼–è¯‘ç¯å¢ƒ</span></span><br><span class="line">alias get-idf=&#x27;. $HOME/esp/esp-adf/esp-idf/export.sh&#x27;</span><br><span class="line">alias get-adf=&#x27;. $HOME/esp/esp-adf/export.sh&#x27;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">çƒ§å½•åˆ°è®¾å¤‡ï¼Œå¹¶æ‰“å¼€ç›‘è§†å™¨ï¼Œ/dev/ttyS15ä¸ºUSBæŒ‚è½½ç«¯å£ï¼Œéœ€æµ‹è¯•åå¡«å†™ï¼Œ115200ä¸ºç›‘è§†å™¨æ³¢ç‰¹ç‡ï¼Œä¸è®¾å¤‡UART0æ³¢ç‰¹ç‡å¯¹åº”</span></span><br><span class="line">alias esp-u0=&#x27;idf.py -p /dev/ttyUSB0 -b 1152000 flash &amp;&amp; idf.py -p /dev/ttyUSB0 monitor&#x27;</span><br><span class="line">alias esp-u1=&#x27;idf.py -p /dev/ttyUSB1 -b 1152000 flash &amp;&amp; idf.py -p /dev/ttyUSB1 monitor&#x27;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è‡ªå¸¦USB,å¦‚æœåªæƒ³è¦æœ€ç®€å•çš„ çƒ§å½• + ä¸²å£è°ƒè¯•ï¼Œæ¨èç›´æ¥ç”¨ ESP-IDF è‡ªå¸¦çš„ USB Serial/JTAG é©±åŠ¨æ¨¡å¼</span></span><br><span class="line">alias esp-acm0=&#x27;idf.py -p /dev/ttyACM0 -b 1152000 flash &amp;&amp; idf.py -p /dev/ttyACM0 monitor&#x27;</span><br><span class="line">alias esp-busid=&#x27;sudo usbip attach -r 192.168.104.29 -b&#x27;</span><br><span class="line">alias esp-unbusid=&#x27;sudo usbip detach&#x27;  # æŸ¥çœ‹ç«¯å£å·ï¼šsudo usbip port</span><br><span class="line">export PATH=/home/ubuntu/esp/esp-adf/esp-idf/tools:$PATH</span><br><span class="line">export IDF_PATH=/home/ubuntu/esp/esp-adf/esp-idf</span><br><span class="line">export ADF_PATH=/home/ubuntu/esp/esp-adf</span><br></pre></td></tr></table></figure>

<ul>
<li>é‡Šæ”¾<code>USB</code>å£:</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ubuntu@compilation:~/esp/spi_lcd_touch$ lsof /dev/ttyUSB0</span><br><span class="line">COMMAND   PID   USER   FD   TYPE DEVICE SIZE/OFF NODE NAME</span><br><span class="line">python  85630 ubuntu    3uW  CHR  188,0      0t0  730 /dev/ttyUSB0</span><br><span class="line"></span><br><span class="line">ubuntu@compilation:~/esp/spi_lcd_touch$ sudo kill -9 85630 </span><br></pre></td></tr></table></figure>

<h4 id="çƒ§å½•æ­¥éª¤è·Ÿä¸Šæ–‡-WSL-ç¯å¢ƒä¸€æ ·"><a href="#çƒ§å½•æ­¥éª¤è·Ÿä¸Šæ–‡-WSL-ç¯å¢ƒä¸€æ ·" class="headerlink" title="çƒ§å½•æ­¥éª¤è·Ÿä¸Šæ–‡ WSL ç¯å¢ƒä¸€æ ·"></a>çƒ§å½•æ­¥éª¤è·Ÿä¸Šæ–‡ WSL ç¯å¢ƒä¸€æ ·</h4><h4 id="æ–­å¼€è®¾å¤‡è¿æ¥"><a href="#æ–­å¼€è®¾å¤‡è¿æ¥" class="headerlink" title="æ–­å¼€è®¾å¤‡è¿æ¥"></a>æ–­å¼€è®¾å¤‡è¿æ¥</h4><ol>
<li>æœ¬åœ°é‡Šæ”¾è®¾å¤‡ï¼ˆ<code>Windows</code>ç«¯ï¼‰</li>
</ol>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">usbipd unbind <span class="literal">--busid</span> &lt;æ€»çº¿ID&gt;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>å¸è½½<code>USB</code>è®¾å¤‡</li>
</ol>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">sudo usbip detach <span class="literal">--port</span>=<span class="number">00</span>  <span class="comment"># æŸ¥çœ‹ç«¯å£å·ï¼šsudo usbip port</span></span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>åµŒå…¥å¼</category>
        <category>ç¯å¢ƒæ­å»º</category>
        <category>Bluetooth</category>
      </categories>
      <tags>
        <tag>ESP32</tag>
        <tag>Linux</tag>
      </tags>
  </entry>
  <entry>
    <title>I2Cè°ƒè¯•è®°å½•</title>
    <url>/2024/03/01/I2C%E8%B0%83%E8%AF%95%E8%AE%B0%E5%BD%95/</url>
    <content><![CDATA[<h2 id="I2CåŸºæœ¬åŸç†ä»‹ç»"><a href="#I2CåŸºæœ¬åŸç†ä»‹ç»" class="headerlink" title="I2CåŸºæœ¬åŸç†ä»‹ç»"></a>I2CåŸºæœ¬åŸç†ä»‹ç»</h2><h3 id="æ—¶åºä»‹ç»"><a href="#æ—¶åºä»‹ç»" class="headerlink" title="æ—¶åºä»‹ç»"></a>æ—¶åºä»‹ç»</h3><p>å‚è€ƒVishayçš„i2cæ—¶åºå›¾ï¼š</p>
<p><img src="/../pictures/i2c%E6%97%B6%E5%BA%8F%E5%9B%BE1.png" alt="i2cæ—¶åºå›¾1"><br><img src="/../pictures/i2c%E6%97%B6%E5%BA%8F%E5%9B%BE2.png" alt="i2cæ—¶åºå›¾2"></p>
<h3 id="ä»£ç å®ç°è¯¦è§£"><a href="#ä»£ç å®ç°è¯¦è§£" class="headerlink" title="ä»£ç å®ç°è¯¦è§£"></a>ä»£ç å®ç°è¯¦è§£</h3><p><code>I2C</code>åè®®å®ç°æœ‰ç¡¬ä»¶<code>I2C</code>å’Œè½¯ä»¶<code>I2C</code>ä¹‹åˆ†ï¼Œè¿™é‡Œåªè®²è§£è½¯ä»¶<code>I2C</code>å®ç°çš„ç‰ˆæœ¬ã€‚ä¸€ä¸‹åˆ—å‡ºä¸»è¦ç»“æ„ä½“å’Œåˆå§‹åŒ–å‡½æ•°ã€‚</p>
<h4 id="I2Cåè®®åˆå§‹åŒ–"><a href="#I2Cåè®®åˆå§‹åŒ–" class="headerlink" title="I2Cåè®®åˆå§‹åŒ–"></a>I2Cåè®®åˆå§‹åŒ–</h4><p><code>I2C</code>åè®®çš„<code>scl</code>å’Œ<code>sda</code>é…ç½®ä¸ºå¼€æ¼è¾“å‡º,éœ€è¦å¤–éƒ¨ä¸Šæ‹‰ï¼ˆä¸€èˆ¬ä¸º<code>10K</code>ç”µé˜»ï¼‰</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#define i2c_pin_mode(pin,mode)		drv_pin_mode(pin,mode)</span></span><br><span class="line"><span class="comment">#define i2c_pin_write(pin,level) 	drv_pin_write(pin,level)</span></span><br><span class="line"><span class="comment">#define i2c_pin_read(pin) 		drv_pin_read(pin)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#define DRV_I2C_WR                      0x00</span></span><br><span class="line"><span class="comment">#define DRV_I2C_RD                      (1u &lt;&lt; 0)</span></span><br><span class="line"><span class="comment">#define DRV_I2C_ADDR_10BIT              (1u &lt;&lt; 2)  /* this is a ten bit chip address */</span></span><br><span class="line"><span class="comment">#define DRV_I2C_NO_START                (1u &lt;&lt; 4)</span></span><br><span class="line"><span class="comment">#define DRV_I2C_IGNORE_NACK             (1u &lt;&lt; 5)</span></span><br><span class="line"><span class="comment">#define DRV_I2C_NO_READ_ACK             (1u &lt;&lt; 6)  /* when I2C reading, we do not ACK */</span></span><br><span class="line"><span class="comment">#define DRV_I2C_NO_STOP                 (1u &lt;&lt; 7)</span></span><br><span class="line"></span><br><span class="line">typedef enum&#123;</span><br><span class="line">	EI2C_DEV_1 = 1,</span><br><span class="line">	EI2C_DEV_2,</span><br><span class="line">	EI2C_DEV_3</span><br><span class="line">&#125;EI2C_DEVICE;</span><br><span class="line"></span><br><span class="line">struct drv_soft_i2c_config</span><br><span class="line">&#123;</span><br><span class="line">	uint8_t scl;</span><br><span class="line">	uint8_t sda;</span><br><span class="line">	uint8_t i2c_num;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">struct drv_i2c_msg</span><br><span class="line">&#123;</span><br><span class="line">    uint16_t addr;</span><br><span class="line">    uint16_t flags;</span><br><span class="line">    uint16_t len;</span><br><span class="line">	uint8_t reg_addr;</span><br><span class="line">    uint8_t  *buf;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">struct drv_i2c_bit_ops</span><br><span class="line">&#123;</span><br><span class="line">    void *data;            /* private data <span class="keyword">for</span> lowlevel routines */</span><br><span class="line">    void (*set_sda)(void *data, int state);</span><br><span class="line">    void (*set_scl)(void *data, int state);</span><br><span class="line">    int (*get_sda)(void *data);</span><br><span class="line">    int (*get_scl)(void *data);</span><br><span class="line"></span><br><span class="line">    void (*udelay)(uint32_t us);</span><br><span class="line"></span><br><span class="line">    uint32_t delay_us;  /* scl and sda line delay */</span><br><span class="line">    uint32_t <span class="built_in">timeout</span>;   /* <span class="keyword">in</span> tick */</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">struct drv_i2c_bus_device</span><br><span class="line">&#123;</span><br><span class="line">	struct drv_i2c_msg msg;</span><br><span class="line">	struct drv_i2c_bit_ops ops;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">static void drv_i2c_gpio_init(struct drv_soft_i2c_config *i2c)</span><br><span class="line">&#123;</span><br><span class="line">    struct drv_soft_i2c_config* cfg = i2c;</span><br><span class="line"></span><br><span class="line">    i2c_pin_mode(cfg-&gt;scl, I2C_PIN_MODE_OUTPUT_OD);	//PIN_MODE_OUTPUT</span><br><span class="line">    i2c_pin_mode(cfg-&gt;sda, I2C_PIN_MODE_OUTPUT_OD);</span><br><span class="line"></span><br><span class="line">    i2c_pin_write(cfg-&gt;scl, I2C_PIN_HIGH);</span><br><span class="line">    i2c_pin_write(cfg-&gt;sda, I2C_PIN_HIGH);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int drv_hw_i2c_init(EI2C_DEVICE dev_e)</span><br><span class="line">&#123;</span><br><span class="line">	int size = sizeof(i2c_pin_config)/sizeof(struct drv_soft_i2c_config);</span><br><span class="line">	struct drv_i2c_bus_device *dev = get_i2c_device(dev_e);</span><br><span class="line">	uint8_t dev_num = (uint8_t)dev_e;</span><br><span class="line">	struct drv_soft_i2c_config *pin_cfg = NULL;</span><br><span class="line">	struct drv_i2c_bit_ops *ops = &amp;dev-&gt;ops;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">for</span>(int i=0;i&lt;size;i++)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">if</span>(i2c_pin_config[i].i2c_num == dev_num)</span><br><span class="line">		&#123;</span><br><span class="line">			pin_cfg = (struct drv_soft_i2c_config *)&amp;i2c_pin_config[i];</span><br><span class="line">			<span class="built_in">break</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span>(pin_cfg == NULL)</span><br><span class="line">		<span class="built_in">return</span> -1;</span><br><span class="line">    ops-&gt;data  = (void*)pin_cfg;</span><br><span class="line">    ops-&gt;set_sda  = n32_set_sda;</span><br><span class="line">    ops-&gt;set_scl  = n32_set_scl;</span><br><span class="line">    ops-&gt;get_sda  = n32_get_sda;</span><br><span class="line">    ops-&gt;get_scl  = n32_get_scl;</span><br><span class="line">    ops-&gt;udelay   = n32_udelay;</span><br><span class="line">    ops-&gt;delay_us = 1;</span><br><span class="line">    ops-&gt;<span class="built_in">timeout</span>  = 5;</span><br><span class="line">    </span><br><span class="line">    drv_i2c_gpio_init(pin_cfg);</span><br><span class="line">    drv_i2c_bus_unlock(pin_cfg);</span><br><span class="line">    <span class="built_in">return</span> 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="æ¥å£å‡½æ•°"><a href="#æ¥å£å‡½æ•°" class="headerlink" title="æ¥å£å‡½æ•°"></a>æ¥å£å‡½æ•°</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">int drv_i2c_bit_xfer(struct drv_i2c_bit_ops *bus,</span><br><span class="line">                 struct drv_i2c_msg msgs[],</span><br><span class="line">                 uint32_t num);</span><br><span class="line">struct drv_i2c_bus_device *get_i2c_device(EI2C_DEVICE dev_e);</span><br><span class="line">static uint64_t i2c_tick_get(void);</span><br><span class="line">int drv_hw_i2c_init(EI2C_DEVICE dev_e);</span><br><span class="line">int drv_i2c_send_data(EI2C_DEVICE dev_e,uint16_t addr,uint8_t reg_addr,uint8_t *buf,uint16_t len);</span><br><span class="line">int drv_i2c_recv_data(EI2C_DEVICE dev_e,uint16_t addr,uint8_t reg_addr,uint8_t *buf,uint16_t len);</span><br></pre></td></tr></table></figure>

<h2 id="å®æˆ˜å¼€å‘é—®é¢˜åˆ†æ"><a href="#å®æˆ˜å¼€å‘é—®é¢˜åˆ†æ" class="headerlink" title="å®æˆ˜å¼€å‘é—®é¢˜åˆ†æ"></a>å®æˆ˜å¼€å‘é—®é¢˜åˆ†æ</h2><p>å®é™…å¼€å‘è¿‡ç¨‹ä¸­ï¼ŒåŒæ ·çš„<code>I2C</code>é©±åŠ¨ç¨‹åºï¼Œåœ¨ä¸åŒå‚å®¶èŠ¯ç‰‡çš„ä½¿ç”¨ä¸Šå‡ºç°ä¸€äº›é—®é¢˜ï¼Œå¯¼è‡´éƒ¨åˆ†å‚å®¶é€šä¿¡å¼‚å¸¸ï¼Œå¯¼è‡´æ•°æ®æ¥æ”¶ä¸æ­£ç¡®ï¼Œä»¥ä¸‹è¿›è¡Œåˆ†æå¯¹æ¯”ï¼Œä½œè¯å¹¶è§£å†³é—®é¢˜ã€‚</p>
<h3 id="Vishay-å’Œ-äº¿å…‰-æ¥è¿‘ä¼ æ„Ÿå™¨æ¨¡å—å¯¹æ¯”"><a href="#Vishay-å’Œ-äº¿å…‰-æ¥è¿‘ä¼ æ„Ÿå™¨æ¨¡å—å¯¹æ¯”" class="headerlink" title="Vishay å’Œ äº¿å…‰ æ¥è¿‘ä¼ æ„Ÿå™¨æ¨¡å—å¯¹æ¯”"></a>Vishay å’Œ äº¿å…‰ æ¥è¿‘ä¼ æ„Ÿå™¨æ¨¡å—å¯¹æ¯”</h3><p><code>Vishay</code>ä½¿ç”¨<code>VCNL3682S</code>å‹å·èŠ¯ç‰‡ï¼Œäº¿å…‰ä½¿ç”¨<code>APM-16D24-U6E</code>å‹å·èŠ¯ç‰‡ï¼Œ<code>I2C</code>åè®®å¯¹æ¯”ã€‚</p>
<h5 id="Vishay-ï¼š"><a href="#Vishay-ï¼š" class="headerlink" title="Vishay ï¼š"></a>Vishay ï¼š</h5><p><img src="/../pictures/Vishay%E5%86%99i2c%E5%8D%8F%E8%AE%AE.png" alt="Vishayå†™i2cåè®®"><br><img src="/../pictures/Vishay%E8%AF%BBi2c%E5%8D%8F%E8%AE%AE.png" alt="Vishayè¯»i2cåè®®"></p>
<h5 id="äº¿å…‰ï¼š"><a href="#äº¿å…‰ï¼š" class="headerlink" title="äº¿å…‰ï¼š"></a>äº¿å…‰ï¼š</h5><p><img src="/../pictures/%E4%BA%BF%E5%85%89i2c%E5%8D%8F%E8%AE%AE.png" alt="äº¿å…‰i2cåè®®"></p>
<h6 id="å¯¹æ¯”æ³¢å½¢"><a href="#å¯¹æ¯”æ³¢å½¢" class="headerlink" title="å¯¹æ¯”æ³¢å½¢"></a>å¯¹æ¯”æ³¢å½¢</h6><p>å¯¹æ¯”åè®®æ¥çœ‹åŸºæœ¬ä¸Šæ˜¯ä¸€è‡´çš„ï¼Œç”¨<code>JI2C</code>å·¥å…·æµ‹çš„<code>i2c</code>æ³¢å½¢ä¹ŸåŸºæœ¬ä¸Šä¸€è‡´ï¼Œä½†æ˜¯æˆ‘è‡ªå·±å†™çš„è½¯ä»¶<code>i2c</code>é©±åŠ¨ï¼Œ<code>Vishay</code>å¯ä»¥æ­£å¸¸ä½¿ç”¨ï¼Œäº¿å…‰è¯»å–çš„æ•°æ®å°±æœ‰é—®é¢˜ï¼Œç”¨é€»è¾‘åˆ†æä»ªæŠ“ä¸€æ³¢æ³¢å½¢åˆ†æä¸€ä¸‹ã€‚</p>
<p>å‘ç°æ¯æ¬¡è¯»å®Œéƒ½ä¼šå¤šæ¢å¤ä¸€ä¸ª<code>ack</code>ï¼Œè€Œåè®®ä¸Šè¯»å®Œæœ€åä¸€ä¸ªå­—èŠ‚éœ€è¦æ¢å¤<code>nack</code>ã€‚</p>
<h6 id="ä¿®æ”¹äº†ä»¥ä¸‹ä»£ç "><a href="#ä¿®æ”¹äº†ä»¥ä¸‹ä»£ç " class="headerlink" title="ä¿®æ”¹äº†ä»¥ä¸‹ä»£ç "></a>ä¿®æ”¹äº†ä»¥ä¸‹ä»£ç </h6><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">static int i2c_send_ack_or_nack(struct drv_i2c_bit_ops *bus, int ack)</span><br><span class="line">&#123;</span><br><span class="line">    struct drv_i2c_bit_ops *ops = bus;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (ack)				// <span class="keyword">if</span>(ack &gt;= 0) æ”¹æˆ <span class="keyword">if</span>(ack)</span><br><span class="line">        SET_SDA(ops, 0);</span><br><span class="line">    i2c_delay(ops);</span><br><span class="line">    <span class="keyword">if</span> (SCL_H(ops) &lt; 0)</span><br><span class="line">    &#123;</span><br><span class="line">//        logVerbose(<span class="string">&quot;ACK or NACK timeout.&quot;</span>);</span><br><span class="line">        <span class="built_in">return</span> -2;</span><br><span class="line">    &#125;</span><br><span class="line">    SCL_L(ops);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">return</span> 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>static int i2c_send_ack_or_nack(struct drv_i2c_bit_ops *bus, int ack)&#123;&#125;</code><br>å‡½æ•°ä¸»è¦å¤„ç†å“åº”å›å¤ã€‚</p>
<pre><code>if(ack &gt;= 0)è¡¨ç¤ºæ¯æ¬¡éƒ½ä¼šå›å¤ack/nack
if(ack)è¡¨ç¤ºé™¤æœ€åä¸€æ¬¡æ•°æ®ä¸å›å¤ï¼Œå…¶ä»–æ¯æ¬¡éƒ½ä¼šå›å¤ack/nack
</code></pre>
<br>
]]></content>
      <categories>
        <category>ç¡¬ä»¶è°ƒè¯•</category>
      </categories>
      <tags>
        <tag>é€»è¾‘åˆ†æä»ª</tag>
        <tag>æ¥è¿‘ä¼ æ„Ÿå™¨</tag>
      </tags>
  </entry>
  <entry>
    <title>å•ç‰‡æœºå¼€å‘é—®é¢˜æ±‡æ€»</title>
    <url>/2024/01/31/MCU%E5%BC%80%E5%8F%91%E9%97%AE%E9%A2%98%E6%B1%87%E6%80%BB/</url>
    <content><![CDATA[<h2 id="å†…æ ¸å¤ä½ï¼ˆkernel-resetï¼‰"><a href="#å†…æ ¸å¤ä½ï¼ˆkernel-resetï¼‰" class="headerlink" title="å†…æ ¸å¤ä½ï¼ˆkernel resetï¼‰"></a>å†…æ ¸å¤ä½ï¼ˆkernel resetï¼‰</h2><h3 id="å¸¸è§é€šç”¨é—®é¢˜"><a href="#å¸¸è§é€šç”¨é—®é¢˜" class="headerlink" title="å¸¸è§é€šç”¨é—®é¢˜"></a>å¸¸è§é€šç”¨é—®é¢˜</h3><ol>
<li>å†…æ ¸å¤ä½ä»£ç ï¼Œå†…æ ¸å¤ä½ä¹‹å‰è™½ç„¶å…³é—­äº†ä¸­æ–­ï¼Œä½†æ˜¯DMAæ•°æ®æ¥æ”¶&#x2F;å‘é€è¿˜æ˜¯åœ¨è¿è¡Œï¼Œå¤ä½åæ²¡æœ‰ç®¡ç†çš„æ—¶å€™å°±ä¼šæº¢å‡ºï¼š</li>
</ol>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">kernel_reset</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    __DSB();</span><br><span class="line">    __disable_irq();							<span class="comment">//close irq</span></span><br><span class="line">	drv_usart_deinit(ESERIAL_1);				<span class="comment">//disable uart</span></span><br><span class="line">	drv_usart_deinit(ESERIAL_2);</span><br><span class="line">	drv_usart_deinit(ESERIAL_3);</span><br><span class="line">	drv_usart_deinit(ESERIAL_6);</span><br><span class="line">	drv_adc_deinit(EADC_DEV1,EDMA_CH6);			<span class="comment">//disable adc data</span></span><br><span class="line">    SCB-&gt;AIRCR = ((<span class="number">0x5FA</span> &lt;&lt; SCB_AIRCR_VECTKEY_Pos)      |</span><br><span class="line">                  (SCB-&gt;AIRCR &amp; SCB_AIRCR_PRIGROUP_Msk) |</span><br><span class="line">                   SCB_AIRCR_VECTRESET_Msk);</span><br><span class="line">    __DSB();</span><br><span class="line">    <span class="keyword">while</span>(<span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>æ¿çº§åˆå§‹åŒ–å‰å…ˆè¦é‡ç½®çŠ¶æ€ï¼š</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">DMA_DeInit(dma_chx);		<span class="comment">//DMAå¼€å¯å¾ªç¯æ¥æ”¶åä¼šæŒç»­æ¥æ”¶å­—èŠ‚</span></span><br><span class="line">ADC_DeInit(adc_handler);</span><br></pre></td></tr></table></figure>
</li>
<li><p>é©±åŠ¨ååˆå§‹åŒ–:</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">drv_adc_deinit</span><span class="params">(EADC_DEVICE adc_dev,EDMA_CHANNEL dma_ch)</span></span><br><span class="line">&#123;</span><br><span class="line">	ADC_Module *adc_handler = drv_get_adc_device(adc_dev)-&gt;ADC_Handler;</span><br><span class="line">	DMA_ChannelType * dma_chx = drv_get_dma_channel(dma_ch);</span><br><span class="line">	</span><br><span class="line">	drv_adc_enable(adc_dev,DISABLE);</span><br><span class="line">	DMA_EnableChannel(dma_chx,DISABLE);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">drv_usart_deinit</span><span class="params">(ESERIAL_DEV dev)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span>(dev == ESERIAL_1)</span><br><span class="line">    &#123;</span><br><span class="line">        USART_ConfigInt(USART1, USART_INT_IDLEF, DISABLE);</span><br><span class="line">        USART_ReceiveData(USART1);</span><br><span class="line">        USART_EnableDMA(USART1, USART_DMAREQ_TX, DISABLE);</span><br><span class="line">        USART_EnableDMA(USART1, USART_DMAREQ_RX, DISABLE);</span><br><span class="line">        USART_Enable(USART1, DISABLE);</span><br><span class="line">        USART_DeInit(USART1);</span><br><span class="line">        DMA_ConfigInt(DMA1_CH5, DMA_INT_TXC, DISABLE);</span><br><span class="line">        DMA_ClearFlag(DMA1_FLAG_TC5,DMA1);</span><br><span class="line">        DMA_EnableChannel(DMA1_CH5, DISABLE);</span><br><span class="line">        DMA_EnableChannel(DMA1_CH4, DISABLE);</span><br><span class="line">        DMA_DeInit(DMA1_CH5);</span><br><span class="line">        DMA_DeInit(DMA1_CH4);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(dev == ESERIAL_2)</span><br><span class="line">    &#123;</span><br><span class="line">        USART_ConfigInt(USART2, USART_INT_IDLEF, DISABLE);</span><br><span class="line">        USART_ReceiveData(USART2);</span><br><span class="line">        USART_EnableDMA(USART2, USART_DMAREQ_RX, DISABLE);</span><br><span class="line">        USART_Enable(USART2, DISABLE);</span><br><span class="line">        USART_DeInit(USART2);</span><br><span class="line">        DMA_ConfigInt(DMA1_CH6, DMA_INT_TXC, DISABLE);</span><br><span class="line">        DMA_ClearFlag(DMA1_FLAG_TC6,DMA1);</span><br><span class="line">        DMA_EnableChannel(DMA1_CH6, DISABLE);</span><br><span class="line">        DMA_DeInit(DMA1_CH6);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(dev == ESERIAL_3)</span><br><span class="line">    &#123;</span><br><span class="line">        USART_ConfigInt(USART3, USART_INT_IDLEF, DISABLE);</span><br><span class="line">        USART_ReceiveData(USART3);</span><br><span class="line">        USART_EnableDMA(USART3, USART_DMAREQ_RX, DISABLE);</span><br><span class="line">        USART_Enable(USART3, DISABLE);</span><br><span class="line">        USART_DeInit(USART3);</span><br><span class="line">        DMA_ConfigInt(DMA1_CH3, DMA_INT_TXC, DISABLE);</span><br><span class="line">        DMA_ClearFlag(DMA1_FLAG_TC3,DMA1);</span><br><span class="line">        DMA_EnableChannel(DMA1_CH3, DISABLE);</span><br><span class="line">        DMA_DeInit(DMA1_CH3);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(dev == ESERIAL_6)</span><br><span class="line">    &#123;</span><br><span class="line">        USART_Enable(UART6, DISABLE);</span><br><span class="line">        USART_DeInit(UART6);</span><br><span class="line">        DMA_EnableChannel(DMA2_CH6, DISABLE);</span><br><span class="line">        DMA_DeInit(DMA2_CH6);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<br></li>
</ul>
<ol start="2">
<li>å†…æ ¸å¤ä½å¼•èµ·çš„å¤–éƒ¨<code>flash</code>åˆå§‹åŒ–å¤±è´¥ï¼Œä¸²å£å¼‚å¸¸</li>
</ol>
<p><img src="/../pictures/%E5%A4%96%E9%83%A8flash%E5%88%9D%E5%A7%8B%E5%8C%96%E5%A4%B1%E8%B4%A5.png" alt="å¤–éƒ¨flashåˆå§‹åŒ–å¤±è´¥"></p>
<br>

<h3 id="n32g452rcå†…æ ¸å¤ä½é—®é¢˜"><a href="#n32g452rcå†…æ ¸å¤ä½é—®é¢˜" class="headerlink" title="n32g452rcå†…æ ¸å¤ä½é—®é¢˜"></a>n32g452rcå†…æ ¸å¤ä½é—®é¢˜</h3><h4 id="bootloaderè·³è½¬åˆ°app"><a href="#bootloaderè·³è½¬åˆ°app" class="headerlink" title="bootloaderè·³è½¬åˆ°app"></a>bootloaderè·³è½¬åˆ°app</h4><ul>
<li>æ ˆå¤§å°æ”¹å˜åè·³è½¬æˆåŠŸï¼šå°†<code>ram</code>ç©ºé—´æ•°æ®<code>uint16_t</code>æ”¹ä¸º<code>uint32_t</code>ã€‚</li>
<li>å †å¤§å°æ”¹å˜åè·³è½¬æˆåŠŸï¼šå°†é˜Ÿåˆ—ç”³è¯·é•¿åº¦<code>20</code>æ”¹ä¸º<code>30</code>ã€‚</li>
<li>ä»£ç å¤§å°å˜åŒ–åè·³è½¬å¤±è´¥ï¼š<ul>
<li>ä»£ç æ®µå˜é•¿ï¼Œèƒ½è·‘è¿›<code>system_init</code>,è·‘é£å¾…æŸ¥ã€‚</li>
<li>ä»£ç æ®µå˜çŸ­ï¼Œä¸èƒ½è·‘è¿›<code>system_init</code>,è·‘é£å¾…æŸ¥ã€‚</li>
</ul>
</li>
</ul>
<p><strong>æ€»ç»“ï¼š</strong></p>
<ul>
<li><code>n32g45x</code>ç³»åˆ—æ ˆå¤§å°å’Œå †å¤§å°å½±å“ä¸å¤§ï¼Œåªè¦ä»£ç æ®µå¤§å°ä¸å˜ï¼Œè·³è½¬æˆåŠŸï¼›è‹¥ä»£ç æ®µé•¿åº¦å˜åŒ–ï¼Œè·³è½¬å¤±è´¥ã€‚ï¼ˆèŠ¯ç‰‡åŸå› ä¸æ”¯æŒï¼‰</li>
<li><code>n32l40x</code>ç³»åˆ—ä¸å­˜åœ¨æ­¤ç±»é—®é¢˜ã€‚</li>
</ul>
<br>

<h2 id="MCUå¤ä½åçŠ¶æ€"><a href="#MCUå¤ä½åçŠ¶æ€" class="headerlink" title="MCUå¤ä½åçŠ¶æ€"></a>MCUå¤ä½åçŠ¶æ€</h2><ul>
<li><p>å¤ä½æœŸé—´å’Œåˆšå¤ä½åï¼Œå¤ç”¨åŠŸèƒ½æœªå¼€å¯,<code>I/O</code>ç«¯å£è¢«é…ç½®æˆæ¨¡æ‹ŸåŠŸèƒ½æ¨¡å¼(<code>PCFGy[1:0] = 00b</code>, <code>PMODEy[1:0] = 00b</code>)ã€‚</p>
</li>
<li><p>ä½†æœ‰ä»¥ä¸‹å‡ ä¸ªä¾‹å¤–çš„ä¿¡å·ï¼š<code>BOOT0</code>ã€ <code>NRST</code>ã€ <code>OSC_IN</code>ã€ <code>OSC_OUT</code> é»˜è®¤æ—  <code>GPIO</code> åŠŸèƒ½ï¼š</p>
<ul>
<li><code>BOOT0</code> å¼•è„šé»˜è®¤è¾“å…¥ä¸‹æ‹‰</li>
<li><code>NRST</code> ä¸Šæ‹‰è¾“å…¥è¾“å‡º</li>
</ul>
</li>
<li><p>å¤ä½åï¼Œè°ƒè¯•ç³»ç»Ÿç›¸å…³çš„å¼•è„šé»˜è®¤çŠ¶æ€ä¸ºå¯åŠ¨ <code>SWD-JTAG</code>ï¼Œ <code>JTAG</code> å¼•è„šè¢«ç½®äºè¾“å…¥ä¸Šæ‹‰æˆ–ä¸‹æ‹‰æ¨¡å¼ï¼š</p>
<ul>
<li><code>PA15</code>ï¼š<code>JTDI</code> ç½®äºè¾“å…¥ä¸Šæ‹‰æ¨¡å¼ </li>
<li><code>PA14</code>ï¼š<code>JTCK</code> ç½®äºè¾“å…¥ä¸‹æ‹‰æ¨¡å¼ </li>
<li><code>PA13</code>ï¼š<code>JTMS</code> ç½®äºè¾“å…¥ä¸Šæ‹‰æ¨¡å¼</li>
<li><code>PB4</code>ï¼š<code>NJTRST</code> ç½®äºè¾“å…¥ä¸Šæ‹‰æ¨¡å¼</li>
<li><code>PB3</code>ï¼š<code>JTD0</code> ç½®äºæ¨æŒ½è¾“å‡ºæ— ä¸Šä¸‹æ‹‰</li>
</ul>
</li>
<li><p><code>PD0</code> å’Œ <code>PD1</code></p>
<ul>
<li><code>PD0</code> å’Œ <code>PD1</code> åœ¨ <code>80</code> åŠä»¥ä¸Šå¼•è„šå°è£…é»˜è®¤ä¸ºæ¨¡æ‹Ÿæ¨¡å¼</li>
<li><code>PD0</code> å’Œ <code>PD1</code> åœ¨ <code>80</code> ä»¥ä¸‹å¼•è„šå°è£…å¤ç”¨åˆ° OSC_IN&#x2F;OUT</li>
</ul>
</li>
<li><p><code>PC13</code>ã€ <code>PC14</code>ã€ <code>PC15</code>ï¼š</p>
<ul>
<li><code>PC13ï½15</code> ä¸ºå¤‡ç”µåŸŸä¸‹çš„ä¸‰ä¸ª<code> IO</code>ï¼Œ å¤‡ä»½åŸŸåˆæ¬¡ä¸Šç”µé»˜è®¤ä¸ºæ¨¡æ‹Ÿæ¨¡å¼ï¼›</li>
</ul>
</li>
<li><p><code>PD14</code>ä¸ºå¤–éƒ¨æ™¶æŒ¯è¾“å…¥å¼•è„šï¼Œä¸è¦åš<code>MCU</code>ä½¿èƒ½è„šï¼Œä¸Šç”µç”µå¹³ä¼šæœ‰æŠ–åŠ¨ï¼Œä¼šè¯¯è§¦å‘ä¸Šç”µã€‚</p>
</li>
</ul>
<br>

<ul>
<li><code>PB2</code>&#x2F;<code>BOOT1</code>ï¼š<ul>
<li><code>PB2</code>&#x2F;<code>BOOT1</code> é»˜è®¤å¤„äºä¸‹æ‹‰è¾“å…¥çŠ¶æ€ï¼›</li>
</ul>
</li>
</ul>
<br>

<ul>
<li><code>BOOT0</code> é»˜è®¤è¾“å…¥ä¸‹æ‹‰ï¼Œå‚ç…§ä¸‹è¡¨ï¼Œ è‹¥ <code>BOOT</code> çš„å¼•è„šæœªè¿æ¥ï¼Œåˆ™é»˜è®¤é€‰æ‹© <code>Flash</code> ä¸»å­˜å‚¨åŒºã€‚</li>
</ul>
<p><img src="/../pictures/mcu%E5%90%AF%E5%8A%A8%E9%80%89%E9%A1%B9%E8%A1%A8.png" alt="mcuå¯åŠ¨é€‰é¡¹è¡¨"></p>
<br>

<p><strong>é—®é¢˜</strong>ï¼š<code>n32g452</code>ç³»åˆ—èŠ¯ç‰‡ï¼Œ <code>ä¸²å£2</code>æ— æ³•å‘é€æ•°æ®é—®é¢˜</p>
<ul>
<li>æ‰“å°æµ‹è¯•è¿›å…¥äº†<code>usart2</code>çš„ä¸²å£å‘é€å‡½æ•°ï¼Œç¤ºæ³¢å™¨æµ‹é‡ï¼Œæœ‰å°–å³°å¼‚å¸¸æ³¢å½¢ã€‚</li>
</ul>
<p><strong>è§£å†³</strong>ï¼š<code>ä¸²å£2</code>å¼•è„šä¸º<code>PB4</code>,é»˜è®¤ä¸º<code>JTAG</code>å¼•è„šï¼Œå¤ç”¨æ—¶åº”å…³é—­<code>JTAG</code>åŠŸèƒ½ã€‚</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ä½¿ç”¨jlinkå¼•è„šå¤ç”¨æˆGPIOæ—¶éœ€è¦å…³é—­jlinkå¼•è„šåŠŸèƒ½ï¼Œå¦åˆ™æ— æ³•æ­£å¸¸è¾“å‡ºã€‚</span></span><br><span class="line">GPIO_ConfigPinRemap(GPIO_RMP_SW_JTAG_SW_ENABLE, ENABLE);</span><br></pre></td></tr></table></figure>

<ul>
<li>æ—¶é’Ÿå¼•è„šä½¿ç”¨é—®é¢˜(<code>n32l406</code>ä¸ºä¾‹)ï¼Œå¯èƒ½ä¸éœ€è¦å¤ç”¨ï¼Œä»¥å®é™…ä¸ºå‡†ã€‚<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*å¼€å¯å¤ç”¨çš„å¤–è®¾æ—¶é’Ÿä½¿èƒ½*/</span></span><br><span class="line"><span class="keyword">if</span>(pin == <span class="number">5</span>)</span><br><span class="line">&#123;</span><br><span class="line">	RCC_EnableAPB2PeriphClk(RCC_APB2_PERIPH_AFIO,ENABLE);</span><br><span class="line">	GPIO_ConfigPinRemap(GPIOD_PORT_SOURCE,GPIO_PIN_SOURCE14,GPIO_NO_AF);	<span class="comment">/*æ˜ å°„çš„ä½¿èƒ½*/</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(pin == <span class="number">6</span>)</span><br><span class="line">&#123;</span><br><span class="line">	RCC_EnableAPB2PeriphClk(RCC_APB2_PERIPH_AFIO,ENABLE);</span><br><span class="line">	GPIO_ConfigPinRemap(GPIOD_PORT_SOURCE,GPIO_PIN_SOURCE15,GPIO_NO_AF);	<span class="comment">/*æ˜ å°„çš„ä½¿èƒ½*/</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<br></li>
</ul>
<h2 id="printfé‡å®šå‘"><a href="#printfé‡å®šå‘" class="headerlink" title="printfé‡å®šå‘"></a>printfé‡å®šå‘</h2><ul>
<li>MDKç‰ˆæœ¬ï¼Œå‹¾é€‰Use MicroLIBé€‰é¡¹ï¼š</li>
</ul>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="type">static</span> <span class="type">int</span> is_lr_sent = <span class="number">0</span>;</span><br><span class="line"><span class="type">int</span> <span class="title function_">fputc</span><span class="params">(<span class="type">int</span> ch, FILE* f)</span></span><br><span class="line">&#123;</span><br><span class="line">   <span class="keyword">if</span> (ch == <span class="string">&#x27;\r&#x27;</span>)</span><br><span class="line">   &#123;</span><br><span class="line">       is_lr_sent = <span class="number">1</span>;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">else</span> <span class="keyword">if</span> (ch == <span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">   &#123;</span><br><span class="line">       <span class="keyword">if</span> (!is_lr_sent)</span><br><span class="line">   	&#123;</span><br><span class="line">           USART_SendData(USART1, <span class="string">&#x27;\r&#x27;</span>);</span><br><span class="line">           <span class="keyword">while</span> (USART_GetFlagStatus(USART1, USART_FLAG_TXDE) == RESET);</span><br><span class="line">   	&#125;</span><br><span class="line">   	is_lr_sent = <span class="number">0</span>;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">else</span></span><br><span class="line">   &#123;</span><br><span class="line">   	is_lr_sent = <span class="number">0</span>;</span><br><span class="line">   &#125;</span><br><span class="line">   USART_SendData(USART1, ch);</span><br><span class="line">   <span class="keyword">while</span> (USART_GetFlagStatus(USART1, USART_FLAG_TXDE) == RESET);</span><br><span class="line">   <span class="keyword">return</span> ch;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>GCCç‰ˆæœ¬</li>
</ul>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="type">int</span> _write(<span class="type">int</span> fd, <span class="type">char</span>* pBuffer, <span class="type">int</span> size)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; size; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        USART_SendData(USART1, pBuffer[i]);</span><br><span class="line">        <span class="keyword">while</span> (USART_GetFlagStatus(USART1, USART_FLAG_TXDE) == RESET);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> size;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<br>

<h2 id="RT-THREADè°ƒè¯•é—®é¢˜"><a href="#RT-THREADè°ƒè¯•é—®é¢˜" class="headerlink" title="RT-THREADè°ƒè¯•é—®é¢˜"></a>RT-THREADè°ƒè¯•é—®é¢˜</h2><h3 id="LETTER-SHELLé—®é¢˜"><a href="#LETTER-SHELLé—®é¢˜" class="headerlink" title="LETTER SHELLé—®é¢˜"></a>LETTER SHELLé—®é¢˜</h3><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">// SHELL_USING_LOCKè®¾ä¸º 1ï¼Œåˆ™éœ€è¦åˆå§‹åŒ–äº’æ–¥é”ï¼Œå¦åˆ™shellä¼šå¡æ­»ã€‚</span></span><br><span class="line"><span class="comment">// LOG_USING_LOCKè®¾ä¸º 0ï¼Œå¦åˆ™logä¼šå¡æ­»ï¼Œé—®é¢˜å¾…åç»­éªŒè¯ã€‚</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SHELL_USING_LOCK    1       </span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LOG_USING_LOCK      0</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">if</span> SHELL_USING_LOCK</span></span><br><span class="line"><span class="type">static</span> <span class="class"><span class="keyword">struct</span> <span class="title">rt_mutex</span> <span class="title">shellMutex</span>;</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">userShellLock</span><span class="params">(Shell *sh)</span></span><br><span class="line">&#123;</span><br><span class="line">    rt_mutex_take(&amp;shellMutex,RT_WAITING_FOREVER);		<span class="comment">// rt_tick_from_millisecond(100),RT_WAITING_FOREVER</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @brief ç”¨æˆ·shellè§£é”</span></span><br><span class="line"><span class="comment"> * @param shell shell</span></span><br><span class="line"><span class="comment"> * @return int 0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">userShellUnlock</span><span class="params">(Shell *sh)</span></span><br><span class="line">&#123;</span><br><span class="line">    rt_mutex_release(&amp;shellMutex);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">if</span> LOG_USING_LOCK</span></span><br><span class="line"><span class="type">static</span> <span class="class"><span class="keyword">struct</span> <span class="title">rt_mutex</span> <span class="title">logMutex</span>;</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">userLogLock</span><span class="params">(Log *<span class="built_in">log</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    rt_mutex_take(&amp;logMutex, RT_WAITING_FOREVER);		<span class="comment">//rt_tick_from_millisecond(10)</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">userLogUnlock</span><span class="params">(Log *<span class="built_in">log</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    rt_mutex_release(&amp;logMutex);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">User_Shell_Init</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">serial_configure</span> <span class="title">config</span> =</span> EC_SERIAL_CONFIG_DEFAULT;</span><br><span class="line">    config.baud_rate = BAUD_RATE_921600;</span><br><span class="line">    drv_usart_init(ESERIAL_1, ESERIAL_MODE_DMA_RX | ESERIAL_MODE_DMA_TX, &amp;config);</span><br><span class="line"><span class="meta">#<span class="keyword">if</span> SHELL_USING_LOCK</span></span><br><span class="line">	rt_mutex_init(&amp;shellMutex,<span class="string">&quot;shellMutex&quot;</span>,RT_IPC_FLAG_FIFO);</span><br><span class="line">	shell.unlock = userShellUnlock;</span><br><span class="line">	shell.lock = userShellLock;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">if</span> LOG_USING_LOCK</span></span><br><span class="line">	rt_mutex_init(&amp;logMutex,<span class="string">&quot;logMutex&quot;</span>,RT_IPC_FLAG_FIFO);</span><br><span class="line">	uartLog.unlock = userLogUnlock;</span><br><span class="line">	uartLog.lock = userLogLock;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">    shell.write = User_Shell_Write;</span><br><span class="line">	shell.read = User_Shell_Read;</span><br><span class="line">    shellInit(&amp;shell, shell_buffer, <span class="keyword">sizeof</span>(shell_buffer));</span><br><span class="line">	logRegister(&amp;uartLog, &amp;shell);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="ä¸²å£é€šä¿¡å¼‚å¸¸"><a href="#ä¸²å£é€šä¿¡å¼‚å¸¸" class="headerlink" title="ä¸²å£é€šä¿¡å¼‚å¸¸"></a>ä¸²å£é€šä¿¡å¼‚å¸¸</h3><ul>
<li>æ‰“å¼€UART7æ¥æ”¶ä¸º<code>DMA IDLE</code>ä¸­æ–­ï¼Œç”³è¯·ä¸€ä¸ªè¶…æ—¶å®šæ—¶å™¨ï¼Œå‘é€&#x2F;æ¥å—å„ä¸€ä¸ªä»»åŠ¡ï¼Œå‘é€&#x2F;æ¥å—ä¸¤ä¸ªé˜Ÿåˆ—,ä»¥ä¸‹æ˜¯é”™è¯¯ä¿¡æ¯ï¼š</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">psr: 0x60000000</span><br><span class="line">r00: 0x00000000</span><br><span class="line">r01: 0x20007978</span><br><span class="line">r02: 0x20007978</span><br><span class="line">r03: 0x00000000</span><br><span class="line">r04: 0x00000000</span><br><span class="line">r05: 0x00000000</span><br><span class="line">r06: 0x00000000</span><br><span class="line">r07: 0x20000920</span><br><span class="line">r08: 0x20005908</span><br><span class="line">r09: 0x20000568</span><br><span class="line">r10: 0xdeadbeef</span><br><span class="line">r11: 0xdeadbeef</span><br><span class="line">r12: 0x00000000</span><br><span class="line"> lr: 0x0801156f</span><br><span class="line"> pc: 0x00000000</span><br><span class="line">hard fault on thread: timer</span><br><span class="line"></span><br><span class="line">E [00:00:07,324] (rtt-nano/src/kservice.c) rt_assert_handler [1340]: (rt_object_get_type(&amp;mq-&gt;parent.parent) == RT_Object_Class_MessageQueue) assertion failed at <span class="keyword">function</span>:rt_mq_send_wait, line number:2026 </span><br><span class="line"></span><br><span class="line">E [00:00:00,659] (rtt-nano/src/kservice.c) rt_assert_handler [1340]: (rt_object_get_type(&amp;timer-&gt;parent) == RT_Object_Class_Timer) assertion failed at <span class="keyword">function</span>:rt_timer_control, line number:474 </span><br><span class="line"></span><br><span class="line">E [00:00:39,282] (rtt-nano/src/kservice.c) rt_assert_handler [1340]: (rt_object_get_type((rt_object_t)thread) == RT_Object_Class_Thread) assertion failed at function:rt_thread_resume, line number:<span class="number">760</span> </span><br></pre></td></tr></table></figure>

<ul>
<li>é—®é¢˜å®šä½åˆ°æŒ‡é’ˆå˜é‡<code>p_srx_mq[0]</code>å’Œ<code>&amp;p_srx_mq[0]</code>çš„åŒºåˆ«ï¼Œä»£ç å¦‚ä¸‹ï¼š</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#define COMM_MAX_NUM     3</span></span><br><span class="line">static uint8_t *p_srx_mq[COMM_MAX_NUM];</span><br><span class="line">static struct comm_serial_mq srx_mq_data[COMM_MAX_NUM];</span><br><span class="line">static struct rt_timer comm_rx_stimer[COMM_MAX_NUM];</span><br><span class="line"></span><br><span class="line">static void comm_serial_recieve_data_deinit(uint8_t num)</span><br><span class="line">&#123;</span><br><span class="line">	srx_mq_data[num].size = 0;</span><br><span class="line">	p_srx_mq[num] = srx_mq_data[num].data;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">static int usart_key_rx_indicate(ESERIAL_DEV serial_dev, uint16_t size)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">if</span>(p_srx_mq[0] - srx_mq_data[0].data + size &gt; sizeof(srx_mq_data[0].data))</span><br><span class="line">	&#123;</span><br><span class="line">		comm_serial_recieve_data_deinit(0);</span><br><span class="line">		<span class="built_in">return</span> -1;</span><br><span class="line">	&#125;</span><br><span class="line">	rt_timer_start(&amp;comm_rx_stimer[0]);                   // å¯åŠ¨å®šæ—¶å™¨</span><br><span class="line">	drv_fifo_data_get(serial_dev, (uint8_t *)p_srx_mq[0], size);</span><br><span class="line">	logPrintln(<span class="string">&quot;test = [%p][%p][%p]&quot;</span>,p_srx_mq[0],&amp;p_srx_mq[0],srx_mq_data[0].data);</span><br><span class="line">	p_srx_mq[0] += size;</span><br><span class="line">	srx_mq_data[0].size += size;</span><br><span class="line">	<span class="built_in">return</span> 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="FlashDBé—®é¢˜ï¼ˆç¢°å·§å¯¹ä¸Šè¿°é—®é¢˜æœªé‡åˆ°é—®é¢˜çš„è§£å†³ï¼‰"><a href="#FlashDBé—®é¢˜ï¼ˆç¢°å·§å¯¹ä¸Šè¿°é—®é¢˜æœªé‡åˆ°é—®é¢˜çš„è§£å†³ï¼‰" class="headerlink" title="FlashDBé—®é¢˜ï¼ˆç¢°å·§å¯¹ä¸Šè¿°é—®é¢˜æœªé‡åˆ°é—®é¢˜çš„è§£å†³ï¼‰"></a>FlashDBé—®é¢˜ï¼ˆç¢°å·§å¯¹ä¸Šè¿°é—®é¢˜æœªé‡åˆ°é—®é¢˜çš„è§£å†³ï¼‰</h3><ul>
<li><p>ä¸Šè¿°é—®é¢˜<code>LETTER SHELL</code>é—®é¢˜ä¸­<code>SHELL_USING_LOCK</code>è®¾ä¸º<code>1</code>ï¼Œ<code>LOG_USING_LOCK</code>éœ€è®¾ä¸º<code>0</code>,å¦åˆ™ä¼šå¡æ­»ï¼Œç»è°ƒè¯•åä¸‹é¢ä¼šåšå‡ºè§£é‡Šã€‚</p>
</li>
<li><p>åœ¨åˆå§‹åŒ–çš„æ—¶å€™ï¼Œä¸ç®¡æ˜¯<code>KVDB</code>è¿˜æ˜¯<code>TSDB</code>ï¼Œå¿…é¡»åœ¨çƒ§å®Œç¨‹åºåï¼Œ<code>reboot</code>ä¸€ä¸‹æ‰èƒ½åˆå§‹åŒ–æ‰‡åŒºæˆåŠŸï¼ŒåŸå› å¾…æŸ¥ã€‚</p>
</li>
<li><p>ä¼šå‡ºç°ä»¥ä¸‹æ‰“å°åå¡ä½ï¼š</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">admin:/$ tsdb_test</span><br><span class="line">[D/FAL] (fal_flash_init:<span class="number">47</span>) Flash device |               n32_onchip | addr: <span class="number">0x08000000</span> | len: <span class="number">0x00080000</span> | blk_size: <span class="number">0x00000800</span> |initialized finish.</span><br><span class="line">[I/FAL] ==================== FAL partition table ====================</span><br><span class="line">[I/FAL] | name      | flash_dev  |   offset   |    length  |</span><br><span class="line">[I/FAL] -------------------------------------------------------------</span><br><span class="line">[I/FAL] | bl        | n32_onchip | <span class="number">0x00000000</span> | <span class="number">0x00002800</span> |</span><br><span class="line">[I/FAL] | app       | n32_onchip | <span class="number">0x00002800</span> | <span class="number">0x00032000</span> |</span><br><span class="line">[I/FAL] | download  | n32_onchip | <span class="number">0x00034800</span> | <span class="number">0x00032000</span> |</span><br><span class="line">[I/FAL] | upflag    | n32_onchip | <span class="number">0x00066800</span> | <span class="number">0x00000800</span> |</span><br><span class="line">[I/FAL] | dcd       | n32_onchip | <span class="number">0x00067000</span> | <span class="number">0x00000800</span> |</span><br><span class="line">[I/FAL] | mcuinfo   | n32_onchip | <span class="number">0x00067800</span> | <span class="number">0x00000800</span> |</span><br><span class="line">[I/FAL] | fdb_kvdb1 | n32_onchip | <span class="number">0x00068000</span> | <span class="number">0x00001000</span> |</span><br><span class="line">[I/FAL] | fdb_tsdb1 | n32_onchip | <span class="number">0x00069000</span> | <span class="number">0x00016800</span> |</span><br><span class="line">[I/FAL] =============================================================</span><br><span class="line">[I/FAL] RT-Thread Flash Abstraction Layer (V1<span class="number">.0</span><span class="number">.0</span>) initialize success.</span><br><span class="line">[FlashDB][tsl][<span class="built_in">log</span>][fdb_tsdb1] Sector (<span class="number">0x00000000</span>) header info is incorrect.</span><br><span class="line"></span><br><span class="line"><span class="comment">// è·‘é£å¡æ­»</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>çƒ§å½•å®Œ<code>reboot</code>åï¼Œæ­£å¸¸çš„æ‰“å°ï¼š</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">admin:/$ tsdb_test</span><br><span class="line">[D/FAL] (fal_flash_init:<span class="number">47</span>) Flash device |               n32_onchip | addr: <span class="number">0x08000000</span> | len: <span class="number">0x00080000</span> | blk_size: <span class="number">0x00000800</span> |initialized finish.</span><br><span class="line">[I/FAL] ==================== FAL partition table ====================</span><br><span class="line">[I/FAL] | name      | flash_dev  |   offset   |    length  |</span><br><span class="line">[I/FAL] -------------------------------------------------------------</span><br><span class="line">[I/FAL] | bl        | n32_onchip | <span class="number">0x00000000</span> | <span class="number">0x00002800</span> |</span><br><span class="line">[I/FAL] | app       | n32_onchip | <span class="number">0x00002800</span> | <span class="number">0x00032000</span> |</span><br><span class="line">[I/FAL] | download  | n32_onchip | <span class="number">0x00034800</span> | <span class="number">0x00032000</span> |</span><br><span class="line">[I/FAL] | upflag    | n32_onchip | <span class="number">0x00066800</span> | <span class="number">0x00000800</span> |</span><br><span class="line">[I/FAL] | dcd       | n32_onchip | <span class="number">0x00067000</span> | <span class="number">0x00000800</span> |</span><br><span class="line">[I/FAL] | mcuinfo   | n32_onchip | <span class="number">0x00067800</span> | <span class="number">0x00000800</span> |</span><br><span class="line">[I/FAL] | fdb_kvdb1 | n32_onchip | <span class="number">0x00068000</span> | <span class="number">0x00001000</span> |</span><br><span class="line">[I/FAL] | fdb_tsdb1 | n32_onchip | <span class="number">0x00069000</span> | <span class="number">0x00016800</span> |</span><br><span class="line">[I/FAL] =============================================================</span><br><span class="line">[I/FAL] RT-Thread Flash Abstraction Layer (V1<span class="number">.0</span><span class="number">.0</span>) initialize success.</span><br><span class="line">[FlashDB][tsl][<span class="built_in">log</span>][fdb_tsdb1] Sector (<span class="number">0x00000000</span>) header info is incorrect.</span><br><span class="line">[FlashDB][tsl][<span class="built_in">log</span>][fdb_tsdb1] All sector format finished.</span><br><span class="line">[FlashDB][tsl][<span class="built_in">log</span>][fdb_tsdb1] (components/flashdb/fdb_tsdb.c:<span class="number">980</span>) TSDB (<span class="built_in">log</span>) oldest sectors is <span class="number">0x00000000</span>, current using sector is <span class="number">0x00000000</span>.</span><br><span class="line">[FlashDB] FlashDB V2<span class="number">.1</span><span class="number">.1</span> is initialize success.</span><br><span class="line">[FlashDB] You can get the latest version on https:<span class="comment">//github.com/armink/FlashDB .</span></span><br><span class="line">[FlashDB][sample][tsdb] ==================== tsdb_sample ====================</span><br><span class="line">[FlashDB][sample][tsdb] append the new status.temp (<span class="number">36</span>) and status.humi (<span class="number">85</span>)</span><br><span class="line">[FlashDB][sample][tsdb] append the new status.temp (<span class="number">38</span>) and status.humi (<span class="number">90</span>)</span><br><span class="line">[FlashDB][sample][tsdb] [query_cb] queried a TSL: time: <span class="number">1</span>, temp: <span class="number">36</span>, humi: <span class="number">85</span></span><br><span class="line">[FlashDB][sample][tsdb] [query_cb] queried a TSL: time: <span class="number">2</span>, temp: <span class="number">38</span>, humi: <span class="number">90</span></span><br><span class="line">[FlashDB][sample][tsdb] [query_by_time_cb] queried a TSL: time: <span class="number">1</span>, temp: <span class="number">36</span>, humi: <span class="number">85</span></span><br><span class="line">[FlashDB][sample][tsdb] [query_by_time_cb] queried a TSL: time: <span class="number">2</span>, temp: <span class="number">38</span>, humi: <span class="number">90</span></span><br><span class="line">[FlashDB][sample][tsdb] query count is: <span class="number">2</span></span><br><span class="line">[FlashDB][sample][tsdb] <span class="built_in">set</span> the TSL (time <span class="number">1</span>) status from <span class="number">2</span> to <span class="number">3</span></span><br><span class="line">[FlashDB][sample][tsdb] <span class="built_in">set</span> the TSL (time <span class="number">2</span>) status from <span class="number">2</span> to <span class="number">3</span></span><br><span class="line">[FlashDB][sample][tsdb] ===========================================================</span><br></pre></td></tr></table></figure>
</li>
<li><p>åŸå› ï¼šç”±äºflashè§£é”æ˜¯ç»™äº’æ–¥é‡åŠ é”ï¼Œä¹‹å‰å†™æˆä¸€è‡´äº†ï¼Œå†™åäº†ï¼Œå¯¼è‡´è¿›å»ä¸€æ¬¡ä¹‹åå¡æ­»ã€‚</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="type">static</span> <span class="class"><span class="keyword">struct</span> <span class="title">rt_mutex</span> <span class="title">flashMutex</span>;</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">af_flash_init</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line"> 	rt_mutex_init(&amp;flashMutex, <span class="string">&quot;flashMutex&quot;</span>, RT_IPC_FLAG_FIFO);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">af_flash_unlock</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">	rt_mutex_take(&amp;flashMutex, RT_WAITING_FOREVER);	   <span class="comment">// é”™è¯¯ç”¨ä¾‹ï¼šrt_mutex_release(&amp;flashMutex);</span></span><br><span class="line">	FLASH_Unlock();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">af_flash_lock</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">	FLASH_Lock();</span><br><span class="line">	rt_mutex_release(&amp;flashMutex);                      <span class="comment">// é”™è¯¯ç”¨ä¾‹ï¼šrt_mutex_take(&amp;flashMutex, RT_WAITING_FOREVER);	</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="ç»“æ„ä½“ä¸æŒ‡é’ˆæ±‡æ€»"><a href="#ç»“æ„ä½“ä¸æŒ‡é’ˆæ±‡æ€»" class="headerlink" title="ç»“æ„ä½“ä¸æŒ‡é’ˆæ±‡æ€»"></a>ç»“æ„ä½“ä¸æŒ‡é’ˆæ±‡æ€»</h2><h3 id="æŒ‡é’ˆå–å€ç¬¦-ä¸å–å€¼-çš„åŒºåˆ«"><a href="#æŒ‡é’ˆå–å€ç¬¦-ä¸å–å€¼-çš„åŒºåˆ«" class="headerlink" title="æŒ‡é’ˆå–å€ç¬¦&amp;ä¸å–å€¼*çš„åŒºåˆ«"></a>æŒ‡é’ˆå–å€ç¬¦&amp;ä¸å–å€¼*çš„åŒºåˆ«</h3><p><strong>1. æŒ‡é’ˆå–å€ç¬¦(&amp;)</strong></p>
<pre><code>æŒ‡é’ˆå–å€ç¬¦ &amp; ç”¨äºè·å–ä¸€ä¸ªå˜é‡çš„åœ°å€ï¼Œå¹¶å°†è¯¥åœ°å€å­˜å‚¨åœ¨ä¸€ä¸ªæŒ‡é’ˆå˜é‡ä¸­ã€‚
</code></pre>
<p><strong>å…·ä½“æ¥è¯´:</strong></p>
<ul>
<li>&amp; è¿ç®—ç¬¦ä½äºå˜é‡åå‰é¢ã€‚</li>
<li>&amp; è¿ç®—ç¬¦çš„è¿”å›å€¼æ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼ŒæŒ‡å‘è¯¥å˜é‡çš„å†…å­˜åœ°å€ã€‚</li>
</ul>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="type">int</span> num = <span class="number">10</span>;</span><br><span class="line"><span class="type">int</span> *p = &amp;num; <span class="comment">// p æŒ‡å‘ num çš„åœ°å€</span></span><br></pre></td></tr></table></figure>

<p><strong>2. å–å€¼ç¬¦(*)</strong></p>
<pre><code>å–å€¼ç¬¦ * ç”¨äºè·å–æŒ‡é’ˆå˜é‡æ‰€æŒ‡å‘çš„å˜é‡çš„å€¼ã€‚
</code></pre>
<p><strong>å…·ä½“æ¥è¯´:</strong></p>
<ul>
<li>è¿ç®—ç¬¦ä½äºæŒ‡é’ˆå˜é‡åå‰é¢ã€‚</li>
<li>è¿ç®—ç¬¦çš„è¿”å›å€¼æ˜¯è¯¥æŒ‡é’ˆå˜é‡æ‰€æŒ‡å‘å˜é‡çš„å€¼ã€‚</li>
</ul>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="type">int</span> num = <span class="number">10</span>;</span><br><span class="line"><span class="type">int</span> *p = &amp;num;</span><br><span class="line"><span class="type">int</span> value = *p;		<span class="comment">// è®¿é—® num çš„å€¼</span></span><br></pre></td></tr></table></figure>

<p><strong>æ€»ç»“ï¼š</strong></p>
<ul>
<li>æŒ‡é’ˆå–å€ç¬¦ &amp; ç”¨äºè·å–å˜é‡çš„åœ°å€ï¼Œå¹¶å°†è¯¥åœ°å€å­˜å‚¨åœ¨ä¸€ä¸ªæŒ‡é’ˆå˜é‡ä¸­ã€‚</li>
<li>å–å€¼ç¬¦ * ç”¨äºè·å–æŒ‡é’ˆå˜é‡æ‰€æŒ‡å‘çš„å˜é‡çš„å€¼ã€‚</li>
</ul>
<p><strong>éœ€è¦æ³¨æ„çš„æ˜¯ï¼š</strong></p>
<ul>
<li>ä¸èƒ½å¯¹ä¸å­˜åœ¨çš„å˜é‡è¿›è¡Œå–å€ã€‚</li>
<li>**<code>ä¸èƒ½å¯¹æŒ‡é’ˆå˜é‡è¿›è¡Œå–å€</code>**ã€‚</li>
<li>å–å€æ“ä½œå¯èƒ½ä¼šäº§ç”Ÿç©ºæŒ‡é’ˆï¼Œéœ€è¦è¿›è¡Œç©ºæŒ‡é’ˆæ£€æŸ¥ã€‚</li>
</ul>
<h4 id="ä¸ºä»€ä¹ˆä¸èƒ½å¯¹æŒ‡é’ˆå˜é‡è¿›è¡Œå–å€"><a href="#ä¸ºä»€ä¹ˆä¸èƒ½å¯¹æŒ‡é’ˆå˜é‡è¿›è¡Œå–å€" class="headerlink" title="ä¸ºä»€ä¹ˆä¸èƒ½å¯¹æŒ‡é’ˆå˜é‡è¿›è¡Œå–å€"></a>ä¸ºä»€ä¹ˆä¸èƒ½å¯¹æŒ‡é’ˆå˜é‡è¿›è¡Œå–å€</h4><p><strong>1. æŒ‡é’ˆå˜é‡æœ¬èº«ä¹Ÿæ˜¯ä¸€ä¸ªå˜é‡</strong></p>
<p>æŒ‡é’ˆå˜é‡ä¹Ÿæ˜¯ä¸€ä¸ªå˜é‡ï¼Œå®ƒå­˜å‚¨çš„æ˜¯å¦ä¸€ä¸ªå˜é‡çš„åœ°å€ã€‚ä¸å…¶ä»–å˜é‡ä¸€æ ·ï¼Œ**<code>æŒ‡é’ˆå˜é‡ä¹Ÿå­˜åœ¨äºå†…å­˜ä¸­ï¼Œå¹¶æ‹¥æœ‰è‡ªå·±çš„åœ°å€</code>**ã€‚</p>
<p><strong>2. å–å€æ“ä½œä¼šäº§ç”Ÿæ— é™å¾ªç¯</strong></p>
<p>**<code>å¦‚æœå¯¹æŒ‡é’ˆå˜é‡è¿›è¡Œå–å€ï¼Œé‚£ä¹ˆå°±ä¼šå¾—åˆ°è¯¥æŒ‡é’ˆå˜é‡çš„åœ°å€</code>**ã€‚ä½†æ˜¯ï¼Œè¯¥æŒ‡é’ˆå˜é‡æœ¬èº«ä¹Ÿæ˜¯ä¸€ä¸ªå˜é‡ï¼Œæ‰€ä»¥å…¶åœ°å€ä¹Ÿæ˜¯å­˜å‚¨åœ¨å¦ä¸€ä¸ªå˜é‡ä¸­çš„ã€‚å¦‚æ­¤å¾ªç¯å¾€å¤ï¼Œå°±ä¼šäº§ç”Ÿæ— é™å¾ªç¯ã€‚</p>
<p><strong>3. è¿èƒŒäº†æŒ‡é’ˆçš„å®šä¹‰</strong></p>
<p>æŒ‡é’ˆçš„å®šä¹‰æ˜¯æŒ‡å‘å¦ä¸€ä¸ªå˜é‡çš„åœ°å€ã€‚å¦‚æœå¯¹æŒ‡é’ˆå˜é‡è¿›è¡Œå–å€ï¼Œé‚£ä¹ˆå°±æ„å‘³ç€æŒ‡é’ˆæŒ‡å‘äº†å®ƒè‡ªå·±çš„åœ°å€ï¼Œè¿™è¿èƒŒäº†æŒ‡é’ˆçš„å®šä¹‰ã€‚</p>
<p><strong>4. å¯èƒ½å¯¼è‡´ç¨‹åºå´©æºƒ</strong></p>
<p>åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œå¯¹æŒ‡é’ˆå˜é‡è¿›è¡Œå–å€ä¼šå¯¼è‡´ç¨‹åºå´©æºƒã€‚è¿™æ˜¯å› ä¸ºç¨‹åºä¼šè¯•å›¾è®¿é—®ä¸€ä¸ªä¸å­˜åœ¨çš„å†…å­˜åœ°å€ã€‚</p>
<br>

<h3 id="ç»“æ„ä½“åç§»æ“ä½œ"><a href="#ç»“æ„ä½“åç§»æ“ä½œ" class="headerlink" title="ç»“æ„ä½“åç§»æ“ä½œ"></a>ç»“æ„ä½“åç§»æ“ä½œ</h3><ul>
<li><code>offsetof(TYPE, MEMBER)</code> å‡½æ•°ç”¨æ³•ï¼š<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* Offset of member MEMBER in a struct of type TYPE. */</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> offsetof(TYPE, MEMBER) __builtin_offsetof (TYPE, MEMBER)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> __<span class="title">attribute__</span>((<span class="title">packed</span>))</span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="type">uint8_t</span> device;</span><br><span class="line">    <span class="type">uint8_t</span> version;</span><br><span class="line">    <span class="type">uint16_t</span> packet_sum;        <span class="comment">// å¤§ç«¯æ¨¡å¼</span></span><br><span class="line">    <span class="type">uint16_t</span> packet_index;      <span class="comment">// å¤§ç«¯æ¨¡å¼</span></span><br><span class="line">    <span class="type">uint8_t</span> len;</span><br><span class="line">    <span class="type">uint8_t</span> cmd;</span><br><span class="line">    <span class="type">uint8_t</span> *data;</span><br><span class="line">    <span class="type">uint16_t</span> check_sum;         <span class="comment">// å¤§ç«¯æ¨¡å¼</span></span><br><span class="line">&#125;ble_comm_protocol;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> send_len = offsetof(ble_comm_protocol, data);       <span class="comment">// send_len é•¿åº¦ä¸º 8 bytes</span></span><br></pre></td></tr></table></figure>
<br></li>
</ul>
<h3 id="ç»“æ„ä½“æˆ–æŒ‡é’ˆåˆå§‹åŒ–"><a href="#ç»“æ„ä½“æˆ–æŒ‡é’ˆåˆå§‹åŒ–" class="headerlink" title="ç»“æ„ä½“æˆ–æŒ‡é’ˆåˆå§‹åŒ–"></a>ç»“æ„ä½“æˆ–æŒ‡é’ˆåˆå§‹åŒ–</h3><ul>
<li>æŒ‡é’ˆåˆå§‹åŒ–èµ‹å€¼ä¼šå˜æˆé‡æŒ‡é’ˆï¼Œä¸çŸ¥é“æŒ‡å‘å“ªï¼Œå› ä¸ºæ˜¯åœ¨<code>ram</code>é‡Œç”³è¯·æŒ‡é’ˆå˜é‡ï¼Œç”³è¯·çš„<code>ram</code>ä¹‹å‰æ˜¯ä»€ä¹ˆæ•°æ®ä¸çŸ¥é“ã€‚</li>
<li>ç»“æ„ä½“åˆå§‹åŒ–è·ŸæŒ‡é’ˆç±»ä¼¼ï¼Œå¦‚æœä¸åˆå§‹åŒ–å˜é‡ï¼Œè™½ç„¶ç”³è¯·äº†å˜é‡ï¼Œä½†æ˜¯å˜é‡é‡Œè¿˜æ˜¯è¿™æ®µç©ºé—´é‡Šæ”¾å‰çš„æ•°æ®ã€‚</li>
<li>è‹¥æœªåˆå§‹åŒ–çš„æŒ‡é’ˆæŒ‡å‘çš„æ˜¯å¯„å­˜å™¨çš„ç»“æ„ä½“æŒ‡é’ˆï¼Œä¼šé€ æˆä¸å¯é¢„ä¼°çš„é”™è¯¯ï¼Œæ¯”å¦‚ï¼šå½±å“æœ¬èº«å½±å“çš„åŠŸèƒ½ï¼›å…¶ä»–å¼•è„šçš„åŠŸèƒ½ï¼ˆå¯„å­˜å™¨åœ°å€æ˜¯æœ‰åºæ‘†æ”¾ï¼‰ã€‚</li>
</ul>
<h2 id="TFTå±ST7735Sè°ƒè¯•é—®é¢˜"><a href="#TFTå±ST7735Sè°ƒè¯•é—®é¢˜" class="headerlink" title="TFTå±ST7735Sè°ƒè¯•é—®é¢˜"></a>TFTå±ST7735Sè°ƒè¯•é—®é¢˜</h2><h3 id="ç¡¬ä»¶-è½¯ä»¶spiåˆå§‹åŒ–"><a href="#ç¡¬ä»¶-è½¯ä»¶spiåˆå§‹åŒ–" class="headerlink" title="ç¡¬ä»¶&#x2F;è½¯ä»¶spiåˆå§‹åŒ–"></a>ç¡¬ä»¶&#x2F;è½¯ä»¶spiåˆå§‹åŒ–</h3><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">//å¤´æ–‡ä»¶å®šä¹‰</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> HARDWARE_SPI_MODE 1	<span class="comment">//1ï¼šhardwareï¼›0ï¼šsoftware</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LCD_SCLK_Clr() GPIO_ResetBits(GPIOA, GPIO_PIN_5)	<span class="comment">//SCL=SCLK</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LCD_SCLK_Set() GPIO_SetBits(GPIOA, GPIO_PIN_5)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LCD_MOSI_Clr() GPIO_ResetBits(GPIOA, GPIO_PIN_7)		<span class="comment">//SDA=MOSI</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LCD_MOSI_Set() GPIO_SetBits(GPIOA, GPIO_PIN_7)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LCD_RES_Clr()  GPIO_ResetBits(GPIOB, GPIO_PIN_0)		<span class="comment">//RES</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LCD_RES_Set()  GPIO_SetBits(GPIOB, GPIO_PIN_0)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LCD_DC_Clr()   GPIO_ResetBits(GPIOB, GPIO_PIN_1)		<span class="comment">//DC</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LCD_DC_Set()   GPIO_SetBits(GPIOB, GPIO_PIN_1)	     </span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LCD_CS_Clr()   GPIO_ResetBits(GPIOA, GPIO_PIN_4)		<span class="comment">//CS</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LCD_CS_Set()   GPIO_SetBits(GPIOA, GPIO_PIN_4)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LCD_BLK_Clr()											<span class="comment">//BLK</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> LCD_BLK_Set()</span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">LCD_GPIO_Init</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">	GPIO_InitType GPIO_InitStructure;</span><br><span class="line">	RCC_EnableAPB2PeriphClk(RCC_APB2_PERIPH_GPIOA | RCC_APB2_PERIPH_GPIOB , ENABLE);</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">if</span> HARDWARE_SPI_MODE</span></span><br><span class="line"></span><br><span class="line">    SPI_InitType SPI_InitStructure;</span><br><span class="line">    RCC_EnableAPB2PeriphClk(RCC_APB2_PERIPH_SPI1 | RCC_APB2_PERIPH_AFIO, ENABLE);</span><br><span class="line"></span><br><span class="line">    GPIO_InitStruct(&amp;GPIO_InitStructure);</span><br><span class="line">    GPIO_InitStructure.Pin        = GPIO_PIN_4 | GPIO_PIN_5 | GPIO_PIN_7;</span><br><span class="line">    GPIO_InitStructure.GPIO_Alternate = GPIO_AF0_SPI1;</span><br><span class="line">    GPIO_InitStructure.GPIO_Mode = GPIO_Mode_AF_PP;</span><br><span class="line">    GPIO_InitPeripheral(GPIOA, &amp;GPIO_InitStructure);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* SPIy Config -------------------------------------------------------------*/</span></span><br><span class="line">    SPI_InitStructure.DataDirection = SPI_DIR_SINGLELINE_TX;</span><br><span class="line">    SPI_InitStructure.SpiMode       = SPI_MODE_MASTER;</span><br><span class="line">    SPI_InitStructure.DataLen       = SPI_DATA_SIZE_8BITS;</span><br><span class="line">    SPI_InitStructure.CLKPOL        = SPI_CLKPOL_HIGH;</span><br><span class="line">    SPI_InitStructure.CLKPHA        = SPI_CLKPHA_FIRST_EDGE;</span><br><span class="line">    SPI_InitStructure.NSS           = SPI_NSS_HARD;</span><br><span class="line">    SPI_InitStructure.BaudRatePres  = SPI_BR_PRESCALER_2;</span><br><span class="line">    SPI_InitStructure.FirstBit      = SPI_FB_MSB;</span><br><span class="line">    SPI_InitStructure.CRCPoly       = <span class="number">7</span>;</span><br><span class="line">    SPI_Init(SPI1, &amp;SPI_InitStructure);</span><br><span class="line"></span><br><span class="line">    SPI_SSOutputEnable(SPI1, ENABLE);</span><br><span class="line">    SPI_EnableCalculateCrc(SPI1, DISABLE);</span><br><span class="line">    <span class="comment">/* Enable SPIy */</span></span><br><span class="line">    SPI_Enable(SPI1, ENABLE);</span><br><span class="line"><span class="meta">#<span class="keyword">else</span></span></span><br><span class="line">    GPIO_InitStruct(&amp;GPIO_InitStructure);</span><br><span class="line">    GPIO_InitStructure.Pin = GPIO_PIN_4 | GPIO_PIN_5 | GPIO_PIN_7;</span><br><span class="line">    GPIO_InitStructure.GPIO_Mode = GPIO_Mode_Out_PP;</span><br><span class="line">    GPIO_InitPeripheral(GPIOA, &amp;GPIO_InitStructure);</span><br><span class="line"></span><br><span class="line">    GPIO_SetBits(GPIOA, GPIO_PIN_4 | GPIO_PIN_5 | GPIO_PIN_7);</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">    GPIO_InitStruct(&amp;GPIO_InitStructure);</span><br><span class="line">    GPIO_InitStructure.GPIO_Mode = GPIO_Mode_Out_PP;</span><br><span class="line">    GPIO_InitStructure.Pin = GPIO_PIN_0 | GPIO_PIN_1;</span><br><span class="line">    GPIO_InitPeripheral(GPIOB, &amp;GPIO_InitStructure);</span><br><span class="line"></span><br><span class="line">    GPIO_SetBits(GPIOB, GPIO_PIN_0 | GPIO_PIN_1);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">LCD_Writ_Bus</span><span class="params">(u8 dat)</span> </span><br><span class="line">&#123;	</span><br><span class="line">	LCD_CS_Clr();</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">if</span> HARDWARE_SPI_MODE</span></span><br><span class="line">	SPI_I2S_TransmitData(SPI1, dat);</span><br><span class="line">	<span class="keyword">while</span> (SPI_I2S_GetStatus(SPI1, SPI_I2S_TE_FLAG) == RESET); <span class="comment">//å¿…é¡»ç­‰åˆ°SPIæ•°æ®å‘å®Œï¼Œæ‰èƒ½æ‹‰é«˜CSç‰‡é€‰ï¼Œå‘ä¸‹ä¸€æ¬¡æ•°æ®ï¼Œå¦åˆ™æ•°æ®ä¼šå‡ºé”™</span></span><br><span class="line"><span class="meta">#<span class="keyword">else</span></span></span><br><span class="line">	u8 i;</span><br><span class="line">	<span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;<span class="number">8</span>;i++)</span><br><span class="line">	&#123;			  </span><br><span class="line">		LCD_SCLK_Clr();</span><br><span class="line">		<span class="keyword">if</span>(dat&amp;<span class="number">0x80</span>)</span><br><span class="line">		&#123;</span><br><span class="line">		   LCD_MOSI_Set();</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span></span><br><span class="line">		&#123;</span><br><span class="line">		   LCD_MOSI_Clr();</span><br><span class="line">		&#125;</span><br><span class="line">		LCD_SCLK_Set();</span><br><span class="line">		dat&lt;&lt;=<span class="number">1</span>;</span><br><span class="line">	&#125;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line">   LCD_CS_Set();	</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">LCD_WR_DATA8</span><span class="params">(u8 dat)</span></span><br><span class="line">&#123;</span><br><span class="line">	LCD_Writ_Bus(dat);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">LCD_WR_DATA</span><span class="params">(u16 dat)</span></span><br><span class="line">&#123;</span><br><span class="line">	LCD_Writ_Bus(dat&gt;&gt;<span class="number">8</span>);</span><br><span class="line">	LCD_Writ_Bus(dat);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br>

<h2 id="Cortex-Mç³»åˆ—å†…æ ¸å­—èŠ‚å¯¹é½æ±‡æ€»"><a href="#Cortex-Mç³»åˆ—å†…æ ¸å­—èŠ‚å¯¹é½æ±‡æ€»" class="headerlink" title="Cortex-Mç³»åˆ—å†…æ ¸å­—èŠ‚å¯¹é½æ±‡æ€»"></a>Cortex-Mç³»åˆ—å†…æ ¸å­—èŠ‚å¯¹é½æ±‡æ€»</h2><ul>
<li><p>4å­—èŠ‚å¯¹é½çš„å«ä¹‰å°±æ˜¯å˜é‡åœ°å€å¯¹4æ±‚ä½™æ•°ä¸º0ï¼›8å­—èŠ‚å¯¹é½å°±æ˜¯åœ°å€å¯¹8æ±‚ä½™ç­‰äº0ï¼Œä¾æ¬¡ç±»æ¨ï¼Œæ¯”å¦‚ï¼šå¦‚æœè®©på»è®¿é—®0x20000001ï¼Œ 0x20000002ï¼Œ0x20000003è¿™éƒ½æ˜¯ä¸å¯¹é½è®¿é—®ã€‚</p>
</li>
<li><p>å¯¹äº<code>M3å’ŒM4</code>è€Œè¨€ï¼Œå¯ä»¥ç›´æ¥è®¿é—®éå¯¹é½åœ°å€ï¼ˆæ³¨æ„èŠ¯ç‰‡è¦åœ¨è¿™ä¸ªåœ°å€æœ‰å¯¹åº”çš„å†…å­˜ç©ºé—´), å› ä¸º<code>M3å’ŒM4</code>æ˜¯æ”¯æŒçš„ï¼Œè€Œ<code>M0/M0+/M1</code>æ˜¯ä¸æ”¯æŒçš„ï¼Œä¸æ”¯æŒçš„å†…æ ¸èŠ¯ç‰‡ï¼Œåªè¦éå¯¹é½è®¿é—®å°±ä¼šè§¦å‘ç¡¬ä»¶å¼‚å¸¸ã€‚</p>
</li>
</ul>
<p><strong>ç»¼ä¸Šæ‰€è¿°ï¼Œæˆ‘ä»¬åªè®¨è®ºCortex-M3&#x2F;M4å†…æ ¸æƒ…å†µã€‚</strong></p>
<h3 id="å…¨å±€å˜é‡å¯¹é½é—®é¢˜"><a href="#å…¨å±€å˜é‡å¯¹é½é—®é¢˜" class="headerlink" title="å…¨å±€å˜é‡å¯¹é½é—®é¢˜"></a>å…¨å±€å˜é‡å¯¹é½é—®é¢˜</h3><ul>
<li><code>uint8_t</code>å®šä¹‰å˜é‡åœ°å€è¦1å­—èŠ‚å¯¹é½ã€‚</li>
<li><code>uint16_t</code>å®šä¹‰å˜é‡åœ°å€è¦2å­—èŠ‚å¯¹é½ã€‚</li>
<li><code>uint32_t</code>å®šä¹‰å˜é‡åœ°å€è¦4å­—èŠ‚å¯¹é½ã€‚</li>
<li><code>uint64_t</code>å®šä¹‰å˜é‡åœ°å€è¦8å­—èŠ‚å¯¹é½ã€‚</li>
<li><code>æŒ‡é’ˆå˜é‡</code>æ˜¯4å­—èŠ‚å¯¹é½ã€‚</li>
</ul>
<h3 id="ç»“æ„ä½“æˆå‘˜å¯¹é½é—®é¢˜"><a href="#ç»“æ„ä½“æˆå‘˜å¯¹é½é—®é¢˜" class="headerlink" title="ç»“æ„ä½“æˆå‘˜å¯¹é½é—®é¢˜"></a>ç»“æ„ä½“æˆå‘˜å¯¹é½é—®é¢˜</h3><h4 id="è‡ªç„¶å¯¹ç•Œ"><a href="#è‡ªç„¶å¯¹ç•Œ" class="headerlink" title="è‡ªç„¶å¯¹ç•Œ"></a>è‡ªç„¶å¯¹ç•Œ</h4><p><strong>ä¾‹å­1</strong>ï¼ˆåˆ†æç»“æ„å„æˆå‘˜çš„é»˜è®¤å­—èŠ‚å¯¹ç•Œæ¡ç•Œæ¡ä»¶å’Œç»“æ„æ•´ä½“çš„é»˜è®¤å­—èŠ‚å¯¹ç•Œæ¡ä»¶ï¼‰:</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Test</span></span></span><br><span class="line"><span class="class">&#123;</span> </span><br><span class="line">  <span class="type">char</span> x1; <span class="comment">// æˆå‘˜x1ä¸ºcharå‹(å…¶èµ·å§‹åœ°å€å¿…é¡»1å­—èŠ‚å¯¹ç•Œ)ï¼Œå…¶åç§»åœ°å€ä¸º0 </span></span><br><span class="line">  <span class="type">char</span> x2; <span class="comment">// æˆå‘˜x2ä¸ºcharå‹(å…¶èµ·å§‹åœ°å€å¿…é¡»1å­—èŠ‚å¯¹ç•Œï¼Œå…¶åç§»åœ°å€ä¸º1 </span></span><br><span class="line">  <span class="type">float</span> x3; <span class="comment">// æˆå‘˜x3ä¸ºfloatå‹(å…¶èµ·å§‹åœ°å€å¿…é¡»4å­—èŠ‚å¯¹ç•Œ)ï¼Œç¼–è¯‘å™¨åœ¨x2å’Œx3ä¹‹é—´å¡«å……äº†ä¸¤ä¸ªç©ºå­—èŠ‚ï¼Œå…¶åç§»åœ°å€ä¸º4 </span></span><br><span class="line">  <span class="type">char</span> x4; <span class="comment">// æˆå‘˜x4ä¸ºcharå‹(å…¶èµ·å§‹åœ°å€å¿…é¡»1å­—èŠ‚å¯¹ç•Œ)ï¼Œå…¶åç§»åœ°å€ä¸º8 </span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>åœ¨Testç»“æ„ä½“ä¸­ï¼Œæœ€å¤§çš„æˆå‘˜ä¸º<code>float</code> x3ï¼Œå› æ­¤ç»“æ„ä½“çš„è‡ªç„¶å¯¹ç•Œæ¡ä»¶ä¸º4å­—èŠ‚å¯¹é½ã€‚åˆ™ç»“æ„ä½“é•¿åº¦å°±ä¸º12å­—èŠ‚ï¼Œå†…å­˜å¸ƒå±€ä¸º<code>1100 1111 1000</code>ã€‚</p>
<br>

<h4 id="æŒ‡ä»¤å¯¹é½"><a href="#æŒ‡ä»¤å¯¹é½" class="headerlink" title="æŒ‡ä»¤å¯¹é½"></a>æŒ‡ä»¤å¯¹é½</h4><p><strong>1. ä¼ªæŒ‡ä»¤#pragma pack</strong></p>
<p>æ”¹å˜ç¼ºçœçš„å¯¹ç•Œæ¡ä»¶(æŒ‡å®šå¯¹ç•Œ)</p>
<ul>
<li>ä½¿ç”¨ä¼ªæŒ‡ä»¤<code>#pragma pack (n)</code>ï¼Œç¼–è¯‘å™¨å°†æŒ‰ç…§nä¸ªå­—èŠ‚å¯¹é½ã€‚</li>
<li>ä½¿ç”¨ä¼ªæŒ‡ä»¤<code>#pragma pack ()</code>ï¼Œå–æ¶ˆè‡ªå®šä¹‰å­—èŠ‚å¯¹é½æ–¹å¼ã€‚<ul>
<li>æ•°æ®æˆå‘˜å¯¹é½è§„åˆ™ï¼šç»“æ„(<code>struct</code>)(æˆ–è”åˆ(<code>union</code>))çš„æ•°æ®æˆå‘˜ï¼Œç¬¬ä¸€ä¸ªæ•°æ®æˆå‘˜æ”¾åœ¨offsetä¸º0çš„åœ°æ–¹ï¼Œä»¥åæ¯ä¸ªæ•°æ®æˆå‘˜çš„å¯¹é½æŒ‰ç…§<code>#pragma pack</code>æŒ‡å®šçš„æ•°å€¼å’Œè¿™ä¸ªæ•°æ®æˆå‘˜è‡ªèº«é•¿åº¦ä¸­ï¼Œæ¯”è¾ƒå°çš„é‚£ä¸ªè¿›è¡Œã€‚</li>
<li>ç»“æ„(æˆ–è”åˆ)çš„æ•´ä½“å¯¹é½è§„åˆ™ï¼šåœ¨æ•°æ®æˆå‘˜å®Œæˆå„è‡ªå¯¹é½ä¹‹åï¼Œç»“æ„(æˆ–è”åˆ)æœ¬èº«ä¹Ÿè¦è¿›è¡Œå¯¹é½ï¼Œå¯¹é½å°†æŒ‰ç…§<code>#pragma pack</code>æŒ‡å®šçš„æ•°å€¼å’Œç»“æ„(æˆ–è”åˆ)æœ€å¤§æ•°æ®æˆå‘˜é•¿åº¦ä¸­ï¼Œæ¯”è¾ƒå°çš„é‚£ä¸ªè¿›è¡Œã€‚</li>
</ul>
</li>
</ul>
<p>ç»“åˆæ¨æ–­ï¼šå½“<code>#pragma pack</code>çš„nå€¼ç­‰äºæˆ–è¶…è¿‡æ‰€æœ‰æ•°æ®æˆå‘˜é•¿åº¦çš„æ—¶å€™ï¼Œè¿™ä¸ªnå€¼çš„å¤§å°å°†ä¸äº§ç”Ÿä»»ä½•æ•ˆæœã€‚å› æ­¤ï¼Œå½“ä½¿ç”¨ä¼ªæŒ‡ä»¤<code>#pragma pack (2)</code>æ—¶ï¼ŒTestç»“æ„ä½“çš„å¤§å°ä¸º8ï¼Œå†…å­˜å¸ƒå±€ä¸º<code>1111 1110</code>ã€‚</p>
<ul>
<li>éœ€è¦æ³¨æ„ä¸€ç‚¹ï¼Œå½“ç»“æ„ä½“ä¸­åŒ…å«ä¸€ä¸ªå­ç»“æ„ä½“æ—¶ï¼Œå­ç»“æ„ä¸­çš„æˆå‘˜æŒ‰ç…§#pragma packæŒ‡å®šçš„æ•°å€¼å’Œå­ç»“æ„æœ€å¤§æ•°æ®æˆå‘˜é•¿åº¦ä¸­ï¼Œæ¯”è¾ƒå°çš„é‚£ä¸ªè¿›è¡Œè¿›è¡Œå¯¹é½ã€‚ä¾‹å­å¦‚ä¸‹ï¼š</li>
</ul>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">pragma</span> pack(8)</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">s1</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">  <span class="type">short</span> a;</span><br><span class="line">  <span class="type">long</span> b;</span><br><span class="line">&#125;;</span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">s2</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">  <span class="type">char</span> c;</span><br><span class="line">  s1 d;</span><br><span class="line">  <span class="type">long</span> <span class="type">long</span> e;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> pack()</span></span><br></pre></td></tr></table></figure>
<p><code>sizeof(s2)</code>çš„ç»“æœä¸º24ã€‚S1çš„å†…å­˜å¸ƒå±€ä¸º<code>1100 1111</code>ï¼ŒS2çš„å†…å­˜å¸ƒå±€ä¸º<code>1000 1100 1111 0000 1111 1111</code>ã€‚</p>
<p><strong>ä¾‹å­2</strong>(æŒ‰ç…§2ä¸ªå­—èŠ‚å¯¹é½æ—¶)ï¼š</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> pack(2)</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">  <span class="type">int</span> aa1; <span class="comment">//2ä¸ªå­—èŠ‚å¯¹é½ 1111</span></span><br><span class="line">  <span class="type">char</span> bb1;<span class="comment">//1ä¸ªå­—èŠ‚å¯¹é½ 1</span></span><br><span class="line">  <span class="type">short</span> cc1;<span class="comment">//2ä¸ªå­—èŠ‚å¯¹é½ 011</span></span><br><span class="line">  <span class="type">char</span> dd1; <span class="comment">//1ä¸ªå­—èŠ‚å¯¹é½ 1</span></span><br><span class="line">&#125; testlength1;</span><br><span class="line"><span class="type">int</span> length1 = <span class="keyword">sizeof</span>(testlength1); <span class="comment">//2ä¸ªå­—èŠ‚å¯¹é½ï¼Œå ç”¨å­—èŠ‚11 11 10 11 10,length = 10</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">  <span class="type">char</span> bb2;<span class="comment">//1ä¸ªå­—èŠ‚å¯¹é½ 1</span></span><br><span class="line">  <span class="type">int</span> aa2; <span class="comment">//2ä¸ªå­—èŠ‚å¯¹é½ 01111</span></span><br><span class="line">  <span class="type">short</span> cc2;<span class="comment">//2ä¸ªå­—èŠ‚å¯¹é½ 11</span></span><br><span class="line">  <span class="type">char</span> dd2; <span class="comment">//1ä¸ªå­—èŠ‚å¯¹é½ 1</span></span><br><span class="line">&#125; testlength2;</span><br><span class="line"><span class="type">int</span> length2 = <span class="keyword">sizeof</span>(testlength2); <span class="comment">//2ä¸ªå­—èŠ‚å¯¹é½ï¼Œå ç”¨å­—èŠ‚10 11 11 11 10,length = 10</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">  <span class="type">char</span> bb3; <span class="comment">//1ä¸ªå­—èŠ‚å¯¹é½ 1</span></span><br><span class="line">  <span class="type">char</span> dd3; <span class="comment">//1ä¸ªå­—èŠ‚å¯¹é½ 1</span></span><br><span class="line">  <span class="type">int</span> aa3; <span class="comment">//2ä¸ªå­—èŠ‚å¯¹é½ 11 11</span></span><br><span class="line">  <span class="type">short</span> cc23<span class="comment">//2ä¸ªå­—èŠ‚å¯¹é½ 11</span></span><br><span class="line"> </span><br><span class="line">&#125; testlength3;</span><br><span class="line"><span class="type">int</span> length3 = <span class="keyword">sizeof</span>(testlength3); <span class="comment">//2ä¸ªå­—èŠ‚å¯¹é½ï¼Œå ç”¨å­—èŠ‚11 11 11 11,length = 8</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">  <span class="type">char</span> bb4; <span class="comment">//1ä¸ªå­—èŠ‚å¯¹é½ 1</span></span><br><span class="line">  <span class="type">char</span> dd4; <span class="comment">//1ä¸ªå­—èŠ‚å¯¹é½ 1</span></span><br><span class="line">  <span class="type">short</span> cc4;<span class="comment">//2ä¸ªå­—èŠ‚å¯¹é½ 11</span></span><br><span class="line">  <span class="type">int</span> aa4; <span class="comment">//2ä¸ªå­—èŠ‚å¯¹é½ 11 11</span></span><br><span class="line">&#125; testlength4;</span><br><span class="line"><span class="type">int</span> length4 = <span class="keyword">sizeof</span>(testlength4); <span class="comment">//2ä¸ªå­—èŠ‚å¯¹é½ï¼Œå ç”¨å­—èŠ‚11 11 11 11,length = 8</span></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> pack()</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;length1 = %d.\n&quot;</span>,length1);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;length2 = %d.\n&quot;</span>,length2);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;length3 = %d.\n&quot;</span>,length3);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;length4 = %d.\n&quot;</span>,length4);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>2. <strong>attribute</strong>((<strong>aligned</strong>(n)))</strong></p>
<p><code>__attribute__</code>æ˜¯GCCé‡Œçš„ç¼–è¯‘å‚æ•°ï¼Œç”¨æ³•æœ‰å¾ˆå¤šç§ï¼Œæ„Ÿå…´è¶£å¯ä»¥é˜…è¯»ä¸€ä¸‹gccçš„ç›¸å…³æ–‡æ¡£ã€‚è¿™é‡Œè¯´ä¸€ä¸‹<code>__attribute__</code>å¯¹å˜é‡å’Œç»“æ„ä½“å¯¹é½çš„å½±å“ã€‚è¿™é‡Œçš„å½±å“å¤§æ¦‚åˆ†ä¸ºä¸¤ä¸ªæ–¹é¢ï¼Œå¯¹é½å’Œæœ¬èº«å ç”¨çš„å­—èŠ‚æ•°çš„å¤§å°ï¼Œå³sizeofï¼ˆå˜é‡ï¼‰çš„å€¼ã€‚</p>
<ul>
<li><code>int a attribute((aligned(64))) = 10;</code></li>
</ul>
<p>è¿™ä¸ªä¿®é¥°çš„å½±å“ä¸»è¦æ˜¯å¯¹é½ï¼Œæ‰€è°“å¯¹é½æ˜¯å­˜å‚¨ä¸ºå€¼çš„èµ·å§‹åœ°å€ã€‚å˜é‡açš„åœ°å€&amp;a,æœ¬æ¥æ˜¯4å­—èŠ‚å¯¹é½ï¼Œå˜æˆäº†64å­—èŠ‚å¯¹é½ï¼ˆæœ‰çš„ç¯å¢ƒå¯¹æœ€å¤§å¯¹é½æ•°å€¼æœ‰é™åˆ¶ï¼‰ã€‚64å­—èŠ‚å¯¹é½å°±æ˜¯<code>&amp;a</code>çš„æœ€å6ä½ä¸º0ã€‚</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="keyword">sizeof</span>(a) = <span class="number">4</span>; 		<span class="comment">//a å ç”¨çš„å­—èŠ‚æ•°è¿˜æ˜¯4ä¸ªå­—èŠ‚</span></span><br></pre></td></tr></table></figure>

<ul>
<li><code>typedef int myint attribute((aligned(64))) ;</code></li>
</ul>
<p>è¿™æ ·è¯´æ˜myint å£°æ˜çš„å˜é‡æŒ‰ç…§64å­—èŠ‚å¯¹é½ï¼Œå¤§å°æ˜¯4å­—èŠ‚ï¼Œè¿™æ ·å°±ä¼šæœ‰ä¸€ä¸ªé—®é¢˜ï¼Œè¿™ä¸ªå˜é‡ä¸èƒ½å®šä¹‰æ•°ç»„ï¼š</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">myint myarray[<span class="number">2</span>]; 	<span class="comment">//è¿™æ ·å®šä¹‰ç¼–è¯‘å™¨ä¼šæŠ¥err</span></span><br></pre></td></tr></table></figure>
<p>æŠ¥é”™çš„åŸå› æ˜¯æ•°ç»„çš„å­˜å‚¨åœ¨å†…å­˜ä¸­æ˜¯è¿ç»­çš„ï¼Œè€Œmyintåªæœ‰4å­—èŠ‚ç¡®è¦64å­—èŠ‚å¯¹é½ï¼Œè¿™æ ·å¯¹é½å’Œè¿ç»­å°±ä¸èƒ½åŒæ—¶ä¿è¯ï¼Œå°±ä¼šæŠ¥é”™ã€‚</p>
<p><strong>ä¾‹å­1</strong>ï¼š</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">st_tag</span> &#123;</span></span><br><span class="line">	<span class="type">int</span> a;</span><br><span class="line">	<span class="type">char</span> b;</span><br><span class="line">&#125; ST1;</span><br><span class="line">ST1 mystï¼›</span><br></pre></td></tr></table></figure>

<p>åœ¨æ²¡æœ‰å¯¹é½çš„æƒ…å†µä¸‹ï¼š<code>sizeof(ST1) = sizeof(myst) = 8;</code><br>ç»“æ„ä½“å¯¹é½çš„åŸåˆ™å¯ä»¥æ€»ç»“ä¸ºï¼š</p>
<ul>
<li>ç»“æ„ä½“èµ·å§‹åœ°å€(&amp;myst)æŒ‰æœ€å¤§å˜é‡å­—èŠ‚æ•°(sizeof(int))å¯¹é½ï¼›</li>
<li>ç»“æ„ä½“å†…æ¯ä¸ªå˜é‡æŒ‰ç…§è‡ªèº«å­—èŠ‚æ•°å¯¹é½ï¼›</li>
<li>ç»“æ„ä½“çš„å¤§å°<code>(sizeof(myst))</code>æ˜¯æœ€å¤§å˜é‡å­—èŠ‚æ•°çš„æ•´æ•°å€ï¼ˆ8&#x2F;4&#x3D;2ï¼‰ï¼›</li>
</ul>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">st_tag</span> &#123;</span></span><br><span class="line">	<span class="type">int</span> a;</span><br><span class="line">	<span class="type">char</span> b;</span><br><span class="line">&#125;  __attribute__((__aligned__(<span class="number">64</span>))) ST1;</span><br><span class="line">ST1 mystï¼›</span><br><span class="line"><span class="keyword">sizeof</span>(ST1) = <span class="keyword">sizeof</span>(myst) = <span class="number">64</span>; </span><br></pre></td></tr></table></figure>
<p>å¯¹æ¯”ï¼š</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">st_tag</span> &#123;</span></span><br><span class="line">	<span class="type">int</span> a;</span><br><span class="line">	<span class="type">char</span> b;</span><br><span class="line">&#125;  ST1 __attribute__((__aligned__(<span class="number">64</span>)));</span><br><span class="line">ST1 mystï¼›</span><br><span class="line"><span class="keyword">sizeof</span>(ST1) = <span class="keyword">sizeof</span>(myst) = <span class="number">8</span> ;</span><br></pre></td></tr></table></figure>

<p>è¿™ç¬¬äºŒç§æƒ…å†µå¯ä»¥ç†è§£ä¸º<code>__attribute__((aligned(64)))</code>ä½œç”¨äºå˜é‡ST1 ï¼Œåªå½±å“å¯¹é½ï¼Œä¸å½±å“ç»“æ„çš„å¤§å°ã€‚</p>
<p><strong>ä¾‹å­2</strong>ï¼š</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> __<span class="title">attribute__</span>((<span class="title">packed</span>))</span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="type">uint8_t</span> comm_version;</span><br><span class="line">    <span class="type">uint8_t</span> comm_lenth;</span><br><span class="line">    <span class="type">uint8_t</span> device_fw_verion[];</span><br><span class="line">&#125;ble_resp_device_info_desc;</span><br></pre></td></tr></table></figure>
<p><code>__attribute__((packed))</code>æ˜¯GCCç¼–è¯‘å™¨æä¾›çš„ä¸€ä¸ªå±æ€§,<code>__attribute__((packed))</code>å…¶ä¸­çš„æˆå‘˜å˜é‡ä¸ä¼šè¿›è¡Œå¯¹é½ã€‚</p>
<br>

<h2 id="HSV-æ¨¡å‹"><a href="#HSV-æ¨¡å‹" class="headerlink" title="HSV æ¨¡å‹"></a>HSV æ¨¡å‹</h2><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;math.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* å°†HSVé¢œè‰²è½¬æ¢ä¸ºRGBé¢œè‰²</span></span><br><span class="line"><span class="comment">* hue,è‰²è°ƒ:0-360; saturation,çº¯åº¦:0-1; value,æ˜åº¦:0-1</span></span><br><span class="line"><span class="comment">* r,g,b,RGBé¢œè‰²ï¼Œæ­¤å€¼èŒƒå›´ä¸º0-255ï¼Œä½†å¤–ç•Œä¼ å…¥æ—¶çš„å˜é‡é¡»æ˜¯intç±»å‹</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">hsv_to_rgb</span><span class="params">(<span class="type">float</span> h, <span class="type">float</span> s, <span class="type">float</span> v, <span class="type">int</span> *r, <span class="type">int</span> *g, <span class="type">int</span> *b)</span></span><br><span class="line">&#123;</span><br><span class="line">   <span class="type">float</span> f, x, y, z;</span><br><span class="line">   <span class="type">int</span> i;</span><br><span class="line">   v *= <span class="number">255.0</span>;</span><br><span class="line">   <span class="keyword">if</span> (s == <span class="number">0.0</span>) &#123;</span><br><span class="line">      *r = *g = *b = (<span class="type">int</span>)v;</span><br><span class="line">   &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">while</span> (h &lt; <span class="number">0</span>)</span><br><span class="line">      h += <span class="number">360</span>;</span><br><span class="line">      h = <span class="built_in">fmod</span>(h, <span class="number">360</span>) / <span class="number">60.0</span>;</span><br><span class="line">      i = (<span class="type">int</span>)h;</span><br><span class="line">      f = h - i;</span><br><span class="line">      x = v * (<span class="number">1.0</span> - s);</span><br><span class="line">      y = v * (<span class="number">1.0</span> - (s * f));</span><br><span class="line">      z = v * (<span class="number">1.0</span> - (s * (<span class="number">1.0</span> - f)));</span><br><span class="line">      <span class="keyword">switch</span> (i) &#123;</span><br><span class="line">         <span class="keyword">case</span> <span class="number">0</span>: *r = v; *g = z; *b = x; <span class="keyword">break</span>;</span><br><span class="line">         <span class="keyword">case</span> <span class="number">1</span>: *r = y; *g = v; *b = x; <span class="keyword">break</span>;</span><br><span class="line">         <span class="keyword">case</span> <span class="number">2</span>: *r = x; *g = v; *b = z; <span class="keyword">break</span>;</span><br><span class="line">         <span class="keyword">case</span> <span class="number">3</span>: *r = x; *g = y; *b = v; <span class="keyword">break</span>;</span><br><span class="line">         <span class="keyword">case</span> <span class="number">4</span>: *r = z; *g = x; *b = v; <span class="keyword">break</span>;</span><br><span class="line">         <span class="keyword">case</span> <span class="number">5</span>: *r = v; *g = x; *b = y; <span class="keyword">break</span>;</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨Demoå¦‚ä¸‹ï¼š</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">led_set_poll</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;    </span><br><span class="line">    <span class="type">int</span> red,green,blue;</span><br><span class="line">    </span><br><span class="line">    <span class="type">static</span> <span class="type">float</span> hue = <span class="number">0</span>;</span><br><span class="line">    hue = fmodf(hue + <span class="number">1.0</span>, <span class="number">360.0</span>);  <span class="comment">// 0-360 è‰²è°ƒå¾ªç¯</span></span><br><span class="line">    hsv_to_rgb(hue, <span class="number">1.0</span>, <span class="number">1.0</span>, &amp;red, &amp;green, &amp;blue);</span><br><span class="line">    display_board_rgb_color_set(red, green, blue);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br>

<h2 id="å†…å­˜ç®¡ç†"><a href="#å†…å­˜ç®¡ç†" class="headerlink" title="å†…å­˜ç®¡ç†"></a>å†…å­˜ç®¡ç†</h2><p><code>RT-Thread</code>å’Œ<code>FreeRTOS</code>éƒ½æ˜¯æµè¡Œçš„åµŒå…¥å¼å®æ—¶æ“ä½œç³»ç»Ÿï¼ˆ<code>RTOS</code>ï¼‰ï¼Œå®ƒä»¬æä¾›äº†å†…å­˜ç®¡ç†æœºåˆ¶æ¥å¤„ç†ä»»åŠ¡ã€é˜Ÿåˆ—ã€ä¿¡å·é‡ç­‰å¯¹è±¡çš„åˆ›å»ºå’Œåˆ é™¤ã€‚å°½ç®¡ä¸¤è€…åœ¨å†…å­˜ç®¡ç†çš„æŸäº›æ–¹é¢æœ‰ç›¸ä¼¼ä¹‹å¤„ï¼Œä½†å®ƒä»¬åœ¨å®ç°å’Œé…ç½®ä¸Šå­˜åœ¨ä¸€äº›å…³é”®çš„åŒºåˆ«ï¼š</p>
<ul>
<li><p>å†…å­˜ç®¡ç†ç­–ç•¥ï¼š</p>
<ul>
<li><strong>RT-Thread</strong>ï¼šæä¾›äº†åŠ¨æ€å†…å­˜å †ç®¡ç†å’Œé™æ€å†…å­˜æ± ç®¡ç†ä¸¤ç§æ–¹å¼ã€‚åŠ¨æ€å†…å­˜å †ç®¡ç†å…è®¸åœ¨è¿è¡Œæ—¶åŠ¨æ€åˆ†é…å’Œé‡Šæ”¾å†…å­˜ï¼Œè€Œå†…å­˜æ± ç®¡ç†åˆ™åˆ†é…å›ºå®šå¤§å°çš„å†…å­˜å—ï¼Œé€‚ç”¨äºåˆ†é…å¤§é‡å¤§å°ç›¸åŒçš„å°å†…å­˜å—çš„åœºæ™¯ã€‚</li>
<li><strong>FreeRTOS</strong>ï¼šæä¾›äº†å¤šç§å†…å­˜ç®¡ç†æ–¹æ¡ˆï¼ŒåŒ…æ‹¬ç®€å•çš„é™æ€å†…å­˜åˆ†é…ï¼ˆ<code>heap_1</code>ï¼‰å’Œæ›´å¤æ‚çš„åŠ¨æ€å†…å­˜åˆ†é…ç­–ç•¥ï¼ˆå¦‚<code>heap_2</code>ã€<code>heap_3</code>ã€<code>heap_4</code>å’Œ<code>heap_5</code>ï¼‰ã€‚<code>FreeRTOS</code>çš„åŠ¨æ€å†…å­˜åˆ†é…ç­–ç•¥å…è®¸å†…å­˜çš„åˆ†é…å’Œé‡Šæ”¾ï¼ŒåŒæ—¶ä¹Ÿæä¾›äº†å†…å­˜ç¢ç‰‡ç®¡ç†çš„æ–¹æ³•ã€‚</li>
</ul>
</li>
<li><p>å†…å­˜åˆ†é…å‡½æ•°ï¼š</p>
<ul>
<li><strong>RT-Thread</strong>ï¼šä½¿ç”¨è‡ªå·±çš„å†…å­˜åˆ†é…å‡½æ•°ï¼Œå¦‚<code>rt_malloc</code>ã€<code>rt_free</code>ã€<code>rt_realloc</code>å’Œ<code>rt_calloc</code>ï¼Œè¿™äº›å‡½æ•°ä¸<code>C</code>æ ‡å‡†åº“ä¸­çš„<code>malloc</code>å’Œ<code>free</code>ç±»ä¼¼ï¼Œä½†æ˜¯ä¸“ä¸º<code>RT-Thread</code>è®¾è®¡ã€‚</li>
<li><strong>FreeRTOS</strong>ï¼šä½¿ç”¨<code>pvPortMalloc</code>å’Œ<code>vPortFree</code>å‡½æ•°è¿›è¡Œå†…å­˜åˆ†é…å’Œé‡Šæ”¾ã€‚<code>FreeRTOS</code>è¿˜æä¾›äº†<code>xPortGetFreeHeapSize</code>ç­‰å‡½æ•°æ¥è·å–å†…å­˜å †çš„çŠ¶æ€ã€‚</li>
</ul>
</li>
<li><p>å†…å­˜å †çš„å®ç°ï¼š</p>
<ul>
<li><strong>RT-Thread</strong>ï¼šå†…å­˜å †ç®¡ç†æ ¹æ®å†…å­˜è®¾å¤‡çš„ä¸åŒï¼Œåˆ†ä¸ºå°å†…å­˜å—åˆ†é…ç®¡ç†ã€å¤§å†…å­˜å—çš„<code>slab</code>åˆ†é…ç®¡ç†å’Œå¤šå†…å­˜å †åˆ†é…æƒ…å†µçš„ç®¡ç†ã€‚</li>
<li><strong>FreeRTOS</strong>ï¼šæä¾›äº†å¤šç§å†…å­˜å †å®ç°ï¼Œä¾‹å¦‚<code>heap_1</code>ä¸å…è®¸é‡Šæ”¾å†…å­˜ï¼Œ<code>heap_2</code>å…è®¸é‡Šæ”¾ä½†ä¸åˆå¹¶ç›¸é‚»ç©ºé—²å—ï¼Œ<code>heap_3</code>åŒ…è£…äº†æ ‡å‡†åº“çš„<code>malloc</code>å’Œ<code>free</code>ï¼Œ<code>heap_4</code>åˆå¹¶ç›¸é‚»ç©ºé—²å—ä»¥å‡å°‘ç¢ç‰‡ï¼Œ<code>heap_5</code>åˆ™æ”¯æŒè·¨å¤šä¸ªä¸ç›¸é‚»å†…å­˜åŒºåŸŸçš„å †ã€‚</li>
</ul>
</li>
<li><p>å†…å­˜ç¢ç‰‡ç®¡ç†ï¼š</p>
<ul>
<li><strong>RT-Thread</strong>ï¼šé€šè¿‡å†…å­˜æ± ç®¡ç†æ¥å‡å°‘å†…å­˜ç¢ç‰‡ï¼Œå†…å­˜æ± é¢„å…ˆåˆ†é…ä¸€å—å†…å­˜ï¼Œå¹¶åœ¨å…¶ä¸­ç®¡ç†å›ºå®šå¤§å°çš„å†…å­˜å—ã€‚</li>
<li><strong>FreeRTOS</strong>ï¼š<code>heap_4</code>å’Œ<code>heap_5</code>å®ç°äº†å†…å­˜ç¢ç‰‡ç®¡ç†ï¼Œé€šè¿‡åˆå¹¶ç›¸é‚»çš„ç©ºé—²å†…å­˜å—æ¥å‡å°‘ç¢ç‰‡ã€‚</li>
</ul>
</li>
<li><p>å†…å­˜ç®¡ç†çš„é…ç½®ï¼š</p>
<ul>
<li><strong>RT-Thread</strong>ï¼šå†…å­˜ç®¡ç†çš„é…ç½®é€šå¸¸åœ¨<code>rtconfig.h</code>ä¸­è¿›è¡Œï¼Œå¯ä»¥é€‰æ‹©ä½¿ç”¨ä¸åŒçš„å†…å­˜ç®¡ç†ç®—æ³•ã€‚</li>
<li><strong>FreeRTOS</strong>ï¼šå†…å­˜ç®¡ç†çš„é…ç½®ä¹Ÿåœ¨é…ç½®æ–‡ä»¶ä¸­è¿›è¡Œï¼Œéœ€è¦é€‰æ‹©ä¸€ä¸ªåˆé€‚çš„å †ç®¡ç†å®ç°æ–‡ä»¶ï¼Œå¹¶åœ¨<code>FreeRTOSConfig.h</code>ä¸­è¿›è¡Œç›¸åº”çš„é…ç½®ã€‚</li>
</ul>
</li>
<li><p>å†…å­˜ç®¡ç†çš„é€‚ç”¨æ€§ï¼š</p>
<ul>
<li><strong>RT-Thread</strong>ï¼šå†…å­˜ç®¡ç†æœºåˆ¶é€‚ç”¨äºå„ç§å¤§å°çš„å†…å­˜å—ï¼Œç‰¹åˆ«æ˜¯é€šè¿‡å†…å­˜æ± ç®¡ç†æ¥ä¼˜åŒ–å°å†…å­˜å—çš„åˆ†é…æ•ˆç‡ã€‚</li>
<li><strong>FreeRTOS</strong>ï¼šæä¾›äº†å¤šç§å†…å­˜ç®¡ç†ç­–ç•¥ï¼Œé€‚ç”¨äºä¸åŒçš„åº”ç”¨åœºæ™¯å’Œå†…å­˜éœ€æ±‚ï¼Œä»ç®€å•çš„é™æ€åˆ†é…åˆ°å¤æ‚çš„åŠ¨æ€åˆ†é…ã€‚</li>
</ul>
</li>
</ul>
<p>æ€»çš„æ¥è¯´ï¼Œ<code>RT-Thread</code>å’Œ<code>FreeRTOS</code>éƒ½æä¾›äº†çµæ´»çš„å†…å­˜ç®¡ç†æœºåˆ¶æ¥æ»¡è¶³ä¸åŒåµŒå…¥å¼åº”ç”¨çš„éœ€æ±‚ã€‚é€‰æ‹©å“ªç§å†…å­˜ç®¡ç†ç­–ç•¥å–å†³äºå…·ä½“çš„åº”ç”¨åœºæ™¯ã€å†…å­˜éœ€æ±‚å’Œå¼€å‘åå¥½ã€‚</p>
<h2 id="å›½æ°‘UART-DMA-TXé—®é¢˜"><a href="#å›½æ°‘UART-DMA-TXé—®é¢˜" class="headerlink" title="å›½æ°‘UART+DMA+TXé—®é¢˜"></a>å›½æ°‘UART+DMA+TXé—®é¢˜</h2><p>æ”¹ä¹‹å‰ï¼š</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">ec32_uart_dma_tx_config</span><span class="params">(<span class="keyword">struct</span> ec_serial_device *serial, <span class="type">uint8_t</span> *buffer, <span class="type">uint16_t</span> length)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span>(serial-&gt;Txbuffer-&gt;tail + length &gt; serial-&gt;dma.setting_tx_len) </span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">while</span>(DMA_GetFlagStatus(serial-&gt;dma.tx_gl_flag, serial-&gt;dma.tx_dma_type) == RESET)&#123;&#125;</span><br><span class="line">        DMA_ClearFlag(serial-&gt;dma.tx_gl_flag, serial-&gt;dma.tx_dma_type);</span><br><span class="line">    &#125;</span><br><span class="line">	</span><br><span class="line">    DMA_EnableChannel(serial-&gt;dma.tx_ch, DISABLE);</span><br><span class="line">    DMA_InitType DMA_InitStructure;</span><br><span class="line">	</span><br><span class="line">    <span class="type">uint16_t</span> dma_get_counts = DMA_GetCurrDataCounter(serial-&gt;dma.tx_ch);</span><br><span class="line">    <span class="comment">/* if no data waiting send*/</span></span><br><span class="line">    <span class="keyword">if</span>(dma_get_counts == <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">	serial-&gt;Txbuffer-&gt;lenth = length &gt; serial-&gt;dma.setting_tx_len ? serial-&gt;dma.setting_tx_len : length;</span><br><span class="line">	<span class="built_in">memcpy</span>(serial-&gt;Txbuffer-&gt;data, buffer, serial-&gt;Txbuffer-&gt;lenth);</span><br><span class="line">        DMA_InitStructure.MemAddr = (<span class="type">uint32_t</span>)serial-&gt;Txbuffer-&gt;data;</span><br><span class="line">        DMA_InitStructure.BufSize = serial-&gt;Txbuffer-&gt;lenth;</span><br><span class="line">        serial-&gt;Txbuffer-&gt;tail = serial-&gt;Txbuffer-&gt;lenth;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;	</span><br><span class="line">        <span class="built_in">memcpy</span>(serial-&gt;Txbuffer-&gt;data + serial-&gt;Txbuffer-&gt;tail, buffer, length);</span><br><span class="line">        DMA_InitStructure.MemAddr = (<span class="type">uint32_t</span>)(serial-&gt;Txbuffer-&gt;data + serial-&gt;Txbuffer-&gt;tail - dma_get_counts);</span><br><span class="line">        DMA_InitStructure.BufSize = length + dma_get_counts;</span><br><span class="line">        serial-&gt;Txbuffer-&gt;tail = serial-&gt;Txbuffer-&gt;tail + length;</span><br><span class="line">    &#125;</span><br><span class="line">... ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é—®é¢˜è§£å†³æ¥è‡ª<code>jindu-chen</code>ï¼Œä¿®æ”¹åï¼š</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">ec32_uart_dma_tx_config</span><span class="params">(<span class="keyword">struct</span> ec_serial_device *serial, <span class="type">uint8_t</span> *buffer, <span class="type">uint16_t</span> length)</span></span><br><span class="line">&#123;</span><br><span class="line">    DMA_EnableChannel(serial-&gt;dma.tx_ch, DISABLE);</span><br><span class="line">    DMA_InitType DMA_InitStructure;</span><br><span class="line">	</span><br><span class="line">    <span class="type">uint16_t</span> dma_get_counts = DMA_GetCurrDataCounter(serial-&gt;dma.tx_ch);</span><br><span class="line">    <span class="comment">/* if no data waiting send*/</span></span><br><span class="line">    <span class="keyword">if</span>(dma_get_counts == <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        serial-&gt;Txbuffer-&gt;lenth = length &gt; serial-&gt;dma.setting_tx_len ? serial-&gt;dma.setting_tx_len : length;</span><br><span class="line">        <span class="built_in">memcpy</span>(serial-&gt;Txbuffer-&gt;data, buffer, serial-&gt;Txbuffer-&gt;lenth);</span><br><span class="line">        DMA_InitStructure.MemAddr = (<span class="type">uint32_t</span>)serial-&gt;Txbuffer-&gt;data;</span><br><span class="line">        DMA_InitStructure.BufSize = serial-&gt;Txbuffer-&gt;lenth;</span><br><span class="line">        serial-&gt;Txbuffer-&gt;tail = serial-&gt;Txbuffer-&gt;lenth;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;	</span><br><span class="line">        <span class="keyword">if</span>(serial-&gt;Txbuffer-&gt;tail + length &gt; serial-&gt;dma.setting_tx_len)</span><br><span class="line">        &#123;</span><br><span class="line">            DMA_EnableChannel(serial-&gt;dma.tx_ch, ENABLE);</span><br><span class="line">            <span class="keyword">while</span>(DMA_GetFlagStatus(serial-&gt;dma.tx_gl_flag, serial-&gt;dma.tx_dma_type) == RESET)&#123;&#125;</span><br><span class="line"></span><br><span class="line">            DMA_EnableChannel(serial-&gt;dma.tx_ch, DISABLE);</span><br><span class="line">            <span class="built_in">memcpy</span>(serial-&gt;Txbuffer-&gt;data, buffer, serial-&gt;Txbuffer-&gt;lenth);</span><br><span class="line">            DMA_InitStructure.MemAddr = (<span class="type">uint32_t</span>)serial-&gt;Txbuffer-&gt;data;</span><br><span class="line">            DMA_InitStructure.BufSize = length;</span><br><span class="line">            serial-&gt;Txbuffer-&gt;tail = serial-&gt;Txbuffer-&gt;lenth;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="built_in">memcpy</span>(serial-&gt;Txbuffer-&gt;data + serial-&gt;Txbuffer-&gt;tail, buffer, length);</span><br><span class="line">            DMA_InitStructure.MemAddr = (<span class="type">uint32_t</span>)(serial-&gt;Txbuffer-&gt;data + serial-&gt;Txbuffer-&gt;tail - dma_get_counts);</span><br><span class="line">            DMA_InitStructure.BufSize = length + dma_get_counts;</span><br><span class="line">            serial-&gt;Txbuffer-&gt;tail = serial-&gt;Txbuffer-&gt;tail + length;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">... ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¿®æ”¹å‰<code>tail</code>æŒ‡é’ˆæ¥è¿‘ç¼“å­˜åŒºæœ€å¤§è¾¹ç•Œæ—¶ï¼Œå‰©ä½™ç©ºé—´ä¸è¶³æ—¶ä¼šè¿›å…¥ä»¥ä¸‹å‡½æ•°, ä¸€ç›´å¡åœ¨<code>while</code>ä¸­å‡ºä¸æ¥, éœ€æ”¹åˆ°åé¢å»ï¼š</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(serial-&gt;Txbuffer-&gt;tail + length &gt; serial-&gt;dma.setting_tx_len) </span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">while</span>(DMA_GetFlagStatus(serial-&gt;dma.tx_gl_flag, serial-&gt;dma.tx_dma_type) == RESET)&#123;&#125;</span><br><span class="line">    DMA_ClearFlag(serial-&gt;dma.tx_gl_flag, serial-&gt;dma.tx_dma_type);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">DMA_GetCurrDataCounter(serial-&gt;dma.tx_ch) éœ€è¦å®æ—¶è·å–</span><br></pre></td></tr></table></figure>
<p>å³ä»¥ä¸‹ä»£ç ï¼š</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">ec32_uart_dma_tx_config</span><span class="params">(<span class="keyword">struct</span> ec_serial_device *serial, <span class="type">uint8_t</span> *buffer, <span class="type">uint16_t</span> length)</span></span><br><span class="line">&#123;</span><br><span class="line">    DMA_EnableChannel(serial-&gt;dma.tx_ch, DISABLE);</span><br><span class="line">    DMA_InitType DMA_InitStructure;</span><br><span class="line">	</span><br><span class="line">    <span class="comment">/* if no data waiting send*/</span></span><br><span class="line">    <span class="keyword">if</span>(DMA_GetCurrDataCounter(serial-&gt;dma.tx_ch) == <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">		serial-&gt;Txbuffer-&gt;lenth = length &gt; serial-&gt;dma.setting_tx_len ? serial-&gt;dma.setting_tx_len : length;</span><br><span class="line">		<span class="built_in">memcpy</span>(serial-&gt;Txbuffer-&gt;data, buffer, serial-&gt;Txbuffer-&gt;lenth);</span><br><span class="line">        DMA_InitStructure.MemAddr = (<span class="type">uint32_t</span>)serial-&gt;Txbuffer-&gt;data;</span><br><span class="line">        DMA_InitStructure.BufSize = serial-&gt;Txbuffer-&gt;lenth;</span><br><span class="line">        serial-&gt;Txbuffer-&gt;tail = serial-&gt;Txbuffer-&gt;lenth;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;	</span><br><span class="line">        <span class="keyword">if</span>(serial-&gt;Txbuffer-&gt;tail + length &gt; serial-&gt;dma.setting_tx_len)</span><br><span class="line">        &#123;</span><br><span class="line">            DMA_EnableChannel(serial-&gt;dma.tx_ch, ENABLE);</span><br><span class="line">            <span class="keyword">while</span>(DMA_GetFlagStatus(serial-&gt;dma.tx_gl_flag, serial-&gt;dma.tx_dma_type) == RESET)&#123;&#125;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">//éœ€åœ¨serial-&gt;Txbuffer-&gt;lenthèµ‹å€¼ä¹‹å‰ï¼Œå¦åˆ™DMA_InitStructure.BufSizeä¼šåˆ·æ–°ï¼Œä¼šç»§ç»­å‘é€æœªçŸ¥æ•°æ®ã€‚</span></span><br><span class="line">            DMA_EnableChannel(serial-&gt;dma.tx_ch, DISABLE);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//éœ€åœ¨DMA_EnableChannel(serial-&gt;dma.tx_ch, DISABLE)ä¹‹å</span></span><br><span class="line">            serial-&gt;Txbuffer-&gt;lenth = length &gt; serial-&gt;dma.setting_tx_len ? serial-&gt;dma.setting_tx_len : length;</span><br><span class="line"></span><br><span class="line">            <span class="built_in">memcpy</span>(serial-&gt;Txbuffer-&gt;data, buffer, serial-&gt;Txbuffer-&gt;lenth);</span><br><span class="line">			DMA_InitStructure.MemAddr = (<span class="type">uint32_t</span>)serial-&gt;Txbuffer-&gt;data;</span><br><span class="line">			DMA_InitStructure.BufSize = serial-&gt;Txbuffer-&gt;lenth;</span><br><span class="line">			serial-&gt;Txbuffer-&gt;tail = serial-&gt;Txbuffer-&gt;lenth;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">			<span class="built_in">memcpy</span>(serial-&gt;Txbuffer-&gt;data + serial-&gt;Txbuffer-&gt;tail, buffer, length);</span><br><span class="line">			DMA_InitStructure.MemAddr = (<span class="type">uint32_t</span>)(serial-&gt;Txbuffer-&gt;data + serial-&gt;Txbuffer-&gt;tail - DMA_GetCurrDataCounter(serial-&gt;dma.tx_ch));</span><br><span class="line">			DMA_InitStructure.BufSize = length + DMA_GetCurrDataCounter(serial-&gt;dma.tx_ch);</span><br><span class="line">			serial-&gt;Txbuffer-&gt;tail = serial-&gt;Txbuffer-&gt;tail + length;</span><br><span class="line">		&#125;</span><br><span class="line">    &#125;</span><br><span class="line">... ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¿®æ”¹åè¿˜æ˜¯ä¼šåœ¨DMAå‘é€æ•°æ®æ»¡çš„æ—¶å€™ï¼Œå¤šå‡ºä¸çŸ¥åçš„ç¬¦å·ï¼Œå†æ¬¡ä¿®æ”¹ï¼š</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">ec32_uart_dma_tx_config</span><span class="params">(<span class="keyword">struct</span> ec_serial_device *serial, <span class="type">uint8_t</span> *buffer, <span class="type">uint16_t</span> length)</span></span><br><span class="line">&#123;</span><br><span class="line">    DMA_EnableChannel(serial-&gt;dma.tx_ch, DISABLE);          <span class="comment">//å»æ‰è¿™ä¸€é¡¹ï¼Œåœ¨éœ€è¦å…³é—­æ—¶å†å…³é—­DMAï¼Œå¦åˆ™ä¼šå½±å“æ•°ç»„æ»¡æ—¶çš„æ•°æ®ã€‚</span></span><br><span class="line">... ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¿®æ”¹åä»£ç ï¼š</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">ec32_uart_dma_tx_config</span><span class="params">(<span class="keyword">struct</span> ec_serial_device *serial, <span class="type">uint8_t</span> *buffer, <span class="type">uint16_t</span> length)</span></span><br><span class="line">&#123;</span><br><span class="line">    DMA_InitType DMA_InitStructure;</span><br><span class="line">	</span><br><span class="line">    <span class="comment">/* if no data waiting send*/</span></span><br><span class="line">    <span class="keyword">if</span>(DMA_GetCurrDataCounter(serial-&gt;dma.tx_ch) == <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        DMA_EnableChannel(serial-&gt;dma.tx_ch, DISABLE);</span><br><span class="line">		serial-&gt;Txbuffer-&gt;lenth = length &gt; serial-&gt;dma.setting_tx_len ? serial-&gt;dma.setting_tx_len : length;</span><br><span class="line">		<span class="built_in">memcpy</span>(serial-&gt;Txbuffer-&gt;data, buffer, serial-&gt;Txbuffer-&gt;lenth);</span><br><span class="line">        DMA_InitStructure.MemAddr = (<span class="type">uint32_t</span>)serial-&gt;Txbuffer-&gt;data;</span><br><span class="line">        DMA_InitStructure.BufSize = serial-&gt;Txbuffer-&gt;lenth;</span><br><span class="line">        serial-&gt;Txbuffer-&gt;tail = serial-&gt;Txbuffer-&gt;lenth;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(serial-&gt;Txbuffer-&gt;tail + length &gt; serial-&gt;dma.setting_tx_len)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">while</span>(DMA_GetFlagStatus(serial-&gt;dma.tx_gl_flag, serial-&gt;dma.tx_dma_type) == RESET)&#123;&#125;</span><br><span class="line">            DMA_EnableChannel(serial-&gt;dma.tx_ch, DISABLE);</span><br><span class="line">            </span><br><span class="line">            serial-&gt;Txbuffer-&gt;lenth = length &gt; serial-&gt;dma.setting_tx_len ? serial-&gt;dma.setting_tx_len : length;</span><br><span class="line">            <span class="built_in">memcpy</span>(serial-&gt;Txbuffer-&gt;data, buffer, serial-&gt;Txbuffer-&gt;lenth);</span><br><span class="line">			DMA_InitStructure.MemAddr = (<span class="type">uint32_t</span>)serial-&gt;Txbuffer-&gt;data;</span><br><span class="line">			DMA_InitStructure.BufSize = serial-&gt;Txbuffer-&gt;lenth;</span><br><span class="line">			serial-&gt;Txbuffer-&gt;tail = serial-&gt;Txbuffer-&gt;lenth;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            DMA_EnableChannel(serial-&gt;dma.tx_ch, DISABLE);</span><br><span class="line">			<span class="built_in">memcpy</span>(serial-&gt;Txbuffer-&gt;data + serial-&gt;Txbuffer-&gt;tail, buffer, length);</span><br><span class="line">			DMA_InitStructure.MemAddr = (<span class="type">uint32_t</span>)(serial-&gt;Txbuffer-&gt;data + serial-&gt;Txbuffer-&gt;tail - DMA_GetCurrDataCounter(serial-&gt;dma.tx_ch));</span><br><span class="line">			DMA_InitStructure.BufSize = length + DMA_GetCurrDataCounter(serial-&gt;dma.tx_ch);</span><br><span class="line">			serial-&gt;Txbuffer-&gt;tail = serial-&gt;Txbuffer-&gt;tail + length;</span><br><span class="line">		&#125;</span><br><span class="line">    &#125;</span><br><span class="line">... ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br>

<h2 id="RT-THREADä¸‹IAPå‡çº§é—®é¢˜"><a href="#RT-THREADä¸‹IAPå‡çº§é—®é¢˜" class="headerlink" title="RT-THREADä¸‹IAPå‡çº§é—®é¢˜"></a>RT-THREADä¸‹IAPå‡çº§é—®é¢˜</h2><p>å½“å‰ä»£ç ï¼š</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> RT_THREAD_PRIORITY_MAX          32 </span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> RT_THREAD_COMM_TASK_PRIORITY    10</span></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">iap</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">uint8_t</span> proi = RT_THREAD_COMM_TASK_PRIORITY - <span class="number">1</span>;</span><br><span class="line">	<span class="type">rt_thread_t</span> th = rt_thread_find(<span class="string">&quot;tidle&quot;</span>);					<span class="comment">//fix itï¼ˆ2022.8.30ï¼‰</span></span><br><span class="line">	rt_thread_control(th,RT_THREAD_CTRL_CHANGE_PRIORITY,&amp;proi);</span><br><span class="line">	SerialDownload();</span><br><span class="line">	proi = RT_THREAD_PRIORITY_MAX - <span class="number">1</span>;</span><br><span class="line">	rt_thread_control(th,RT_THREAD_CTRL_CHANGE_PRIORITY,&amp;proi);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>æ€è·¯æ˜¯è¿›å…¥<code>IAP</code>å‡çº§åæé«˜å½“å‰ä¼˜å…ˆçº§ï¼Œé¿å…å…¶ä»–ä»»åŠ¡æ‰“æ–­ï¼Œä¼ è¾“æ•°æ®æ¥æ”¶å¼‚å¸¸ï¼Œå¯¼è‡´å‡çº§å¤±è´¥ã€‚</li>
<li>åé¢æµ‹è¯•å‘ç°å¦‚æœå‡çº§é€”ä¸­è¢«å¤–éƒ¨å­—ç¬¦è¾“å…¥æ‰“æ–­ï¼Œä¼šä¸€ç›´åœ¨<code>YMODEM</code>é‡Œé¢å‡ºä¸æ¥ï¼Œå¼€äº†çœ‹é—¨å£ä¹Ÿæ²¡ç”¨ï¼ˆ<code>YMODEM</code>æ¥æ”¶ç¨‹åºé‡Œæœ‰çœ‹é—¨ç‹—ï¼‰ã€‚</li>
<li>è§£å†³æ–¹æ³•ï¼š<br>ç›®å‰æ·»åŠ <code>rt_schedule();</code>æš‚æ—¶è§£å†³é—®é¢˜ï¼Œæµ‹è¯•ä¸­ä¼šå¶å‘ï¼Œæœ€è¿‘æµ‹è¯•æ²¡æœ‰å‘ç°ï¼Œå¾…è¿›ä¸€æ­¥æµ‹è¯•ã€‚<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">   <span class="type">rt_thread_t</span> th = rt_thread_find(<span class="string">&quot;tidle&quot;</span>);					<span class="comment">//fix itï¼ˆ2022.8.30ï¼‰</span></span><br><span class="line">   <span class="type">int</span> original_priority = th-&gt;current_priority;</span><br><span class="line">   <span class="type">int</span> new_priority = RT_THREAD_COMM_TASK_PRIORITY - <span class="number">1</span>;</span><br><span class="line"><span class="type">rt_err_t</span> ret = rt_thread_control(th,RT_THREAD_CTRL_CHANGE_PRIORITY,&amp;new_priority);</span><br><span class="line">   <span class="comment">// rt_schedule();</span></span><br><span class="line"></span><br><span class="line">SerialDownload();</span><br><span class="line"></span><br><span class="line">ret = rt_thread_control(th,RT_THREAD_CTRL_CHANGE_PRIORITY,&amp;original_priority);</span><br><span class="line">   rt_schedule();</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="J-LINKæ·»åŠ èŠ¯ç‰‡"><a href="#J-LINKæ·»åŠ èŠ¯ç‰‡" class="headerlink" title="J-LINKæ·»åŠ èŠ¯ç‰‡"></a>J-LINKæ·»åŠ èŠ¯ç‰‡</h2><p><code>J-LINK</code>æ—¶å¸¸ä¼šæ·»åŠ æ²¡ç”¨è¿‡çš„èŠ¯ç‰‡ï¼Œæœ‰ä»¥ä¸‹æ­¥éª¤å¯ä»¥é€‚é…J-LINKçš„UIç•Œé¢ç‰ˆå’ŒæŒ‡ä»¤æ¿ï¼Œä»¥<code>GD</code>çš„<code>GD32E235CBT6</code>ä¸¾ä¾‹ï¼š</p>
<ul>
<li>æ·»åŠ <code>GD32E23x.FLM</code>æ–‡ä»¶åˆ°<code>JLink\Devices\GigaDevice</code></li>
<li>åœ¨æœ€åé¢, <code>&lt;/DataBase&gt;</code>ä¹‹å‰è¿½åŠ <code>JLinkDevices.xml</code>æ–‡ä»¶çš„å†…å®¹ï¼š<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Device</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ChipInfo</span> <span class="attr">Vendor</span>=<span class="string">&quot;GigaDevice&quot;</span> <span class="attr">Name</span>=<span class="string">&quot;GD32E235CB&quot;</span> <span class="attr">Core</span>=<span class="string">&quot;JLINK_CORE_CORTEX_M23&quot;</span>  <span class="attr">WorkRAMAddr</span>=<span class="string">&quot;0x20000000&quot;</span> <span class="attr">WorkRAMSize</span>=<span class="string">&quot;0x00004000&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">FlashBankInfo</span> <span class="attr">Name</span>=<span class="string">&quot;Flash Bank1&quot;</span> <span class="attr">BaseAddr</span>=<span class="string">&quot;0x08000000&quot;</span> <span class="attr">MaxSize</span>=<span class="string">&quot;0x00020000&quot;</span> <span class="attr">Loader</span>=<span class="string">&quot;Devices\GigaDevice\GD32E23x.FLM&quot;</span> <span class="attr">LoaderType</span>=<span class="string">&quot;FLASH_ALGO_TYPE_OPEN&quot;</span> <span class="attr">AlwaysPresent</span>=<span class="string">&quot;1&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">Device</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>æ³¨æ„, <code>Name=&quot;GD32E235CB&quot;</code> ä¸­çš„<code>GD32E235CB</code> éœ€è¦è·Ÿè„šæœ¬æŒ‡ä»¤ <code>JLink -device N32G452RC</code>ä¿æŒä¸€è‡´ã€‚</li>
</ul>
<h2 id="åˆ©ç”¨æ­£å¼¦æ›²çº¿æ¨¡æ‹Ÿå‘¼å¸ç¯"><a href="#åˆ©ç”¨æ­£å¼¦æ›²çº¿æ¨¡æ‹Ÿå‘¼å¸ç¯" class="headerlink" title="åˆ©ç”¨æ­£å¼¦æ›²çº¿æ¨¡æ‹Ÿå‘¼å¸ç¯"></a>åˆ©ç”¨æ­£å¼¦æ›²çº¿æ¨¡æ‹Ÿå‘¼å¸ç¯</h2><ul>
<li>ç›´æ¥ä¸Šç¤ºä¾‹ï¼š<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å®å®šä¹‰</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;math.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> RLED_WHITE_NUM_MAX 		11</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> RLED_RGB_TYPE 			3</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> RLED_LIGHT_PERCENT 		0.3f								<span class="comment">//light percent</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> RLED_VALUE_MAX 			(uint8_t)(255 * RLED_LIGHT_PERCENT)	<span class="comment">//max 255</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> CHARGE_BREATH_TICKS		3000.0								<span class="comment">//3s</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">ifndef</span> M_PI</span></span><br><span class="line">	<span class="meta">#<span class="keyword">define</span> M_PI 3.14159265358979323846</span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"><span class="type">const</span> <span class="type">float</span> twoPi = <span class="number">2.0f</span> * M_PI; <span class="comment">// 2 * Ï€</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å…·ä½“å®ç°</span></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">led_rgb_breath_function</span><span class="params">(<span class="type">uint8_t</span> *rgb, <span class="type">float</span> tick)</span>		<span class="comment">//tick-&gt;(0~1) ä¸ºä¸€ä¸ªå‘¨æœŸ</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">uint8_t</span> temp[RLED_RGB_TYPE] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>; i&lt;RLED_RGB_TYPE; i++)</span><br><span class="line">	&#123;</span><br><span class="line">		temp[i] = (rgb[i] * (<span class="number">1.0f</span> + <span class="built_in">cos</span>(M_PI + twoPi * tick)) / <span class="number">2.0f</span>);</span><br><span class="line">		board_led_rgb_set(i, temp[i]);          <span class="comment">//å…·ä½“è¾“å‡ºRGBçš„PWMå‡½æ•°</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">RLED_RUN_MODE <span class="title function_">rled_ring_charge_function</span><span class="params">(<span class="type">event_param_t</span> ep)</span></span><br><span class="line">&#123;</span><br><span class="line">	RLED_RUN_MODE ret = RLED_NONE;</span><br><span class="line">		</span><br><span class="line">	<span class="type">static</span> <span class="type">float</span> ticks = <span class="number">0</span>;</span><br><span class="line">	<span class="type">uint8_t</span> rgb_temp[] = RGB_LED_COLOR_WHITE;</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>; i&lt;RLED_RGB_TYPE; i++)</span><br><span class="line">		rgb_temp[i] = (<span class="type">uint8_t</span>)(rgb_temp[i] * RLED_LIGHT_PERCENT);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span>(ep.first_in)&#123;</span><br><span class="line">		led_white_all_play(<span class="number">0</span>);</span><br><span class="line">		ticks = <span class="number">0</span>;</span><br><span class="line">	&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">		ticks = ticks + LED_MAIN_UPGRATE_TIMES * LED_SINGLE_CHR_IN_CNTS / CHARGE_BREATH_TICKS;  <span class="comment">// ticksé€’å¢</span></span><br><span class="line">		led_rgb_breath_function(rgb_temp, ticks);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	ret = ep.mode;</span><br><span class="line">	<span class="keyword">if</span>(ep.ret_priv)</span><br><span class="line">		ret = ep.mode;</span><br><span class="line">	<span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<br>

<h2 id="RTCä½åŠŸè€—å”¤é†’é—®é¢˜"><a href="#RTCä½åŠŸè€—å”¤é†’é—®é¢˜" class="headerlink" title="RTCä½åŠŸè€—å”¤é†’é—®é¢˜"></a>RTCä½åŠŸè€—å”¤é†’é—®é¢˜</h2><h3 id="RTCè®¾ç½®æ—¥æœŸæ—¶é—´é—®é¢˜"><a href="#RTCè®¾ç½®æ—¥æœŸæ—¶é—´é—®é¢˜" class="headerlink" title="RTCè®¾ç½®æ—¥æœŸæ—¶é—´é—®é¢˜"></a>RTCè®¾ç½®æ—¥æœŸæ—¶é—´é—®é¢˜</h3><ul>
<li><p>é‡åˆ°é—®é¢˜</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">drv_low_power_rtc_init</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">	rtc_date_time_default_value();</span><br><span class="line">	rtc_alarm_default_value();</span><br><span class="line">    rtc_system_clk_config();</span><br><span class="line">	<span class="keyword">if</span>(USER_WRITE_BKP_DAT1_DATA != BKP_ReadBkpData(BKP_DAT1))</span><br><span class="line">    &#123;</span><br><span class="line">		logDebug(<span class="string">&quot;RTC not yet configured.... &quot;</span>);</span><br><span class="line">		rtc_clk_source_config(RTC_CLK_SRC_TYPE_LSI, <span class="literal">true</span>, <span class="literal">true</span>);</span><br><span class="line">		rtc_date_params_set(&amp;RTC_DateDefault);</span><br><span class="line">		rtc_time_params_set(&amp;RTC_TimeDefault);</span><br><span class="line">		BKP_WriteBkpData(BKP_DAT1, USER_WRITE_BKP_DAT1_DATA);</span><br><span class="line">	&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">		logDebug(<span class="string">&quot;RTC is haven configured.... &quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	wakeup_exti_trigger_init();</span><br><span class="line">    wakeup_exti_config_it(<span class="literal">true</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>rtc_clk_source_config(...)</code>æ‰§è¡Œå®Œåï¼Œè®¾ç½®æ—¥æœŸ<code>rtc_date_params_set(...)</code>ï¼Œè®¾ç½®ä¼šå¤±è´¥æ˜¾ç¤º<code>The current date (WeekDay-Date-Month-Year) is &lt; 00-01-01-00 &gt;</code>ï¼š</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">D [<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>,<span class="number">000</span>] (driver/drv_lp_rtc.c) drv_low_power_rtc_init [<span class="number">380</span>]: RTC not yet configured.... </span><br><span class="line">D [<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>,<span class="number">000</span>] (driver/drv_lp_rtc.c) rtc_clk_source_config [<span class="number">331</span>]: RTC_ClkSrc Is Set LSI!</span><br><span class="line">D [<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>,<span class="number">001</span>] (driver/drv_lp_rtc.c) rtc_date_params_set [<span class="number">166</span>]: &gt;&gt; RTC Set Date success. &lt;&lt;</span><br><span class="line">D [<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>,<span class="number">001</span>] (driver/drv_lp_rtc.c) rtc_date_param_show [<span class="number">125</span>]: The current <span class="title function_">date</span> <span class="params">(WeekDay-Date-Month-Year)</span> is &lt; 00-01-01-00 &gt;</span><br><span class="line">D [00:00:00,001] <span class="params">(driver/drv_lp_rtc.c)</span> rtc_time_params_set [186]: &gt;&gt; RTC Set Time success. &lt;&lt;</span><br><span class="line">D [00:00:00,001] <span class="params">(driver/drv_lp_rtc.c)</span> rtc_time_param_show [137]: The current <span class="title function_">time</span> <span class="params">(Hour-Minute-Second)</span> is &lt; 12:00:01 &gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>åŸå› åˆ†æï¼Œåœ¨å‡½æ•°<code>ErrorStatus RTC_Init(RTC_InitType* RTC_InitStruct)&#123;...&#125;</code>ä¸­æœ‰ä»¥ä¸‹ä»£ç ï¼š</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* Delay for the RTC prescale effect */</span></span><br><span class="line"><span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;<span class="number">0x2FF</span>;i++);</span><br></pre></td></tr></table></figure></li>
<li><p>å½“è·‘åŸå‚<code>demo</code>çš„æ—¶å€™ä¸ä¼šå‡ºç°è®¾ç½®å¤±è´¥ï¼Œç»æ’æŸ¥å‘ç°<code>demo</code>æ˜¯çš„ä¼˜åŒ–ç­‰çº§æ˜¯<code>O0</code>ï¼Œè€Œæœ¬ä»£ç æ˜¯<code>Os</code>ï¼Œä¼˜åŒ–ç­‰çº§<code>Os</code>ä¼šå°†ç©ºå¾ªç¯<code>for(i=0;i&lt;0x2FF;i++);</code>å¯¼è‡´RTCåˆå§‹åŒ–åï¼Œç­‰å¾…å¯„å­˜å™¨åŒæ­¥è¿‡ç¨‹è¢«ä¼˜åŒ–æ‰ä¸å»æ‰§è¡Œï¼Œå¯¼è‡´ä¸‹ä¸€æ­¥è®¾ç½®<code>RTC</code>å‚æ•°å¤±è´¥ã€‚</p>
</li>
<li><p>è§£å†³æ–¹æ¡ˆï¼š</p>
<ul>
<li>1ã€å°†å‡½æ•°<code>for(i=0;i&lt;0x2FF;i++);</code>ä¸­<code>i</code>çš„å˜é‡ç±»å‹æ”¹ä¸º<code>volatile</code>ï¼Œå°†ä¼šç›´æ¥è¯»å–å¯„å­˜å™¨ï¼Œä¸ä¼šè¢«å†…å­˜ä¼˜åŒ–ã€‚</li>
<li>2ã€å°†å‡½æ•°<code>for(i=0;i&lt;0x2FF;i++);</code>æ›¿æ¢ä¸º<code>for(i=0;i&lt;0x2FF;i++)&#123;__asm(&quot;nop&quot;);&#125;</code>ï¼Œå°†ä¼šç›´æ¥æ‰§è¡ŒæŒ‡ä»¤ï¼Œä¸ä¼šè¢«å†…å­˜ä¼˜åŒ–ã€‚</li>
</ul>
</li>
</ul>
<h3 id="RTCå”¤é†’å¶å°”å¤±è´¥ï¼ˆrt-threadæ“ä½œç³»ç»Ÿï¼‰"><a href="#RTCå”¤é†’å¶å°”å¤±è´¥ï¼ˆrt-threadæ“ä½œç³»ç»Ÿï¼‰" class="headerlink" title="RTCå”¤é†’å¶å°”å¤±è´¥ï¼ˆrt-threadæ“ä½œç³»ç»Ÿï¼‰"></a>RTCå”¤é†’å¶å°”å¤±è´¥ï¼ˆrt-threadæ“ä½œç³»ç»Ÿï¼‰</h3><p>è°ƒè¯•å‘ç°<code>æŒ‰é”®å”¤é†’</code>å’Œ<code>é—¹é’Ÿå”¤é†’</code>å‡å¯, <code>RTCè‡ªåŠ¨å”¤é†’</code>æœ‰é—®é¢˜ã€‚</p>
<h4 id="å”¤é†’ä¾‹ç¨‹"><a href="#å”¤é†’ä¾‹ç¨‹" class="headerlink" title="å”¤é†’ä¾‹ç¨‹"></a>å”¤é†’ä¾‹ç¨‹</h4><ul>
<li><p>ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> RTC_WAKEUP_EN  			0</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> IWDG_MAX_TIMEOUT_SECS	25</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> IWDG_MAX_USER_SECS	21</span></span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">board_rtc_alarm_second_set</span><span class="params">(<span class="type">uint32_t</span> secs)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">uint32_t</span> second = IWDG_MAX_USER_SECS;</span><br><span class="line">	<span class="keyword">if</span>(secs &lt; IWDG_MAX_USER_SECS)</span><br><span class="line">		second = secs;</span><br><span class="line">	rtc_alarm_second_set(second);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æŒ‚èµ·æ‰€æœ‰çº¿ç¨‹çš„å‡½æ•°</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">suspend_all_threads</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">rt_thread</span> *<span class="title">thread</span>;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">rt_object_information</span> *<span class="title">information</span>;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">rt_list_node</span> *<span class="title">node</span>;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/* è·å–çº¿ç¨‹å¯¹è±¡ä¿¡æ¯ */</span></span><br><span class="line">    information = rt_object_get_information(RT_Object_Class_Thread);</span><br><span class="line">    RT_ASSERT(information != RT_NULL);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* è¿›å…¥ä¸´ç•ŒåŒº */</span></span><br><span class="line">    rt_enter_critical();</span><br><span class="line"></span><br><span class="line">	<span class="comment">//æ¸…ç©ºtickå€¼ï¼Œå…³é—­systickä¸­æ–­</span></span><br><span class="line">	SysTick-&gt;VAL = <span class="number">0x00</span>;</span><br><span class="line">	SysTick-&gt;CTRL = <span class="number">0x00</span>;	</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* éå†çº¿ç¨‹å¯¹è±¡åˆ—è¡¨ */</span></span><br><span class="line">    <span class="keyword">for</span> (node = information-&gt;object_list.next; node != &amp;(information-&gt;object_list); node = node-&gt;next)</span><br><span class="line">    &#123;</span><br><span class="line">        thread = rt_list_entry(node, <span class="keyword">struct</span> rt_thread, <span class="built_in">list</span>);</span><br><span class="line">        <span class="comment">/* ç¡®ä¿ä¸æ˜¯æŒ‚èµ·å½“å‰æ­£åœ¨è¿è¡Œçš„çº¿ç¨‹ */</span></span><br><span class="line">        <span class="keyword">if</span> (thread != rt_thread_self())</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">/* æŒ‚èµ·çº¿ç¨‹ */</span></span><br><span class="line">            rt_thread_suspend(thread);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* é€€å‡ºä¸´ç•ŒåŒº */</span></span><br><span class="line">    rt_exit_critical();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">board_pwr_enter_stop2</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">	suspend_all_threads();</span><br><span class="line"><span class="meta">#<span class="keyword">if</span> RTC_WAKEUP_EN</span></span><br><span class="line">	rtc_auto_wakeup_init(<span class="number">5</span>);</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">	<span class="keyword">while</span>(<span class="number">1</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		serial_only_print_string(<span class="string">&quot;Start low power mode!\r\n\r\n&quot;</span>);</span><br><span class="line"><span class="meta">#<span class="keyword">if</span> !RTC_WAKEUP_EN</span></span><br><span class="line">		board_rtc_alarm_second_set(<span class="number">20</span>);</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">		PWR_EnterSTOP2Mode(PWR_STOPENTRY_WFI);</span><br><span class="line">		system_clock_config_stop2();</span><br><span class="line">		system_print_config_stop2();</span><br><span class="line">		serial_only_print_string(<span class="string">&quot;Exit low power mode!\r\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">		<span class="type">bool</span> botton_sw = GPIO_ReadInputDataBit(GPIOA, GPIO_PIN_0);</span><br><span class="line">		<span class="type">bool</span> dc_ch = !GPIO_ReadInputDataBit(GPIOA, GPIO_PIN_5);</span><br><span class="line">		<span class="keyword">if</span>(botton_sw) 		<span class="comment">//  || dc_ch</span></span><br><span class="line">		&#123;</span><br><span class="line">			serial_only_print_string(<span class="string">&quot;botton press!\r\n&quot;</span>);</span><br><span class="line">			reboot();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>RTC auto wakeup</code>æˆåŠŸ, éœ€æ³¨æ„å”¤é†’æ—¶é’Ÿé—®é¢˜:</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">drv_low_power_rtc_init</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">	rtc_date_time_default_value();</span><br><span class="line">	rtc_alarm_default_value();</span><br><span class="line">    rtc_system_clk_config();</span><br><span class="line">    rtc_auto_wakeup_init();</span><br><span class="line">	<span class="keyword">if</span>(USER_WRITE_BKP_DAT1_DATA != BKP_ReadBkpData(BKP_DAT1))</span><br><span class="line">    &#123;</span><br><span class="line">		logDebug(<span class="string">&quot;RTC not yet configured.... &quot;</span>);</span><br><span class="line">		rtc_clk_source_config(RTC_CLK_SRC_TYPE_LSI, <span class="literal">true</span>, <span class="literal">true</span>);</span><br><span class="line">        RTC_ConfigWakeUpClock(RTC_WKUPCLK_CK_SPRE_16BITS);          <span class="comment">// æ³¨æ„ï¼šåªèƒ½è®¾ç½®ä¸€æ¬¡ï¼Œå¦åˆ™ä¼šæœ‰å¼‚å¸¸ï¼Œä¸èƒ½è‡ªåŠ¨å”¤é†’å¯¼è‡´å¡æ­»</span></span><br><span class="line">		rtc_date_params_set(&amp;RTC_DateDefault);</span><br><span class="line">		rtc_time_params_set(&amp;RTC_TimeDefault);</span><br><span class="line">		BKP_WriteBkpData(BKP_DAT1, USER_WRITE_BKP_DAT1_DATA);</span><br><span class="line">	&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">		logDebug(<span class="string">&quot;RTC is haven configured.... &quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	wakeup_exti_trigger_init();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">rtc_auto_wakeup_set</span><span class="params">(<span class="type">uint8_t</span> seconds)</span></span><br><span class="line">&#123;</span><br><span class="line">    RTC_SetWakeUpCounter(seconds);</span><br><span class="line">    EXTI20_RTCWKUP_Configuration(<span class="literal">true</span>);</span><br><span class="line">    RTC_ConfigInt(RTC_INT_WUT, ENABLE);</span><br><span class="line">    RTC_EnableWakeUp(ENABLE);</span><br><span class="line">    exti20_alarm_config_it(<span class="literal">true</span>);</span><br><span class="line">    rtc_wakeup_all_config_it(<span class="literal">true</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="gccä¼˜åŒ–ç­‰çº§å’Œæ ‡å‡†åº“é—®é¢˜"><a href="#gccä¼˜åŒ–ç­‰çº§å’Œæ ‡å‡†åº“é—®é¢˜" class="headerlink" title="gccä¼˜åŒ–ç­‰çº§å’Œæ ‡å‡†åº“é—®é¢˜"></a>gccä¼˜åŒ–ç­‰çº§å’Œæ ‡å‡†åº“é—®é¢˜</h3><ul>
<li><code>O0</code>çº§ä¼˜åŒ–ä½åŠŸè€—ä¼šè·‘é£ï¼Œ<code>Os</code>çº§ä¼˜åŒ–ä½åŠŸè€—å°±æ˜¯æ­£å¸¸çš„ï¼ŒåŸå› å¾…æŸ¥ï¼Œä¸‹ä¸€æ­¥<strong>å…ˆæŸ¥æ‰“å°å‡½æ•°</strong>, <strong>ä¸æ˜¯æ‰“å°å‡½æ•°åŸå› </strong>ï¼Œå·²éªŒè¯ã€‚</li>
<li><code>arm-none-eabi-gcc</code>çš„<code>nano</code>ç³»ç»Ÿï¼šæ·»åŠ <code>--specs=nano.specs</code> æ‰“å°ä¸äº†<code>float</code>å’Œ<code>64ä½</code>æ•´æ•°ï¼Œä½†æ˜¯ç¨‹åºç¼©å°<code>20K</code>å·¦å³; ä½†æ˜¯æ ‡å‡†åº“è·‘ä¸äº†ä½åŠŸè€—ï¼ŒåŸå› ä¸º<strong>ä¸²å£æ‰“å°å‡½æ•°é—®é¢˜</strong>, å¾…åˆ†æã€‚</li>
</ul>
<br>

<h2 id="è‡ªå†™printfå‡½æ•°"><a href="#è‡ªå†™printfå‡½æ•°" class="headerlink" title="è‡ªå†™printfå‡½æ•°"></a>è‡ªå†™printfå‡½æ•°</h2><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="type">static</span> <span class="type">int</span> <span class="title function_">lp_printf</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *format, ...)</span> &#123;</span><br><span class="line">    va_list args;</span><br><span class="line">    <span class="type">char</span> buffer[<span class="number">256</span>];  			<span class="comment">// å®šä¹‰ä¸€ä¸ªè¶³å¤Ÿå¤§çš„ç¼“å†²åŒº</span></span><br><span class="line">    <span class="type">int</span> len, size;</span><br><span class="line"></span><br><span class="line">    va_start(args, format);  	<span class="comment">// åˆå§‹åŒ–args</span></span><br><span class="line">    len = vsnprintf(buffer, <span class="keyword">sizeof</span>(buffer), format, args);  <span class="comment">// æ ¼å¼åŒ–å­—ç¬¦ä¸²åˆ°buffer</span></span><br><span class="line">    va_end(args);  				<span class="comment">// æ¸…ç†args</span></span><br><span class="line">	</span><br><span class="line">	<span class="type">uint8_t</span> *p_buff = (<span class="type">uint8_t</span> *)buffer;</span><br><span class="line">	size = len;</span><br><span class="line">	</span><br><span class="line">    <span class="comment">// ç¡¬ä»¶é€‚é…å±‚</span></span><br><span class="line">	USART_ClrFlag(USART1, USART_FLAG_TXC);</span><br><span class="line">	<span class="keyword">while</span>(len --)</span><br><span class="line">	&#123;</span><br><span class="line">		USART_SendData(USART1, *p_buff);</span><br><span class="line">        <span class="keyword">while</span> (USART_GetFlagStatus(USART1, USART_FLAG_TXC) == RESET);</span><br><span class="line">		p_buff ++;</span><br><span class="line">	&#125;</span><br><span class="line">    <span class="keyword">return</span> size;  <span class="comment">// è¿”å›å‘é€çš„å­—ç¬¦æ•°</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>é—®é¢˜ç‚¹ï¼šä½¿ç”¨<code>arm-none-eabi-gcc</code>ç¯å¢ƒåœ¨<code>makefile</code>ä¸­ä½¿ç”¨<code>--specs=nano.specs</code>é€‰é¡¹ï¼Œä½¿ç”¨çš„æ˜¯<code>newlib-nano</code>åº“ï¼Œ<code>lp_printf</code>è¿›å…¥ä½åŠŸè€—ååˆå§‹åŒ–æ‰“å°æ­£å¸¸ï¼›ä½¿ç”¨çš„æ˜¯æ ‡å‡†åº“<code>newlib</code>åº“ï¼Œ<code>lp_printf</code>è¿›å…¥ä½åŠŸè€—ååˆå§‹åŒ–æ‰“å°å¼‚å¸¸ã€‚è°ƒè¯•å‘ç°åœ¨ä½¿ç”¨<code>vsnprintf</code>å‡½æ•°æ—¶ä¼šè·‘é£ã€‚</li>
<li>æ”¹è¿›æ–¹æ³•ï¼šå°†<code>vsnprintf</code>å‡½æ•°æ›¿æ¢æˆ<code>rt_vsnprintf</code>å‡½æ•°ã€‚</li>
<li>åˆ†æåŸå› ï¼š<ul>
<li>å¯èƒ½é—®é¢˜ç‚¹ï¼šåœ¨è¿›å…¥ä½åŠŸè€—æ¨¡å¼æ—¶ï¼Œç³»ç»Ÿä¼šå…³é—­ä¸€äº›å¤–è®¾å’Œèµ„æºä»¥èŠ‚çœèƒ½é‡ã€‚å½“é€€å‡ºä½åŠŸè€—æ¨¡å¼æ—¶ï¼Œéœ€è¦æ­£ç¡®åœ°æ¢å¤è¿™äº›èµ„æºã€‚å¦‚æœ <code>newlib</code> ä¸­çš„æŸäº›åŠŸèƒ½åœ¨èµ„æºæ¢å¤è¿‡ç¨‹ä¸­å­˜åœ¨é—®é¢˜ï¼Œå¯èƒ½ä¼šå¯¼è‡´ç¨‹åºå¼‚å¸¸ã€‚</li>
<li><code>newlib-nano</code> ç”±äºå®ç°ç®€å•ï¼Œå¯èƒ½åœ¨èµ„æºæ¢å¤æ–¹é¢æ›´åŠ ç¨³å®šï¼Œä¸ä¼šå—åˆ°ä½åŠŸè€—æ¨¡å¼çš„å½±å“ã€‚</li>
</ul>
</li>
<li>è§£å†³æ–¹æ³•ï¼šï¼ˆæ„Ÿè§‰æ— ç”¨ï¼‰<ul>
<li>æ£€æŸ¥èµ„æºç®¡ç†ï¼šç¡®ä¿åœ¨è¿›å…¥å’Œé€€å‡ºä½åŠŸè€—æ¨¡å¼æ—¶ï¼Œæ‰€æœ‰èµ„æºéƒ½è¢«æ­£ç¡®ç®¡ç†ã€‚ç‰¹åˆ«æ˜¯å¯¹äºæ ‡å‡†åº“ä¸­ä½¿ç”¨çš„èµ„æºï¼Œå¦‚å†…å­˜åˆ†é…å™¨ç­‰ï¼Œç¡®ä¿å®ƒä»¬åœ¨ä½åŠŸè€—æ¨¡å¼ä¸‹èƒ½å¤Ÿæ­£å¸¸å·¥ä½œã€‚</li>
<li>ä½¿ç”¨çº¿ç¨‹å®‰å…¨çš„å®ç°ï¼šå¦‚æœåœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­ä½¿ç”¨æ ‡å‡†åº“ï¼Œç¡®ä¿æ‰€æœ‰å‡½æ•°éƒ½æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œä»¥é¿å…åœ¨ä½åŠŸè€—æ¨¡å¼ä¸‹å‡ºç°å¹¶å‘é—®é¢˜ã€‚</li>
</ul>
</li>
</ul>
<br>

<h2 id="rt-thread-äº’æ–¥é‡é—®é¢˜"><a href="#rt-thread-äº’æ–¥é‡é—®é¢˜" class="headerlink" title="rt-thread äº’æ–¥é‡é—®é¢˜"></a>rt-thread äº’æ–¥é‡é—®é¢˜</h2><p><strong>é—®é¢˜ç‚¹ï¼š</strong></p>
<ul>
<li>ä½ä¼˜å…ˆçº§ä»»åŠ¡åœ¨æ‰“å°æ—¶ï¼Œé«˜ä¼˜å…ˆçº§ä»»åŠ¡ä¹Ÿæœ‰æ‰“å°ï¼Œå¯¼è‡´æ‰“å°å‡½æ•°é‡å…¥äº’æ–¥é‡è‡ªé”ã€‚</li>
</ul>
<p><strong>è§£å†³æ–¹æ³•ï¼š</strong></p>
<ul>
<li><strong>ä½¿ç”¨é€’å½’äº’æ–¥é‡</strong>ï¼šåœ¨<code>FreeRTOS</code>ä¸­ï¼Œå¯ä»¥ä½¿ç”¨<code>xSemaphoreCreateRecursiveMutex</code>æ¥åˆ›å»ºé€’å½’äº’æ–¥é‡ï¼Œå¹¶ä½¿ç”¨<code>xSemaphoreTakeRecursive</code>å’Œ<code>xSemaphoreGiveRecursive</code>æ¥è·å–å’Œé‡Šæ”¾äº’æ–¥é‡, <code>rtthread</code>ç³»ç»Ÿå¾…éªŒè¯ã€‚</li>
<li><strong>ä¼˜å…ˆçº§ç»§æ‰¿</strong>ï¼šå½“ä½ä¼˜å…ˆçº§ä»»åŠ¡æŒæœ‰äº’æ–¥é‡æ—¶ï¼Œå¦‚æœé«˜ä¼˜å…ˆçº§ä»»åŠ¡è¯•å›¾è·å–åŒä¸€ä¸ªäº’æ–¥é‡ï¼Œå¯ä»¥é€šè¿‡ä¼˜å…ˆçº§ç»§æ‰¿æœºåˆ¶æ¥é¿å…æ­»é”ã€‚è¿™æ ·ï¼Œä½ä¼˜å…ˆçº§ä»»åŠ¡çš„ä¼˜å…ˆçº§ä¼šä¸´æ—¶æå‡ï¼Œä»¥å‡å°‘é«˜ä¼˜å…ˆçº§ä»»åŠ¡çš„ç­‰å¾…æ—¶é—´ã€‚</li>
<li><strong>è®¾è®¡åˆç†çš„èµ„æºè®¿é—®é¡ºåº</strong>ï¼šç¡®ä¿ç³»ç»Ÿä¸­çš„æ‰€æœ‰ä»»åŠ¡ä»¥ç›¸åŒçš„é¡ºåºè·å–äº’æ–¥é‡ï¼Œè¿™å¯ä»¥é¿å…å¾ªç¯ç­‰å¾…ï¼Œä»è€Œå‡å°‘æ­»é”çš„å¯èƒ½æ€§ã€‚</li>
</ul>
<br>

<p><strong>é¡¹ç›®ä¸­çš„è§£å†³æ–¹æ¡ˆåŠä»£ç </strong>ï¼š</p>
<ul>
<li><code>shell</code>æ˜¯ç©ºé—²ä»»åŠ¡ï¼Œçº¿ç¨‹ä¼˜å…ˆçº§æœ€ä½ã€‚</li>
<li><code>brains_electric_data_send(&amp;send_data, sizeof(send_data));</code>å‡½æ•°ä¼šä¼ é€’é˜Ÿåˆ—ï¼Œæ¥æ”¶é˜Ÿåˆ—ä»»åŠ¡ä¼˜å…ˆçº§è¦æ¯”<code>shell</code>çº¿ç¨‹ä¼˜å…ˆçº§é«˜ã€‚</li>
<li>åœ¨è¿™é‡Œè¿›å…¥æ‰“å°æ—¶<code>ä¸è®¾ä¸Šé”ç­‰å¾…æ—¶é—´</code>ï¼Œä¼šç›´æ¥é‡å…¥ã€‚</li>
<li><strong>å½±å“</strong>ï¼šæœ‰éƒ¨åˆ†æ‰“å°ä¼šè¢«è¦†ç›–ï¼Œä¸æ˜¾ç¤ºã€‚<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">if</span> LOG_USING_LOCK</span></span><br><span class="line"><span class="type">static</span> <span class="class"><span class="keyword">struct</span> <span class="title">rt_mutex</span> <span class="title">logMutex</span>;</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">userLogLock</span><span class="params">(Log *<span class="built_in">log</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//äº’æ–¥é‡åœ¨ä½ä¼˜å…ˆçº§ä½¿ç”¨çš„æ—¶å€™ï¼Œåˆ‡åˆ°é«˜ä¼˜å…ˆçº§ä»»åŠ¡ä¼šå¯¼è‡´æ­»é”ï¼Œä¸èƒ½ç”¨RT_WAITING_FOREVER</span></span><br><span class="line">    rt_mutex_take(&amp;logMutex, rt_tick_from_millisecond(<span class="number">0</span>));</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">userLogUnlock</span><span class="params">(Log *<span class="built_in">log</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    rt_mutex_release(&amp;logMutex);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// åœ¨shellä¸­</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">brains_electric_transmit_en</span><span class="params">(<span class="type">bool</span> en)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">uint8_t</span> send_data = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">if</span>(en)</span><br><span class="line">	&#123;</span><br><span class="line">		brains_electric_onoff = <span class="literal">true</span>;</span><br><span class="line">		send_data = <span class="string">&#x27;b&#x27;</span>;</span><br><span class="line">		brains_electric_data_send(&amp;send_data, <span class="keyword">sizeof</span>(send_data));</span><br><span class="line">		<span class="comment">// logVerbose(&quot;brains_electric_serial_tx -&gt; [%c]&quot;, send_data);</span></span><br><span class="line">	&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">		rt_timer_stop(&amp;brains_timer_stimer);</span><br><span class="line">		rt_timer_stop(&amp;brains_wait_stimer);</span><br><span class="line">		send_data = <span class="string">&#x27;s&#x27;</span>;</span><br><span class="line">		brains_electric_data_send(&amp;send_data, <span class="keyword">sizeof</span>(send_data));</span><br><span class="line">		<span class="comment">// logVerbose(&quot;brains_electric_serial_tx -&gt; [%c]&quot;, send_data);</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">SHELL_EXPORT_CMD(SHELL_CMD_PERMISSION(<span class="number">0</span>)|SHELL_CMD_TYPE(SHELL_TYPE_CMD_FUNC)|SHELL_CMD_DISABLE_RETURN, brains_electric_transmit_en, brains_electric_transmit_en,brains_electric_transmit_en);</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="arm-none-eabi-gccæ‰“å°ä¸äº†æµ®ç‚¹å’Œ64ä½æ•°æ®é—®é¢˜åˆ†æ"><a href="#arm-none-eabi-gccæ‰“å°ä¸äº†æµ®ç‚¹å’Œ64ä½æ•°æ®é—®é¢˜åˆ†æ" class="headerlink" title="arm-none-eabi-gccæ‰“å°ä¸äº†æµ®ç‚¹å’Œ64ä½æ•°æ®é—®é¢˜åˆ†æ"></a>arm-none-eabi-gccæ‰“å°ä¸äº†æµ®ç‚¹å’Œ64ä½æ•°æ®é—®é¢˜åˆ†æ</h2><p><strong>é—®é¢˜ç‚¹</strong>ï¼š</p>
<ul>
<li><code>arm-none-eabi-gcc</code>ç¯å¢ƒæ‰“å°ä¸äº†æµ®ç‚¹å’Œ64ä½æ•°æ®ï¼Œæµ‹è¯•å‘ç°åœ¨<code>makefile</code>ä¸­ä½¿ç”¨<code>--specs=nano.specs</code>é€‰é¡¹ï¼Œä½¿ç”¨çš„æ˜¯<code>nano</code>åº“è€Œéæ ‡å‡†åº“ã€‚</li>
</ul>
<p><strong>è§£å†³æ–¹æ³•</strong>ï¼š</p>
<ul>
<li>å°è¯•æ·»åŠ <code>LDFLAGS += -lc -lrdimon -u _printf_float</code>ï¼Œç¨‹åºä¼šè·‘é£ã€‚</li>
<li>å°†<code>--specs=nano.specs</code>å»æ‰ï¼Œé»˜è®¤ä½¿ç”¨æ ‡å‡†åº“å°±å¯ä»¥æ‰“å°æµ®ç‚¹å’Œ64ä½æ•°æ®äº†ã€‚</li>
</ul>
<h2 id="letter-shellè°ƒè¯•é—®é¢˜"><a href="#letter-shellè°ƒè¯•é—®é¢˜" class="headerlink" title="letter shellè°ƒè¯•é—®é¢˜"></a>letter shellè°ƒè¯•é—®é¢˜</h2><ul>
<li>ä½¿ç”¨<code>letter shell</code>è°ƒè¯•æ—¶é—´æˆ³è½¬æ¢å‡½æ•°æ—¶é‡åˆ°é—®é¢˜ï¼Œè®¾ç½®æ—¶é—´å¯¹ä¸ä¸Šï¼Œä»£ç å¦‚ä¸‹ï¼š<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å°†UTCçš„Unixæ—¶é—´æˆ³è½¬æ¢ä¸ºRTCæ—¶é—´å’Œæ—¥æœŸ</span></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">rtc_utc_timestamp_set</span><span class="params">(<span class="type">time_t</span> timestamp)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">tm</span> *<span class="title">tm</span> =</span> gmtime(&amp;timestamp);</span><br><span class="line">    RTC_DateType RTC_Date;</span><br><span class="line">    RTC_TimeType RTC_Time;</span><br><span class="line"></span><br><span class="line">    RTC_Date.Year = tm-&gt;tm_year - <span class="number">100</span>;    <span class="comment">// å¹´ä»½ä»1900å¼€å§‹è®¡ç®—</span></span><br><span class="line">    RTC_Date.Month = tm-&gt;tm_mon + <span class="number">1</span>;      <span class="comment">// æœˆä»½ä»0å¼€å§‹è®¡ç®—</span></span><br><span class="line">    RTC_Date.Date = tm-&gt;tm_mday;</span><br><span class="line">    RTC_Date.WeekDay = (tm-&gt;tm_wday == <span class="number">0</span>) ? <span class="number">7</span> : tm-&gt;tm_wday;   <span class="comment">// æ˜ŸæœŸå‡ ï¼Œtmç»“æ„ä½“æ˜¯0-6ï¼Œ0æ˜¯æ˜ŸæœŸå¤©; stm32çš„RTCè¿”å›çš„æ˜¯1-7</span></span><br><span class="line">    RTC_Time.Hours = tm-&gt;tm_hour;</span><br><span class="line">    RTC_Time.Minutes = tm-&gt;tm_min;</span><br><span class="line">    RTC_Time.Seconds = tm-&gt;tm_sec;</span><br><span class="line">    RTC_Time.H12 = RTC_AM_H12;</span><br><span class="line"></span><br><span class="line">    rtc_date_params_set(&amp;RTC_Date);</span><br><span class="line">    rtc_time_params_set(&amp;RTC_Time);</span><br><span class="line">&#125;</span><br><span class="line">SHELL_EXPORT_CMD(SHELL_CMD_PERMISSION(<span class="number">0</span>)|SHELL_CMD_TYPE(SHELL_TYPE_CMD_FUNC)|SHELL_CMD_DISABLE_RETURN, utc_timestamp_set, rtc_utc_timestamp_set, rtc_utc_timestamp_set);</span><br><span class="line"></span><br><span class="line"><span class="comment">// å°†UTCçš„Unixæ—¶é—´æˆ³è½¬æ¢ä¸ºæœ¬åœ°RTCæ—¶é—´å’Œæ—¥æœŸ</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">rtc_local_timestamp_set</span><span class="params">(<span class="type">time_t</span> timestamp)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">time_t</span> utc_timestamp = timestamp + <span class="number">8</span> * <span class="number">3600</span>;    <span class="comment">// æœ¬åœ°æ—¶é—´æ¯”UTCæ—¶é—´å¿«8å°æ—¶ï¼ŒUTCæ—¶é—´è¦åŠ ä¸Š8å°æ—¶</span></span><br><span class="line">    rtc_utc_timestamp_set(utc_timestamp);</span><br><span class="line">&#125;</span><br><span class="line">SHELL_EXPORT_CMD(SHELL_CMD_PERMISSION(<span class="number">0</span>)|SHELL_CMD_TYPE(SHELL_TYPE_CMD_FUNC)|SHELL_CMD_DISABLE_RETURN, local_timestamp_set, rtc_local_timestamp_set, rtc_local_timestamp_set);</span><br></pre></td></tr></table></figure></li>
</ul>
<br>

<ul>
<li>æŸ¥é˜…<code>letter shell</code>ç›¸å…³èµ„æ–™å‘ç°ï¼Œå‚æ•°åªæ”¯æŒ<code>char(å­—ç¬¦)</code>ï¼Œ<code>char(æ•°å­—)</code>ï¼Œ<code>short(æ•°å­—)</code>ï¼Œ<code>int(æ•°å­—)</code>ï¼Œ<code>char *(å­—ç¬¦ä¸²)</code>ï¼Œ<code>pointer</code>è¿™å‡ ä¸ªæ•°æ®ç±»å‹ï¼Œå¹¶ä¸æ”¯æŒ<code>time_t</code>ï¼Œæ‰€ä»¥æ•²<code>shell</code>æŒ‡ä»¤å…¥å‚çš„æ—¶å€™ï¼Œä¼šæŠŠæ•°æ®å¼ºåˆ¶è½¬ä¸º<code>int</code>ç±»å‹ï¼Œè€Œåœ¨ä½¿ç”¨<code>gmtime(&amp;timestamp)</code>è½¬æ¢çš„æ—¶å€™ï¼Œ<code>timestamp</code>æ˜¯éœ€è¦ä¸º<code>time_t</code>ç±»å‹çš„ï¼Œæ‰€ä»¥åšå‡ºå¦‚ä¸‹ä¿®æ”¹ï¼š<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å°†UTCçš„Unixæ—¶é—´æˆ³è½¬æ¢ä¸ºRTCæ—¶é—´å’Œæ—¥æœŸ</span></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">rtc_utc_timestamp_set</span><span class="params">(<span class="type">int</span> timestamp)</span>       <span class="comment">// æ”¹ä¸ºintç±»å‹</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">time_t</span> utc_timestamp = (<span class="type">time_t</span>)timestamp;          <span class="comment">// å¼ºåˆ¶è½¬æ¢ä¸ºtime_tç±»å‹</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">tm</span> *<span class="title">tm</span> =</span> gmtime(&amp;utc_timestamp);</span><br><span class="line">    RTC_DateType RTC_Date;</span><br><span class="line">    RTC_TimeType RTC_Time;</span><br><span class="line"></span><br><span class="line">    RTC_Date.Year = tm-&gt;tm_year - <span class="number">100</span>;    <span class="comment">// å¹´ä»½ä»1900å¼€å§‹è®¡ç®—</span></span><br><span class="line">    RTC_Date.Month = tm-&gt;tm_mon + <span class="number">1</span>;      <span class="comment">// æœˆä»½ä»0å¼€å§‹è®¡ç®—</span></span><br><span class="line">    RTC_Date.Date = tm-&gt;tm_mday;</span><br><span class="line">    RTC_Date.WeekDay = (tm-&gt;tm_wday == <span class="number">0</span>) ? <span class="number">7</span> : tm-&gt;tm_wday;   <span class="comment">// æ˜ŸæœŸå‡ ï¼Œtmç»“æ„ä½“æ˜¯0-6ï¼Œ0æ˜¯æ˜ŸæœŸå¤©; stm32çš„RTCè¿”å›çš„æ˜¯1-7</span></span><br><span class="line">    RTC_Time.Hours = tm-&gt;tm_hour;</span><br><span class="line">    RTC_Time.Minutes = tm-&gt;tm_min;</span><br><span class="line">    RTC_Time.Seconds = tm-&gt;tm_sec;</span><br><span class="line">    RTC_Time.H12 = RTC_AM_H12;</span><br><span class="line"></span><br><span class="line">    rtc_date_params_set(&amp;RTC_Date);</span><br><span class="line">    rtc_time_params_set(&amp;RTC_Time);</span><br><span class="line">&#125;</span><br><span class="line">SHELL_EXPORT_CMD(SHELL_CMD_PERMISSION(<span class="number">0</span>)|SHELL_CMD_TYPE(SHELL_TYPE_CMD_FUNC)|SHELL_CMD_DISABLE_RETURN, utc_timestamp_set, rtc_utc_timestamp_set, rtc_utc_timestamp_set);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// å°†UTCçš„Unixæ—¶é—´æˆ³è½¬æ¢ä¸ºæœ¬åœ°RTCæ—¶é—´å’Œæ—¥æœŸ</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">rtc_local_timestamp_set</span><span class="params">(<span class="type">time_t</span> timestamp)</span>      <span class="comment">// æ— éœ€æ”¹ä¸ºintç±»å‹èƒ½é€šè¿‡?</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">time_t</span> utc_timestamp = timestamp + <span class="number">8</span> * <span class="number">3600</span>;    <span class="comment">// æœ¬åœ°æ—¶é—´æ¯”UTCæ—¶é—´å¿«8å°æ—¶ï¼ŒUTCæ—¶é—´è¦åŠ ä¸Š8å°æ—¶</span></span><br><span class="line">    rtc_utc_timestamp_set(utc_timestamp);           <span class="comment">// è°ƒç”¨UTCæ—¶é—´æˆ³è½¬æ¢ä¸ºRTCæ—¶é—´å’Œæ—¥æœŸçš„å‡½æ•°</span></span><br><span class="line">&#125;</span><br><span class="line">SHELL_EXPORT_CMD(SHELL_CMD_PERMISSION(<span class="number">0</span>)|SHELL_CMD_TYPE(SHELL_TYPE_CMD_FUNC)|SHELL_CMD_DISABLE_RETURN, local_timestamp_set, rtc_local_timestamp_set, rtc_local_timestamp_set);</span><br></pre></td></tr></table></figure></li>
</ul>
<br>

<h2 id="ä¸²å£ç›¸å…³é—®é¢˜"><a href="#ä¸²å£ç›¸å…³é—®é¢˜" class="headerlink" title="ä¸²å£ç›¸å…³é—®é¢˜"></a>ä¸²å£ç›¸å…³é—®é¢˜</h2><h3 id="ä¸å¸¦æ•°æ®çº¿USBçš„D-å’ŒD-çŸ­æ¥"><a href="#ä¸å¸¦æ•°æ®çº¿USBçš„D-å’ŒD-çŸ­æ¥" class="headerlink" title="ä¸å¸¦æ•°æ®çº¿USBçš„D+å’ŒD-çŸ­æ¥"></a>ä¸å¸¦æ•°æ®çº¿USBçš„D+å’ŒD-çŸ­æ¥</h3><ul>
<li>æ·»åŠ <code>shell.c</code>æ–‡ä»¶ä¸­çš„åˆ¤æ–­ï¼Œå¯èƒ½ä¼šå‡ºç°æ¢å¤å<code>shell</code>äº¤äº’é”®å…¥æ•°æ®å»¶åï¼š<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> SHELL_SHUTDOWN_CNTS		50</span></span><br><span class="line"><span class="type">static</span> <span class="type">unsigned</span> <span class="type">char</span> shell_shutdown = <span class="number">0</span>;			<span class="comment">//TX RXçŸ­æ¥å¤„ç†</span></span><br><span class="line"><span class="type">static</span> <span class="type">int</span> shell_shutdown_cnts = <span class="number">0</span>;					<span class="comment">//TX RXçŸ­æ¥å¤„ç†cntsæ¬¡æ•°</span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">shellExec</span><span class="params">(Shell *shell)</span></span><br><span class="line">&#123;</span><br><span class="line">......</span><br><span class="line">    <span class="keyword">if</span> (shell-&gt;status.isChecked)</span><br><span class="line">    &#123;</span><br><span class="line">        ......</span><br><span class="line">        <span class="keyword">if</span> (command != <span class="literal">NULL</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            shellRunCommand(shell, command);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            shell_shutdown_cnts ++;											<span class="comment">//shell_shutdown bug è§£å†³</span></span><br><span class="line">            <span class="keyword">if</span>(shell_shutdown_cnts &gt; SHELL_SHUTDOWN_CNTS)</span><br><span class="line">                shell_shutdown = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">            shellWriteString(shell, shellText[SHELL_TEXT_CMD_NOT_FOUND]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        shellCheckPassword(shell);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">shellInsertByte</span><span class="params">(Shell *shell, <span class="type">char</span> data)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">/* åˆ¤æ–­è¾“å…¥æ•°æ®æ˜¯å¦è¿‡é•¿ */</span></span><br><span class="line">    <span class="keyword">if</span> (shell-&gt;parser.length &gt;= shell-&gt;parser.bufferSize - <span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">		shell_shutdown_cnts ++;											    <span class="comment">//è¶…é•¿æ¬¡æ•°è¿‡å¤šè§¦å‘shellä¸æ¥å—æ ‡å¿—</span></span><br><span class="line">		<span class="keyword">if</span>(shell_shutdown_cnts &gt; SHELL_SHUTDOWN_CNTS)</span><br><span class="line">			shell_shutdown = <span class="number">1</span>;</span><br><span class="line">		</span><br><span class="line">        shellWriteString(shell, shellText[SHELL_TEXT_CMD_TOO_LONG]);</span><br><span class="line">        shellWritePrompt(shell, <span class="number">1</span>);</span><br><span class="line">        shellWriteString(shell, shell-&gt;parser.buffer);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">......</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">shellWriteCommandHelp</span><span class="params">(Shell *shell, <span class="type">char</span> *cmd)</span></span><br><span class="line">&#123;</span><br><span class="line">    ShellCommand *command = shellSeekCommand(shell,</span><br><span class="line">                                             cmd,</span><br><span class="line">                                             shell-&gt;commandList.base,</span><br><span class="line">                                             <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">if</span> (command)</span><br><span class="line">    &#123;</span><br><span class="line">        shellWriteString(shell, shellText[SHELL_TEXT_HELP_HEADER]);</span><br><span class="line">        shellWriteString(shell, shellGetCommandName(command));</span><br><span class="line">        shellWriteString(shell, <span class="string">&quot;\r\n&quot;</span>);</span><br><span class="line">        shellWriteString(shell, shellGetCommandDesc(command));</span><br><span class="line">        shellWriteString(shell, <span class="string">&quot;\r\n&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">		shell_shutdown_cnts ++;											<span class="comment">//shell_shutdown bug è§£å†³</span></span><br><span class="line">		<span class="keyword">if</span>(shell_shutdown_cnts &gt; SHELL_SHUTDOWN_CNTS)</span><br><span class="line">			shell_shutdown = <span class="number">1</span>;</span><br><span class="line">		</span><br><span class="line">        shellWriteString(shell, shellText[SHELL_TEXT_CMD_NOT_FOUND]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @brief shell ä»»åŠ¡</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * @param param å‚æ•°(shellå¯¹è±¡)</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">shellTask</span><span class="params">(<span class="type">void</span> *param)</span></span><br><span class="line">&#123;</span><br><span class="line">    Shell *shell = (Shell *)param;</span><br><span class="line">    <span class="type">char</span> data;</span><br><span class="line"><span class="meta">#<span class="keyword">if</span> SHELL_TASK_WHILE == 1</span></span><br><span class="line">    <span class="keyword">while</span>(<span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">		<span class="keyword">if</span>(shell_shutdown)									<span class="comment">//shell_shutdown true é€€å‡º, å¯å¤–éƒ¨è°ƒç”¨shell_shutdownç½®ä¸ºfalseé‡æ–°å¯ç”¨</span></span><br><span class="line">			<span class="keyword">return</span>;</span><br><span class="line">	</span><br><span class="line">        <span class="keyword">if</span> (shell-&gt;read &amp;&amp; shell-&gt;read(&amp;data, <span class="number">1</span>) == <span class="number">1</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            shellHandler(shell, data);</span><br><span class="line">        &#125;</span><br><span class="line"><span class="meta">#<span class="keyword">if</span> SHELL_TASK_WHILE == 1</span></span><br><span class="line">    &#125;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ul>
<br>

<h3 id="ä¸²å£å›ç¯åshelläº¤äº’é”®å…¥æ•°æ®å»¶åè§£å†³"><a href="#ä¸²å£å›ç¯åshelläº¤äº’é”®å…¥æ•°æ®å»¶åè§£å†³" class="headerlink" title="ä¸²å£å›ç¯åshelläº¤äº’é”®å…¥æ•°æ®å»¶åè§£å†³"></a>ä¸²å£å›ç¯åshelläº¤äº’é”®å…¥æ•°æ®å»¶åè§£å†³</h3><ul>
<li><p>ä½¿ç”¨<code>letter shell</code>çš„è§£å†³æ–¹æ³•ï¼š(<strong>ä¾ç„¶ä¼šå¤ç°, å·²å®šä½æ˜¯ç¯å½¢ç¼“å†²åŒºçš„é—®é¢˜</strong>)</p>
</li>
<li><p>ä¿®æ”¹<code>shell.c</code>æ–‡ä»¶ä¸­çš„éƒ¨åˆ†å‡½æ•°ï¼Œæ¸…ç©ºç¼“å­˜åŒºé•¿åº¦ï¼š(æœªè§£å†³)</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">// shell.c æ–‡ä»¶ </span></span><br><span class="line"><span class="type">void</span> <span class="title function_">shellInsertByte</span><span class="params">(Shell *shell, <span class="type">char</span> data)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">/* åˆ¤æ–­è¾“å…¥æ•°æ®æ˜¯å¦è¿‡é•¿ */</span></span><br><span class="line">    <span class="keyword">if</span> (shell-&gt;parser.length &gt;= shell-&gt;parser.bufferSize - <span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        shellWriteString(shell, shellText[SHELL_TEXT_CMD_TOO_LONG]);    <span class="comment">//å¯ä»¥æ³¨é‡Šæ‰ï¼Œä¹Ÿä»¥å…ä¸€ç›´æ‰“å°ï¼Ÿ</span></span><br><span class="line">        shellWritePrompt(shell, <span class="number">1</span>);</span><br><span class="line">        shell-&gt;parser.buffer[shell-&gt;parser.length] = <span class="number">0</span>;                 <span class="comment">// + å¢åŠ æ¸…ç©ºç¼“å­˜åŒºé•¿åº¦</span></span><br><span class="line">        <span class="comment">// shellWriteString(shell, shell-&gt;parser.buffer);               //ä¸æ‰“å°æ˜¾ç¤ºè¶…é•¿æ•°æ®</span></span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">shellWriteCommandHelp</span><span class="params">(Shell *shell, <span class="type">char</span> *cmd)</span></span><br><span class="line">&#123;</span><br><span class="line">    ShellCommand *command = shellSeekCommand(shell,</span><br><span class="line">                                             cmd,</span><br><span class="line">                                             shell-&gt;commandList.base,</span><br><span class="line">                                             <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">if</span> (command)</span><br><span class="line">    &#123;</span><br><span class="line">        shellWriteString(shell, shellText[SHELL_TEXT_HELP_HEADER]);</span><br><span class="line">        shellWriteString(shell, shellGetCommandName(command));</span><br><span class="line">        shellWriteString(shell, <span class="string">&quot;\r\n&quot;</span>);</span><br><span class="line">        shellWriteString(shell, shellGetCommandDesc(command));</span><br><span class="line">        shellWriteString(shell, <span class="string">&quot;\r\n&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        shellWriteString(shell, shellText[SHELL_TEXT_CMD_NOT_FOUND]);</span><br><span class="line">        shell-&gt;parser.buffer[shell-&gt;parser.length] = <span class="number">0</span>;                 <span class="comment">// + ç¼“å­˜å­—ç¬¦ä¸²æ¸…é›¶</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<br>

<h3 id="letter-shellåˆå§‹åŒ–ä¼˜åŒ–"><a href="#letter-shellåˆå§‹åŒ–ä¼˜åŒ–" class="headerlink" title="letter shellåˆå§‹åŒ–ä¼˜åŒ–"></a>letter shellåˆå§‹åŒ–ä¼˜åŒ–</h3><ul>
<li><code>letter shell</code>æ–°å¢åˆå§‹åŒ–è®¾ç½®æ‰“å°ç­‰çº§å‚æ•°</li>
</ul>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">User_Shell_Init</span><span class="params">(<span class="type">uint8_t</span> level)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">serial_configure</span> <span class="title">config</span> =</span> EC_SERIAL_CONFIG_DEFAULT;</span><br><span class="line">    config.baud_rate = BAUD_RATE_921600;</span><br><span class="line">    drv_usart_init(ESERIAL_1, ESERIAL_MODE_DMA_RX | ESERIAL_MODE_DMA_TX, &amp;config);</span><br><span class="line"></span><br><span class="line">    shell.write = User_Shell_Write;</span><br><span class="line">	shell.read = User_Shell_Read;</span><br><span class="line">    shellInit(&amp;shell, shell_buffer, <span class="keyword">sizeof</span>(shell_buffer));</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span>(level &gt; LOG_ALL)</span><br><span class="line">    &#123;</span><br><span class="line">        uartLog.level = LOG_ALL;</span><br><span class="line">    &#125;</span><br><span class="line">	logRegister(&amp;uartLog, &amp;shell);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br>

<h3 id="ä¸²å£å‡çº§åæ¸…å±æŒ‡ä»¤é—®é¢˜"><a href="#ä¸²å£å‡çº§åæ¸…å±æŒ‡ä»¤é—®é¢˜" class="headerlink" title="ä¸²å£å‡çº§åæ¸…å±æŒ‡ä»¤é—®é¢˜"></a>ä¸²å£å‡çº§åæ¸…å±æŒ‡ä»¤é—®é¢˜</h3><ul>
<li>ä¸²å£å‡çº§åæ¸…å±æŒ‡ä»¤æ‰“ä¸å…¨å¯¼è‡´å­—ç¬¦é‡å ï¼Œ<code>letter shell</code>ä¼˜åŒ–ä»£ç å¦‚ä¸‹ï¼š<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="type">static</span> <span class="type">const</span> <span class="type">char</span> *shellText[] =</span><br><span class="line">&#123;</span><br><span class="line">    ...</span><br><span class="line">    [SHELL_TEXT_CLEAR_CONSOLE] = </span><br><span class="line">        <span class="string">&quot;\033[2J\033[1H&quot;</span>,</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">æ”¹ä¸ºï¼š</span><br><span class="line"><span class="type">static</span> <span class="type">const</span> <span class="type">char</span> *shellText[] =</span><br><span class="line">&#123;</span><br><span class="line">    ...</span><br><span class="line">    [SHELL_TEXT_CLEAR_CONSOLE] = </span><br><span class="line">        <span class="string">&quot;\r\n\033[2J\033[1H&quot;</span>,                   <span class="comment">// æ·»åŠ \r\nå­—ç¬¦ä¿è¯ç»ˆç«¯ä¸ä¼šç²˜è¿è¯†åˆ«</span></span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<br>

<h2 id="secure-CRTé—®é¢˜"><a href="#secure-CRTé—®é¢˜" class="headerlink" title="secure CRTé—®é¢˜"></a>secure CRTé—®é¢˜</h2><ul>
<li>åœ¨çº¿å‡çº§åæ‰“å°å‡ºä¸å®Œæ•´æ¸…å±æŒ‡ä»¤ï¼Œæ˜¾ç¤ºæ®‹ç•™<code>2J</code>ï¼Œä¸ä¼šæ¸…å±ã€‚</li>
<li>æµ‹è¯•ä¸¤å—æ¿ï¼Œä¸€å—æœ‰è¿™ä¸ªé—®é¢˜ï¼Œå¦ä¸€å—æ²¡æœ‰é—®é¢˜</li>
</ul>
<br>

<h2 id="n32l406çš„ADCè·‘é£"><a href="#n32l406çš„ADCè·‘é£" class="headerlink" title="n32l406çš„ADCè·‘é£"></a>n32l406çš„ADCè·‘é£</h2><ul>
<li>é—®é¢˜ï¼š<code>n32l406</code>çš„<code>ADC</code>è·‘é£ï¼Œä»£ç å¤ç”¨ä»¥å‰å¯ä»¥è·‘çš„ã€‚</li>
<li>è§£å†³ï¼šä½çº§é”™è¯¯ï¼Œ<code>ADC</code>çš„<code>IO</code>å£åˆå§‹åŒ–<code>PORT</code>å’Œ<code>PIN</code>å†™åï¼Œ<code>CmBacktrace</code>æ’æŸ¥å‡ºé—®é¢˜ã€‚</li>
</ul>
<br>

<h2 id="n32l406çš„ä¸å®šæ—¶è·‘é£"><a href="#n32l406çš„ä¸å®šæ—¶è·‘é£" class="headerlink" title="n32l406çš„ä¸å®šæ—¶è·‘é£"></a>n32l406çš„ä¸å®šæ—¶è·‘é£</h2><ul>
<li>ä»¥ä¸‹æ˜¯è·‘é£å<code>cmbacktrace</code>è¿½è¸ªçš„<code>pc</code>æŒ‡é’ˆåŠè¿½è¸ªå‡½æ•°ã€‚</li>
<li>å¯èƒ½æ˜¯ä¸²å£<code>RX</code>å¹²æ‰°é—®é¢˜ï¼š(é—®é¢˜å®šä½è½¯ä»¶é—®é¢˜æˆ–è€…ç¡¬ä»¶é—®é¢˜)ã€‚<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">xuan@DESKTOP-A52B6V9:~/work/n5/code/app$ addr2line -e app.elf -a -f <span class="number">080160</span>c2 <span class="number">08013f</span>cc <span class="number">080140f</span>c <span class="number">080141</span>d2 <span class="number">08014252</span> <span class="number">0800</span>a4b6 <span class="number">08009092</span> <span class="number">0x080160c2</span> fault_test_by_div0 /home/xuan/work/n5/code/app/components/cm_backtrace/fault_test.c:<span class="number">38</span> <span class="number">0x08013fcc</span> shellRunCommand /home/xuan/work/n5/code/app/components/letter_shell/shell.c:<span class="number">1264</span> <span class="number">0x080140fc</span> shellEnter /home/xuan/work/n5/code/app/components/letter_shell/shell.c:<span class="number">1704</span> <span class="number">0x080141d2</span> shellHandler /home/xuan/work/n5/code/app/components/letter_shell/shell.c:<span class="number">1831</span> <span class="number">0x08014252</span> shellTask /home/xuan/work/n5/code/app/components/letter_shell/shell.c:<span class="number">1905</span> <span class="number">0x0800a4b6</span> main /home/xuan/work/n5/code/app/application/main.c:<span class="number">37</span> <span class="number">0x08009092</span> LoopFillZerobss /home/xuan/work/n5/code/app/CMSIS/device/startup/startup_n32l40x_gcc.s:<span class="number">113</span></span><br></pre></td></tr></table></figure></li>
</ul>
<br>

<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">xuan@DESKTOP-A52B6V9:~/work/n5/code/app$ addr2line -e app.elf -a -f <span class="number">6f</span>6d656c <span class="number">080131</span>aa <span class="number">08010</span>a62 <span class="number">080131</span>aa <span class="number">080140</span>c0 <span class="number">080141f</span>0 <span class="number">080142</span>c6 <span class="number">0801434</span>c <span class="number">0800</span>a4b6 <span class="number">08009092</span></span><br><span class="line"><span class="number">0x6f6d656c</span></span><br><span class="line">??</span><br><span class="line">??:<span class="number">0</span></span><br><span class="line"><span class="number">0x080131aa</span></span><br><span class="line">logHexDump</span><br><span class="line">/home/xuan/work/n5/code/app/components/letter_shell/<span class="built_in">log</span>.c:<span class="number">243</span></span><br><span class="line"><span class="number">0x08010a62</span></span><br><span class="line">board_battery_ntc_get_temp_thres_down_work</span><br><span class="line">/home/xuan/work/n5/code/app/user/user_board.c:<span class="number">678</span></span><br><span class="line"><span class="number">0x080131aa</span></span><br><span class="line">logHexDump</span><br><span class="line">/home/xuan/work/n5/code/app/components/letter_shell/<span class="built_in">log</span>.c:<span class="number">243</span></span><br><span class="line"><span class="number">0x080140c0</span></span><br><span class="line">shellRunCommand</span><br><span class="line">/home/xuan/work/n5/code/app/components/letter_shell/shell.c:<span class="number">1264</span></span><br><span class="line"><span class="number">0x080141f0</span></span><br><span class="line">shellEnter</span><br><span class="line">/home/xuan/work/n5/code/app/components/letter_shell/shell.c:<span class="number">1704</span></span><br><span class="line"><span class="number">0x080142c6</span></span><br><span class="line">shellHandler</span><br><span class="line">/home/xuan/work/n5/code/app/components/letter_shell/shell.c:<span class="number">1831</span></span><br><span class="line"><span class="number">0x0801434c</span></span><br><span class="line">shellTask</span><br><span class="line">/home/xuan/work/n5/code/app/components/letter_shell/shell.c:<span class="number">1905</span></span><br><span class="line"><span class="number">0x0800a4b6</span></span><br><span class="line">main</span><br><span class="line">/home/xuan/work/n5/code/app/application/main.c:<span class="number">37</span></span><br><span class="line"><span class="number">0x08009092</span></span><br><span class="line">LoopFillZerobss</span><br><span class="line">/home/xuan/work/n5/code/app/CMSIS/device/startup/startup_n32l40x_gcc.s:<span class="number">113</span></span><br></pre></td></tr></table></figure>

<ul>
<li>ä¿®æ”¹æ–¹æ³•ä¸€ï¼šè½¯ä»¶ä¿®æ”¹<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">ec32_msp_usart_init</span><span class="params">(<span class="type">void</span> *Instance)</span></span><br><span class="line">&#123;</span><br><span class="line">    GPIO_InitType GPIO_InitStructure;</span><br><span class="line">    USART_Module *USARTx = (USART_Module *)Instance;</span><br><span class="line"></span><br><span class="line">    GPIO_InitStruct(&amp;GPIO_InitStructure);</span><br><span class="line">	EC_APBxClkCmd_AFIO(EC_PERIPHClk_AFIO,ENABLE);                  <span class="comment">//æ—¶é’Ÿå¤ç”¨</span></span><br><span class="line">	</span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> BSP_USING_UART1</span></span><br><span class="line">    <span class="keyword">if</span>(USART1 == USARTx)</span><br><span class="line">    &#123;</span><br><span class="line">        RCC_EnableAPB2PeriphClk(RCC_APB2_PERIPH_USART1,ENABLE);</span><br><span class="line">        RCC_EnableAPB2PeriphClk(EC_USART1_RCC_GPIOx,ENABLE);</span><br><span class="line"></span><br><span class="line">        GPIO_InitStructure.GPIO_Mode = GPIO_Mode_AF_PP;</span><br><span class="line">        GPIO_InitStructure.GPIO_Alternate =  EC_USART1_Tx_GPIO_AF;</span><br><span class="line">        GPIO_InitStructure.Pin = EC_USART1_TxPin;</span><br><span class="line">        GPIO_InitPeripheral(EC_USART1_GPIO, &amp;GPIO_InitStructure);</span><br><span class="line"></span><br><span class="line">        GPIO_InitStructure.GPIO_Alternate =  EC_USART1_Rx_GPIO_AF;</span><br><span class="line">        GPIO_InitStructure.Pin = EC_USART1_RxPin;</span><br><span class="line">        GPIO_InitStructure.GPIO_Pull = GPIO_Pull_Up;                       <span class="comment">// æ·»åŠ RXä¸Šæ‹‰</span></span><br><span class="line">        GPIO_InitPeripheral(EC_USART1_GPIO, &amp;GPIO_InitStructure);</span><br><span class="line">    &#125;</span><br><span class="line">...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<br>

<h2 id="N32L40Xçš„DMAå¤ç”¨é—®é¢˜"><a href="#N32L40Xçš„DMAå¤ç”¨é—®é¢˜" class="headerlink" title="N32L40Xçš„DMAå¤ç”¨é—®é¢˜"></a>N32L40Xçš„DMAå¤ç”¨é—®é¢˜</h2><ul>
<li>è¿™ä¸ªç³»åˆ—èŠ¯ç‰‡çš„<code>8</code>ä¸ª<code>DMA</code>é€šé“æºï¼Œå¯ä»¥ç»™ä»»æ„èƒ½ä½¿ç”¨çš„å¤–è®¾æ˜ å°„ã€‚</li>
<li>éœ€æ±‚å˜æ›´ï¼Œæ–°å¢ADCæ£€æµ‹ï¼Œåœ¨èµ‹äºˆDMAé€šé“æ—¶æ²¡æœ‰è‡ªæ£€ã€‚</li>
</ul>
<p><code>Scalp 5</code>å…‰èƒ½æ¨¡ç»„ç¤ºä¾‹ï¼š</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">// USART å®šä¹‰</span></span><br><span class="line"><span class="meta">#<span class="keyword">if</span> defined(BSP_USING_UART2)</span></span><br><span class="line">	&#123;	</span><br><span class="line">		USART2,</span><br><span class="line">		USART2_IRQn,</span><br><span class="line">		&#123;</span><br><span class="line">			DMA_CH2,</span><br><span class="line">			DMA,</span><br><span class="line">			DMA_FLAG_GL2,</span><br><span class="line">			DMA_Channel2_IRQn,</span><br><span class="line">			<span class="number">0</span>,</span><br><span class="line">			<span class="number">0</span>,</span><br><span class="line">            DMA_CH6,</span><br><span class="line">			DMA,</span><br><span class="line">			DMA_FLAG_TC6,</span><br><span class="line">			DMA_Channel6_IRQn,</span><br><span class="line">			<span class="number">0</span>,</span><br><span class="line">			<span class="number">0</span>,</span><br><span class="line">		&#125;,</span><br><span class="line">		&amp;default_cfg2,</span><br><span class="line">		&amp;uart2_rxbuff,</span><br><span class="line">		&amp;uart2_txbuff,</span><br><span class="line">		<span class="literal">NULL</span>,</span><br><span class="line">	&#125;,</span><br><span class="line">	<span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="comment">// ADCéƒ¨åˆ†å®šä¹‰</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ADC_DMAy			DMA</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span>	DMAy_FLAG_TCz		DMA_FLAG_TC6</span></span><br><span class="line"></span><br><span class="line">drv_adc_init(adc_dev, EDMA_CH6);</span><br></pre></td></tr></table></figure>
<ul>
<li><p><code>USART2</code>å’Œ<code>ADC</code>éƒ½ä½¿ç”¨äº†<code>DMA_CH6</code>è¿™ä¸ªé€šé“ï¼Œç°è±¡æ˜¯å…ˆåˆå§‹åŒ–çš„<code>USART2</code>å‘é€ä¼šå¼‚å¸¸ã€‚</p>
</li>
<li><p>è§£å†³æ–¹æ¡ˆ</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ADCéƒ¨åˆ†å®šä¹‰æ”¹ä¸ºé€šé“4</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ADC_DMAy			DMA</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span>	DMAy_FLAG_TCz		DMA_FLAG_TC4</span></span><br><span class="line"></span><br><span class="line">drv_adc_init(adc_dev, EDMA_CH4);</span><br><span class="line">...</span><br></pre></td></tr></table></figure></li>
<li><p>æ€»ç»“ï¼šå¤ç”¨æ—¶éœ€è¦æ³¨æ„ä¸è¦è¢«é‡å¤æ˜ å°„ã€‚æ’æŸ¥æ–¹æ³•ï¼šåˆ†æç°è±¡-&gt;åº”ç”¨å±‚-&gt;é©±åŠ¨å±‚ã€‚</p>
</li>
</ul>
<h2 id="æ›¿ä»£æ¥è¿‘ä¼ æ„Ÿå™¨é—®é¢˜"><a href="#æ›¿ä»£æ¥è¿‘ä¼ æ„Ÿå™¨é—®é¢˜" class="headerlink" title="æ›¿ä»£æ¥è¿‘ä¼ æ„Ÿå™¨é—®é¢˜"></a>æ›¿ä»£æ¥è¿‘ä¼ æ„Ÿå™¨é—®é¢˜</h2><ul>
<li>è¿‘æœŸæ›´æ¢æ¥è¿‘ä¼ æ„Ÿå™¨<code>MT3101</code>å’Œ<code>LS9806</code>,å‘ç°åº”ç”¨åœ¨<code>Scalp 5</code>å…‰èƒ½æ¨¡ç»„ä¸Šä¼šå‡ºç°é—ªç¯ç°è±¡ã€‚</li>
<li>æ’æŸ¥æ­¥éª¤ï¼š<ul>
<li>ä¸ä½¿ç”¨<code>SPIçº§è”ç¯</code>ï¼Œè¿ç»­è¯»å–ä¼ æ„Ÿå™¨æ•°å€¼ï¼Œæ— æ˜æ˜¾è·³å˜ï¼›</li>
<li>ä½¿ç”¨<code>SPIçº§è”ç¯</code>ï¼Œè¿ç»­è¯»å–ä¼ æ„Ÿå™¨æ•°å€¼ï¼Œå‡ºç°æ˜æ˜¾è·³å˜ï¼›</li>
</ul>
</li>
</ul>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">vcnl read sum = [<span class="number">1815</span>],H=[<span class="number">0x07</span>],L=[<span class="number">0x17</span>]</span><br><span class="line">vcnl read sum = [<span class="number">1815</span>],H=[<span class="number">0x07</span>],L=[<span class="number">0x17</span>]</span><br><span class="line">vcnl read sum = [<span class="number">1815</span>],H=[<span class="number">0x07</span>],L=[<span class="number">0x17</span>]</span><br><span class="line">vcnl read sum = [<span class="number">0</span>],H=[<span class="number">0x00</span>],L=[<span class="number">0x00</span>]</span><br><span class="line">vcnl read sum = [<span class="number">0</span>],H=[<span class="number">0x00</span>],L=[<span class="number">0x00</span>]</span><br><span class="line">vcnl read sum = [<span class="number">0</span>],H=[<span class="number">0x00</span>],L=[<span class="number">0x00</span>]</span><br><span class="line">vcnl read sum = [<span class="number">0</span>],H=[<span class="number">0x00</span>],L=[<span class="number">0x00</span>]</span><br><span class="line">vcnl read sum = [<span class="number">935</span>],H=[<span class="number">0x03</span>],L=[<span class="number">0xA7</span>]</span><br><span class="line">vcnl read sum = [<span class="number">935</span>],H=[<span class="number">0x03</span>],L=[<span class="number">0xA7</span>]</span><br><span class="line">vcnl read sum = [<span class="number">935</span>],H=[<span class="number">0x03</span>],L=[<span class="number">0xA7</span>]</span><br><span class="line">vcnl read sum = [<span class="number">935</span>],H=[<span class="number">0x03</span>],L=[<span class="number">0xA7</span>]</span><br><span class="line">vcnl read sum = [<span class="number">786</span>],H=[<span class="number">0x03</span>],L=[<span class="number">0x12</span>]</span><br><span class="line">vcnl read sum = [<span class="number">786</span>],H=[<span class="number">0x03</span>],L=[<span class="number">0x12</span>]</span><br><span class="line">vcnl read sum = [<span class="number">786</span>],H=[<span class="number">0x03</span>],L=[<span class="number">0x12</span>]</span><br><span class="line">vcnl read sum = [<span class="number">786</span>],H=[<span class="number">0x03</span>],L=[<span class="number">0x12</span>]</span><br><span class="line">vcnl read sum = [<span class="number">0</span>],H=[<span class="number">0x00</span>],L=[<span class="number">0x00</span>]</span><br><span class="line">vcnl read sum = [<span class="number">0</span>],H=[<span class="number">0x00</span>],L=[<span class="number">0x00</span>]</span><br><span class="line">vcnl read sum = [<span class="number">0</span>],H=[<span class="number">0x00</span>],L=[<span class="number">0x00</span>]</span><br><span class="line">vcnl read sum = [<span class="number">0</span>],H=[<span class="number">0x00</span>],L=[<span class="number">0x00</span>]</span><br><span class="line">vcnl read sum = [<span class="number">0</span>],H=[<span class="number">0x00</span>],L=[<span class="number">0x00</span>]</span><br><span class="line">vcnl read sum = [<span class="number">950</span>],H=[<span class="number">0x03</span>],L=[<span class="number">0xB6</span>]</span><br><span class="line">vcnl read sum = [<span class="number">950</span>],H=[<span class="number">0x03</span>],L=[<span class="number">0xB6</span>]</span><br><span class="line">vcnl read sum = [<span class="number">950</span>],H=[<span class="number">0x03</span>],L=[<span class="number">0xB6</span>]</span><br><span class="line">vcnl read sum = [<span class="number">950</span>],H=[<span class="number">0x03</span>],L=[<span class="number">0xB6</span>]</span><br><span class="line">vcnl read sum = [<span class="number">617</span>],H=[<span class="number">0x02</span>],L=[<span class="number">0x69</span>]</span><br><span class="line">vcnl read sum = [<span class="number">617</span>],H=[<span class="number">0x02</span>],L=[<span class="number">0x69</span>]</span><br></pre></td></tr></table></figure>
<ul>
<li>æ•°æ®è¯´æ˜ä¸çº§è”ç¯æœ‰å…³ã€‚</li>
<li>è¿›ä¸€æ­¥æ’æŸ¥æ˜¯å¦ä¸<code>I2C</code>é€šä¿¡æœ‰å…³ã€‚</li>
<li>ç»æµ‹è¯•å‘ç°<code>MT3101</code>åœ¨æœ‰å…¶ä»–å…‰æºå¹²æ‰°çš„æƒ…å†µä¸‹ï¼Œå¶å°”ä¼šè¿”å›<code>0</code>ï¼Œå¯¼è‡´è§¦è‚¤å¯åœåŠŸèƒ½å¼‚å¸¸ï¼Œåç»­å’¨è¯¢ä¾›åº”å•†èƒ½å¦é€šè¿‡é…ç½®è§£å†³ã€‚</li>
<li><code>MT3101</code>å¶ç°è¿”å›æ•°æ®ä¸æ”¹å˜çš„é—®é¢˜ï¼Œä¾›åº”å•†è§£å†³ã€‚</li>
</ul>
<h2 id="æ™®å†‰é—®é¢˜æ±‡æ€»"><a href="#æ™®å†‰é—®é¢˜æ±‡æ€»" class="headerlink" title="æ™®å†‰é—®é¢˜æ±‡æ€»"></a>æ™®å†‰é—®é¢˜æ±‡æ€»</h2><h3 id="USARTè°ƒè¯•é—®é¢˜"><a href="#USARTè°ƒè¯•é—®é¢˜" class="headerlink" title="USARTè°ƒè¯•é—®é¢˜"></a>USARTè°ƒè¯•é—®é¢˜</h3><ul>
<li><code>WSL</code>é…ç½®æ™®é€šæ¨¡å¼æ­£å¸¸ï¼Œä¸­æ–­å°±è·‘é£ï¼ŒåŠ æ‰“å°ï¼š<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;VTOR=0x%08lx, USART2_IRQn=%d\r\n&quot;</span>, SCB-&gt;VTOR, USART2_IRQn);</span><br><span class="line"></span><br><span class="line">admin: VTOR=<span class="number">0x08002800</span>, USART2_IRQn=<span class="number">28</span></span><br></pre></td></tr></table></figure>
ä½†æ˜¯ç¨‹åºå’Œé…ç½®å¹¶æ²¡æœ‰è®¾ç½®åç§»ï¼Œæ’æŸ¥é“¾æ¥æ–‡ä»¶ï¼Œå¯åŠ¨æ–‡ä»¶ï¼Œ<code>JLINK</code>é…ç½®æ–‡ä»¶ç›¸å…³ã€‚<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#ifdef VECT_TAB_SRAM</span><br><span class="line">  SCB-&gt;VTOR = SRAM_BASE | VECT_TAB_OFFSET; /* Vector Table Relocation in Internal SRAM */</span><br><span class="line">#else</span><br><span class="line">//add by lexy 2025-09-5</span><br><span class="line">  SCB-&gt;VTOR = 0x08002800 | VECT_TAB_OFFSET; /* Vector Table Relocation in Internal FLASH */</span><br><span class="line">0x08002800 æ”¹ä¸º 0x08000000</span><br></pre></td></tr></table></figure></li>
</ul>
]]></content>
      <categories>
        <category>åµŒå…¥å¼</category>
      </categories>
      <tags>
        <tag>MCU</tag>
      </tags>
  </entry>
  <entry>
    <title>Markdownå°è´´å£«</title>
    <url>/2024/02/19/Markdown%E5%B0%8F%E8%B4%B4%E5%A3%AB/</url>
    <content><![CDATA[<h3 id="Markdown-çš„åŸºæœ¬è¯­æ³•"><a href="#Markdown-çš„åŸºæœ¬è¯­æ³•" class="headerlink" title="Markdown çš„åŸºæœ¬è¯­æ³•"></a>Markdown çš„åŸºæœ¬è¯­æ³•</h3><p>Markdown çš„è¯­æ³•éå¸¸ç®€å•ï¼Œå¸¸ç”¨çš„æ ‡è®°ç¬¦å·ä¸è¶…è¿‡åä¸ªï¼Œç”¨äºæ—¥å¸¸å†™ä½œè®°å½•ç»°ç»°æœ‰ä½™ï¼Œä¸åˆ°åŠå°æ—¶å°±èƒ½å®Œå…¨æŒæ¡ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸ç”¨çš„ Markdown æ ‡è®°ç¬¦å·ï¼š</p>
<h4 id="æ ‡é¢˜"><a href="#æ ‡é¢˜" class="headerlink" title="æ ‡é¢˜"></a>æ ‡é¢˜</h4><pre><code># ä¸€çº§æ ‡é¢˜
## äºŒçº§æ ‡é¢˜
### ä¸‰çº§æ ‡é¢˜
#### å››çº§æ ‡é¢˜
##### äº”çº§æ ‡é¢˜
###### å…­çº§æ ‡é¢˜	
</code></pre>
<h4 id="æ–‡æœ¬"><a href="#æ–‡æœ¬" class="headerlink" title="æ–‡æœ¬"></a>æ–‡æœ¬</h4><pre><code>æ™®é€šæ–‡æœ¬
**åŠ ç²—æ–‡æœ¬**
*æ–œä½“æ–‡æœ¬*
**~åˆ é™¤çº¿æ–‡æœ¬~**
</code></pre>
<h4 id="åˆ—è¡¨"><a href="#åˆ—è¡¨" class="headerlink" title="åˆ—è¡¨"></a>åˆ—è¡¨</h4><pre><code>* æ— åºåˆ—è¡¨
1. æœ‰åºåˆ—è¡¨
    * åµŒå¥—åˆ—è¡¨
</code></pre>
<h4 id="ä»£ç å—"><a href="#ä»£ç å—" class="headerlink" title="ä»£ç å—"></a>ä»£ç å—</h4><pre><code><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;Hello, world!\n&quot;</span>);</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</code></pre>
<h4 id="æ–‡æœ¬ä¸­ä»£ç é«˜äº®"><a href="#æ–‡æœ¬ä¸­ä»£ç é«˜äº®" class="headerlink" title="æ–‡æœ¬ä¸­ä»£ç é«˜äº®"></a>æ–‡æœ¬ä¸­ä»£ç é«˜äº®</h4><pre><code>ä½¿ç”¨`printf(&quot;Hello, world!\n&quot;);`å‡½æ•°è¿›è¡Œæ‰“å°
</code></pre>
<p>æ•ˆæœï¼šä½¿ç”¨<code>printf(&quot;Hello, world!\n&quot;);</code>å‡½æ•°è¿›è¡Œæ‰“å°</p>
<h4 id="é“¾æ¥"><a href="#é“¾æ¥" class="headerlink" title="é“¾æ¥"></a>é“¾æ¥</h4><p><strong>é“¾æ¥æ–‡æœ¬</strong>: <a href="https://www.example.com/">https://www.example.com</a></p>
<h4 id="å›¾ç‰‡"><a href="#å›¾ç‰‡" class="headerlink" title="å›¾ç‰‡"></a>å›¾ç‰‡</h4><pre><code>ç½‘ç»œåœ°å€: ![è¿™æ˜¯ä¸€å¼ ç¤ºä¾‹å›¾ç‰‡](https://www.example.com/example.png)
æœ¬åœ°æ–‡ä»¶è·¯å¾„ï¼š![è¿™æ˜¯ä¸€å¼ ç¤ºä¾‹å›¾ç‰‡](../pictures/è¿™æ˜¯ä¸€å¼ ç¤ºä¾‹å›¾ç‰‡.png)
å›¾ç‰‡é“¾æ¥è·³è½¬: ![è¿™æ˜¯ä¸€å¼ ç¤ºä¾‹å›¾ç‰‡](example.png) &#123;link=https://www.example.com/&#125;
å›¾ç‰‡æ ‡é¢˜: ![è¿™æ˜¯ä¸€å¼ ç¤ºä¾‹å›¾ç‰‡](example.png) &#123;title=è¿™æ˜¯ä¸€å¼ ç¤ºä¾‹å›¾ç‰‡&#125;
å›¾ç‰‡å±…ä¸­: ![è¿™æ˜¯ä¸€å¼ ç¤ºä¾‹å›¾ç‰‡](example.png) &#123;align=center&#125;

ç¤ºä¾‹ï¼š
![è¿™æ˜¯ä¸€å¼ ç¤ºä¾‹å›¾ç‰‡](example.png)
![è¿™æ˜¯ä¸€å¼  200x100 åƒç´ çš„å›¾ç‰‡](example.png) &#123;width=200 height=100&#125;
![è¿™æ˜¯ä¸€å¼ å±…ä¸­çš„å›¾ç‰‡](example.png) &#123;align=center&#125;
![ç‚¹å‡»å›¾ç‰‡è·³è½¬åˆ° https://www.example.com/](example.png) &#123;link=https://www.example.com/&#125;
![è¿™æ˜¯ä¸€å¼ ç¤ºä¾‹å›¾ç‰‡](example.png) &#123;title=è¿™æ˜¯ä¸€å¼ ç¤ºä¾‹å›¾ç‰‡&#125;
</code></pre>
<h4 id="è¡¨æ ¼"><a href="#è¡¨æ ¼" class="headerlink" title="è¡¨æ ¼"></a>è¡¨æ ¼</h4><table>
<thead>
<tr>
<th>å¤´éƒ¨1</th>
<th>å¤´éƒ¨2</th>
<th>å¤´éƒ¨3</th>
</tr>
</thead>
<tbody><tr>
<td>å†…å®¹1</td>
<td>å†…å®¹2</td>
<td>å†…å®¹3</td>
</tr>
<tr>
<td>å†…å®¹4</td>
<td>å†…å®¹5</td>
<td>å†…å®¹6</td>
</tr>
</tbody></table>
<h3 id="Markdown-çš„åº”ç”¨"><a href="#Markdown-çš„åº”ç”¨" class="headerlink" title="Markdown çš„åº”ç”¨"></a>Markdown çš„åº”ç”¨</h3><pre><code>åšå®¢æ–‡ç« 
æŠ€æœ¯æ–‡æ¡£
README æ–‡ä»¶
æ¼”ç¤ºæ–‡ç¨¿
ç”µå­ä¹¦
</code></pre>
<h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><pre><code>Markdown æ˜¯ä¸€ç§æ˜“äºå­¦ä¹ å’Œä½¿ç”¨çš„æ ‡è®°è¯­è¨€ï¼Œéå¸¸é€‚åˆç¼–å†™å„ç§æ–‡æ¡£ã€‚å¦‚æœæ‚¨è¿˜æ²¡æœ‰ä½¿ç”¨è¿‡ Markdownï¼Œå»ºè®®æ‚¨å°è¯•ä¸€ä¸‹ã€‚
</code></pre>
<p>ä»¥ä¸‹æ˜¯ Markdown å®˜æ–¹æ•™å­¦ç½‘ç«™ï¼š<br><a href="https://markdown.com.cn/basic-syntax/headings.html">Markdown å®˜æ–¹ç½‘ç«™</a></p>
]]></content>
      <categories>
        <category>æ–‡æœ¬ç¼–è¾‘å·¥å…·</category>
      </categories>
      <tags>
        <tag>Markdown</tag>
      </tags>
  </entry>
  <entry>
    <title>CmBacktraceç§»æ¤</title>
    <url>/2024/04/19/CmBacktrace%E7%A7%BB%E6%A4%8D/</url>
    <content><![CDATA[<h2 id="CmBacktraceç®€ä»‹"><a href="#CmBacktraceç®€ä»‹" class="headerlink" title="CmBacktraceç®€ä»‹"></a>CmBacktraceç®€ä»‹</h2><ul>
<li>æ”¯æŒæ–­è¨€ï¼ˆ<code>assert</code>ï¼‰å’Œæ•…éšœï¼ˆ<code>Hard Fault</code>ï¼‰</li>
<li>æ•…éšœåŸå› è‡ªåŠ¨è¯Šæ–­</li>
<li>è¾“å‡ºé”™è¯¯ç°åœºçš„ å‡½æ•°è°ƒç”¨æ ˆ</li>
<li>é€‚é… <code>Cortex-M0</code>&#x2F;<code>M3</code>&#x2F;<code>M4</code>&#x2F;<code>M7</code>ç­‰<code>MCU</code>ï¼›</li>
<li>æ”¯æŒ <code>IAR</code>ã€<code>KEIL</code>ã€<code>GCC</code> ç¼–è¯‘å™¨ï¼›</li>
</ul>
<br>

<h3 id="åŸç†åŠç§»æ¤æ–¹æ³•"><a href="#åŸç†åŠç§»æ¤æ–¹æ³•" class="headerlink" title="åŸç†åŠç§»æ¤æ–¹æ³•"></a>åŸç†åŠç§»æ¤æ–¹æ³•</h3><p><strong>1 åŸºæœ¬åŸç†</strong><br>å…¶åŸç†ä¸»è¦åŸºäº <code>Cortex-M</code> æ¶æ„çš„å‹æ ˆç‰¹æ€§å’ŒæŒ‡ä»¤åˆ†æï¼Œä»¥ä¸‹æ˜¯å…¶å·¥ä½œåŸç†çš„è¯¦ç»†ä»‹ç»ï¼š</p>
<p><strong>1.1 å‹æ ˆç‰¹æ€§</strong></p>
<ul>
<li><code>Cortex-M</code> æ¶æ„åœ¨å‘ç”Ÿå¼‚å¸¸æˆ–å‡½æ•°è°ƒç”¨æ—¶ï¼Œä¼šè‡ªåŠ¨å°†ç›¸å…³å¯„å­˜å™¨ï¼ˆå¦‚ <code>R0-R3</code>ã€<code>R12</code>ã€<code>LR</code>ã€<code>PC</code>ã€<code>PSR</code> ç­‰ï¼‰å‹å…¥æ ˆä¸­ã€‚<code>CmBacktrace</code> é€šè¿‡åˆ†ææ ˆä¸­çš„æ•°æ®æ¥è·å–å‡½æ•°è°ƒç”¨æ ˆçš„ä¿¡æ¯ã€‚</li>
</ul>
<p><strong>1.2 æŒ‡ä»¤åˆ†æä¸å‡½æ•°è°ƒç”¨æ ˆè¿˜åŸ</strong></p>
<ul>
<li>å½“ç¨‹åºå‡ºç°å¼‚å¸¸æ—¶ï¼Œ<code>CmBacktrace</code> ä¼šè·å–å½“å‰çš„æ ˆé¡¶æŒ‡é’ˆï¼ˆ<code>SP</code>ï¼‰å’Œæ ˆçš„èµ·å§‹åœ°å€åŠå¤§å°ã€‚ç„¶åä»æ ˆé¡¶å¼€å§‹éå†ï¼Œæ¯æ¬¡è¯»å–ä¸€ä¸ªåœ°å€å€¼ã€‚å¦‚æœè¯¥åœ°å€å€¼å‡å»ä¸€ä¸ªå­—çš„å¤§å°åæ˜¯å¥‡æ•°ï¼ˆå³ç¬¦åˆ <code>Thumb</code> æŒ‡ä»¤æ¨¡å¼çš„åœ°å€ï¼‰ï¼Œå¹¶ä¸”è¯¥åœ°å€å¯¹åº”çš„æŒ‡ä»¤æ˜¯ <code>BL</code> æˆ– <code>BLX</code>ï¼ˆå‡½æ•°è°ƒç”¨æŒ‡ä»¤ï¼‰ï¼Œåˆ™è®¤ä¸ºè¿™æ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„å‡½æ•°è°ƒç”¨åœ°å€ã€‚</li>
</ul>
<p><strong>1.3 é”™è¯¯ç°åœºä¿¡æ¯ä¿å­˜</strong></p>
<ul>
<li><p><code>CmBacktrace</code> ä¼šåœ¨å¼‚å¸¸å‘ç”Ÿæ—¶ä¿å­˜ <code>CPU</code> çš„å¯„å­˜å™¨çŠ¶æ€ï¼ŒåŒ…æ‹¬ <code>R0-R12</code>ã€<code>LR</code>ã€<code>PC</code>ã€<code>PSR</code> ç­‰ã€‚è¿™äº›å¯„å­˜å™¨çš„å€¼å¯ä»¥å¸®åŠ©å¼€å‘è€…äº†è§£å¼‚å¸¸å‘ç”Ÿæ—¶ç¨‹åºçš„æ‰§è¡ŒçŠ¶æ€ã€‚</p>
</li>
<li><p><code>CmBacktrace</code> è¿˜ä¼šæ ¹æ®å¼‚å¸¸ç±»å‹ï¼ˆå¦‚ <code>Hard Fault</code>ã€<code>Bus Fault</code> ç­‰ï¼‰ä¿å­˜ç›¸å…³çš„æ•…éšœçŠ¶æ€å¯„å­˜å™¨ï¼ˆå¦‚ <code>HFSR</code>ã€<code>BFSR</code>ã€<code>MMFSR</code> ç­‰ï¼‰ï¼Œè¿™äº›å¯„å­˜å™¨çš„å€¼å¯ä»¥ç”¨æ¥åˆ†æå¼‚å¸¸çš„å…·ä½“åŸå› ã€‚</p>
</li>
</ul>
<br>

<p><strong>2. æºç åŠä¾‹ç¨‹</strong></p>
<p><strong>å®˜æ–¹æºç é“¾æ¥</strong> : <a href="https://github.com/armink/CmBacktrace">https://github.com/armink/CmBacktrace</a><br><strong>ç¤ºä¾‹é¡¹ç›®é“¾æ¥</strong> : <a href="https://github.com/XUAN9527/cmbacktrace-demo">https://github.com/XUAN9527/cmbacktrace-demo</a><br><strong>è¯´æ˜æ–‡æ¡£é“¾æ¥</strong> : <a href="https://xuan9527.github.io/2024/04/19/CmBacktrace%E7%A7%BB%E6%A4%8D/">https://xuan9527.github.io/2024/04/19/CmBacktrace%E7%A7%BB%E6%A4%8D/</a></p>
<br>

<p><strong>æºç ç›®å½•ï¼š</strong></p>
<p><img src="/../pictures/cmbacktrace%E7%9B%AE%E5%BD%95.png" alt="cmbacktraceç›®å½•"></p>
<ul>
<li>å°†æºç æ‹·è´åˆ°å·¥ç¨‹ç›®å½•ä¸‹ï¼Œå¦‚<code>~/work/cmbacktrace-demo/code/components</code></li>
<li>æ·»åŠ å¤´æ–‡ä»¶<code>cm_backtrace.h</code> <code>cmb_cfg.h</code> <code>cmb_def.h</code></li>
<li>æ·»åŠ æºæ–‡ä»¶<code>cm_backtrace.c</code></li>
<li>æ·»åŠ demoæ–‡ä»¶ <code>demos/non_os/stm32f10x/app/src/fault_test.c</code></li>
</ul>
<br>

<p><strong>2.1 æ·»åŠ ä¿®æ”¹makefileï¼š</strong></p>
<p><strong>æ–¹æ³•ä¸€</strong>ã€ä¿®æ”¹æ·»åŠ <code>fault_handler/gcc/cmb_fault.S</code>ä¸º<code>fault_handler/gcc/cmb_fault.s</code></p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">ASM_SOURCES =  \</span><br><span class="line">CMSIS/device/startup/startup_n32l40x_gcc.s \</span><br><span class="line">components/cm_backtrace/fault_handler/gcc/cmb_fault.s # æ·»åŠ è¿™ä¸€è¡Œ</span><br></pre></td></tr></table></figure>

<p><strong>æ–¹æ³•äºŒ</strong>ã€å°†<code>cmb_fault.S</code>å°†å…¥<code>makefile</code>ç¼–è¯‘é€‰é¡¹</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">ASM_SOURCES = CMSIS/device/startup/startup_n32l40x_gcc.s</span><br><span class="line">ASM_SOURCES2 = components/cm_backtrace/fault_handler/gcc/cmb_fault.S	# æ­¤è¡Œä¸ºæ–°å¢</span><br><span class="line"></span><br><span class="line"># Cæºæ–‡ä»¶ã€æ±‡ç¼–æºæ–‡ä»¶çš„ç›®æ ‡æ–‡ä»¶è·¯å¾„</span><br><span class="line">C_OBJECTS = $(addprefix $(OUTPUT_DIR)/, $(C_SOURCES:.c=.o))</span><br><span class="line">ASM_OBJECTS = $(addprefix $(OUTPUT_DIR)/, $(ASM_SOURCES:.s=.o)) \</span><br><span class="line">	      $(addprefix $(OUTPUT_DIR)/, $(ASM_SOURCES2:.S=.o))	# æ­¤è¡Œä¸ºæ–°å¢</span><br><span class="line"></span><br><span class="line">$(OUTPUT_DIR)/%.o: %.s					</span><br><span class="line">	mkdir -p $(dir $@)</span><br><span class="line">	$(CC) $(INCLUDE) $(CFLAGS) -c $&lt; -o $@</span><br><span class="line"></span><br><span class="line">$(OUTPUT_DIR)/%.o: %.S         # æ–°å¢ %.S </span><br><span class="line">	mkdir -p $(dir $@)</span><br><span class="line">	$(CC) $(INCLUDE) $(CFLAGS) -c $&lt; -o $@</span><br></pre></td></tr></table></figure>

<br>

<p><strong>2.2 æ·»åŠ printfé‡å®šå‘ï¼š</strong></p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="type">int</span> _write(<span class="type">int</span> fd, <span class="type">char</span>* pBuffer, <span class="type">int</span> size)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// æ·»åŠ è‡ªå·±çš„å‘é€å‡½æ•°</span></span><br><span class="line">    <span class="keyword">return</span> drv_serial_dma_write(ESERIAL_1, pBuffer, size); </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br>

<p><strong>2.3 ä¿®æ”¹æ–‡ä»¶ï¼š</strong></p>
<ul>
<li><p><code>cmb_cfg.h</code>é…ç½®æ–‡ä»¶ï¼š</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">ifndef</span> _CMB_CFG_H_</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> _CMB_CFG_H_</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;log.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* print line, must config by user */</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> cmb_println(...)  printf(__VA_ARGS__);printf(<span class="string">&quot;\r\n&quot;</span>) <span class="comment">/* e.g., printf(__VA_ARGS__);printf(&quot;\r\n&quot;)  or  SEGGER_RTT_printf(0, __VA_ARGS__);SEGGER_RTT_WriteString(0, &quot;\r\n&quot;)  */</span></span></span><br><span class="line"><span class="comment">/* enable bare metal(no OS) platform */</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> CMB_USING_BARE_METAL_PLATFORM</span></span><br><span class="line"><span class="comment">/* enable OS platform */</span></span><br><span class="line"><span class="comment">/* #define CMB_USING_OS_PLATFORM */</span></span><br><span class="line"><span class="comment">/* OS platform type, must config when CMB_USING_OS_PLATFORM is enable */</span></span><br><span class="line"><span class="comment">/* #define CMB_OS_PLATFORM_TYPE           CMB_OS_PLATFORM_RTT or CMB_OS_PLATFORM_UCOSII or CMB_OS_PLATFORM_UCOSIII or CMB_OS_PLATFORM_FREERTOS or CMB_OS_PLATFORM_RTX5 */</span></span><br><span class="line"><span class="comment">/* cpu platform type, must config by user */</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> CMB_CPU_PLATFORM_TYPE   CMB_CPU_ARM_CORTEX_M4       <span class="comment">/* CMB_CPU_ARM_CORTEX_M0 or CMB_CPU_ARM_CORTEX_M3 or CMB_CPU_ARM_CORTEX_M4 or CMB_CPU_ARM_CORTEX_M7 */</span></span></span><br><span class="line"><span class="comment">/* enable dump stack information */</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> CMB_USING_DUMP_STACK_INFO</span></span><br><span class="line"><span class="comment">/* language of print information */</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> CMB_PRINT_LANGUAGE    CMB_PRINT_LANGUAGE_ENGLISH        <span class="comment">/* CMB_PRINT_LANGUAGE_ENGLISH(default) or CMB_PRINT_LANGUAGE_CHINESE */</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span> <span class="comment">/* _CMB_CFG_H_ */</span></span></span><br></pre></td></tr></table></figure>
</li>
<li><p>ä¿®æ”¹<code>n32l40x_flash.ld</code>é“¾æ¥æ–‡ä»¶å¦‚ä¸‹ï¼š</p>
</li>
<li><p><code>text</code>æ®µå¼€å§‹ä¹‹å‰æ·»åŠ  <code>_stext = .;</code> ä¸‹é¢ä¸ºä¾‹ç¨‹ï¼š</p>
</li>
</ul>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* Define output sections */</span></span><br><span class="line">SECTIONS</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">/* The startup code goes first into FLASH */</span></span><br><span class="line">  .isr_vector :</span><br><span class="line">  &#123;</span><br><span class="line">    . = ALIGN(<span class="number">4</span>);</span><br><span class="line">    KEEP(*(.isr_vector)) <span class="comment">/* Startup code */</span></span><br><span class="line">    . = ALIGN(<span class="number">4</span>);</span><br><span class="line">  &#125; &gt;FLASH</span><br><span class="line"></span><br><span class="line">  _stext = .;				<span class="meta"># textæ®µå¼€å§‹ä¹‹å‰æ·»åŠ </span></span><br><span class="line"></span><br><span class="line">  <span class="comment">/* The program code and other data goes into FLASH */</span></span><br><span class="line">  .text :</span><br><span class="line">  &#123;</span><br><span class="line">    . = ALIGN(<span class="number">4</span>);</span><br><span class="line">    *(.text)           <span class="comment">/* .text sections (code) */</span></span><br><span class="line">    *(.text*)          <span class="comment">/* .text* sections (code) */</span></span><br><span class="line">    *(.glue_7)         <span class="comment">/* glue arm to thumb code */</span></span><br><span class="line">    *(.glue_7t)        <span class="comment">/* glue thumb to arm code */</span></span><br><span class="line">    *(.eh_frame)</span><br><span class="line"></span><br><span class="line">    KEEP (*(.init))</span><br><span class="line">    KEEP (*(.fini))</span><br></pre></td></tr></table></figure>

<ul>
<li><code>bss</code>æ®µå¼€å§‹ä¹‹å‰æ·»åŠ  <code>_sstack = .;</code> ä¸‹é¢ä¸ºä¾‹ç¨‹ï¼š</li>
</ul>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">.bss :</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">/* This is used by the startup in order to initialize the .bss secion */</span></span><br><span class="line">  _sbss = .;         <span class="comment">/* define a global symbol at bss start */</span></span><br><span class="line">  __bss_start__ = _sbss;</span><br><span class="line">  *(.bss)</span><br><span class="line">  *(.bss*)</span><br><span class="line">  *(COMMON)</span><br><span class="line"></span><br><span class="line">  . = ALIGN(<span class="number">4</span>);</span><br><span class="line">  _ebss = .;         <span class="comment">/* define a global symbol at bss end */</span></span><br><span class="line">  __bss_end__ = _ebss;</span><br><span class="line">&#125; &gt;RAM</span><br><span class="line"></span><br><span class="line">_sstack = .;				<span class="meta"># stackæ®µå¼€å§‹ä¹‹å‰æ·»åŠ </span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* User_heap_stack section, used to check that there is enough RAM left */</span></span><br><span class="line">._user_heap_stack :</span><br><span class="line">&#123;</span><br><span class="line">  . = ALIGN(<span class="number">4</span>);</span><br><span class="line">  PROVIDE ( end = . );</span><br><span class="line">  PROVIDE ( _end = . );</span><br><span class="line">  . = . + _Min_Heap_Size;</span><br><span class="line">  . = . + _Min_Stack_Size;</span><br><span class="line">  _estack = .;        <span class="comment">/* end of RAM */</span></span><br><span class="line">  . = ALIGN(<span class="number">4</span>);</span><br><span class="line">&#125; &gt;RAM</span><br></pre></td></tr></table></figure>

<br>

<p><strong>2.4 å‚¨å­˜é”™è¯¯ä¿¡æ¯ï¼š</strong></p>
<ul>
<li><code>cm_backtrace.c</code>æ–‡ä»¶ä¿®æ”¹ï¼Œæ·»åŠ è¯»å†™éƒ¨åˆ†ï¼š<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">...</span><br><span class="line"><span class="comment">// æ·»åŠ è¯»å†™flashçš„åœ°å€</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;dcd_user.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ERRORLOG_FLASH_BASIC_ADDR 	USER_DATA_ADDR</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ERRORLOG_FLASH_OFFSET 		(0 * 1024)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ERRORLOG_FLASH_TARGET_ADDR 	(ERRORLOG_FLASH_BASIC_ADDR + ERRORLOG_FLASH_OFFSET)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ERRORLOG_FLASH_TARGET_SIZE 	(2 * 1024)</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * dump function call stack</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * @param sp stack pointer</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">print_call_stack</span><span class="params">(<span class="type">uint32_t</span> sp)</span> &#123;</span><br><span class="line">    <span class="type">size_t</span> i, cur_depth = <span class="number">0</span>;</span><br><span class="line">    <span class="type">uint32_t</span> call_stack_buf[CMB_CALL_STACK_MAX_DEPTH] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line"></span><br><span class="line">    cur_depth = cm_backtrace_call_stack(call_stack_buf, CMB_CALL_STACK_MAX_DEPTH, sp);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; cur_depth; i++) &#123;</span><br><span class="line">        <span class="built_in">sprintf</span>(call_stack_info + i * (<span class="number">8</span> + <span class="number">1</span>), <span class="string">&quot;%08lx&quot;</span>, (<span class="type">unsigned</span> <span class="type">long</span>)call_stack_buf[i]);</span><br><span class="line">        call_stack_info[i * (<span class="number">8</span> + <span class="number">1</span>) + <span class="number">8</span>] = <span class="string">&#x27; &#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (cur_depth) &#123;</span><br><span class="line">        call_stack_info[cur_depth * (<span class="number">8</span> + <span class="number">1</span>) - <span class="number">1</span>] = <span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line">        cmb_println(print_info[PRINT_CALL_STACK_INFO], fw_name, CMB_ELF_FILE_EXTENSION_NAME, call_stack_info);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ·»åŠ éƒ¨åˆ†ï¼Œå›æº¯å­—ç¬¦ä¸²å†™åˆ°flashé‡Œã€‚ä¾‹ï¼šShow more call stack info by run: addr2line -e CmBacktrace.elf -a -f 080154c2 0800a3b3 08009092</span></span><br><span class="line">        <span class="type">uint8_t</span> buff[<span class="number">512</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">        <span class="built_in">snprintf</span>((<span class="type">char</span> *)buff, <span class="keyword">sizeof</span>(buff), print_info[PRINT_CALL_STACK_INFO], fw_name, CMB_ELF_FILE_EXTENSION_NAME, call_stack_info);</span><br><span class="line">        dcd_port_erase(ERRORLOG_FLASH_TARGET_ADDR, ERRORLOG_FLASH_TARGET_SIZE);</span><br><span class="line">        dcd_port_write(ERRORLOG_FLASH_TARGET_ADDR, (<span class="type">const</span> <span class="type">uint32_t</span> *)buff, <span class="built_in">strlen</span>((<span class="type">char</span> *)buff) + <span class="number">1</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        cmb_println(print_info[PRINT_CALL_STACK_ERR]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¯»å–é”™è¯¯ä¿¡æ¯</span></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">fault_read_string</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">uint8_t</span> buff[<span class="number">512</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">	dcd_port_read(ERRORLOG_FLASH_TARGET_ADDR, (<span class="type">uint32_t</span> *)buff, <span class="keyword">sizeof</span>(buff));</span><br><span class="line">	buff[<span class="number">512</span><span class="number">-1</span>] = <span class="number">0</span>;</span><br><span class="line">	logPrintln(<span class="string">&quot;CmBacktrace hard fault = %s&quot;</span>, buff);</span><br><span class="line">&#125;</span><br><span class="line">SHELL_EXPORT_CMD(SHELL_CMD_PERMISSION(<span class="number">0</span>)|SHELL_CMD_TYPE(SHELL_TYPE_CMD_FUNC)|SHELL_CMD_DISABLE_RETURN, fault_read_string, fault_read_string, fault_read_string);</span><br><span class="line">...</span><br></pre></td></tr></table></figure></li>
</ul>
<br>

<p><strong>2.5 æ³¨é‡Šæ‰åŸæœ‰çš„<code>HardFault_Handler</code>ï¼š</strong></p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *\*\name   HardFault_Handler.</span></span><br><span class="line"><span class="comment"> *\*\fun    This function handles Hard Fault exception.</span></span><br><span class="line"><span class="comment"> *\*\param  none.</span></span><br><span class="line"><span class="comment"> *\*\return none.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">// void HardFault_Handler(void)</span></span><br><span class="line"><span class="comment">// &#123;</span></span><br><span class="line"><span class="comment">//     /* Go to infinite loop when Hard Fault exception occurs */</span></span><br><span class="line"><span class="comment">//     while (1)</span></span><br><span class="line"><span class="comment">//     &#123;</span></span><br><span class="line"><span class="comment">//     &#125;</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br></pre></td></tr></table></figure>

<br>

<p><strong>2.6 ä¸»å‡½æ•°ä¾‹ç¨‹ï¼š</strong></p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;cm_backtrace.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> HARDWARE_VERSION               <span class="string">&quot;V1.0.0&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SOFTWARE_VERSION               <span class="string">&quot;V0.1.0&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">extern</span> <span class="type">void</span> <span class="title function_">fault_test_by_unalign</span><span class="params">(<span class="type">void</span>)</span>;</span><br><span class="line"><span class="keyword">extern</span> <span class="type">void</span> <span class="title function_">fault_test_by_div0</span><span class="params">(<span class="type">void</span>)</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">	main_system_init();</span><br><span class="line">	cm_backtrace_init(<span class="string">&quot;CmBacktrace&quot;</span>, HARDWARE_VERSION, SOFTWARE_VERSION);     <span class="comment">// åœ¨å¼€å¯æ—¶é’Ÿï¼Œæ‰“å°å’Œçœ‹é—¨ç‹—ä¹‹åå°±éœ€è¦åˆå§‹åŒ–</span></span><br><span class="line">	</span><br><span class="line">	fault_test_by_unalign();    # å­—èŠ‚å¯¹é½å¼‚å¸¸ç¤ºä¾‹</span><br><span class="line">	fault_test_by_div0();       # é™¤é›¶å¼‚å¸¸ç¤ºä¾‹</span><br><span class="line"></span><br><span class="line">	<span class="keyword">while</span>(<span class="number">1</span>)</span><br><span class="line">	&#123;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br>

<p><strong>2.7 é”™è¯¯ç°åœºä¿¡æ¯è¾“å‡ºï¼š</strong></p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">Firmware name: CmBacktrace, hardware version: V1<span class="number">.0</span><span class="number">.0</span>, software version: V0<span class="number">.1</span><span class="number">.0</span></span><br><span class="line">Fault on interrupt or bare <span class="title function_">metal</span><span class="params">(no OS)</span> environment</span><br><span class="line">===== Thread <span class="built_in">stack</span> information =====</span><br><span class="line">  addr: <span class="number">20004</span>ec8    data: <span class="number">5</span>a6d79ca</span><br><span class="line">  addr: <span class="number">20004</span>ecc    data: f758b4b7</span><br><span class="line">  addr: <span class="number">20004</span>ed0    data: <span class="number">94</span>cfc3fd</span><br><span class="line">  addr: <span class="number">20004</span>ed4    data: a8ccaa51</span><br><span class="line">  addr: <span class="number">20004</span>ed8    data: <span class="number">61049</span>ca6</span><br><span class="line">  addr: <span class="number">20004</span>edc    data: e4e1b169</span><br><span class="line">  addr: <span class="number">20004</span>ee0    data: b48e100d</span><br><span class="line">  addr: <span class="number">20004</span>ee4    data: c44eb7ea</span><br><span class="line">  addr: <span class="number">20004</span>ee8    data: <span class="number">23</span>d4e51e</span><br><span class="line">  addr: <span class="number">20004</span>eec    data: <span class="number">8527b</span>7c0</span><br><span class="line">  addr: <span class="number">20004</span>ef0    data: fd9d41f7</span><br><span class="line">  addr: <span class="number">20004</span>ef4    data: f539e421</span><br><span class="line">  addr: <span class="number">20004</span>ef8    data: <span class="number">4</span>ad52963</span><br><span class="line">  addr: <span class="number">20004</span>efc    data: <span class="number">4587b</span>423</span><br><span class="line">  addr: <span class="number">20004f</span>00    data: e000ed00</span><br><span class="line">  addr: <span class="number">20004f</span>04    data: <span class="number">00000000</span></span><br><span class="line">  addr: <span class="number">20004f</span>08    data: <span class="number">00000000</span></span><br><span class="line">  addr: <span class="number">20004f</span>0c    data: <span class="number">00000000</span></span><br><span class="line">  addr: <span class="number">20004f</span>10    data: <span class="number">200022</span>cc</span><br><span class="line">  addr: <span class="number">20004f</span>14    data: <span class="number">00000000</span></span><br><span class="line">  addr: <span class="number">20004f</span>18    data: <span class="number">00000000</span></span><br><span class="line">  addr: <span class="number">20004f</span>1c    data: <span class="number">00000000</span></span><br><span class="line">  addr: <span class="number">20004f</span>20    data: <span class="number">00000000</span></span><br><span class="line">  addr: <span class="number">20004f</span>24    data: <span class="number">08009093</span></span><br><span class="line">====================================</span><br><span class="line">=================== Registers information ====================</span><br><span class="line">  R0 : <span class="number">20002</span>ee9  R1 : <span class="number">20002e4</span>c  R2 : e000ed14  R3 : <span class="number">2000253</span>c</span><br><span class="line">  R12: <span class="number">0000000</span>a  LR : <span class="number">0800</span>a3b3  PC : <span class="number">080154</span>c2  PSR: <span class="number">61000000</span></span><br><span class="line">==============================================================</span><br><span class="line">Usage fault is caused by attempts to execute an undefined instruction</span><br><span class="line">Show more call <span class="built_in">stack</span> info by run: addr2line -e CmBacktrace.elf -a -f <span class="number">080154</span>c2 <span class="number">0800</span>a3b3 <span class="number">08009092</span></span><br></pre></td></tr></table></figure>

<p><strong>è½¬æ¢ä¸ºå®šä½ä»£ç å·¥å…·ï¼š</strong></p>
<ul>
<li><code>linux</code>ç¯å¢ƒä¸‹è¾“å…¥ï¼Œ<code>app.elf</code> ä¸ºä½ çš„å·¥ç¨‹ç¼–è¯‘æ–‡ä»¶ï¼Œéœ€åœ¨å½“å‰ç›®å½•ä¸‹ï¼š</li>
</ul>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">addr2line -e app.elf -a -f <span class="number">080154</span>c2 <span class="number">0800</span>a3b3 <span class="number">08009092</span></span><br></pre></td></tr></table></figure>

<p><strong>æ•°æ®åˆ†æç»“æœï¼š</strong></p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">xuan@DESKTOP-A52B6V9:~/work/n5-mini-s-plus/code/app/build$ addr2line -e app.elf -a -f <span class="number">080154</span>c2 <span class="number">0800</span>a3b3 <span class="number">08009092</span></span><br><span class="line"><span class="number">0x080154c2</span></span><br><span class="line">fault_test_by_unalign</span><br><span class="line">/home/xuan/work/n5-mini-s-plus/code/app/components/cm_backtrace/fault_test.c:<span class="number">18</span></span><br><span class="line"><span class="number">0x0800a3b3</span></span><br><span class="line">main</span><br><span class="line">/home/xuan/work/n5-mini-s-plus/code/app/application/main.c:<span class="number">30</span></span><br><span class="line"><span class="number">0x08009092</span></span><br><span class="line">LoopFillZerobss  # .bssæ®µå¼‚å¸¸ï¼ˆæœªåˆå§‹åŒ–çš„å…¨å±€å’Œé™æ€å˜é‡ï¼‰</span><br><span class="line">/home/xuan/work/n5-mini-s-plus/code/app/CMSIS/device/startup/startup_n32l40x_gcc.s:<span class="number">113</span></span><br></pre></td></tr></table></figure>

<br>

<p><strong>3. æ€»ç»“ï¼š</strong></p>
<ul>
<li><code>CmBacktrace</code>èƒ½å¿«é€Ÿæ–¹ä¾¿çš„å®šä½å¶ç°çš„ç¨‹åºè·‘é£é—®é¢˜ã€‚</li>
<li>é”™è¯¯<code>log</code>å…¨åŠŸèƒ½æ‰“å°å¸¦å‚¨å­˜ä»£ç å ç”¨ä¸º<code>8K</code>å·¦å³ï¼›å»æ‰æ‰“å°ï¼Œä¿ç•™æœ€åŸºæœ¬çš„åŠŸèƒ½ä»£ç å ç”¨ç©ºé—´ä»…<code>4K</code>å·¦å³ã€‚</li>
<li>å‚¨å­˜ä»£ç æ®µå¯ä¼˜åŒ–ï¼Œæ·»åŠ <code>flash</code>æ“¦å†™å‡è¡¡ã€‚</li>
</ul>
]]></content>
      <categories>
        <category>åµŒå…¥å¼</category>
        <category>é”™è¯¯è¿½è¸ª</category>
      </categories>
      <tags>
        <tag>Linux</tag>
        <tag>Cortex-M</tag>
      </tags>
  </entry>
  <entry>
    <title>Linuxä¸‹å¼€å‘å•ç‰‡æœº</title>
    <url>/2024/03/28/Linux%E4%B8%8B%E5%BC%80%E5%8F%91%E5%8D%95%E7%89%87%E6%9C%BA/</url>
    <content><![CDATA[<h2 id="Ubuntu-Wslç¯å¢ƒæ­å»º"><a href="#Ubuntu-Wslç¯å¢ƒæ­å»º" class="headerlink" title="Ubuntu Wslç¯å¢ƒæ­å»º"></a>Ubuntu Wslç¯å¢ƒæ­å»º</h2><h3 id="Windows10ç³»ç»Ÿå®‰è£…å­ç³»ç»ŸWsl"><a href="#Windows10ç³»ç»Ÿå®‰è£…å­ç³»ç»ŸWsl" class="headerlink" title="Windows10ç³»ç»Ÿå®‰è£…å­ç³»ç»ŸWsl"></a>Windows10ç³»ç»Ÿå®‰è£…å­ç³»ç»ŸWsl</h3><p><strong>1. é€šè¿‡ Microsoft Store å®‰è£…</strong></p>
<ul>
<li>æ‰“å¼€ Microsoft Storeã€‚</li>
<li>æœç´¢ â€œé€‚ç”¨äº Linux çš„ Windows å­ç³»ç»Ÿâ€ã€‚</li>
<li>é€‰æ‹© â€œUbuntuâ€ æˆ–æ‚¨å–œæ¬¢çš„å…¶ä»– Linux å‘è¡Œç‰ˆã€‚</li>
<li>ç‚¹å‡» â€œè·å–â€ã€‚</li>
<li>å®‰è£…å®Œæˆåï¼Œç‚¹å‡» â€œå¯åŠ¨â€ã€‚</li>
</ul>
<p><strong>2. é€šè¿‡å‘½ä»¤è¡Œ</strong></p>
<ul>
<li><p>æ‰“å¼€ PowerShell æˆ– å‘½ä»¤æç¤ºç¬¦ ä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œã€‚</p>
</li>
<li><p>è¾“å…¥ä»¥ä¸‹å‘½ä»¤:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">wsl --install</span><br></pre></td></tr></table></figure>
</li>
<li><p>é‡å¯æ‚¨çš„è®¡ç®—æœºã€‚</p>
</li>
<li><p>å®‰è£…å®Œæˆåï¼Œæ‚¨å¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤å¯åŠ¨ WSLï¼š</p>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">wsl</span><br></pre></td></tr></table></figure>

<p><strong>æ³¨æ„:</strong></p>
<ul>
<li>WSL éœ€è¦ Windows 10 ç‰ˆæœ¬ 1709 æˆ–æ›´é«˜ç‰ˆæœ¬ã€‚</li>
<li>æ‚¨å¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤æ£€æŸ¥æ‚¨çš„ Windows ç‰ˆæœ¬ï¼š</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">winver</span><br></pre></td></tr></table></figure>

<ul>
<li><p>å¦‚æœæ‚¨ä½¿ç”¨çš„æ˜¯ Windows 10 å®¶åº­ç‰ˆï¼Œæ‚¨éœ€è¦å¯ç”¨ â€œ<strong>é€‚ç”¨äº Linux çš„ Windows å­ç³»ç»Ÿ</strong>â€ åŠŸèƒ½ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">æ§åˆ¶é¢æ¿-&gt;ç¨‹åºå’ŒåŠŸèƒ½-&gt;å¯ç”¨æˆ–å…³é—­ Windows åŠŸèƒ½-&gt;é€‚ç”¨äº Linux çš„ Windows å­ç³»ç»Ÿ-&gt;ç¡®å®š</span><br></pre></td></tr></table></figure>
</li>
<li><p>æ‚¨å¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤å¯ç”¨ â€œ<strong>é€‚ç”¨äº Linux çš„ Windows å­ç³»ç»Ÿ</strong>â€ åŠŸèƒ½ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">dism.exe /online /enable-feature /featurename:Microsoft-Windows-Subsystem-Linux</span><br></pre></td></tr></table></figure>
</li>
<li><p>é‡å¯æ‚¨çš„è®¡ç®—æœºåï¼Œæ‚¨å°±å¯ä»¥é€šè¿‡ä¸Šè¿°æ–¹æ³•å®‰è£… WSL äº†ã€‚</p>
</li>
</ul>
<p>å®‰è£… Windows Terminal</p>
<h3 id="ç¼–è¯‘ç¯å¢ƒé…ç½®"><a href="#ç¼–è¯‘ç¯å¢ƒé…ç½®" class="headerlink" title="ç¼–è¯‘ç¯å¢ƒé…ç½®"></a>ç¼–è¯‘ç¯å¢ƒé…ç½®</h3><ul>
<li><p><code>gcc-arm-none-eabi</code>å·¥å…·é“¾å®‰è£…</p>
<ul>
<li>æ‰‹åŠ¨å®‰è£…ï¼š<a href="https://developer.arm.com/downloads/-/gnu-rm">å®˜æ–¹é“¾æ¥åœ°å€</a> ä¸‹è½½æ‰€éœ€ç‰ˆæœ¬ï¼›  <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo apt install bzip2</span><br><span class="line">sudo tar -xvf ~/n32_gcc/software_package/gcc-arm-none-eabi-9-2019-q4-major-x86_64-linux.tar.bz2 -C ~/n32_gcc</span><br></pre></td></tr></table></figure></li>
<li>è‡ªåŠ¨å®‰è£…ï¼š<code>sudo apt-get install gcc-arm-none-eabi</code></li>
<li>æ‰“å¼€ <code>~/.bashrc</code></li>
<li>æ·»åŠ <code>export PATH=$PATH:~/n32_gcc/gcc-arm-none-eabi-9-2019-q4-major/bin</code></li>
<li>æ·»åŠ <code>alias open-file=&#39;explorer.exe .&#39;</code></li>
<li>ä½¿èƒ½ç”¨æˆ·ç¯å¢ƒå˜é‡<code>source ~/.bashrc</code></li>
</ul>
</li>
<li><p>Make</p>
<ul>
<li><code>sudo apt-get install make</code></li>
</ul>
</li>
</ul>
<h3 id="Winodows-Gcc-Make-ç¯å¢ƒæ­å»º"><a href="#Winodows-Gcc-Make-ç¯å¢ƒæ­å»º" class="headerlink" title="Winodows Gcc + Make ç¯å¢ƒæ­å»º"></a>Winodows Gcc + Make ç¯å¢ƒæ­å»º</h3><ul>
<li>å®‰è£…software_packageç›®å½•ä¸‹çš„<code>gcc-arm-none-eabi-9-2019-q4-major-win32-sha2.exe</code>å’Œ<code>make-3.81.exe</code></li>
<li>åˆ†åˆ«å°†å…¶å®‰è£…ç›®å½•ä¸‹çš„ <code>./bin</code>æ·»åŠ åˆ°ç³»ç»Ÿç¯å¢ƒå˜é‡ï¼Œé‡å¯ç”Ÿæ•ˆ</li>
<li>å¤åˆ¶è£¸æœºå·¥ç¨‹è‡³Windowsä¸‹ï¼Œä¿®æ”¹éƒ¨åˆ†Makefileçš„linuxæŒ‡ä»¤ä»¥é€‚é…Windowså³å¯</li>
</ul>
<h3 id="è£¸æœºå·¥ç¨‹ç¼–è¯‘"><a href="#è£¸æœºå·¥ç¨‹ç¼–è¯‘" class="headerlink" title="è£¸æœºå·¥ç¨‹ç¼–è¯‘"></a>è£¸æœºå·¥ç¨‹ç¼–è¯‘</h3><ul>
<li>cd n32g452_gcc</li>
<li>make</li>
</ul>
<br>

<h2 id="ç¯å¢ƒé…ç½®åŠå·¥å…·é“¾"><a href="#ç¯å¢ƒé…ç½®åŠå·¥å…·é“¾" class="headerlink" title="ç¯å¢ƒé…ç½®åŠå·¥å…·é“¾"></a>ç¯å¢ƒé…ç½®åŠå·¥å…·é“¾</h2><h3 id="æ‰“å¼€æ–°ç»ˆç«¯-bashrcä¸ä¼šè‡ªåŠ¨åˆ·æ–°"><a href="#æ‰“å¼€æ–°ç»ˆç«¯-bashrcä¸ä¼šè‡ªåŠ¨åˆ·æ–°" class="headerlink" title="æ‰“å¼€æ–°ç»ˆç«¯ ~&#x2F;.bashrcä¸ä¼šè‡ªåŠ¨åˆ·æ–°"></a>æ‰“å¼€æ–°ç»ˆç«¯ ~&#x2F;.bashrcä¸ä¼šè‡ªåŠ¨åˆ·æ–°</h3><p>è§£å†³linuxæ¯æ¬¡æ‰“å¼€æ–°ç»ˆç«¯éƒ½è¦é‡æ–°<code>source ~/.bashrc</code>é—®é¢˜<br>æ‰§è¡Œä»¥ä¸‹ä»£ç ï¼š</p>
<pre><code>vi ~/.bash_profile
</code></pre>
<p>æœ‰å¯èƒ½æ­¤æ–‡ä»¶æ˜¯ç©ºç™½æ–°å»ºçš„ï¼Œæ— æ‰€è°“ã€‚ç„¶ååœ¨æ­¤æ–‡ä»¶æœ«å°¾åŠ å…¥ï¼š</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> [ -f ~/.bashrc ];then</span><br><span class="line">source ~/.bashrc</span><br><span class="line">fi</span><br></pre></td></tr></table></figure>
<p>ç„¶å<code>:wq</code>ä¿å­˜å³å¯ã€‚<br>æ­¤æ—¶æ‰“å¼€æ–°ç»ˆç«¯å¯ä»¥è‡ªåŠ¨æ‰§è¡Œ<code>source ~/.bashrc</code></p>
<br>

<h3 id="arm-none-eabi-gccå·¥å…·é“¾é—®é¢˜"><a href="#arm-none-eabi-gccå·¥å…·é“¾é—®é¢˜" class="headerlink" title="arm-none-eabi-gccå·¥å…·é“¾é—®é¢˜"></a>arm-none-eabi-gccå·¥å…·é“¾é—®é¢˜</h3><ul>
<li>arm-none-eabi-gccå·¥å…·é“¾éœ€åŠ å…¥ç”¨æˆ·å˜é‡ï¼š<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">export PATH=/home/xuan/OpenHarmony/install-software/gcc-arm-none-eabi<span class="number">-9</span><span class="number">-2019</span>-q4-major/bin:$PATH</span><br></pre></td></tr></table></figure></li>
</ul>
<p>æ³¨æ„ï¼šéœ€ç¡®è®¤è·¯å¾„ï¼Œå¦åˆ™æ‰¾ä¸åˆ°ç”¨æˆ·è·¯å¾„ä¼šæœç´¢ç³»ç»Ÿè‡ªå¸¦ç¼–è¯‘é“¾ <code>/usr/lib/gcc/arm-none-eabi/10.3.1</code></p>
<br>

<h2 id="Linuxä¸‹ç¼–å†™Pythonåˆå¹¶è„šæœ¬"><a href="#Linuxä¸‹ç¼–å†™Pythonåˆå¹¶è„šæœ¬" class="headerlink" title="Linuxä¸‹ç¼–å†™Pythonåˆå¹¶è„šæœ¬"></a>Linuxä¸‹ç¼–å†™Pythonåˆå¹¶è„šæœ¬</h2><h3 id="åˆå¹¶-bootloader-app-mix"><a href="#åˆå¹¶-bootloader-app-mix" class="headerlink" title="åˆå¹¶ bootloader + app  &#x3D; mix"></a>åˆå¹¶ bootloader + app  &#x3D; mix</h3><p><strong>1. å®‰è£… PyInstaller</strong></p>
<pre><code>pip install pyinstaller
</code></pre>
<br>

<p><strong>2. ç¼–å†™Pythonåˆå¹¶ç¨‹åº</strong></p>
<p><a href="https://github.com/XUAN9527/script">ä»£ç é“¾æ¥</a></p>
<br>

<p><strong>3. æ‰“åŒ… Python ç¨‹åº</strong></p>
<p><strong>å‚æ•°è¯´æ˜ï¼š</strong></p>
<ul>
<li><code>-F</code>ï¼šç”Ÿæˆå•ä¸€å¯æ‰§è¡Œæ–‡ä»¶ã€‚</li>
<li><code>-D</code>ï¼šç”ŸæˆåŒ…å«æ‰€æœ‰ä¾èµ–é¡¹çš„ç›®å½•ã€‚</li>
<li><code>-n</code>ï¼šæŒ‡å®šå¯æ‰§è¡Œæ–‡ä»¶åã€‚</li>
<li><code>--distpath</code>ï¼šæŒ‡å®šå¯æ‰§è¡Œæ–‡ä»¶è¾“å‡ºç›®å½•ã€‚</li>
<li><code>--noconfirm</code>ï¼šè¦†ç›–è¾“å‡ºæ–‡ä»¶æ—¶æ— éœ€ç¡®è®¤ã€‚</li>
</ul>
<p><strong>ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸ç”¨çš„é«˜çº§é€‰é¡¹ï¼š</strong></p>
<ul>
<li><code>--hidden-import</code>ï¼šæŒ‡å®šè¦éšè—å¯¼å…¥çš„æ¨¡å—ã€‚</li>
<li><code>--exclude-module</code>ï¼šæŒ‡å®šè¦æ’é™¤çš„æ¨¡å—ã€‚</li>
<li><code>--onefile</code>ï¼šå°†æ‰€æœ‰æ–‡ä»¶æ‰“åŒ…æˆä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ã€‚</li>
<li><code>--runtime</code>ï¼šæŒ‡å®š Python è¿è¡Œæ—¶ç‰ˆæœ¬ã€‚</li>
</ul>
<p><strong>æ‰§è¡Œè§„åˆ™:</strong></p>
<pre><code>cd new_file,copy file.py and file.ico
pyinstaller -F -w (-i icofile) æ–‡ä»¶å.py
</code></pre>
<p><strong>example:</strong></p>
<pre><code>pyinstaller -F file.py
pyinstaller -F -w -i file.ico file.py
</code></pre>
<br>

<p><strong>4. è¿è¡Œå¯æ‰§è¡Œæ–‡ä»¶</strong></p>
<pre><code>./dist/file
</code></pre>
<br>

<p><strong>5. ä¾‹ç¨‹</strong></p>
<p><a href="https://github.com/XUAN9527/script">ä»£ç é“¾æ¥</a></p>
<br>

<p><strong>6. å®é™…åº”ç”¨åœºæ™¯</strong></p>
<ul>
<li>å•ç‹¬ä½¿ç”¨ï¼šLinuxç¯å¢ƒä¸‹å•ç‹¬æ‰§è¡Œä½¿ç”¨ã€‚</li>
<li>é›†æˆåœ¨<code>makefile</code>ä¸­ï¼Œä½¿ç”¨<code>make</code>ç¼–è¯‘è‡ªåŠ¨ç”Ÿæˆæ–‡ä»¶ï¼š<ul>
<li>å°†<code>papp_up</code>å’Œ<code>mix_10K</code>æ‰“åŒ…è‡³<code>tools</code>æ–‡ä»¶å¤¹ï¼Œæ”¾åœ¨<code>makefile</code>åŒä¸€ç›®å½•ä¸‹ã€‚</li>
<li>éœ€è¦<code>bootloder.bin</code>åœ¨<code>../bootloader</code>ç›®å½•ä¸‹ã€‚</li>
<li>ä¿®æ”¹makefileç”Ÿæˆè§„åˆ™ã€‚</li>
<li><code>$(BUILD_DIR)</code>ä¸ºç¼–è¯‘æ–‡ä»¶ç›®å½•ï¼Œè·Ÿè¿›è‡ªèº«makefileä¿®æ”¹ã€‚<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">.PHONY : clean all</span><br><span class="line"></span><br><span class="line">all: $(TARGET).bin $(TARGET).<span class="built_in">list</span> $(TARGET).hex</span><br><span class="line">	$(SZ) $(TARGET).elf</span><br><span class="line">	@make copy</span><br><span class="line">	@make mix</span><br><span class="line"></span><br><span class="line">.PHONY: copy</span><br><span class="line"></span><br><span class="line">copy: $(TARGET).bin</span><br><span class="line">	cp $(TARGET).bin app.bin</span><br><span class="line">	cp ../bootloader/bootloader.bin bootloader.bin</span><br><span class="line"><span class="meta">#	cp $(TARGET).hex app.hex</span></span><br><span class="line"></span><br><span class="line">mix:</span><br><span class="line">	./tools/papp_up</span><br><span class="line">	./tools/mix_10K</span><br><span class="line">	$(OC) -I binary -O ihex --change-addresses <span class="number">0x8000000</span> mix.bin mix.hex</span><br><span class="line">	rm bootloader.bin</span><br><span class="line">	rm app.bin</span><br><span class="line">	rm mix.bin</span><br><span class="line"></span><br><span class="line">clean:</span><br><span class="line">	rm -rf $(BUILD_DIR)</span><br><span class="line">	rm papp.bin</span><br><span class="line">	rm mix.hex</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<br>



]]></content>
      <categories>
        <category>åµŒå…¥å¼</category>
        <category>ç¯å¢ƒæ­å»º</category>
      </categories>
      <tags>
        <tag>Linux</tag>
        <tag>Wsl</tag>
      </tags>
  </entry>
  <entry>
    <title>æ‚é¡¹ç¬”è®°</title>
    <url>/2024/01/31/%E6%9D%82%E9%A1%B9%E7%AC%94%E8%AE%B0/</url>
    <content><![CDATA[<h2 id="J-Link-J-Flash"><a href="#J-Link-J-Flash" class="headerlink" title="J-Link&#x2F;J-Flash"></a>J-Link&#x2F;J-Flash</h2><p><strong>J-Flashæ‰¹å¤„ç†è„šæœ¬é…ç½®çƒ§å½•ï¼š</strong>å½“ç„¶ï¼Œå‰ææ˜¯è¦æ·»åŠ J-Linkçš„å¯æ‰§è¡Œç¨‹åºè·¯å¾„åˆ°<code>$PATH</code>ç¯å¢ƒå˜é‡ä¸­</p>
<ul>
<li><code>program.bat</code>è„šæœ¬ä»£ç å¦‚ä¸‹ï¼Œå‚è€ƒä¿®æ”¹å³å¯ï¼š<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">echo start...</span><br><span class="line"></span><br><span class="line">JLink -device N32L406CB -if swd -speed 4000 -CommanderScript &quot;C:\Users\Breo\Desktop\Wireless moxibustion\Software\program.jlink&quot;</span><br></pre></td></tr></table></figure></li>
<li><code>program.jlink</code>æ–‡ä»¶ä»£ç å¦‚ä¸‹ï¼Œå…¶ä¸­ç›®æ ‡è®¾å¤‡ã€æ–‡ä»¶è·¯å¾„ã€çƒ§å½•åœ°å€ç­‰æ ¹æ®éœ€è¦é…ç½®ï¼š<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">connect</span><br><span class="line">device N32L406CB</span><br><span class="line">si SWD</span><br><span class="line">speed 4000</span><br><span class="line">h		// halt-åœæ­¢</span><br><span class="line">r		// å¤ä½ï¼Œå¯ä»¥è€ƒè™‘å»æ‰</span><br><span class="line">erase		// æˆ– erase 0x8002800ï¼Œå»æ‰ä¹Ÿè¡Œï¼Œä½†å¯èƒ½ä¼šå‡ºç°error fail address 0x00000000é”™è¯¯æç¤º</span><br><span class="line"></span><br><span class="line">loadfile app.bin 0x8002800      // loadfile app.hex æˆ– loadfile app.bin 0x8000000</span><br><span class="line">verifybin app.bin 0x8002800</span><br><span class="line">r</span><br><span class="line">go		// r goè¡¨ç¤ºreset and run</span><br><span class="line">q		// é€€å‡ºJ-Linkå‘½ä»¤è¡Œå·¥å…·</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="Ubuntu-æ— æ³•æ›´æ–°é—®é¢˜"><a href="#Ubuntu-æ— æ³•æ›´æ–°é—®é¢˜" class="headerlink" title="Ubuntu æ— æ³•æ›´æ–°é—®é¢˜"></a>Ubuntu æ— æ³•æ›´æ–°é—®é¢˜</h2><p>Ubuntu æ— æ³•ä½¿ç”¨<code>apt update</code></p>
<h3 id="æ›´æ”¹è½¯ä»¶æº"><a href="#æ›´æ”¹è½¯ä»¶æº" class="headerlink" title="æ›´æ”¹è½¯ä»¶æº"></a>æ›´æ”¹è½¯ä»¶æº</h3><p>ç¼–è¾‘ <code>/etc/apt/sources.list</code> æ–‡ä»¶ï¼Œå°†ä»¥ä¸‹å†…å®¹æ·»åŠ åˆ°æ–‡ä»¶æœ«å°¾</p>
<pre><code>deb https://mirrors.aliyun.com/ubuntu/ jammy main restricted universe multiverse
deb-src https://mirrors.aliyun.com/ubuntu/ jammy main restricted universe multiverse

deb https://mirrors.aliyun.com/ubuntu/ jammy-updates main restricted universe multiverse
deb-src https://mirrors.aliyun.com/ubuntu/ jammy-updates main restricted universe multiverse

deb https://mirrors.aliyun.com/ubuntu/ jammy-backports main restricted universe multiverse
deb-src https://mirrors.aliyun.com/ubuntu/ jammy-backports main restricted universe multiverse
</code></pre>
<h3 id="æ¸…é™¤-apt-ç¼“å­˜"><a href="#æ¸…é™¤-apt-ç¼“å­˜" class="headerlink" title="æ¸…é™¤ apt ç¼“å­˜"></a>æ¸…é™¤ apt ç¼“å­˜</h3><pre><code>sudo apt clean
sudo apt autoclean
</code></pre>
<h3 id="å°è¯•æ›´æ–°ç³»ç»Ÿ"><a href="#å°è¯•æ›´æ–°ç³»ç»Ÿ" class="headerlink" title="å°è¯•æ›´æ–°ç³»ç»Ÿ"></a>å°è¯•æ›´æ–°ç³»ç»Ÿ</h3><pre><code>sudo apt update
</code></pre>
<p>æ˜¾ç¤º <code>ModuleNotFoundError: No module named &#39;apt_pkg&#39;</code>ï¼Œé‡æ–°å®‰è£… â€œ<code>apt_pkg</code>â€œ æ¨¡å—ï¼š</p>
<pre><code>sudo apt install --reinstall python3-apt
</code></pre>
<p>æ˜¾ç¤º ERRORï¼š</p>
<pre><code>E: Could not read response to hello message from hook [ ! -f /usr/bin/snap ] || /usr/bin/snap advise-snap --from-apt 2&gt;/dev/null || true: Success
</code></pre>
<p>å¦‚æœé—®é¢˜ä»ç„¶å­˜åœ¨ï¼Œå°è¯•ä¿®å¤ Python åŒ…ï¼š</p>
<pre><code>sudo apt install --fix-broken
</code></pre>
<p>ç„¶åå°±æ›´æ–°ç³»ç»Ÿäº†ï¼š</p>
<pre><code>sudo apt update
sudo apt upgrade
</code></pre>
<p>æ‰§è¡Œ<code>sudo apt upgrade</code>åæ˜¾ç¤ºERRORï¼š</p>
<pre><code>Errors were encountered while processing:
/tmp/apt-dpkg-install-cQBLJW/626-linux-iot-tools-common_5.4.0-1030.31_all.deb
E: Sub-process /usr/bin/dpkg returned an error code (1)
</code></pre>
<p>æœ€åä¸€æ­¥ï¼Œä¿®å¤æŸåçš„è½¯ä»¶åŒ…é…ç½®ï¼š</p>
<pre><code>sudo dpkg --configure -a
sudo apt upgrade
</code></pre>
<h2 id="Breoè“ç‰™å¯åŠ¨å¼‚å¸¸"><a href="#Breoè“ç‰™å¯åŠ¨å¼‚å¸¸" class="headerlink" title="Breoè“ç‰™å¯åŠ¨å¼‚å¸¸"></a>Breoè“ç‰™å¯åŠ¨å¼‚å¸¸</h2><h3 id="Breoè“ç‰™åˆå§‹åŒ–"><a href="#Breoè“ç‰™åˆå§‹åŒ–" class="headerlink" title="Breoè“ç‰™åˆå§‹åŒ–"></a>Breoè“ç‰™åˆå§‹åŒ–</h3><p>è“ç‰™åˆå§‹åŒ–æ²¡å®Œæˆï¼Œé€ä¼ æœªå¼€å¯ï¼Œappå°±è¿æ¥è“ç‰™äº†ã€‚<br>è®¾ç½®é€ä¼ å‚æ•°ï¼Œå¼€å¯é€ä¼ çš„çš„çŠ¶æ€ä¸­å¢åŠ è¿æ¥è“ç‰™æ¥å—æŒ‡ä»¤ã€‚</p>
<h3 id="å¿ƒè·³åŒ…å›å¤è¶…æ—¶"><a href="#å¿ƒè·³åŒ…å›å¤è¶…æ—¶" class="headerlink" title="å¿ƒè·³åŒ…å›å¤è¶…æ—¶"></a>å¿ƒè·³åŒ…å›å¤è¶…æ—¶</h3><p>ç°åœ¨æ˜¯æ¥æ”¶&#x2F;åˆ·æ–°è®¾å¤‡æ•°æ®200msè¶…æ—¶ï¼Œå»¶è¿Ÿå¤ªé•¿è¿˜å¯ä»¥ç¼©çŸ­ã€‚</p>
<h2 id="SPIçº§è”ledç¯è°ƒè¯•å°åŠ©æ‰‹"><a href="#SPIçº§è”ledç¯è°ƒè¯•å°åŠ©æ‰‹" class="headerlink" title="SPIçº§è”ledç¯è°ƒè¯•å°åŠ©æ‰‹"></a>SPIçº§è”ledç¯è°ƒè¯•å°åŠ©æ‰‹</h2><p>äº§å“åç§°ï¼š1209RGBå¹»å½©é›¾çŠ¶<br>äº§å“å‹å·ï¼šXTQ-016B.RGB-2307125-20</p>
<h3 id="SPIçº§è”ledç¯é—®é¢˜æ±‡æ€»"><a href="#SPIçº§è”ledç¯é—®é¢˜æ±‡æ€»" class="headerlink" title="SPIçº§è”ledç¯é—®é¢˜æ±‡æ€»"></a>SPIçº§è”ledç¯é—®é¢˜æ±‡æ€»</h3><h4 id="å……ç”µé—ªç¯é—®é¢˜"><a href="#å……ç”µé—ªç¯é—®é¢˜" class="headerlink" title="å……ç”µé—ªç¯é—®é¢˜"></a>å……ç”µé—ªç¯é—®é¢˜</h4><h5 id="é—®é¢˜åˆ†æ"><a href="#é—®é¢˜åˆ†æ" class="headerlink" title="é—®é¢˜åˆ†æ"></a>é—®é¢˜åˆ†æ</h5><p>å……ç”µä¸­æ‹”æ‰ç”µæºï¼Œç«‹å³å†æ¬¡æ’å…¥ï¼Œä¼šé—ªä¸€ä¸‹ç¯ï¼›è‹¥ç­‰ä¸¤ç§’å†æ’å…¥åˆ™ä¸ä¼šå‡ºç°ï¼Œåˆæ­¥åˆ¤æ–­æ˜¯æ­¤æ¬¾èŠ¯ç‰‡æœ‰é”å­˜åŠŸèƒ½ï¼Œä¼šä¿å­˜åˆ°å¯„å­˜å™¨ä¸­ï¼Œæœªå®Œå…¨æ‰ç”µå†æ¬¡æ’å…¥åˆ™ä¼šç»§ç»­æ‰§è¡Œä¸Šæ¬¡çš„å¯„å­˜å™¨æ•°æ®ã€‚</p>
<h5 id="è§£å†³æ–¹æ³•"><a href="#è§£å†³æ–¹æ³•" class="headerlink" title="è§£å†³æ–¹æ³•"></a>è§£å†³æ–¹æ³•</h5><p>å……ç”µä¸­æ‹”æ‰ç”µæºï¼Œç¨‹åºä¸è¦ç«‹å³æ–­ç”µï¼ŒæŒç»­ä¸¤ç§’ååˆå§‹åŒ–spiç¯ç ï¼Œå³ç»™spiå¯„å­˜å™¨å†™å…¨ç­æ•°æ®ã€‚</p>
<h4 id="å‘¼å¸ç¯é—ªçƒé—®é¢˜"><a href="#å‘¼å¸ç¯é—ªçƒé—®é¢˜" class="headerlink" title="å‘¼å¸ç¯é—ªçƒé—®é¢˜"></a>å‘¼å¸ç¯é—ªçƒé—®é¢˜</h4><h5 id="é—®é¢˜åˆ†æ-1"><a href="#é—®é¢˜åˆ†æ-1" class="headerlink" title="é—®é¢˜åˆ†æ"></a>é—®é¢˜åˆ†æ</h5><p>ç¨‹åºä¸­å‘¼å¸ç¯ä¼šè·‘å¶å°”é—ªçƒï¼Œå½±å“æ˜¾ç¤ºæ•ˆæœã€‚åˆ†æå‘ç°ï¼Œä»£ç ä¸­æœ‰ç”µæœºçš„FGæ£€æµ‹ï¼Œæ­¤æ£€æµ‹å¼€å¯äº†è¾“å…¥æ•è·åŠŸèƒ½ï¼Œä¼šæŒç»­ä¸­æ–­è§¦å‘ï¼Œè™½ç„¶spiç¯çš„é©±åŠ¨æ˜¯dmaå‘é€ï¼Œä½†æ˜¯ä¹Ÿæ˜¯ç”±CPUæ¥è°ƒåº¦çš„ï¼Œå¹¶ä¸èƒ½ä¸ä¸­æ–­å¹¶è¡Œã€‚spiå‘¼å¸ç¯æ•ˆæœéœ€è¦æŒç»­å‘é€æ•°æ®ï¼Œä¸”æ—¶åºè¦æ±‚å¾ˆé«˜ï¼Œä¸­æ–­ä¼šæŠ¢å spiçš„dmaå‘é€ï¼Œæ‰“æ–­spiä¼ è¾“æ•°æ®ï¼Œå¯¼è‡´æ•°æ®ä¼ è¾“å‡ºé”™ï¼Œé€ æˆé—ªç¯æ•ˆæœã€‚</p>
<h5 id="è§£å†³æ–¹æ³•-1"><a href="#è§£å†³æ–¹æ³•-1" class="headerlink" title="è§£å†³æ–¹æ³•"></a>è§£å†³æ–¹æ³•</h5><p>1ã€æé«˜èŠ¯ç‰‡ä¸»é¢‘ï¼Œn32l403KBæœ€é«˜ä¸»é¢‘ä¸º64MHzï¼Œå¦‚æœä¸»é¢‘æé«˜æ•ˆæœä¼šå¥½ä¸€äº›ã€‚<br>2ã€spiå‘¼å¸ç¯æ•ˆæœæŒç»­å‘é€æ•°æ®ï¼Œä¸èƒ½ä¸ä¸­æ–­é¢‘ç¹çš„ä»£ç ä¸€èµ·ä½¿ç”¨ã€‚</p>
<h2 id="æŸé¡¹ç›®å……ç”µä¿æŠ¤ä»å……ç”µ"><a href="#æŸé¡¹ç›®å……ç”µä¿æŠ¤ä»å……ç”µ" class="headerlink" title="æŸé¡¹ç›®å……ç”µä¿æŠ¤ä»å……ç”µ"></a>æŸé¡¹ç›®å……ç”µä¿æŠ¤ä»å……ç”µ</h2><p>ä¿®æ”¹ä»£ç ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&#123;-1, 1, PIN_CHARGE_CC_DETECT, PIN_MODE_INPUT&#125;,	//input/output switch</span><br><span class="line"></span><br><span class="line">static void board_charge_cc_set(bool en)</span><br><span class="line">&#123;	</span><br><span class="line">	struct pin_status_desc *pin = pin_handle(PIN_CHARGE_CC_DETECT);</span><br><span class="line">	<span class="keyword">if</span>(en)</span><br><span class="line">	&#123;</span><br><span class="line">		pin-&gt;<span class="built_in">type</span> = PIN_MODE_INPUT;</span><br><span class="line">		drv_pin_mode(pin-&gt;pin_id,pin-&gt;<span class="built_in">type</span>);</span><br><span class="line">		pin-&gt;lvl_rt = -1;			//é‡ç½®lvl_rtï¼Œä»¥é˜²æ­¢outputå‡ºé—®é¢˜</span><br><span class="line">	&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">		pin-&gt;<span class="built_in">type</span> = PIN_MODE_OUTPUT;</span><br><span class="line">		drv_pin_mode(pin-&gt;pin_id,pin-&gt;<span class="built_in">type</span>);</span><br><span class="line">		pin_set_func(pin, PIN_HIGH);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br>

<h2 id="å¯å˜å‚æ•°å‡½æ•°è¯¦è§£"><a href="#å¯å˜å‚æ•°å‡½æ•°è¯¦è§£" class="headerlink" title="å¯å˜å‚æ•°å‡½æ•°è¯¦è§£"></a>å¯å˜å‚æ•°å‡½æ•°è¯¦è§£</h2><p>Cè¯­è¨€ä¸­çš„å¯å˜å‚æ•°å‡½æ•°å…è®¸æ‚¨å®šä¹‰å‡½æ•°ï¼Œå…¶å‚æ•°ä¸ªæ•°æ˜¯ä¸ç¡®å®šçš„ï¼Œå¯ä»¥æ ¹æ®å…·ä½“éœ€æ±‚æ¥å—å¯å˜æ•°é‡çš„å‚æ•°ã€‚è¿™åœ¨å¤„ç†ä¸å®šæ•°é‡å‚æ•°çš„æƒ…å†µä¸‹éå¸¸æœ‰ç”¨ï¼Œæ¯”å¦‚<code>printf</code>å’Œ<code>scanf</code>ç­‰å‡½æ•°ã€‚è®©æˆ‘ä¸ºæ‚¨è¯¦ç»†è§£é‡Šä¸€ä¸‹å¯å˜å‚æ•°å‡½æ•°çš„åŸç†å’Œå®ç°ã€‚</p>
<p><strong>1. åŸç†ä¸å®ç°ï¼š</strong></p>
<ul>
<li><p>å¯å˜å‚æ•°å‡½æ•°çš„å‚æ•°åˆ—è¡¨æ˜¯ä»å³å¾€å·¦å‹å…¥å †æ ˆçš„ã€‚å‡è®¾å †æ ˆä¸­æœ‰ä»¥ä¸‹å‚æ•°ï¼šä¸å¯å˜å‚æ•°1ã€ä¸å¯å˜å‚æ•°2ã€â€¦ã€ä¸å¯å˜å‚æ•°nã€å¯å˜å‚æ•°1ã€å¯å˜å‚æ•°2ã€â€¦ã€å¯å˜å‚æ•°nã€‚</p>
</li>
<li><p>ä¸ºäº†è·å–å¯å˜å‚æ•°ï¼Œæˆ‘ä»¬éœ€è¦çŸ¥é“æ¯ä¸ªå¯å˜å‚æ•°çš„åœ°å€ã€‚è¿™æ˜¯é€šè¿‡å‰ä¸€ä¸ªä¸å¯å˜å‚æ•°çš„åœ°å€å’Œç±»å‹æ¥å®ç°çš„ã€‚</p>
</li>
<li><p>ANSIæ ‡å‡†æä¾›äº†ä¸‰ä¸ªå®æ¥å®ç°è¿™ä¸ªè¿‡ç¨‹ï¼š</p>
<ul>
<li><p><code>va_start(va_list arg_ptr, prev_param)</code>: åˆå§‹åŒ–å¯å˜å‚æ•°åˆ—è¡¨ï¼Œå°†arg_ptræŒ‡å‘ç¬¬ä¸€ä¸ªå¯å˜å‚æ•°ã€‚</p>
</li>
<li><p><code>va_arg(va_list arg_ptr, type)</code>: è·å–å½“å‰å‚æ•°çš„å€¼ï¼Œç±»å‹ç”±å‰é¢çš„ä¸å¯å˜å‚æ•°ä¼ é€’ã€‚ä¾‹å¦‚ï¼Œprintfä¸­çš„æ ¼å¼åŒ–å­—ç¬¦ä¸²æˆ–è€…å¯å˜å‚æ•°åˆ—è¡¨çš„å‚æ•°ç±»å‹å’Œç¬¬å‡ ä¸ªä¸å¯å˜å‚æ•°çš„ç›¸åŒã€‚</p>
</li>
<li><p><code>va_end(va_list arg_ptr)</code>: é‡Šæ”¾èµ„æºï¼Œç»“æŸå¯å˜å‚æ•°åˆ—è¡¨çš„è®¿é—®ã€‚</p>
</li>
</ul>
</li>
<li><p>è¿™äº›å®çš„å®ç°ç»†èŠ‚ç”±ç¼–è¯‘å™¨å’Œæ ‡å‡†åº“æä¾›ï¼Œæˆ‘ä»¬åªéœ€è°ƒç”¨å®ƒä»¬å³å¯ã€‚</p>
</li>
</ul>
<p><strong>2. å¯å˜å‚æ•°å‡½æ•°ï¼š</strong></p>
<ul>
<li>å¯å˜å‚æ•°å‡½æ•°å…è®¸åœ¨å‡½æ•°å®šä¹‰ä¸­æ¥å—ä¸å®šæ•°é‡çš„å‚æ•°ã€‚</li>
<li>Cè¯­è¨€æä¾›äº† <code>stdarg.h</code> å¤´æ–‡ä»¶æ¥æ”¯æŒå¯å˜å‚æ•°å‡½æ•°çš„å®ç°ã€‚</li>
<li>ä¸‹é¢æ˜¯ä¸€ä¸ªç¤ºä¾‹ä»£ç ï¼Œå±•ç¤ºäº†å¦‚ä½•å®ç°ä¸€ä¸ªå¯å˜å‚æ•°å‡½æ•° sumï¼Œå®ƒæ¥å—ä¸€ä¸ªæ•´æ•°å‚æ•° countï¼Œè¡¨ç¤ºæ¥ä¸‹æ¥çš„å¯å˜å‚æ•°çš„æ•°é‡ï¼š</li>
</ul>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdarg.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">sum</span><span class="params">(<span class="type">int</span> count, ...)</span> &#123;</span><br><span class="line">    <span class="type">int</span> total = <span class="number">0</span>;</span><br><span class="line">    va_list args;</span><br><span class="line">    va_start(args, count);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; count; i++) &#123;</span><br><span class="line">        <span class="type">int</span> num = va_arg(args, <span class="type">int</span>);</span><br><span class="line">        total += num;</span><br><span class="line">    &#125;</span><br><span class="line">    va_end(args);</span><br><span class="line">    <span class="keyword">return</span> total;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">int</span> result = sum(<span class="number">4</span>, <span class="number">10</span>, <span class="number">20</span>, <span class="number">30</span>, <span class="number">40</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Sum: %d\n&quot;</span>, result);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªå¯å˜å‚æ•°å‡½æ•° sumï¼Œå®ƒè®¡ç®—ä¼ å…¥çš„æ•´æ•°å‚æ•°çš„æ€»å’Œã€‚</li>
</ul>
<br>

<p><strong>3. å¯å˜å‚æ•°å®ï¼š</strong></p>
<ul>
<li>å¯å˜å‚æ•°å®å…è®¸åœ¨å®è°ƒç”¨ä¸­æ¥å—å¯å˜æ•°é‡çš„å‚æ•°ã€‚</li>
<li>åœ¨Cè¯­è¨€ä¸­ï¼Œå¯å˜å‚æ•°å®ä½¿ç”¨ <code>__VA_ARGS__</code> è¡¨ç¤ºå¯å˜å‚æ•°çš„éƒ¨åˆ†ã€‚</li>
<li>ä¸‹é¢æ˜¯ä¸€ä¸ªç¤ºä¾‹ä»£ç ï¼Œå±•ç¤ºäº†å¦‚ä½•å®šä¹‰ä¸€ä¸ªå¯å˜å‚æ•°å® <code>PRINT_VALUES</code>ï¼Œå®ƒä½¿ç”¨ printf å‡½æ•°æ¥æ‰“å°å¯å˜æ•°é‡çš„å€¼:</li>
</ul>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PRINT_VALUES(...) do &#123; \</span></span><br><span class="line"><span class="meta">    printf(<span class="string">&quot;Values: &quot;</span>); \</span></span><br><span class="line"><span class="meta">    printf(__VA_ARGS__); \</span></span><br><span class="line"><span class="meta">    printf(<span class="string">&quot;\n&quot;</span>); \</span></span><br><span class="line"><span class="meta">&#125; while (0)</span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">    PRINT_VALUES(<span class="string">&quot;%d %s %f&quot;</span>, <span class="number">10</span>, <span class="string">&quot;hello&quot;</span>, <span class="number">3.14</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªå¯å˜å‚æ•°å® <code>PRINT_VALUES</code>ï¼Œå®ƒä½¿ç”¨ <code>printf</code> å‡½æ•°æ¥æ‰“å°å¤šä¸ªå€¼ã€‚</li>
</ul>
<br>

<p><strong>4. å®ç°è‡ªå·±çš„ printf å‡½æ•°ï¼š</strong></p>
<ul>
<li><code>printf</code> å‡½æ•°æ¥å—ä¸€ä¸ªæ ¼å¼å­—ç¬¦ä¸²ä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°ï¼Œåé¢æ˜¯å¯å˜æ•°é‡çš„å‚æ•°ï¼Œç”¨äºæ›¿æ¢æ ¼å¼å­—ç¬¦ä¸²ä¸­çš„æ ¼å¼å ä½ç¬¦ã€‚</li>
<li>ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€åŒ–ç‰ˆçš„ç¤ºä¾‹ä»£ç ï¼Œå±•ç¤ºäº†ä¸€ä¸ªå®ç°ç±»ä¼¼äº <code>printf</code> å‡½æ•°çš„åŠŸèƒ½çš„å‡½æ•°ï¼š</li>
</ul>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdarg.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">my_printf</span><span class="params">(<span class="type">const</span> <span class="type">char</span>* format, ...)</span> &#123;</span><br><span class="line">    va_list args;</span><br><span class="line">    va_start(args, format);</span><br><span class="line">    <span class="keyword">while</span> (*format != <span class="string">&#x27;\0&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (*format == <span class="string">&#x27;%&#x27;</span>) &#123;</span><br><span class="line">            format++; <span class="comment">// ç§»åŠ¨åˆ°å ä½ç¬¦çš„ä¸‹ä¸€ä¸ªå­—ç¬¦</span></span><br><span class="line">            <span class="keyword">if</span> (*format == <span class="string">&#x27;d&#x27;</span>) &#123;</span><br><span class="line">                <span class="type">int</span> value = va_arg(args, <span class="type">int</span>);</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot;%d&quot;</span>, value);</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (*format == <span class="string">&#x27;f&#x27;</span>) &#123;</span><br><span class="line">                <span class="type">double</span> value = va_arg(args, <span class="type">double</span>);</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot;%f&quot;</span>, value);</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (*format == <span class="string">&#x27;s&#x27;</span>) &#123;</span><br><span class="line">                <span class="type">char</span>* value = va_arg(args, <span class="type">char</span>*);</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot;%s&quot;</span>, value);</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (*format == <span class="string">&#x27;c&#x27;</span>) &#123;</span><br><span class="line">                <span class="type">int</span> value = va_arg(args, <span class="type">int</span>);</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot;%c&quot;</span>, value);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot;Unsupported format specifier: %c&quot;</span>, *format);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%c&quot;</span>, *format);</span><br><span class="line">        &#125;</span><br><span class="line">        format++; <span class="comment">// ç§»åŠ¨åˆ°ä¸‹ä¸€ä¸ªå­—ç¬¦</span></span><br><span class="line">    &#125;</span><br><span class="line">    va_end(args);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">	<span class="type">int</span> num = <span class="number">42</span>;</span><br><span class="line">	<span class="type">double</span> pi = <span class="number">3.14159</span>;</span><br><span class="line">	<span class="type">char</span> str[] = <span class="string">&quot;Hello, world!&quot;</span>;</span><br><span class="line">	<span class="type">char</span> ch = <span class="string">&#x27;A&#x27;</span>;</span><br><span class="line"></span><br><span class="line">	my_printf(<span class="string">&quot;Integer: %d\n&quot;</span>, num);</span><br><span class="line">	my_printf(<span class="string">&quot;Float: %f\n&quot;</span>, pi);</span><br><span class="line">	my_printf(<span class="string">&quot;Float: %s\n&quot;</span>, str);</span><br><span class="line">	my_printf(<span class="string">&quot;Float: %c\n&quot;</span>, ch);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<br>

<h2 id="æ±‡ç¼–åŸºç¡€"><a href="#æ±‡ç¼–åŸºç¡€" class="headerlink" title="æ±‡ç¼–åŸºç¡€"></a>æ±‡ç¼–åŸºç¡€</h2><p>å‚è€ƒæ–‡æ¡£ï¼š<a href="https://www.ruanyifeng.com/blog/2018/01/assembly-language-primer.html">æ±‡ç¼–è¯­è¨€å…¥é—¨æ•™ç¨‹</a></p>
<h3 id="å®ä¾‹åˆ†æ"><a href="#å®ä¾‹åˆ†æ" class="headerlink" title="å®ä¾‹åˆ†æ"></a>å®ä¾‹åˆ†æ</h3><p>äº†è§£å¯„å­˜å™¨å’Œå†…å­˜æ¨¡å‹ä»¥åï¼Œå°±å¯ä»¥æ¥çœ‹æ±‡ç¼–è¯­è¨€åˆ°åº•æ˜¯ä»€ä¹ˆäº†ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ç¨‹åºexample.cã€‚</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">add_a_and_b</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span> &#123;</span><br><span class="line">   <span class="keyword">return</span> a + b;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">   <span class="keyword">return</span> add_a_and_b(<span class="number">2</span>, <span class="number">3</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>gcc å°†è¿™ä¸ªç¨‹åºè½¬æˆæ±‡ç¼–è¯­è¨€ã€‚</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">$ gcc -S example.c</span><br></pre></td></tr></table></figure>
<p>example.sç»è¿‡ç®€åŒ–ä»¥åï¼Œå¤§æ¦‚æ˜¯ä¸‹é¢çš„æ ·å­ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">_add_a_and_b:</span><br><span class="line">   push   %ebx</span><br><span class="line">   mov    %eax, [%esp+8] </span><br><span class="line">   mov    %ebx, [%esp+12]</span><br><span class="line">   add    %eax, %ebx </span><br><span class="line">   pop    %ebx </span><br><span class="line">   ret  </span><br><span class="line"></span><br><span class="line">_main:</span><br><span class="line">   push   3</span><br><span class="line">   push   2</span><br><span class="line">   call   _add_a_and_b </span><br><span class="line">   add    %esp, 8</span><br><span class="line">   ret</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹åˆ°ï¼ŒåŸç¨‹åºçš„ä¸¤ä¸ªå‡½æ•°add_a_and_bå’Œmainï¼Œå¯¹åº”ä¸¤ä¸ªæ ‡ç­¾_add_a_and_bå’Œ_mainã€‚æ¯ä¸ªæ ‡ç­¾é‡Œé¢æ˜¯è¯¥å‡½æ•°æ‰€è½¬æˆçš„ CPU è¿è¡Œæµç¨‹ã€‚</p>
<br>

<h2 id="VSCODEæ–‡ä»¶æ ‡ç­¾æ å¤šè¡Œæ˜¾ç¤º"><a href="#VSCODEæ–‡ä»¶æ ‡ç­¾æ å¤šè¡Œæ˜¾ç¤º" class="headerlink" title="VSCODEæ–‡ä»¶æ ‡ç­¾æ å¤šè¡Œæ˜¾ç¤º"></a>VSCODEæ–‡ä»¶æ ‡ç­¾æ å¤šè¡Œæ˜¾ç¤º</h2><ul>
<li>å¦‚æœä½ å¸Œæœ›æ‰“å¼€å¤šä¸ªæ–‡ä»¶æ—¶ï¼Œæ‰€æœ‰æ–‡ä»¶éƒ½èƒ½æ˜¾ç¤ºå‡ºæ¥ï¼Œè€Œä¸æ˜¯éœ€è¦æ»šåŠ¨æ¡æ¥æŸ¥çœ‹ï¼Œå¯ä»¥å¯ç”¨æ–‡ä»¶æ ‡ç­¾æ å¤šè¡Œæ˜¾ç¤ºåŠŸèƒ½ï¼š<ul>
<li>æŒ‰ä¸‹ <code>Ctrl + Shift + P</code>ï¼ˆæˆ– <code>Command + Shift + P</code>ï¼‰ï¼Œè¾“å…¥ â€œ<code>Open Workspace Settings</code>â€œ å¹¶é€‰æ‹©ã€‚</li>
<li>åœ¨æœç´¢æ¡†ä¸­è¾“å…¥ â€œ<code>Show Tabs</code>â€œï¼Œæ˜¾ç¤ºâ€<code>Workbench â€º Editor: Show Tabs</code>â€œé€‰æ‹©æ¡†ï¼Œå‹¾é€‰â€<code>multiple</code>â€œè®¾ç½®é¡¹ã€‚</li>
</ul>
</li>
</ul>
<p>é€šè¿‡ä¸Šè¿°æ–¹æ³•ï¼Œä½ å¯ä»¥è§£å†³ <code>VSCode</code> åªæ˜¾ç¤ºä¸€ä¸ªæ–‡ä»¶ï¼Œç‚¹å‡»å¦ä¸€ä¸ªæ–‡ä»¶ä¼šè¦†ç›–å½“å‰æ–‡ä»¶çš„é—®é¢˜ã€‚å¸Œæœ›è¿™äº›ä¿¡æ¯å¯¹ä½ æœ‰æ‰€å¸®åŠ©ï¼</p>
<br>

<h2 id="æ‰£å­æ™ºèƒ½è¯­éŸ³"><a href="#æ‰£å­æ™ºèƒ½è¯­éŸ³" class="headerlink" title="æ‰£å­æ™ºèƒ½è¯­éŸ³"></a>æ‰£å­æ™ºèƒ½è¯­éŸ³</h2><ul>
<li>è®¾ç½®wifiè´¦å·å¯†ç ï¼Œ</li>
<li>åˆ›å»ºæ™ºèƒ½ä½“ï¼Œç”Ÿæˆ<code>space_id</code>ï¼Œ<code>bot_ID</code>ï¼Œ<code>Access token</code>ï¼Œå¡«å…¥<code>menuconfig</code>ä¸­ã€‚</li>
<li>åˆ›å»ºä¸ªäºº<code>Access token</code>çš„æ—¶å€™è¦æ·»åŠ <code>API</code>å’Œ<code>Chat SDK</code>æ¨¡æ¿ã€‚</li>
<li><code>idf.py menuconfig</code>ä¸­<code>menuconfig â†’ Component config â†’ ESP-TLS</code>éœ€è¦ä¿®æ”¹<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">// åŸå§‹é…ç½®</span><br><span class="line">Choose SSL/TLS library for ESP-TLS (See help for more Info) (mbedTLS)  ---&gt;</span><br><span class="line">[*] Use Digital Signature (DS) Peripheral with ESP-TLS</span><br><span class="line">[ ] Enable client session tickets</span><br><span class="line">[ ] Enable server session tickets</span><br><span class="line">[ ] Certificate selection hook</span><br><span class="line">[ ] ESP-TLS Server: Set minimum Certificate Verification mode to Optional</span><br><span class="line">[ ] Enable PSK verification</span><br><span class="line">[*] Allow potentially insecure options</span><br><span class="line">[*]     Skip server certificate verification by default (WARNING: ONLY FOR TESTING PURPOSE, READ HELP)</span><br></pre></td></tr></table></figure></li>
<li>å»ºè®®åœ¨ <code>menuconfig</code> é‡Œåšä¸¤ä»¶äº‹ï¼š<ul>
<li>ä¿ç•™ [*] Skip server certificate verification by defaultï¼ˆæ–¹ä¾¿æµ‹è¯•ï¼‰</li>
<li>å…³é—­ [*] Use Digital Signature (DS) Peripheral with ESP-TLSï¼ˆé™¤é demo ä¸“é—¨ç”¨äº† DSï¼‰<br>è¿™æ · TLS ä¼šèµ° mbedTLS æ™®é€šæ¨¡å¼ï¼Œç›´æ¥ç”¨ HTTPs è¿ Cozeï¼Œä¸ä¼šå› ä¸ºç¡¬ä»¶ DS æˆ–è¯ä¹¦æ ¡éªŒå¡ä½ã€‚</li>
</ul>
</li>
</ul>
<br>

<ul>
<li>é‡åˆ°<code>bug</code>å¦‚ä¸‹ï¼š</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">E (109608) ESP_COZE_CHAT: Audio data send to queue failed</span><br><span class="line">E (109668) ESP_COZE_CHAT: Audio data send to queue failed</span><br><span class="line">E (109728) ESP_COZE_CHAT: Audio data send to queue failed</span><br><span class="line">E (109803) ESP_COZE_CHAT: Audio data send to queue failed</span><br><span class="line">W (109849) ESP_COZE_CHAT: coze websocket error reason: &#123;&quot;event_type&quot;:&quot;error&quot;,&quot;id&quot;:&quot;3c08849d-6518-4ed6-8884-bee1a853a19a&quot;,&quot;data&quot;:&#123;&quot;code&quot;:4000,&quot;msg&quot;:&quot;The parameter audio is invalid. It should follow the format: wav. or set input_audio via chat.update event. Please review your input.&quot;&#125;,&quot;detail&quot;:&#123;&quot;logid&quot;:&quot;021755077983527fdbddc030018071200000000000000325163fb&quot;,&quot;respond_at&quot;:&quot;1755077992134&quot;&#125;&#125;ï¿½2&lt;Y</span><br><span class="line"></span><br><span class="line">E (109923) ESP_COZE_CHAT: Audio data send to queue failed</span><br><span class="line">E (110118) ESP_COZE_CHAT: Audio data send to queue failed</span><br><span class="line">W (110152) ESP_COZE_CHAT: coze websocket error reason: &#123;&quot;event_type&quot;:&quot;error&quot;,&quot;id&quot;:&quot;0c329541-cc0b-44d0-9ef4-b5954edd3dc1&quot;,&quot;data&quot;:&#123;&quot;code&quot;:4000,&quot;msg&quot;:&quot;The parameter audio is invalid. It should follow the format: wav. or set input_audio via chat.update event. Please review your input.&quot;&#125;,&quot;detail&quot;:&#123;&quot;logid&quot;:&quot;021755077983527fdbddc030018071200000000000000325163fb&quot;,&quot;respond_at&quot;:&quot;1755077994608&quot;&#125;&#125;~2&lt;</span><br><span class="line"></span><br><span class="line">I (113425) COZE_CHAT_APP: vad start</span><br><span class="line">I (113427) AUDIO_PROCESSOR: VAD_START</span><br><span class="line">W (113531) ESP_COZE_CHAT: coze websocket error reason: &#123;&quot;event_type&quot;:&quot;error&quot;,&quot;id&quot;:&quot;e70d4fef-42a4-4d06-8542-4ba09e47c0fe&quot;,&quot;data&quot;:&#123;&quot;code&quot;:4000,&quot;msg&quot;:&quot;The parameter audio is invalid. It should follow the format: wav. or set input_audio via chat.update event. Please review your input.&quot;&#125;,&quot;detail&quot;:&#123;&quot;logid&quot;:&quot;021755077983527fdbddc030018071200000000000000325163fb&quot;,&quot;respond_at&quot;:&quot;1755077997990&quot;&#125;&#125;&lt;2&lt;</span><br><span class="line"></span><br><span class="line">W (113657) ESP_COZE_CHAT: coze websocket error reason: &#123;&quot;event_type&quot;:&quot;error&quot;,&quot;id&quot;:&quot;966a0434-f467-48f7-8447-3e951fa56b72&quot;,&quot;data&quot;:&#123;&quot;code&quot;:4000,&quot;msg&quot;:&quot;The parameter audio is invalid. It should follow the format: wav. or set input_audio via chat.update event. Please review your input.&quot;&#125;,&quot;detail&quot;:&#123;&quot;logid&quot;:&quot;021755077983527fdbddc030018071200000000000000325163fb&quot;,&quot;respond_at&quot;:&quot;1755077998114&quot;&#125;&#125;2&lt;ï¿½</span><br><span class="line"></span><br><span class="line">W (113754) ESP_COZE_CHAT: coze websocket error reason: &#123;&quot;event_type&quot;:&quot;error&quot;,&quot;id&quot;:&quot;a2d73423-d0d7-4356-80fc-0f5a963ffe45&quot;,&quot;data&quot;:&#123;&quot;code&quot;:4000,&quot;msg&quot;:&quot;The parameter audio is invalid. It should follow the format: wav. or set input_audio via chat.update event. Please review your input.&quot;&#125;,&quot;detail&quot;:&#123;&quot;logid&quot;:&quot;021755077983527fdbddc030018071200000000000000325163fb&quot;,&quot;respond_at&quot;:&quot;1755077998203&quot;&#125;&#125;s2&lt;ï¿½</span><br><span class="line"></span><br><span class="line">W (114268) ESP_COZE_CHAT: coze websocket error reason: &#123;&quot;event_type&quot;:&quot;error&quot;,&quot;id&quot;:&quot;e136e24c-da6a-486e-8ba3-1fe0b9cd6b0d&quot;,&quot;data&quot;:&#123;&quot;code&quot;:4000,&quot;msg&quot;:&quot;The parameter audio is invalid. It should follow the format: wav. or set input_audio via chat.update event. Please review your input.&quot;&#125;,&quot;detail&quot;:&#123;&quot;logid&quot;:&quot;021755077983527fdbddc030018071200000000000000325163fb&quot;,&quot;respond_at&quot;:&quot;1755077998542&quot;&#125;&#125;ï¿½2&lt;ï¿½</span><br><span class="line"></span><br><span class="line">E (114421) esp-tls-mbedtls: write error :-0x6C00</span><br><span class="line">E (114422) transport_base: esp_tls_conn_write error, errno=Socket is not connected</span><br><span class="line">E (114422) transport_ws: Error write header</span><br><span class="line">E (114426) websocket_client: esp_transport_write() returned -1, transport_error=ESP_ERR_MBEDTLS_SSL_WRITE_FAILED, tls_error_code=27648, tls_flags=0, errno=128</span><br><span class="line">E (114440) ESP_COZE_CHAT: WEBSOCKET_EVENT_ERROR</span><br><span class="line">I (114445) websocket_client: Reconnect after 10000 ms</span><br><span class="line">I (114449) ESP_COZE_CHAT: WEBSOCKET_EVENT_DISCONNECTED</span><br><span class="line">E (114454) ESP_COZE_CHAT: Last error reported from esp-tls: 0x8018</span><br><span class="line">E (114460) ESP_COZE_CHAT: Last error reported from tls stack: 0x6c00</span><br><span class="line">E (114468) websocket_client: Websocket client is not connected</span><br><span class="line">E (114473) websocket_client: Websocket client is not connected</span><br><span class="line">E (114478) websocket_client: Websocket client is not connected</span><br></pre></td></tr></table></figure>

<ul>
<li>æˆ‘ä»¬å¯ä»¥ç›´æ¥åœ¨ä½ çš„ <code>audio_data_read_task()</code> é‡Œåšå‡ ä¸ªæ”¹åŠ¨ï¼Œè®©å®ƒæ»¡è¶³ Coze çš„ WAV æ ¼å¼è¦æ±‚ï¼ŒåŒæ—¶è§£å†³é˜Ÿåˆ—æ»¡å¯¼è‡´çš„ Audio data send to queue failedã€‚</li>
<li>ä¸»è¦æ”¹åŠ¨ç‚¹ï¼š</li>
</ul>
<ol>
<li>å°† PCM å°è£…ä¸º WAVï¼š<ul>
<li>16kHzï¼Œ16bitï¼Œmonoã€‚</li>
<li>æ¯æ¬¡å‘é€ä¸€å°å—ï¼ˆå¦‚ 320~640 å­—èŠ‚ PCMï¼‰ç”Ÿæˆå¯¹åº” WAV chunkã€‚</li>
</ul>
</li>
<li>å¢åŠ é˜Ÿåˆ—å‘é€é‡è¯•ï¼š<ul>
<li>å¦‚æœ esp_coze_chat_send_audio_data() å¤±è´¥ï¼Œç­‰å¾… 5ms å†é‡è¯•ã€‚</li>
<li>å¾ªç¯å¤ç”¨ bufferï¼Œé¿å…é¢‘ç¹ malloc&#x2F;freeã€‚</li>
</ul>
</li>
</ol>
<figure class="highlight c"><figcaption><span>- coze_chat_app.c</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> WAV_HEADER_SIZE 44</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PCM_CHUNK_SIZE 640   <span class="comment">// æ¯æ¬¡å‘é€çš„ PCM æ•°æ®é•¿åº¦</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// WAV å¤´ç»“æ„</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">    <span class="type">char</span> riff[<span class="number">4</span>];            <span class="comment">// &quot;RIFF&quot;</span></span><br><span class="line">    <span class="type">uint32_t</span> chunk_size;</span><br><span class="line">    <span class="type">char</span> wave[<span class="number">4</span>];            <span class="comment">// &quot;WAVE&quot;</span></span><br><span class="line">    <span class="type">char</span> fmt[<span class="number">4</span>];             <span class="comment">// &quot;fmt &quot;</span></span><br><span class="line">    <span class="type">uint32_t</span> subchunk1_size; <span class="comment">// 16 for PCM</span></span><br><span class="line">    <span class="type">uint16_t</span> audio_format;   <span class="comment">// PCM = 1</span></span><br><span class="line">    <span class="type">uint16_t</span> num_channels;   <span class="comment">// 1</span></span><br><span class="line">    <span class="type">uint32_t</span> sample_rate;    <span class="comment">// 16000</span></span><br><span class="line">    <span class="type">uint32_t</span> byte_rate;</span><br><span class="line">    <span class="type">uint16_t</span> block_align;</span><br><span class="line">    <span class="type">uint16_t</span> bits_per_sample;</span><br><span class="line">    <span class="type">char</span> subchunk2_id[<span class="number">4</span>];    <span class="comment">// &quot;data&quot;</span></span><br><span class="line">    <span class="type">uint32_t</span> subchunk2_size; <span class="comment">// PCM æ•°æ®é•¿åº¦</span></span><br><span class="line">&#125; <span class="type">wav_header_t</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">fill_wav_header</span><span class="params">(<span class="type">wav_header_t</span> *hdr, <span class="type">uint32_t</span> pcm_len)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">memcpy</span>(hdr-&gt;riff, <span class="string">&quot;RIFF&quot;</span>, <span class="number">4</span>);</span><br><span class="line">    hdr-&gt;chunk_size = <span class="number">36</span> + pcm_len;</span><br><span class="line">    <span class="built_in">memcpy</span>(hdr-&gt;wave, <span class="string">&quot;WAVE&quot;</span>, <span class="number">4</span>);</span><br><span class="line">    <span class="built_in">memcpy</span>(hdr-&gt;fmt, <span class="string">&quot;fmt &quot;</span>, <span class="number">4</span>);</span><br><span class="line">    hdr-&gt;subchunk1_size = <span class="number">16</span>;</span><br><span class="line">    hdr-&gt;audio_format = <span class="number">1</span>;</span><br><span class="line">    hdr-&gt;num_channels = <span class="number">1</span>;</span><br><span class="line">    hdr-&gt;sample_rate = <span class="number">16000</span>;</span><br><span class="line">    hdr-&gt;bits_per_sample = <span class="number">16</span>;</span><br><span class="line">    hdr-&gt;byte_rate = hdr-&gt;sample_rate * hdr-&gt;num_channels * hdr-&gt;bits_per_sample / <span class="number">8</span>;</span><br><span class="line">    hdr-&gt;block_align = hdr-&gt;num_channels * hdr-&gt;bits_per_sample / <span class="number">8</span>;</span><br><span class="line">    <span class="built_in">memcpy</span>(hdr-&gt;subchunk2_id, <span class="string">&quot;data&quot;</span>, <span class="number">4</span>);</span><br><span class="line">    hdr-&gt;subchunk2_size = pcm_len;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">audio_data_read_task</span><span class="params">(<span class="type">void</span> *pv)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">uint8_t</span> *pcm_buf = esp_gmf_oal_calloc(<span class="number">1</span>, PCM_CHUNK_SIZE);</span><br><span class="line">    <span class="type">uint8_t</span> *wav_buf = esp_gmf_oal_calloc(<span class="number">1</span>, PCM_CHUNK_SIZE + WAV_HEADER_SIZE);</span><br><span class="line">    <span class="type">int</span> ret;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line"><span class="meta">#<span class="keyword">if</span> defined CONFIG_KEY_PRESS_DIALOG_MODE</span></span><br><span class="line">        xEventGroupWaitBits(coze_chat.data_evt_group, BUTTON_REC_READING, pdFALSE, pdFALSE, portMAX_DELAY);</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line">        ret = audio_recorder_read_data(pcm_buf, PCM_CHUNK_SIZE);</span><br><span class="line">        <span class="keyword">if</span> (ret &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">            vTaskDelay(pdMS_TO_TICKS(<span class="number">5</span>));</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å¡«å…… WAV å¤´</span></span><br><span class="line">        fill_wav_header((<span class="type">wav_header_t</span> *)wav_buf, ret);</span><br><span class="line">        <span class="built_in">memcpy</span>(wav_buf + WAV_HEADER_SIZE, pcm_buf, ret);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å‘é€åˆ° Coze</span></span><br><span class="line">        <span class="type">int</span> send_len = ret + WAV_HEADER_SIZE;</span><br><span class="line">        <span class="keyword">while</span> (esp_coze_chat_send_audio_data(coze_chat.chat, (<span class="type">char</span> *)wav_buf, send_len) != ESP_OK) &#123;</span><br><span class="line">            vTaskDelay(pdMS_TO_TICKS(<span class="number">5</span>));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>Linuxå°è´´å£«</title>
    <url>/2024/05/06/Linux%E5%B0%8F%E8%B4%B4%E5%A3%AB/</url>
    <content><![CDATA[<h2 id="treeæŒ‡ä»¤å°è´´å£«"><a href="#treeæŒ‡ä»¤å°è´´å£«" class="headerlink" title="treeæŒ‡ä»¤å°è´´å£«"></a>treeæŒ‡ä»¤å°è´´å£«</h2><p><strong>1. åŸºæœ¬ç”¨æ³•ï¼š</strong> æ˜¾ç¤ºå½“å‰ç›®å½•ä¸‹çš„æ–‡ä»¶å’Œç›®å½•ç»“æ„ã€‚</p>
<pre><code>tree
</code></pre>
<p><strong>2. é™åˆ¶ç›®å½•æ·±åº¦ï¼š</strong> ä½¿ç”¨ <code>-L</code> é€‰é¡¹åè·Ÿæ•°å­—æ¥é™åˆ¶ç›®å½•æ˜¾ç¤ºçš„æ·±åº¦ã€‚</p>
<pre><code>tree -L 2
</code></pre>
<p>è¿™å°†æ˜¾ç¤ºå½“å‰ç›®å½•åŠå…¶ä¸‹æœ€å¤šä¸¤çº§å­ç›®å½•ã€‚</p>
<p><strong>3. æ˜¾ç¤ºéšè—æ–‡ä»¶ï¼š</strong> é»˜è®¤æƒ…å†µä¸‹ï¼Œéšè—æ–‡ä»¶ï¼ˆä»¥ç‚¹ . å¼€å¤´çš„æ–‡ä»¶æˆ–ç›®å½•ï¼‰ä¸ä¼šè¢«æ˜¾ç¤ºã€‚è¦æ˜¾ç¤ºè¿™äº›éšè—æ–‡ä»¶ï¼Œå¯ä»¥ä½¿ç”¨ <code>-a</code> é€‰é¡¹ã€‚</p>
<pre><code>tree -a
</code></pre>
<p><strong>4. é€’å½’æ˜¾ç¤ºæ‰€æœ‰æ–‡ä»¶ï¼š</strong> ä½¿ç”¨ <code>-R</code> é€‰é¡¹é€’å½’æ˜¾ç¤ºæ‰€æœ‰æ–‡ä»¶ã€‚</p>
<pre><code>tree -R
</code></pre>
<p><strong>5. æŒ‡å®šç›®å½•ï¼š</strong> æ˜¾ç¤ºæŒ‡å®šç›®å½•çš„æ ‘çŠ¶ç»“æ„ã€‚</p>
<pre><code>tree /path/to/directory
</code></pre>
<p><strong>6. ä½¿ç”¨æ–‡ä»¶ç³»ç»Ÿç±»å‹ï¼š</strong> æ˜¾ç¤ºç›®å½•ç»“æ„æ—¶ï¼ŒåŒ…æ‹¬æ–‡ä»¶ç³»ç»Ÿç±»å‹ã€‚</p>
<pre><code>tree -F
</code></pre>
<p><code>-F</code> é€‰é¡¹ä¼šåœ¨æ¯ä¸ªç›®å½•ååæ·»åŠ ä¸€ä¸ªæ–œæ  <code>/</code>ã€‚</p>
<p><strong>7. æ’åºï¼š</strong> é»˜è®¤æƒ…å†µä¸‹ï¼Œ<code>tree</code> ä¼šæŒ‰å­—æ¯é¡ºåºæ’åºã€‚ä½¿ç”¨ <code>-f</code> é€‰é¡¹å¯ä»¥æŒ‰ç…§æ–‡ä»¶ä¿®æ”¹æ—¶é—´æ’åºã€‚</p>
<pre><code>tree -f
</code></pre>
<p><strong>8. æ˜¾ç¤ºæ–‡ä»¶å¤§å°ï¼š</strong> ä½¿ç”¨ <code>-h</code> é€‰é¡¹ä»¥æ›´æ˜“è¯»çš„æ ¼å¼æ˜¾ç¤ºæ–‡ä»¶å¤§å°ã€‚</p>
<pre><code>tree -h
</code></pre>
<p><strong>9. æ˜¾ç¤ºç›®å½•å’Œæ–‡ä»¶çš„æƒé™ï¼š</strong> ä½¿ç”¨ <code>-u</code> é€‰é¡¹æ˜¾ç¤ºæ–‡ä»¶æ‰€æœ‰è€…ï¼Œ<code>-g</code> é€‰é¡¹æ˜¾ç¤ºæ–‡ä»¶ç»„ã€‚</p>
<pre><code>tree -ug
</code></pre>
<p><strong>10. ä½¿ç”¨é¢œè‰²ï¼š</strong> <code>tree</code> å‘½ä»¤ä½¿ç”¨é¢œè‰²æ¥åŒºåˆ†ä¸åŒç±»å‹çš„æ–‡ä»¶å’Œç›®å½•ã€‚ä½¿ç”¨ <code>--no-colour</code> å¯ä»¥å…³é—­é¢œè‰²æ˜¾ç¤ºã€‚</p>
<pre><code>tree --no-colour
</code></pre>
<p><strong>11. è¾“å‡ºåˆ°æ–‡ä»¶ï¼š</strong><br>å°†æ ‘çŠ¶ç»“æ„è¾“å‡ºåˆ°ä¸€ä¸ªæ–‡ä»¶ä¸­ã€‚</p>
<pre><code>tree &gt; tree.txt
</code></pre>
<p><strong>12. æ‰§è¡Œå‘½ä»¤ï¼š</strong><br>å¯¹æ¯ä¸ªæ–‡ä»¶æˆ–ç›®å½•æ‰§è¡Œå‘½ä»¤ï¼Œä¾‹å¦‚ï¼Œè·å–æ¯ä¸ªæ–‡ä»¶çš„è¯¦ç»†ä¿¡æ¯ã€‚</p>
<pre><code>tree -exec ls -l &#123;&#125; \;
</code></pre>
<p><strong>13. å¸®åŠ©å’Œæ‰‹å†Œï¼š</strong><br>æŸ¥çœ‹ tree å‘½ä»¤çš„å¸®åŠ©ä¿¡æ¯ã€‚</p>
<pre><code>tree --help
man tree
</code></pre>
<p><strong>14. å®‰è£… tree å‘½ä»¤ï¼ˆå¦‚æœå°šæœªå®‰è£…ï¼‰é€šå¸¸å¯ä»¥é€šè¿‡ä½ çš„Linuxå‘è¡Œç‰ˆçš„åŒ…ç®¡ç†å™¨æ¥å®Œæˆã€‚</strong><br>ä¾‹å¦‚ï¼Œåœ¨Ubuntuä¸Šï¼Œä½ å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å®‰è£…ï¼š</p>
<pre><code>sudo apt-get update
sudo apt-get install tree
</code></pre>
<p>ä½¿ç”¨ <code>tree</code> å¯ä»¥å¸®åŠ©ä½ æ›´ç›´è§‚åœ°æŸ¥çœ‹ç›®å½•ç»“æ„ï¼Œç‰¹åˆ«æ˜¯åœ¨å¤„ç†å¤æ‚çš„æ–‡ä»¶ç³»ç»Ÿæ—¶ã€‚</p>
<br>

<h2 id="gitå°è´´å£«"><a href="#gitå°è´´å£«" class="headerlink" title="gitå°è´´å£«"></a>gitå°è´´å£«</h2><p><img src="/../pictures/git%E6%8C%87%E4%BB%A4.jpg" alt="gitæŒ‡ä»¤"></p>
<br>

<p><img src="/../pictures/vim%E6%8C%87%E4%BB%A4.jpg" alt="vimæŒ‡ä»¤"></p>
<br>

<h2 id="Pythoné—®é¢˜"><a href="#Pythoné—®é¢˜" class="headerlink" title="Pythoné—®é¢˜"></a>Pythoné—®é¢˜</h2><ul>
<li><code>python</code> æŒ‡å‘ <code>python3</code></li>
<li><code>Ubuntu</code> ç³»ç»Ÿä¸­é»˜è®¤çš„ <code>python</code> å¯èƒ½æŒ‡å‘ <code>Python 2</code>ï¼Œä½† <code>Python 2</code> å·²ç»åœæ­¢ä½¿ç”¨ã€‚å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å°† <code>python</code> æŒ‡å‘ <code>Python 3</code>ï¼š</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo apt-get install python-is-python3</span><br></pre></td></tr></table></figure>

<br>

<h2 id="OpenHarmonyå­¦ä¹ ç¬”è®°"><a href="#OpenHarmonyå­¦ä¹ ç¬”è®°" class="headerlink" title="OpenHarmonyå­¦ä¹ ç¬”è®°"></a>OpenHarmonyå­¦ä¹ ç¬”è®°</h2><h3 id="ç¯å¢ƒæ­å»º"><a href="#ç¯å¢ƒæ­å»º" class="headerlink" title="ç¯å¢ƒæ­å»º"></a>ç¯å¢ƒæ­å»º</h3><ol>
<li><p>å®‰è£…æ‰€éœ€çš„ç»„ä»¶å’Œé…ç½®<code>git</code>èº«ä»½ä¿¡æ¯</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo apt-get update</span><br><span class="line">sudo apt-get install git-lfs curl python3-pip ccache</span><br><span class="line"></span><br><span class="line">git config --global user.name <span class="string">&quot;YourName&quot;</span></span><br><span class="line">git config --global user.email <span class="string">&quot;YourEmail@example.com&quot;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>è·å–ä»£ç æ­¥éª¤</p>
</li>
</ol>
<ul>
<li><p>å®‰è£…<code>repo</code>å·¥å…·</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> -p ~/bin</span><br><span class="line">curl https://gitee.com/oschina/repo/raw/fork_flow/repo-py3 &gt; ~/bin/repo</span><br><span class="line"><span class="built_in">chmod</span> a+x ~/bin/repo</span><br><span class="line"><span class="built_in">export</span> PATH=~/bin:<span class="variable">$PATH</span>  <span class="comment"># æ°¸ä¹…ç”Ÿæ•ˆéœ€å†™å…¥~/.bashrc</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>åˆå§‹åŒ–ä»“åº“</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">(æ¨èSSHåè®®)</span><br><span class="line">repo init -u git@gitee.com:openharmony/manifest.git -b OpenHarmony-5.0.2-Release --no-repo-verify</span><br><span class="line">æˆ–è€…ï¼š</span><br><span class="line">(HTTPSåè®®)</span><br><span class="line">repo init -u https://gitee.com/openharmony/manifest.git -b OpenHarmony-5.0.2-Release --no-repo-verify</span><br></pre></td></tr></table></figure>
</li>
<li><p>åŒæ­¥å…¨é‡ä»£ç </p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">repo <span class="built_in">sync</span> -c -j8  <span class="comment"># -cä»…åŒæ­¥å½“å‰åˆ†æ”¯ï¼Œ-j8å¯ç”¨8çº¿ç¨‹åŠ é€Ÿ</span></span><br><span class="line">repo forall -c <span class="string">&#x27;git lfs pull&#x27;</span>  <span class="comment"># æ‹‰å–å¤§æ–‡ä»¶ï¼ˆå¦‚å›¾ç‰‡/é¢„ç¼–è¯‘åº“ï¼‰</span></span><br></pre></td></tr></table></figure></li>
</ul>
<ol start="3">
<li>å¸¸è§é—®é¢˜å¤„ç†</li>
</ol>
<ul>
<li><p>æƒé™é”™è¯¯,è‹¥å‡ºç°<code>Permission denied</code>ï¼Œæ£€æŸ¥<code>SSH</code>å…¬é’¥æ˜¯å¦å·²æ­£ç¡®ç»‘å®š<code>Gitee</code>è´¦æˆ·ï¼Œå¹¶ä¿®å¤ç›®å½•æƒé™ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo <span class="built_in">chown</span> -R <span class="variable">$USER</span>:<span class="variable">$USER</span> .repo/</span><br><span class="line">ex: sudo <span class="built_in">chown</span> -R ubuntu:ubuntu /home/ubuntu/openharmony/.repo</span><br></pre></td></tr></table></figure></li>
<li><p>å¦‚æœé—®é¢˜ä»å­˜åœ¨,å¯èƒ½æ˜¯çˆ¶ç›®å½•æƒé™é—®é¢˜ï¼Œæ£€æŸ¥å¹¶ä¿®å¤æ•´ä¸ª<code>openharmony</code>ç›®å½•çš„æƒé™ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo <span class="built_in">chown</span> -R ubuntu:ubuntu /home/ubuntu/openharmony</span><br><span class="line">sudo <span class="built_in">chmod</span> -R 755 /home/ubuntu/openharmony</span><br></pre></td></tr></table></figure>
</li>
<li><p>ç½‘ç»œä¸­æ–­å¯¼è‡´åŒæ­¥å¤±è´¥</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">repo <span class="built_in">sync</span> -c -j4 --fail-fast  <span class="comment"># å¤±è´¥æ—¶è‡ªåŠ¨é‡è¯•</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>ä¾èµ–ç¼ºå¤±</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">./build/prebuilts_download.sh  <span class="comment"># è‡ªåŠ¨ä¸‹è½½ä¾èµ–:cite[3]:cite[6]</span></span><br></pre></td></tr></table></figure></li>
</ul>
<ol start="4">
<li>éªŒè¯ä»£ç å®Œæ•´æ€§</li>
</ol>
<ul>
<li><p>ç›®å½•ç»“æ„æ£€æŸ¥</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">ls</span> -la .repo/manifests/  <span class="comment"># åº”åŒ…å«default.xmlåŠç‰ˆæœ¬åˆ†æ”¯æ–‡ä»¶</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>ç‰ˆæœ¬æ ‡ç­¾åŒ¹é…</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> .repo/manifests.git</span><br><span class="line">git tag | grep OpenHarmony-5.0.2  <span class="comment"># ç¡®è®¤åˆ†æ”¯å­˜åœ¨:cite[7]</span></span><br></pre></td></tr></table></figure></li>
</ul>
]]></content>
      <categories>
        <category>å°è´´å£«</category>
      </categories>
      <tags>
        <tag>Linux</tag>
        <tag>Wsl</tag>
      </tags>
  </entry>
  <entry>
    <title>CMakeå­¦ä¹ ç¬”è®°</title>
    <url>/2024/05/08/CMake%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/</url>
    <content><![CDATA[<h2 id="CMakeå­¦ä¹ æ•™ç¨‹"><a href="#CMakeå­¦ä¹ æ•™ç¨‹" class="headerlink" title="CMakeå­¦ä¹ æ•™ç¨‹"></a>CMakeå­¦ä¹ æ•™ç¨‹</h2><ul>
<li>[å‚è€ƒèµ„æ–™1] : <a href="https://subingwen.cn/cmake/CMake-primer">https://subingwen.cn/cmake/CMake-primer</a></li>
<li>[å‚è€ƒèµ„æ–™2] : <a href="https://subingwen.cn/cmake/CMake-advanced/">https://subingwen.cn/cmake/CMake-advanced/</a></li>
<li>[å‚è€ƒèµ„æ–™3] : <a href="https://zhuanlan.zhihu.com/p/534439206">https://zhuanlan.zhihu.com/p/534439206</a></li>
</ul>
<br>

<h2 id="ç¼–å†™ä¸€ä¸ªç®€å•çš„CMakeLists-txtæ–‡ä»¶"><a href="#ç¼–å†™ä¸€ä¸ªç®€å•çš„CMakeLists-txtæ–‡ä»¶" class="headerlink" title="ç¼–å†™ä¸€ä¸ªç®€å•çš„CMakeLists.txtæ–‡ä»¶"></a>ç¼–å†™ä¸€ä¸ªç®€å•çš„CMakeLists.txtæ–‡ä»¶</h2><h3 id="1-ç¤ºä¾‹æ–‡ä»¶çš„ç›®å½•ç»“æ„å¦‚ä¸‹ï¼š"><a href="#1-ç¤ºä¾‹æ–‡ä»¶çš„ç›®å½•ç»“æ„å¦‚ä¸‹ï¼š" class="headerlink" title="1. ç¤ºä¾‹æ–‡ä»¶çš„ç›®å½•ç»“æ„å¦‚ä¸‹ï¼š"></a>1. ç¤ºä¾‹æ–‡ä»¶çš„ç›®å½•ç»“æ„å¦‚ä¸‹ï¼š</h3><figure class="highlight c"><table><tr><td class="code"><pre><span class="line">$ tree</span><br><span class="line">.</span><br><span class="line">â”œâ”€â”€ add.c</span><br><span class="line">â”œâ”€â”€ div.c</span><br><span class="line">â”œâ”€â”€ head.h</span><br><span class="line">â”œâ”€â”€ main.c</span><br><span class="line">â”œâ”€â”€ mult.c</span><br><span class="line">â””â”€â”€ sub.c</span><br></pre></td></tr></table></figure>

<br>

<h3 id="2-æ·»åŠ -CMakeLists-txt-æ–‡ä»¶"><a href="#2-æ·»åŠ -CMakeLists-txt-æ–‡ä»¶" class="headerlink" title="2. æ·»åŠ  CMakeLists.txt æ–‡ä»¶"></a>2. æ·»åŠ  CMakeLists.txt æ–‡ä»¶</h3><p>åœ¨ä¸Šè¿°æºæ–‡ä»¶æ‰€åœ¨ç›®å½•ä¸‹æ·»åŠ ä¸€ä¸ªæ–°æ–‡ä»¶ CMakeLists.txtï¼Œæ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">cmake_minimum_required(VERSION <span class="number">3.0</span>)</span><br><span class="line">project(CALC)</span><br><span class="line">add_executable(app add.c div.c main.c mult.c sub.c)</span><br></pre></td></tr></table></figure>

<ul>
<li><p><code>cmake_minimum_required</code>ï¼šæŒ‡å®šä½¿ç”¨çš„ cmake çš„æœ€ä½ç‰ˆæœ¬ã€‚</p>
<ul>
<li>å¯é€‰ï¼Œéå¿…é¡»ï¼Œå¦‚æœä¸åŠ å¯èƒ½ä¼šæœ‰è­¦å‘Šã€‚</li>
</ul>
</li>
<li><p><code>project</code>ï¼šå®šä¹‰å·¥ç¨‹åç§°ï¼Œå¹¶å¯æŒ‡å®šå·¥ç¨‹çš„ç‰ˆæœ¬ã€å·¥ç¨‹æè¿°ã€webä¸»é¡µåœ°å€ã€æ”¯æŒçš„è¯­è¨€ï¼ˆé»˜è®¤æƒ…å†µæ”¯æŒæ‰€æœ‰è¯­è¨€ï¼‰ï¼Œå¦‚æœä¸éœ€è¦è¿™äº›éƒ½æ˜¯å¯ä»¥å¿½ç•¥çš„ï¼Œåªéœ€è¦æŒ‡å®šå‡ºå·¥ç¨‹åå­—å³å¯ã€‚</p>
</li>
<li><p><code>add_executable</code>ï¼šå®šä¹‰å·¥ç¨‹ä¼šç”Ÿæˆä¸€ä¸ªå¯æ‰§è¡Œç¨‹åºã€‚</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">add_executable(å¯æ‰§è¡Œç¨‹åºå æºæ–‡ä»¶åç§°)</span><br></pre></td></tr></table></figure>
</li>
<li><p>è¿™é‡Œçš„å¯æ‰§è¡Œç¨‹åºåå’Œ<code>project</code>ä¸­çš„é¡¹ç›®åæ²¡æœ‰ä»»ä½•å…³ç³»</p>
</li>
<li><p>æºæ–‡ä»¶åå¯ä»¥æ˜¯ä¸€ä¸ªä¹Ÿå¯ä»¥æ˜¯å¤šä¸ªï¼Œå¦‚æœ‰å¤šä¸ªå¯ç”¨ç©ºæ ¼æˆ–<code>;</code>é—´éš”</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"># æ ·å¼<span class="number">1</span></span><br><span class="line">add_executable(app add.c div.c main.c mult.c sub.c)</span><br><span class="line"># æ ·å¼<span class="number">2</span></span><br><span class="line">add_executable(app add.c;div.c;main.c;mult.c;sub.c)</span><br></pre></td></tr></table></figure></li>
</ul>
<br>

<h3 id="3-æ‰§è¡ŒCMakeå‘½ä»¤"><a href="#3-æ‰§è¡ŒCMakeå‘½ä»¤" class="headerlink" title="3. æ‰§è¡ŒCMakeå‘½ä»¤"></a>3. æ‰§è¡ŒCMakeå‘½ä»¤</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">cmake å‘½ä»¤åŸå‹</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">cmake CMakeLists.txt æ–‡ä»¶æ‰€åœ¨è·¯å¾„</span></span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œç¤ºä¾‹ (å½“å‰<code>CMakeLists.txt</code>è·¯å¾„) ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">cmake .</span></span><br></pre></td></tr></table></figure>
<p>å½“æ‰§è¡Œ<code>cmake</code>å‘½ä»¤ä¹‹åï¼Œ<code>CMakeLists.txt</code> ä¸­çš„å‘½ä»¤å°±ä¼šè¢«æ‰§è¡Œï¼Œæ‰€ä»¥ä¸€å®šè¦æ³¨æ„ç»™<code>cmake</code>å‘½ä»¤æŒ‡å®šè·¯å¾„çš„æ—¶å€™ä¸€å®šä¸èƒ½å‡ºé”™ã€‚</p>
<p>æ‰§è¡Œå‘½ä»¤ä¹‹åï¼Œçœ‹ä¸€ä¸‹æºæ–‡ä»¶æ‰€åœ¨ç›®å½•ä¸­æ˜¯å¦å¤šäº†ä¸€äº›æ–‡ä»¶ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">tree -L 1</span></span><br><span class="line">.</span><br><span class="line">â”œâ”€â”€ add.c</span><br><span class="line">â”œâ”€â”€ CMakeCache.txt         # new add file</span><br><span class="line">â”œâ”€â”€ CMakeFiles             # new add dir</span><br><span class="line">â”œâ”€â”€ cmake_install.cmake    # new add file</span><br><span class="line">â”œâ”€â”€ CMakeLists.txt</span><br><span class="line">â”œâ”€â”€ div.c</span><br><span class="line">â”œâ”€â”€ head.h</span><br><span class="line">â”œâ”€â”€ main.c</span><br><span class="line">â”œâ”€â”€ Makefile               # new add file</span><br><span class="line">â”œâ”€â”€ mult.c</span><br><span class="line">â””â”€â”€ sub.c</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°åœ¨å¯¹åº”çš„ç›®å½•ä¸‹ç”Ÿæˆäº†ä¸€ä¸ª<code>makefile</code>æ–‡ä»¶ï¼Œæ­¤æ—¶å†æ‰§è¡Œ<code>make</code>å‘½ä»¤ï¼Œå°±å¯ä»¥å¯¹é¡¹ç›®è¿›è¡Œæ„å»ºå¾—åˆ°æ‰€éœ€çš„å¯æ‰§è¡Œç¨‹åºäº†ã€‚</p>
<br>

<h3 id="4-å¤´æ–‡ä»¶åŠæŒ‡å®šå®"><a href="#4-å¤´æ–‡ä»¶åŠæŒ‡å®šå®" class="headerlink" title="4. å¤´æ–‡ä»¶åŠæŒ‡å®šå®"></a>4. å¤´æ–‡ä»¶åŠæŒ‡å®šå®</h3><ul>
<li><code>CMakeLists.txt</code> ç¤ºä¾‹ä»£ç æ–‡ä»¶ï¼š<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cmake_minimum_required(VERSION 3.0)</span><br><span class="line">project(CALC)</span><br><span class="line">set(CMAKE_CXX_STANDARD 11)</span><br><span class="line">set(HOME /home/robin/Linux/calc)</span><br><span class="line">set(EXECUTABLE_OUTPUT_PATH $&#123;HOME&#125;/bin/)</span><br><span class="line"><span class="meta prompt_">include_directories($</span><span class="language-bash">&#123;PROJECT_SOURCE_DIR&#125;/include)</span></span><br><span class="line">file(GLOB SRC_LIST $&#123;CMAKE_CURRENT_SOURCE_DIR&#125;/src/*.cpp)</span><br><span class="line">add_executable(app  $&#123;SRC_LIST&#125;)</span><br></pre></td></tr></table></figure></li>
</ul>
<br>

<h4 id="4-1-é€šè¿‡å‚æ•°-std-c-11æŒ‡å®šå‡ºè¦ä½¿ç”¨c-11æ ‡å‡†ç¼–è¯‘ç¨‹åº-å¯¹åº”å®DCMAKE-CXX-STANDARD"><a href="#4-1-é€šè¿‡å‚æ•°-std-c-11æŒ‡å®šå‡ºè¦ä½¿ç”¨c-11æ ‡å‡†ç¼–è¯‘ç¨‹åº-å¯¹åº”å®DCMAKE-CXX-STANDARD" class="headerlink" title="4.1 é€šè¿‡å‚æ•°-std=c++11æŒ‡å®šå‡ºè¦ä½¿ç”¨c++11æ ‡å‡†ç¼–è¯‘ç¨‹åº,å¯¹åº”å®DCMAKE_CXX_STANDARD:"></a>4.1 é€šè¿‡å‚æ•°<code>-std=c++11</code>æŒ‡å®šå‡ºè¦ä½¿ç”¨c++11æ ‡å‡†ç¼–è¯‘ç¨‹åº,å¯¹åº”å®<code>DCMAKE_CXX_STANDARD</code>:</h4><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"># å¢åŠ -std=c++<span class="number">11</span></span><br><span class="line"><span class="built_in">set</span>(CMAKE_CXX_STANDARD <span class="number">11</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å¢åŠ -std=c++11</span></span><br><span class="line">cmake (CMakeLists.txtæ–‡ä»¶è·¯å¾„) -DCMAKE_CXX_STANDARD=11</span><br></pre></td></tr></table></figure>

<br>

<h4 id="4-2-æŒ‡å®šè¾“å‡ºçš„è·¯å¾„-EXECUTABLE-OUTPUT-PATH-ï¼š"><a href="#4-2-æŒ‡å®šè¾“å‡ºçš„è·¯å¾„-EXECUTABLE-OUTPUT-PATH-ï¼š" class="headerlink" title="4.2 æŒ‡å®šè¾“å‡ºçš„è·¯å¾„(EXECUTABLE_OUTPUT_PATH)ï¼š"></a>4.2 æŒ‡å®šè¾“å‡ºçš„è·¯å¾„(EXECUTABLE_OUTPUT_PATH)ï¼š</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">set(HOME /home/robin/Linux/Sort)</span><br><span class="line">set(EXECUTABLE_OUTPUT_PATH $&#123;HOME&#125;/bin)</span><br></pre></td></tr></table></figure>
<p>å¦‚æœè¿™ä¸ªè·¯å¾„ä¸­çš„å­ç›®å½•ä¸å­˜åœ¨ï¼Œä¼šè‡ªåŠ¨ç”Ÿæˆï¼Œæ— éœ€è‡ªå·±æ‰‹åŠ¨åˆ›å»ºã€‚</p>
<br>

<h4 id="4-3-å¤´æ–‡ä»¶çš„è·¯å¾„-include-directories"><a href="#4-3-å¤´æ–‡ä»¶çš„è·¯å¾„-include-directories" class="headerlink" title="4.3 å¤´æ–‡ä»¶çš„è·¯å¾„(include_directories)"></a>4.3 å¤´æ–‡ä»¶çš„è·¯å¾„(include_directories)</h4><figure class="highlight c"><table><tr><td class="code"><pre><span class="line">include_directories(headpath)</span><br></pre></td></tr></table></figure>
<p>å…¶ä¸­ï¼Œç¬¬å…­è¡ŒæŒ‡å®šå°±æ˜¯å¤´æ–‡ä»¶çš„è·¯å¾„ï¼ŒPROJECT_SOURCE_DIRå®å¯¹åº”çš„å€¼å°±æ˜¯æˆ‘ä»¬åœ¨ä½¿ç”¨cmakeå‘½ä»¤æ—¶ï¼Œåé¢ç´§è·Ÿçš„ç›®å½•ï¼Œä¸€èˆ¬æ˜¯å·¥ç¨‹çš„æ ¹ç›®å½•ã€‚</p>
<br>

<h4 id="4-4-æœç´¢æ–‡ä»¶-aux-source-directory"><a href="#4-4-æœç´¢æ–‡ä»¶-aux-source-directory" class="headerlink" title="4.4 æœç´¢æ–‡ä»¶(aux_source_directory)"></a>4.4 æœç´¢æ–‡ä»¶(aux_source_directory)</h4><ul>
<li><p><code>aux_source_directory(&lt; dir &gt; &lt; variable &gt;)</code> ç¤ºä¾‹ï¼š</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">aux_source_directory</span>(<span class="variable">$&#123;CMAKE_CURRENT_SOURCE_DIR&#125;</span>/src SRC_LIST)</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>file(GLOB/GLOB_RECURSE å˜é‡å è¦æœç´¢çš„æ–‡ä»¶è·¯å¾„å’Œæ–‡ä»¶ç±»å‹)</code>ç¤ºä¾‹ï¼š</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">file</span>(GLOB MAIN_SRC <span class="variable">$&#123;CMAKE_CURRENT_SOURCE_DIR&#125;</span>/src/*.cpp)</span><br><span class="line"><span class="keyword">file</span>(GLOB MAIN_HEAD <span class="variable">$&#123;CMAKE_CURRENT_SOURCE_DIR&#125;</span>/<span class="keyword">include</span>/*.h)</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>CMAKE_CURRENT_SOURCE_DIR</code> å®è¡¨ç¤ºå½“å‰è®¿é—®çš„ <code>CMakeLists.txt</code> æ–‡ä»¶æ‰€åœ¨çš„è·¯å¾„</p>
</li>
</ul>
<br>

<h3 id="5-åˆ¶ä½œåŠ¨æ€åº“æˆ–é™æ€åº“"><a href="#5-åˆ¶ä½œåŠ¨æ€åº“æˆ–é™æ€åº“" class="headerlink" title="5. åˆ¶ä½œåŠ¨æ€åº“æˆ–é™æ€åº“"></a>5. åˆ¶ä½œåŠ¨æ€åº“æˆ–é™æ€åº“</h3><p>æœ‰äº›æ—¶å€™æˆ‘ä»¬ç¼–å†™çš„æºä»£ç å¹¶ä¸éœ€è¦å°†ä»–ä»¬ç¼–è¯‘ç”Ÿæˆå¯æ‰§è¡Œç¨‹åºï¼Œè€Œæ˜¯ç”Ÿæˆä¸€äº›é™æ€åº“æˆ–åŠ¨æ€åº“æä¾›ç»™ç¬¬ä¸‰æ–¹ä½¿ç”¨ï¼Œä¸‹é¢æ¥è®²è§£åœ¨cmakeä¸­ç”Ÿæˆè¿™ä¸¤ç±»åº“æ–‡ä»¶çš„æ–¹æ³•ã€‚</p>
<h4 id="5-1-é™æ€åº“ï¼š"><a href="#5-1-é™æ€åº“ï¼š" class="headerlink" title="5.1 é™æ€åº“ï¼š"></a>5.1 é™æ€åº“ï¼š</h4><h5 id="5-1-1-cmakeç”Ÿæˆè§„åˆ™ï¼š"><a href="#5-1-1-cmakeç”Ÿæˆè§„åˆ™ï¼š" class="headerlink" title="5.1.1 cmakeç”Ÿæˆè§„åˆ™ï¼š"></a>5.1.1 cmakeç”Ÿæˆè§„åˆ™ï¼š</h5><figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">add_library</span>(åº“åç§° STATIC æºæ–‡ä»¶<span class="number">1</span> [æºæ–‡ä»¶<span class="number">2</span>] ...) </span><br></pre></td></tr></table></figure>

<ul>
<li>åœ¨Linuxä¸­ï¼Œé™æ€åº“åå­—åˆ†ä¸ºä¸‰éƒ¨åˆ†ï¼š<code>lib + åº“åå­— + .a</code>ï¼Œç¤ºä¾‹ï¼š<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">cmake_minimum_required</span>(VERSION <span class="number">3.0</span>)</span><br><span class="line"><span class="keyword">project</span>(CALC)</span><br><span class="line"><span class="keyword">include_directories</span>(<span class="variable">$&#123;PROJECT_SOURCE_DIR&#125;</span>/<span class="keyword">include</span>)</span><br><span class="line"><span class="keyword">file</span>(GLOB SRC_LIST <span class="string">&quot;$&#123;CMAKE_CURRENT_SOURCE_DIR&#125;/src/*.cpp&quot;</span>)</span><br><span class="line"><span class="keyword">add_library</span>(calc STATIC <span class="variable">$&#123;SRC_LIST&#125;</span>)</span><br></pre></td></tr></table></figure>
è¿™æ ·æœ€ç»ˆå°±ä¼šç”Ÿæˆå¯¹åº”çš„é™æ€åº“æ–‡ä»¶ <code>libcalc.a</code></li>
</ul>
<br>

<h5 id="5-1-2-gccç”Ÿæˆè§„åˆ™ï¼š"><a href="#5-1-2-gccç”Ÿæˆè§„åˆ™ï¼š" class="headerlink" title="5.1.2 gccç”Ÿæˆè§„åˆ™ï¼š"></a>5.1.2 gccç”Ÿæˆè§„åˆ™ï¼š</h5><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">gcc -c add.c div.c mult.c sub.c -I ./include/</span><br></pre></td></tr></table></figure>

<ul>
<li>ç”Ÿæˆ <code>.o</code> ç¼–è¯‘æ–‡ä»¶</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æŸ¥çœ‹ç›®å½•ä¸­çš„æ–‡ä»¶</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">tree</span></span><br><span class="line">.</span><br><span class="line">â”œâ”€â”€ add.c</span><br><span class="line">â”œâ”€â”€ add.o            # ç›®æ ‡æ–‡ä»¶</span><br><span class="line">â”œâ”€â”€ div.c</span><br><span class="line">â”œâ”€â”€ div.o            # ç›®æ ‡æ–‡ä»¶</span><br><span class="line">â”œâ”€â”€ include</span><br><span class="line">â”‚Â Â  â””â”€â”€ head.h</span><br><span class="line">â”œâ”€â”€ main.c</span><br><span class="line">â”œâ”€â”€ mult.c</span><br><span class="line">â”œâ”€â”€ mult.o           # ç›®æ ‡æ–‡ä»¶</span><br><span class="line">â”œâ”€â”€ sub.c</span><br><span class="line">â””â”€â”€ sub.o            # ç›®æ ‡æ–‡ä»¶</span><br></pre></td></tr></table></figure>
<ul>
<li>å°†ç”Ÿæˆçš„ç›®æ ‡æ–‡ä»¶é€šè¿‡ arå·¥å…·æ‰“åŒ…ç”Ÿæˆé™æ€åº“</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å°†ç”Ÿæˆçš„ç›®æ ‡æ–‡ä»¶ .o æ‰“åŒ…æˆé™æ€åº“</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">ar rcs libcalc.a add.o div.o mult.o sub.o    <span class="comment">#åœ¨åŒä¸€ä¸ªç›®å½•ä¸­å¯ä»¥å†™æˆ *.o</span></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æŸ¥çœ‹ç›®å½•ä¸­çš„æ–‡ä»¶</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">tree</span></span><br><span class="line">.</span><br><span class="line">â”œâ”€â”€ add.c</span><br><span class="line">â”œâ”€â”€ add.o</span><br><span class="line">â”œâ”€â”€ div.c</span><br><span class="line">â”œâ”€â”€ div.o</span><br><span class="line">â”œâ”€â”€ include</span><br><span class="line">â”‚Â Â  â””â”€â”€ `head.h  ===&gt; å’Œé™æ€åº“ä¸€å¹¶å‘å¸ƒ</span><br><span class="line">â”œâ”€â”€ `libcalc.a   ===&gt; ç”Ÿæˆçš„é™æ€åº“</span><br><span class="line">â”œâ”€â”€ main.c</span><br><span class="line">â”œâ”€â”€ mult.c</span><br><span class="line">â”œâ”€â”€ mult.o</span><br><span class="line">â”œâ”€â”€ sub.c</span><br><span class="line">â””â”€â”€ sub.o</span><br></pre></td></tr></table></figure>

<ul>
<li>å°†ç”Ÿæˆçš„çš„é™æ€åº“ libcalc.aå’Œåº“å¯¹åº”çš„å¤´æ–‡ä»¶head.hä¸€å¹¶å‘å¸ƒç»™ä½¿ç”¨è€…å°±å¯ä»¥äº†ã€‚</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">3. å‘å¸ƒé™æ€åº“</span></span><br><span class="line">	1. head.h    =&gt; å‡½æ•°å£°æ˜</span><br><span class="line">	2. libcalc.a =&gt; å‡½æ•°å®šä¹‰(äºŒè¿›åˆ¶æ ¼å¼)</span><br></pre></td></tr></table></figure>
<br>

<h5 id="5-1-3-gccé™æ€åº“çš„ä½¿ç”¨"><a href="#5-1-3-gccé™æ€åº“çš„ä½¿ç”¨" class="headerlink" title="5.1.3 gccé™æ€åº“çš„ä½¿ç”¨:"></a>5.1.3 gccé™æ€åº“çš„ä½¿ç”¨:</h5><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">é¦–å…ˆæ‹¿åˆ°äº†å‘å¸ƒçš„é™æ€åº“</span></span><br><span class="line">	`head.h` å’Œ `libcalc.a`</span><br><span class="line"><span class="meta prompt_">	</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å°†é™æ€åº“, å¤´æ–‡ä»¶, æµ‹è¯•ç¨‹åºæ”¾åˆ°ä¸€ä¸ªç›®å½•ä¸­å‡†å¤‡è¿›è¡Œæµ‹è¯•</span></span><br><span class="line">.</span><br><span class="line">â”œâ”€â”€ head.h          # å‡½æ•°å£°æ˜</span><br><span class="line">â”œâ”€â”€ libcalc.a       # å‡½æ•°å®šä¹‰ï¼ˆäºŒè¿›åˆ¶æ ¼å¼ï¼‰</span><br><span class="line">â””â”€â”€ main.c          # å‡½æ•°æµ‹è¯•</span><br></pre></td></tr></table></figure>

<ul>
<li>ç¼–è¯‘æµ‹è¯•ç¨‹åº, å¾—åˆ°å¯æ‰§è¡Œæ–‡ä»¶ã€‚</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ç¼–è¯‘çš„æ—¶å€™æŒ‡å®šåº“ä¿¡æ¯</span></span><br><span class="line"> 	-I: æŒ‡å®šå¤´æ–‡ä»¶æ‰€åœ¨çš„ç›®å½•(ç›¸å¯¹æˆ–è€…ç»å¯¹è·¯å¾„)</span><br><span class="line">	-L: æŒ‡å®šåº“æ‰€åœ¨çš„ç›®å½•(ç›¸å¯¹æˆ–è€…ç»å¯¹è·¯å¾„)</span><br><span class="line">	-l: æŒ‡å®šåº“çš„åå­—, æå¤´(lib)å»å°¾(.a) ==&gt; calc</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">-L -l, å‚æ•°å’Œå‚æ•°å€¼ä¹‹é—´å¯ä»¥æœ‰ç©ºæ ¼, ä¹Ÿå¯ä»¥æ²¡æœ‰  -L./ -lcalc</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">gcc main.c -o app -I./ -L./ -lcalc</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æŸ¥çœ‹ç›®å½•ä¿¡æ¯, å‘ç°å¯æ‰§è¡Œç¨‹åºå·²ç»ç”Ÿæˆäº†</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">tree</span></span><br><span class="line">.</span><br><span class="line">â”œâ”€â”€ app   		# ç”Ÿæˆçš„å¯æ‰§è¡Œç¨‹åº</span><br><span class="line">â”œâ”€â”€ head.h</span><br><span class="line">â”œâ”€â”€ libcalc.a</span><br><span class="line">â””â”€â”€ main.c</span><br></pre></td></tr></table></figure>

<br>

<h4 id="5-2-åŠ¨æ€åº“ï¼š"><a href="#5-2-åŠ¨æ€åº“ï¼š" class="headerlink" title="5.2 åŠ¨æ€åº“ï¼š"></a>5.2 åŠ¨æ€åº“ï¼š</h4><h5 id="5-2-1-cmakeç”Ÿæˆè§„åˆ™ï¼š"><a href="#5-2-1-cmakeç”Ÿæˆè§„åˆ™ï¼š" class="headerlink" title="5.2.1 cmakeç”Ÿæˆè§„åˆ™ï¼š"></a>5.2.1 cmakeç”Ÿæˆè§„åˆ™ï¼š</h5><figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">add_library</span>(åº“åç§° SHARED æºæ–‡ä»¶<span class="number">1</span> [æºæ–‡ä»¶<span class="number">2</span>] ...)</span><br></pre></td></tr></table></figure>

<ul>
<li>åœ¨Linuxä¸­ï¼ŒåŠ¨æ€åº“åå­—åˆ†ä¸ºä¸‰éƒ¨åˆ†ï¼š<code>lib + åº“åå­— + .so</code> ï¼Œç¤ºä¾‹ï¼š<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">add_library</span>(calc SHARED <span class="variable">$&#123;SRC_LIST&#125;</span>)</span><br></pre></td></tr></table></figure>
è¿™æ ·æœ€ç»ˆå°±ä¼šç”Ÿæˆå¯¹åº”çš„åŠ¨æ€åº“æ–‡ä»¶ <code>libcalc.so</code></li>
</ul>
<br>

<h5 id="5-1-2-gccç”Ÿæˆè§„åˆ™ï¼š-1"><a href="#5-1-2-gccç”Ÿæˆè§„åˆ™ï¼š-1" class="headerlink" title="5.1.2 gccç”Ÿæˆè§„åˆ™ï¼š"></a>5.1.2 gccç”Ÿæˆè§„åˆ™ï¼š</h5><ul>
<li>ç”ŸæˆåŠ¨æ€é“¾æ¥åº“æ˜¯ç›´æ¥ä½¿ç”¨<code>gcc</code>å‘½ä»¤å¹¶ä¸”éœ€è¦æ·»åŠ <code>-fPIC(-fpic)</code> ä»¥åŠ<code>-shared</code> å‚æ•°ã€‚<ul>
<li><code>-fPIC</code> æˆ– <code>-fpic</code> å‚æ•°çš„ä½œç”¨æ˜¯ä½¿å¾— <code>gcc</code> ç”Ÿæˆçš„ä»£ç æ˜¯ä¸ä½ç½®æ— å…³çš„ï¼Œä¹Ÿå°±æ˜¯ä½¿ç”¨ç›¸å¯¹ä½ç½®ã€‚</li>
<li><code>-shared</code>å‚æ•°çš„ä½œç”¨æ˜¯å‘Šè¯‰ç¼–è¯‘å™¨ç”Ÿæˆä¸€ä¸ªåŠ¨æ€é“¾æ¥åº“ã€‚</li>
</ul>
</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">1. å°†.cæ±‡ç¼–å¾—åˆ°.o, éœ€è¦é¢å¤–çš„å‚æ•° -fpic/-fPIC</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">gcc -c -fpic add.c div.c mult.c sub.c -I ./include/</span></span><br></pre></td></tr></table></figure>

<ul>
<li>ç”Ÿæˆ <code>.o</code> ç¼–è¯‘æ–‡ä»¶</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æŸ¥çœ‹ç›®å½•æ–‡ä»¶ä¿¡æ¯, æ£€æŸ¥æ˜¯å¦ç”Ÿæˆäº†ç›®æ ‡æ–‡ä»¶</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">tree</span></span><br><span class="line">.</span><br><span class="line">â”œâ”€â”€ add.c</span><br><span class="line">â”œâ”€â”€ add.o                # ç”Ÿæˆçš„ç›®æ ‡æ–‡ä»¶</span><br><span class="line">â”œâ”€â”€ div.c</span><br><span class="line">â”œâ”€â”€ div.o                # ç”Ÿæˆçš„ç›®æ ‡æ–‡ä»¶</span><br><span class="line">â”œâ”€â”€ include</span><br><span class="line">â”‚Â Â  â””â”€â”€ head.h</span><br><span class="line">â”œâ”€â”€ main.c</span><br><span class="line">â”œâ”€â”€ mult.c</span><br><span class="line">â”œâ”€â”€ mult.o               # ç”Ÿæˆçš„ç›®æ ‡æ–‡ä»¶</span><br><span class="line">â”œâ”€â”€ sub.c</span><br><span class="line">â””â”€â”€ sub.o                # ç”Ÿæˆçš„ç›®æ ‡æ–‡ä»¶</span><br></pre></td></tr></table></figure>
<ul>
<li>ä½¿ç”¨<code>gcc</code>å°†å¾—åˆ°çš„ç›®æ ‡æ–‡ä»¶æ‰“åŒ…ç”ŸæˆåŠ¨æ€åº“, éœ€è¦ä½¿ç”¨å‚æ•° <code>-shared</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">2. å°†å¾—åˆ° .o æ‰“åŒ…æˆåŠ¨æ€åº“, ä½¿ç”¨gcc , å‚æ•° -shared</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">gcc -shared add.o div.o mult.o sub.o -o libcalc.so</span>  </span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ£€æŸ¥ç›®å½•ä¸­æ˜¯å¦ç”Ÿæˆäº†åŠ¨æ€åº“</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">tree</span></span><br><span class="line">.</span><br><span class="line">â”œâ”€â”€ add.c</span><br><span class="line">â”œâ”€â”€ add.o</span><br><span class="line">â”œâ”€â”€ div.c</span><br><span class="line">â”œâ”€â”€ div.o</span><br><span class="line">â”œâ”€â”€ include</span><br><span class="line">â”‚Â Â  â””â”€â”€ `head.h   ===&gt; å’ŒåŠ¨æ€åº“ä¸€èµ·å‘å¸ƒ</span><br><span class="line">â”œâ”€â”€ `libcalc.so   ===&gt; ç”Ÿæˆçš„åŠ¨æ€åº“</span><br><span class="line">â”œâ”€â”€ main.c</span><br><span class="line">â”œâ”€â”€ mult.c</span><br><span class="line">â”œâ”€â”€ mult.o</span><br><span class="line">â”œâ”€â”€ sub.c</span><br><span class="line">â””â”€â”€ sub.o</span><br></pre></td></tr></table></figure>

<ul>
<li>å°†ç”Ÿæˆçš„çš„åŠ¨æ€åº“ libcalc.soå’Œåº“å¯¹åº”çš„å¤´æ–‡ä»¶head.hä¸€å¹¶å‘å¸ƒç»™ä½¿ç”¨è€…å°±å¯ä»¥äº†ã€‚</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å‘å¸ƒåº“æ–‡ä»¶å’Œå¤´æ–‡ä»¶</span></span><br><span class="line">	1. head.h</span><br><span class="line">	2. libcalc.so</span><br></pre></td></tr></table></figure>

<h5 id="5-1-3-gccé™æ€åº“çš„ä½¿ç”¨-1"><a href="#5-1-3-gccé™æ€åº“çš„ä½¿ç”¨-1" class="headerlink" title="5.1.3 gccé™æ€åº“çš„ä½¿ç”¨:"></a>5.1.3 gccé™æ€åº“çš„ä½¿ç”¨:</h5><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">1. æ‹¿åˆ°å‘å¸ƒçš„åŠ¨æ€åº“</span></span><br><span class="line">	`head.h   libcalc.so</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">2. åŸºäºå¤´æ–‡ä»¶ç¼–å†™æµ‹è¯•ç¨‹åº, æµ‹è¯•åŠ¨æ€åº“ä¸­æä¾›çš„æ¥å£æ˜¯å¦å¯ç”¨</span></span><br><span class="line">	`main.c`</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ç¤ºä¾‹ç›®å½•:</span></span><br><span class="line">.</span><br><span class="line">â”œâ”€â”€ head.h          ==&gt; å‡½æ•°å£°æ˜</span><br><span class="line">â”œâ”€â”€ libcalc.so      ==&gt; å‡½æ•°å®šä¹‰</span><br><span class="line">â””â”€â”€ main.c          ==&gt; å‡½æ•°æµ‹è¯•</span><br></pre></td></tr></table></figure>

<ul>
<li>ç¼–è¯‘æµ‹è¯•ç¨‹åº, å¾—åˆ°å¯æ‰§è¡Œæ–‡ä»¶ã€‚</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">åœ¨ç¼–è¯‘çš„æ—¶å€™æŒ‡å®šåŠ¨æ€åº“ç›¸å…³çš„ä¿¡æ¯: å¤´æ–‡ä»¶è·¯å¾„-I åº“çš„è·¯å¾„ -L, åº“çš„åå­— -l</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">gcc main.c -o app -I./ -L./ -lcalc</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æŸ¥çœ‹æ˜¯å¦ç”Ÿæˆäº†å¯æ‰§è¡Œç¨‹åº</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">tree</span></span><br><span class="line">.</span><br><span class="line">â”œâ”€â”€ app 			# ç”Ÿæˆçš„å¯æ‰§è¡Œç¨‹åº</span><br><span class="line">â”œâ”€â”€ head.h</span><br><span class="line">â”œâ”€â”€ libcalc.so</span><br><span class="line">â””â”€â”€ main.c</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ‰§è¡Œç”Ÿæˆçš„å¯æ‰§è¡Œç¨‹åº, é”™è¯¯æç¤º ==&gt; å¯æ‰§è¡Œç¨‹åºæ‰§è¡Œçš„æ—¶å€™æ‰¾ä¸åˆ°åŠ¨æ€åº“</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">./app</span> </span><br><span class="line">./app: error while loading shared libraries: libcalc.so: cannot open shared object file: No such file or directory</span><br></pre></td></tr></table></figure>

<p><strong>ä¿®æ”¹è§£å†³åŠ¨æ€åº“é“¾æ¥ç¼–è¯‘é—®é¢˜</strong></p>
<p>æ–¹æ¡ˆ 1: å°†åº“è·¯å¾„æ·»åŠ åˆ°ç¯å¢ƒå˜é‡<code>LD_LIBRARY_PATH</code>ä¸­</p>
<ol>
<li>æ‰¾åˆ°ç›¸å…³çš„é…ç½®æ–‡ä»¶</li>
</ol>
<ul>
<li>ç”¨æˆ·çº§åˆ«: ~&#x2F;.bashrc â€”&gt; è®¾ç½®å¯¹å½“å‰ç”¨æˆ·æœ‰æ•ˆ</li>
<li>ç³»ç»Ÿçº§åˆ«: &#x2F;etc&#x2F;profile â€”&gt; è®¾ç½®å¯¹æ‰€æœ‰ç”¨æˆ·æœ‰æ•ˆ</li>
</ul>
<ol start="2">
<li>ä½¿ç”¨ vim æ‰“å¼€é…ç½®æ–‡ä»¶, åœ¨æ–‡ä»¶æœ€åæ·»åŠ è¿™æ ·ä¸€å¥è¯</li>
</ol>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è‡ªå·±æŠŠè·¯å¾„å†™è¿›å»å°±è¡Œäº†</span></span><br><span class="line">export LD_LIBRARY_PATH =$LD_LIBRARY_PATH :åŠ¨æ€åº“çš„ç»å¯¹è·¯å¾„</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>è®©ä¿®æ”¹çš„é…ç½®æ–‡ä»¶ç”Ÿæ•ˆ</li>
</ol>
<ul>
<li>ä¿®æ”¹äº†ç”¨æˆ·çº§åˆ«çš„é…ç½®æ–‡ä»¶, å…³é—­å½“å‰ç»ˆç«¯, æ‰“å¼€ä¸€ä¸ªæ–°çš„ç»ˆç«¯é…ç½®å°±ç”Ÿæ•ˆäº†</li>
<li>ä¿®æ”¹äº†ç³»ç»Ÿçº§åˆ«çš„é…ç½®æ–‡ä»¶, æ³¨é”€æˆ–å…³é—­ç³»ç»Ÿ, å†å¼€æœºé…ç½®å°±ç”Ÿæ•ˆäº†</li>
<li>ä¸æƒ³æ‰§è¡Œä¸Šè¾¹çš„æ“ä½œ, å¯ä»¥æ‰§è¡Œä¸€ä¸ªå‘½ä»¤è®©é…ç½®é‡æ–°è¢«åŠ è½½</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ä¿®æ”¹çš„æ˜¯å“ªä¸€ä¸ªå°±æ‰§è¡Œå¯¹åº”çš„é‚£ä¸ªå‘½ä»¤</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">source</span> å¯ä»¥ç®€å†™ä¸ºä¸€ä¸ª . , ä½œç”¨æ˜¯è®©æ–‡ä»¶å†…å®¹è¢«é‡æ–°åŠ è½½</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">source</span> ~/.bashrc          (. ~/.bashrc)</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">source</span> /etc/profile       (. /etc/profile)</span></span><br></pre></td></tr></table></figure>

<p>æ–¹æ¡ˆ 2: æ›´æ–° &#x2F;etc&#x2F;ld.so.cache æ–‡ä»¶</p>
<ol>
<li><p>æ‰¾åˆ°åŠ¨æ€åº“æ‰€åœ¨çš„ç»å¯¹è·¯å¾„ï¼ˆä¸åŒ…æ‹¬åº“çš„åå­—ï¼‰æ¯”å¦‚ï¼š&#x2F;home&#x2F;robin&#x2F;Library&#x2F;</p>
</li>
<li><p>ä½¿ç”¨vim ä¿®æ”¹ &#x2F;etc&#x2F;ld.so.conf è¿™ä¸ªæ–‡ä»¶, å°†ä¸Šè¾¹çš„è·¯å¾„æ·»åŠ åˆ°æ–‡ä»¶ä¸­(ç‹¬è‡ªå ä¸€è¡Œ)</p>
</li>
</ol>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">1. æ‰“å¼€æ–‡ä»¶</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">sudo vim /etc/ld.so.conf</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">2. æ·»åŠ åŠ¨æ€åº“è·¯å¾„, å¹¶ä¿å­˜é€€å‡º</span></span><br></pre></td></tr></table></figure>

<ol start="3">
<li>æ›´æ–° &#x2F;etc&#x2F;ld.so.confä¸­çš„æ•°æ®åˆ° &#x2F;etc&#x2F;ld.so.cache ä¸­</li>
</ol>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å¿…é¡»ä½¿ç”¨ç®¡ç†å‘˜æƒé™æ‰§è¡Œè¿™ä¸ªå‘½ä»¤</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">sudo ldconfig</span>   </span><br></pre></td></tr></table></figure>

<p>æ–¹æ¡ˆ 3: æ‹·è´åŠ¨æ€åº“æ–‡ä»¶åˆ°ç³»ç»Ÿåº“ç›®å½• &#x2F;lib&#x2F; æˆ–è€… &#x2F;usr&#x2F;lib ä¸­ (æˆ–è€…å°†åº“çš„è½¯é“¾æ¥æ–‡ä»¶æ”¾è¿›å»)</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">åº“æ‹·è´</span></span><br><span class="line">sudo cp /xxx/xxx/libxxx.so /usr/lib</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">åˆ›å»ºè½¯è¿æ¥</span></span><br><span class="line">sudo ln -s /xxx/xxx/libxxx.so /usr/lib/libxxx.so</span><br></pre></td></tr></table></figure>

<p>éªŒè¯æ‰§è¡Œå‘½ä»¤ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è¯­æ³•:</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">ldd å¯æ‰§è¡Œç¨‹åºå</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ä¸¾ä¾‹:</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">ldd app</span></span><br><span class="line">	linux-vdso.so.1 =&gt;  (0x00007ffe8fbd6000)</span><br><span class="line">    libcalc.so =&gt; /home/robin/Linux/3Day/calc/test/libcalc.so (0x00007f5d85dd4000)</span><br><span class="line">    libc.so.6 =&gt; /lib/x86_64-linux-gnu/libc.so.6 (0x00007f5d85a0a000)</span><br><span class="line">    /lib64/ld-linux-x86-64.so.2 (0x00007f5d85fd6000)  ==&gt; åŠ¨æ€é“¾æ¥å™¨, æ“ä½œç³»ç»Ÿæä¾›</span><br></pre></td></tr></table></figure>

<br>

<h4 id="5-3-æŒ‡å®šè¾“å‡ºçš„è·¯å¾„ï¼š"><a href="#5-3-æŒ‡å®šè¾“å‡ºçš„è·¯å¾„ï¼š" class="headerlink" title="5.3 æŒ‡å®šè¾“å‡ºçš„è·¯å¾„ï¼š"></a>5.3 æŒ‡å®šè¾“å‡ºçš„è·¯å¾„ï¼š</h4><ul>
<li><p>æ–¹å¼1 - é€‚ç”¨äºåŠ¨æ€åº“</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">set</span>(EXECUTABLE_OUTPUT_PATH <span class="variable">$&#123;PROJECT_SOURCE_DIR&#125;</span>/lib)</span><br></pre></td></tr></table></figure>
</li>
<li><p>æ–¹å¼2 - éƒ½é€‚ç”¨</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="comment"># è®¾ç½®åŠ¨æ€åº“/é™æ€åº“ç”Ÿæˆè·¯å¾„</span></span><br><span class="line"><span class="keyword">set</span>(LIBRARY_OUTPUT_PATH <span class="variable">$&#123;PROJECT_SOURCE_DIR&#125;</span>/lib)</span><br></pre></td></tr></table></figure></li>
</ul>
<br>

<h4 id="5-4-åŒ…å«åº“æ–‡ä»¶ï¼š"><a href="#5-4-åŒ…å«åº“æ–‡ä»¶ï¼š" class="headerlink" title="5.4 åŒ…å«åº“æ–‡ä»¶ï¼š"></a>5.4 åŒ…å«åº“æ–‡ä»¶ï¼š</h4><h5 id="5-4-1-é“¾æ¥é™æ€åº“ï¼š"><a href="#5-4-1-é“¾æ¥é™æ€åº“ï¼š" class="headerlink" title="5.4.1 é“¾æ¥é™æ€åº“ï¼š"></a>5.4.1 é“¾æ¥é™æ€åº“ï¼š</h5><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">src</span><br><span class="line">â”œâ”€â”€ add.cpp</span><br><span class="line">â”œâ”€â”€ div.cpp</span><br><span class="line">â”œâ”€â”€ main.cpp</span><br><span class="line">â”œâ”€â”€ mult.cpp</span><br><span class="line">â””â”€â”€ sub.cpp</span><br></pre></td></tr></table></figure>
<p>ç°åœ¨æˆ‘ä»¬æŠŠä¸Šé¢<code>src</code>ç›®å½•ä¸­çš„<code>add.cpp</code>ã€<code>div.cpp</code>ã€<code>mult.cpp</code>ã€<code>sub.cpp</code>ç¼–è¯‘æˆä¸€ä¸ªé™æ€åº“æ–‡ä»¶<code>libcalc.a</code>ã€‚é€šè¿‡å‘½ä»¤åˆ¶ä½œå¹¶ä½¿ç”¨é™æ€é“¾æ¥åº“ã€‚</p>
<p>æµ‹è¯•ç›®å½•ç»“æ„å¦‚ä¸‹ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">tree</span> </span><br><span class="line">.</span><br><span class="line">â”œâ”€â”€ build</span><br><span class="line">â”œâ”€â”€ CMakeLists.txt</span><br><span class="line">â”œâ”€â”€ include</span><br><span class="line">â”‚Â Â  â””â”€â”€ head.h</span><br><span class="line">â”œâ”€â”€ lib</span><br><span class="line">â”‚Â Â  â””â”€â”€ libcalc.a     # åˆ¶ä½œå‡ºçš„é™æ€åº“çš„åå­—</span><br><span class="line">â””â”€â”€ src</span><br><span class="line">    â””â”€â”€ main.cpp</span><br><span class="line"></span><br><span class="line">4 directories, 4 files</span><br></pre></td></tr></table></figure>

<p>åœ¨cmakeä¸­ï¼Œé“¾æ¥é™æ€åº“çš„å‘½ä»¤å¦‚ä¸‹ï¼š</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">link_libraries</span>(&lt;static lib&gt; [&lt;static lib&gt;...])</span><br></pre></td></tr></table></figure>

<ul>
<li>å‚æ•°1ï¼šæŒ‡å®šå‡ºè¦é“¾æ¥çš„é™æ€åº“çš„åå­—<ul>
<li>å¯ä»¥æ˜¯å…¨å libxxx.a</li>
<li>ä¹Ÿå¯ä»¥æ˜¯æå¤´ï¼ˆlibï¼‰å»å°¾ï¼ˆ.aï¼‰ä¹‹åçš„åå­— xxx</li>
</ul>
</li>
<li>å‚æ•°2-Nï¼šè¦é“¾æ¥çš„å…¶å®ƒé™æ€åº“çš„åå­—</li>
</ul>
<p>å¦‚æœè¯¥é™æ€åº“ä¸æ˜¯ç³»ç»Ÿæä¾›çš„ï¼ˆè‡ªå·±åˆ¶ä½œæˆ–è€…ä½¿ç”¨ç¬¬ä¸‰æ–¹æä¾›çš„é™æ€åº“ï¼‰å¯èƒ½å‡ºç°é™æ€åº“æ‰¾ä¸åˆ°çš„æƒ…å†µï¼Œæ­¤æ—¶å¯ä»¥å°†é™æ€åº“çš„è·¯å¾„ä¹ŸæŒ‡å®šå‡ºæ¥ï¼š</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">link_directories</span>(&lt;lib path&gt;)</span><br></pre></td></tr></table></figure>

<p>è¿™æ ·ï¼Œä¿®æ”¹ä¹‹åçš„CMakeLists.txtæ–‡ä»¶å†…å®¹å¦‚ä¸‹:</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">cmake_minimum_required</span>(VERSION <span class="number">3.0</span>)</span><br><span class="line"><span class="keyword">project</span>(CALC)</span><br><span class="line"><span class="comment"># æœç´¢æŒ‡å®šç›®å½•ä¸‹æºæ–‡ä»¶</span></span><br><span class="line"><span class="keyword">file</span>(GLOB SRC_LIST <span class="variable">$&#123;CMAKE_CURRENT_SOURCE_DIR&#125;</span>/src/*.cpp)</span><br><span class="line"><span class="comment"># åŒ…å«å¤´æ–‡ä»¶è·¯å¾„</span></span><br><span class="line"><span class="keyword">include_directories</span>(<span class="variable">$&#123;PROJECT_SOURCE_DIR&#125;</span>/<span class="keyword">include</span>)</span><br><span class="line"><span class="comment"># åŒ…å«é™æ€åº“è·¯å¾„</span></span><br><span class="line"><span class="keyword">link_directories</span>(<span class="variable">$&#123;PROJECT_SOURCE_DIR&#125;</span>/lib)</span><br><span class="line"><span class="comment"># é“¾æ¥é™æ€åº“</span></span><br><span class="line"><span class="keyword">link_libraries</span>(calc)</span><br><span class="line"><span class="keyword">add_executable</span>(app <span class="variable">$&#123;SRC_LIST&#125;</span>)</span><br></pre></td></tr></table></figure>
<br>

<h5 id="5-4-2-é“¾æ¥åŠ¨æ€åº“ï¼š"><a href="#5-4-2-é“¾æ¥åŠ¨æ€åº“ï¼š" class="headerlink" title="5.4.2 é“¾æ¥åŠ¨æ€åº“ï¼š"></a>5.4.2 é“¾æ¥åŠ¨æ€åº“ï¼š</h5><p>åŠ¨æ€åº“çš„é“¾æ¥å’Œé™æ€åº“æ˜¯å®Œå…¨ä¸åŒçš„ï¼š</p>
<ul>
<li>é™æ€åº“ä¼šåœ¨ç”Ÿæˆå¯æ‰§è¡Œç¨‹åºçš„é“¾æ¥é˜¶æ®µè¢«æ‰“åŒ…åˆ°å¯æ‰§è¡Œç¨‹åºä¸­ï¼Œæ‰€ä»¥å¯æ‰§è¡Œç¨‹åºå¯åŠ¨ï¼Œé™æ€åº“å°±è¢«åŠ è½½åˆ°å†…å­˜ä¸­äº†ã€‚</li>
<li>åŠ¨æ€åº“åœ¨ç”Ÿæˆå¯æ‰§è¡Œç¨‹åºçš„é“¾æ¥é˜¶æ®µä¸ä¼šè¢«æ‰“åŒ…åˆ°å¯æ‰§è¡Œç¨‹åºä¸­ï¼Œå½“å¯æ‰§è¡Œç¨‹åºè¢«å¯åŠ¨å¹¶ä¸”è°ƒç”¨äº†åŠ¨æ€åº“ä¸­çš„å‡½æ•°çš„æ—¶å€™ï¼ŒåŠ¨æ€åº“æ‰ä¼šè¢«åŠ è½½åˆ°å†…å­˜</li>
</ul>
<p>å› æ­¤ï¼Œåœ¨<code>cmake</code>ä¸­æŒ‡å®šè¦é“¾æ¥çš„åŠ¨æ€åº“çš„æ—¶å€™ï¼Œ<code>åº”è¯¥å°†å‘½ä»¤å†™åˆ°ç”Ÿæˆäº†å¯æ‰§è¡Œæ–‡ä»¶ä¹‹å</code>ï¼š</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">cmake_minimum_required</span>(VERSION <span class="number">3.0</span>)</span><br><span class="line"><span class="keyword">project</span>(<span class="keyword">TEST</span>)</span><br><span class="line"><span class="keyword">file</span>(GLOB SRC_LIST <span class="variable">$&#123;CMAKE_CURRENT_SOURCE_DIR&#125;</span>/*.cpp)</span><br><span class="line"><span class="comment"># æ·»åŠ å¹¶æŒ‡å®šæœ€ç»ˆç”Ÿæˆçš„å¯æ‰§è¡Œç¨‹åºå</span></span><br><span class="line"><span class="keyword">add_executable</span>(app <span class="variable">$&#123;SRC_LIST&#125;</span>)</span><br><span class="line"><span class="comment"># æŒ‡å®šå¯æ‰§è¡Œç¨‹åºè¦é“¾æ¥çš„åŠ¨æ€åº“åå­—</span></span><br><span class="line"><span class="keyword">target_link_libraries</span>(app pthread)</span><br></pre></td></tr></table></figure>

<p>åœ¨<code>target_link_libraries(app pthread)</code>ä¸­ï¼š</p>
<ul>
<li><code>app</code>: å¯¹åº”çš„æ˜¯æœ€ç»ˆç”Ÿæˆçš„å¯æ‰§è¡Œç¨‹åºçš„åå­—</li>
<li><code>pthread</code>ï¼šè¿™æ˜¯å¯æ‰§è¡Œç¨‹åºè¦åŠ è½½çš„åŠ¨æ€åº“ï¼Œè¿™ä¸ªåº“æ˜¯ç³»ç»Ÿæä¾›çš„çº¿ç¨‹åº“ï¼Œå…¨åä¸º<code>libpthread.so</code>ï¼Œåœ¨æŒ‡å®šçš„æ—¶å€™ä¸€èˆ¬ä¼šæå¤´<code>ï¼ˆlibï¼‰</code>å»å°¾<code>ï¼ˆ.soï¼‰</code>ã€‚</li>
</ul>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">cmake_minimum_required</span>(VERSION <span class="number">3.0</span>)</span><br><span class="line"><span class="keyword">project</span>(<span class="keyword">TEST</span>)</span><br><span class="line"><span class="keyword">file</span>(GLOB SRC_LIST <span class="variable">$&#123;CMAKE_CURRENT_SOURCE_DIR&#125;</span>/*.cpp)</span><br><span class="line"><span class="keyword">include_directories</span>(<span class="variable">$&#123;PROJECT_SOURCE_DIR&#125;</span>/<span class="keyword">include</span>)</span><br><span class="line"><span class="keyword">add_executable</span>(app <span class="variable">$&#123;SRC_LIST&#125;</span>)</span><br><span class="line"><span class="keyword">target_link_libraries</span>(app pthread calc)</span><br></pre></td></tr></table></figure>

<p>åœ¨ç¬¬å…­è¡Œä¸­ï¼Œpthreadã€calcéƒ½æ˜¯å¯æ‰§è¡Œç¨‹åºappè¦é“¾æ¥çš„åŠ¨æ€åº“çš„åå­—ã€‚å½“å¯æ‰§è¡Œç¨‹åºappç”Ÿæˆä¹‹åå¹¶æ‰§è¡Œè¯¥æ–‡ä»¶ï¼Œä¼šæç¤ºæœ‰å¦‚ä¸‹é”™è¯¯ä¿¡æ¯ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">./app</span> </span><br><span class="line">./app: error while loading shared libraries: libcalc.so: cannot open shared object file: No such file or directory</span><br></pre></td></tr></table></figure>

<p>åœ¨ <code>CMake</code> ä¸­å¯ä»¥åœ¨ç”Ÿæˆå¯æ‰§è¡Œç¨‹åºä¹‹å‰ï¼Œé€šè¿‡å‘½ä»¤æŒ‡å®šå‡ºè¦é“¾æ¥çš„åŠ¨æ€åº“çš„ä½ç½®ï¼ŒæŒ‡å®šé™æ€åº“ä½ç½®ä½¿ç”¨çš„ä¹Ÿæ˜¯è¿™ä¸ªå‘½ä»¤ï¼š</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">link_directories</span>(path)</span><br></pre></td></tr></table></figure>

<p>æ‰€ä»¥ä¿®æ”¹ä¹‹åçš„CMakeLists.txtæ–‡ä»¶åº”è¯¥æ˜¯è¿™æ ·çš„ï¼š</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">cmake_minimum_required</span>(VERSION <span class="number">3.0</span>)</span><br><span class="line"><span class="keyword">project</span>(<span class="keyword">TEST</span>)</span><br><span class="line"><span class="keyword">file</span>(GLOB SRC_LIST <span class="variable">$&#123;CMAKE_CURRENT_SOURCE_DIR&#125;</span>/*.cpp)</span><br><span class="line"><span class="comment"># æŒ‡å®šæºæ–‡ä»¶æˆ–è€…åŠ¨æ€åº“å¯¹åº”çš„å¤´æ–‡ä»¶è·¯å¾„</span></span><br><span class="line"><span class="keyword">include_directories</span>(<span class="variable">$&#123;PROJECT_SOURCE_DIR&#125;</span>/<span class="keyword">include</span>)</span><br><span class="line"><span class="comment"># æŒ‡å®šè¦é“¾æ¥çš„åŠ¨æ€åº“çš„è·¯å¾„</span></span><br><span class="line"><span class="keyword">link_directories</span>(<span class="variable">$&#123;PROJECT_SOURCE_DIR&#125;</span>/lib)</span><br><span class="line"><span class="comment"># æ·»åŠ å¹¶ç”Ÿæˆä¸€ä¸ªå¯æ‰§è¡Œç¨‹åº</span></span><br><span class="line"><span class="keyword">add_executable</span>(app <span class="variable">$&#123;SRC_LIST&#125;</span>)</span><br><span class="line"><span class="comment"># æŒ‡å®šè¦é“¾æ¥çš„åŠ¨æ€åº“</span></span><br><span class="line"><span class="keyword">target_link_libraries</span>(app pthread calc)</span><br></pre></td></tr></table></figure>

<p>é€šè¿‡link_directoriesæŒ‡å®šäº†åŠ¨æ€åº“çš„è·¯å¾„ä¹‹åï¼Œåœ¨æ‰§è¡Œç”Ÿæˆçš„å¯æ‰§è¡Œç¨‹åºçš„æ—¶å€™ï¼Œå°±ä¸ä¼šå‡ºç°æ‰¾ä¸åˆ°åŠ¨æ€åº“çš„é—®é¢˜äº†ã€‚</p>
<p><strong>æ¸©é¦¨æç¤ºï¼šä½¿ç”¨Â target_link_libraries å‘½ä»¤å°±å¯ä»¥é“¾æ¥åŠ¨æ€åº“ï¼Œä¹Ÿå¯ä»¥é“¾æ¥é™æ€åº“æ–‡ä»¶ã€‚</strong></p>
<br>

<h3 id="6-æ—¥å¿—"><a href="#6-æ—¥å¿—" class="headerlink" title="6. æ—¥å¿—"></a>6. æ—¥å¿—</h3><p>åœ¨<code>CMake</code>ä¸­å¯ä»¥ç”¨ç”¨æˆ·æ˜¾ç¤ºä¸€æ¡æ¶ˆæ¯ï¼Œè¯¥å‘½ä»¤çš„åå­—ä¸º<code>message</code>ï¼š</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">message</span>([STATUS|WARNING|AUTHOR_WARNING|FATAL_ERROR|SEND_ERROR] <span class="string">&quot;message to display&quot;</span> ...)</span><br></pre></td></tr></table></figure>

<ul>
<li><code>(æ— )</code> ï¼šé‡è¦æ¶ˆæ¯</li>
<li><code>STATUS</code> ï¼šéé‡è¦æ¶ˆæ¯</li>
<li><code>WARNING</code>ï¼šCMake è­¦å‘Š, ä¼šç»§ç»­æ‰§è¡Œ</li>
<li><code>AUTHOR_WARNING</code>ï¼šCMake è­¦å‘Š (dev), ä¼šç»§ç»­æ‰§è¡Œ</li>
<li><code>SEND_ERROR</code>ï¼šCMake é”™è¯¯, ç»§ç»­æ‰§è¡Œï¼Œä½†æ˜¯ä¼šè·³è¿‡ç”Ÿæˆçš„æ­¥éª¤</li>
<li><code>FATAL_ERROR</code>ï¼šCMake é”™è¯¯, ç»ˆæ­¢æ‰€æœ‰å¤„ç†è¿‡ç¨‹</li>
</ul>
<p><code>CMake</code>çš„å‘½ä»¤è¡Œå·¥å…·ä¼šåœ¨<code>stdout</code>ä¸Šæ˜¾ç¤ºS<code>TATUS</code>æ¶ˆæ¯ï¼Œåœ¨<code>stderr</code>ä¸Šæ˜¾ç¤ºå…¶ä»–æ‰€æœ‰æ¶ˆæ¯ã€‚<code>CMake</code>çš„<code>GUI</code>ä¼šåœ¨å®ƒçš„<code>log</code>åŒºåŸŸæ˜¾ç¤ºæ‰€æœ‰æ¶ˆæ¯ã€‚</p>
<p><code>CMake</code>è­¦å‘Šå’Œé”™è¯¯æ¶ˆæ¯çš„æ–‡æœ¬æ˜¾ç¤ºä½¿ç”¨çš„æ˜¯ä¸€ç§ç®€å•çš„æ ‡è®°è¯­è¨€ã€‚æ–‡æœ¬æ²¡æœ‰ç¼©è¿›ï¼Œè¶…è¿‡é•¿åº¦çš„è¡Œä¼šå›å·ï¼Œæ®µè½ä¹‹é—´ä»¥æ–°è¡Œåšä¸ºåˆ†éš”ç¬¦ã€‚</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="comment"># è¾“å‡ºä¸€èˆ¬æ—¥å¿—ä¿¡æ¯</span></span><br><span class="line"><span class="keyword">message</span>(STATUS <span class="string">&quot;source path: $&#123;PROJECT_SOURCE_DIR&#125;&quot;</span>)</span><br><span class="line"><span class="comment"># è¾“å‡ºè­¦å‘Šä¿¡æ¯</span></span><br><span class="line"><span class="keyword">message</span>(WARNING <span class="string">&quot;source path: $&#123;PROJECT_SOURCE_DIR&#125;&quot;</span>)</span><br><span class="line"><span class="comment"># è¾“å‡ºé”™è¯¯ä¿¡æ¯</span></span><br><span class="line"><span class="keyword">message</span>(FATAL_ERROR <span class="string">&quot;source path: $&#123;PROJECT_SOURCE_DIR&#125;&quot;</span>)</span><br></pre></td></tr></table></figure>

<br>

<h3 id="7-å˜é‡æ“ä½œ"><a href="#7-å˜é‡æ“ä½œ" class="headerlink" title="7. å˜é‡æ“ä½œ"></a>7. å˜é‡æ“ä½œ</h3><h4 id="7-1-è¿½åŠ "><a href="#7-1-è¿½åŠ " class="headerlink" title="7.1 è¿½åŠ "></a>7.1 è¿½åŠ </h4><p>æœ‰æ—¶å€™é¡¹ç›®ä¸­çš„æºæ–‡ä»¶å¹¶ä¸ä¸€å®šéƒ½åœ¨åŒä¸€ä¸ªç›®å½•ä¸­ï¼Œä½†æ˜¯è¿™äº›æºæ–‡ä»¶æœ€ç»ˆå´éœ€è¦ä¸€èµ·è¿›è¡Œç¼–è¯‘æ¥ç”Ÿæˆæœ€ç»ˆçš„å¯æ‰§è¡Œæ–‡ä»¶æˆ–è€…åº“æ–‡ä»¶ã€‚å¦‚æœæˆ‘ä»¬é€šè¿‡<code>file</code>å‘½ä»¤å¯¹å„ä¸ªç›®å½•ä¸‹çš„æºæ–‡ä»¶è¿›è¡Œæœç´¢ï¼Œæœ€åè¿˜éœ€è¦åšä¸€ä¸ªå­—ç¬¦ä¸²æ‹¼æ¥çš„æ“ä½œï¼Œå…³äºå­—ç¬¦ä¸²æ‹¼æ¥å¯ä»¥ä½¿ç”¨<code>set</code>å‘½ä»¤ä¹Ÿå¯ä»¥ä½¿ç”¨<code>list</code>å‘½ä»¤ã€‚</p>
<br>

<h5 id="7-1-1-ä½¿ç”¨setæ‹¼æ¥"><a href="#7-1-1-ä½¿ç”¨setæ‹¼æ¥" class="headerlink" title="7.1.1 ä½¿ç”¨setæ‹¼æ¥"></a>7.1.1 ä½¿ç”¨setæ‹¼æ¥</h5><p>å¦‚æœä½¿ç”¨<code>set</code>è¿›è¡Œå­—ç¬¦ä¸²æ‹¼æ¥ï¼Œå¯¹åº”çš„å‘½ä»¤æ ¼å¼å¦‚ä¸‹ï¼š</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">set</span>(å˜é‡å<span class="number">1</span> <span class="variable">$&#123;å˜é‡å1&#125;</span> <span class="variable">$&#123;å˜é‡å2&#125;</span> ...)</span><br></pre></td></tr></table></figure>

<p>å…³äºä¸Šé¢çš„å‘½ä»¤å…¶å®å°±æ˜¯å°†ä»ç¬¬äºŒä¸ªå‚æ•°å¼€å§‹å¾€åæ‰€æœ‰çš„å­—ç¬¦ä¸²è¿›è¡Œæ‹¼æ¥ï¼Œæœ€åå°†ç»“æœå­˜å‚¨åˆ°ç¬¬ä¸€ä¸ªå‚æ•°ä¸­ï¼Œå¦‚æœç¬¬ä¸€ä¸ªå‚æ•°ä¸­åŸæ¥æœ‰æ•°æ®ä¼šå¯¹åŸæ•°æ®å°±è¡Œè¦†ç›–ã€‚</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">cmake_minimum_required</span>(VERSION <span class="number">3.0</span>)</span><br><span class="line"><span class="keyword">project</span>(<span class="keyword">TEST</span>)</span><br><span class="line"><span class="keyword">set</span>(TEMP <span class="string">&quot;hello,world&quot;</span>)</span><br><span class="line"><span class="keyword">file</span>(GLOB SRC_1 <span class="variable">$&#123;PROJECT_SOURCE_DIR&#125;</span>/src1/*.cpp)</span><br><span class="line"><span class="keyword">file</span>(GLOB SRC_2 <span class="variable">$&#123;PROJECT_SOURCE_DIR&#125;</span>/src2/*.cpp)</span><br><span class="line"><span class="comment"># è¿½åŠ (æ‹¼æ¥)</span></span><br><span class="line"><span class="keyword">set</span>(SRC_1 <span class="variable">$&#123;SRC_1&#125;</span> <span class="variable">$&#123;SRC_2&#125;</span> <span class="variable">$&#123;TEMP&#125;</span>)</span><br><span class="line"><span class="keyword">message</span>(STATUS <span class="string">&quot;message: $&#123;SRC_1&#125;&quot;</span>)</span><br></pre></td></tr></table></figure>

<br>

<h5 id="7-1-2-ä½¿ç”¨listæ‹¼æ¥"><a href="#7-1-2-ä½¿ç”¨listæ‹¼æ¥" class="headerlink" title="7.1.2 ä½¿ç”¨listæ‹¼æ¥"></a>7.1.2 ä½¿ç”¨listæ‹¼æ¥</h5><p><code>list</code>å‘½ä»¤çš„åŠŸèƒ½æ¯”<code>set</code>è¦å¼ºå¤§ï¼Œå­—ç¬¦ä¸²æ‹¼æ¥åªæ˜¯å®ƒçš„å…¶ä¸­ä¸€ä¸ªåŠŸèƒ½ï¼Œæ‰€ä»¥éœ€è¦åœ¨å®ƒç¬¬ä¸€ä¸ªå‚æ•°çš„ä½ç½®æŒ‡å®šå‡ºæˆ‘ä»¬è¦åšçš„æ“ä½œï¼Œ<code>APPEND</code>è¡¨ç¤ºè¿›è¡Œæ•°æ®è¿½åŠ ï¼Œåè¾¹çš„å‚æ•°å’Œ<code>set</code>å°±ä¸€æ ·äº†ã€‚</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">list</span>(APPEND &lt;<span class="keyword">list</span>&gt; [&lt;element&gt; ...])</span><br></pre></td></tr></table></figure>

<br>

<h4 id="7-2-å­—ç¬¦ä¸²ç§»é™¤"><a href="#7-2-å­—ç¬¦ä¸²ç§»é™¤" class="headerlink" title="7.2 å­—ç¬¦ä¸²ç§»é™¤"></a>7.2 å­—ç¬¦ä¸²ç§»é™¤</h4><p>ä½¿ç”¨<code>list</code>å‘½ä»¤ï¼Œ<code>REMOVE_ITEM</code>è¡¨ç¤ºå¯¹æ•°æ®è¿›è¡Œç§»é™¤</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">list</span>(REMOVE_ITEM &lt;<span class="keyword">list</span>&gt; &lt;value&gt; [&lt;value&gt; ...])</span><br></pre></td></tr></table></figure>

<p>ä¾‹å­ï¼š</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">cmake_minimum_required</span>(VERSION <span class="number">3.0</span>)</span><br><span class="line"><span class="keyword">project</span>(<span class="keyword">TEST</span>)</span><br><span class="line"><span class="keyword">set</span>(TEMP <span class="string">&quot;hello,world&quot;</span>)</span><br><span class="line"><span class="keyword">file</span>(GLOB SRC_1 <span class="variable">$&#123;PROJECT_SOURCE_DIR&#125;</span>/*.cpp)</span><br><span class="line"><span class="comment"># ç§»é™¤å‰æ—¥å¿—</span></span><br><span class="line"><span class="keyword">message</span>(STATUS <span class="string">&quot;message: $&#123;SRC_1&#125;&quot;</span>)</span><br><span class="line"><span class="comment"># ç§»é™¤ main.cpp</span></span><br><span class="line"><span class="keyword">list</span>(REMOVE_ITEM SRC_1 <span class="variable">$&#123;PROJECT_SOURCE_DIR&#125;</span>/main.cpp)</span><br><span class="line"><span class="comment"># ç§»é™¤åæ—¥å¿—</span></span><br><span class="line"><span class="keyword">message</span>(STATUS <span class="string">&quot;message: $&#123;SRC_1&#125;&quot;</span>)</span><br></pre></td></tr></table></figure>

<br>

<h3 id="8-å®å®šä¹‰"><a href="#8-å®å®šä¹‰" class="headerlink" title="8. å®å®šä¹‰"></a>8. å®å®šä¹‰</h3><p>åœ¨<code>CMake</code>ä¸­ï¼Œå¯¹åº”çš„å‘½ä»¤å«åš<code>add_definitions</code>:</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">add_definitions</span>(-Då®åç§°)</span><br></pre></td></tr></table></figure>

<p>ä¾‹å­ï¼š</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">cmake_minimum_required</span>(VERSION <span class="number">3.0</span>)</span><br><span class="line"><span class="keyword">project</span>(<span class="keyword">TEST</span>)</span><br><span class="line"><span class="comment"># è‡ªå®šä¹‰ DEBUG å®</span></span><br><span class="line"><span class="keyword">add_definitions</span>(-DDEBUG)</span><br><span class="line"><span class="keyword">add_executable</span>(app ./<span class="keyword">test</span>.c)</span><br></pre></td></tr></table></figure>

<br>

<h3 id="9-é¢„å®šä¹‰å®"><a href="#9-é¢„å®šä¹‰å®" class="headerlink" title="9. é¢„å®šä¹‰å®"></a>9. é¢„å®šä¹‰å®</h3><p>ä¸‹é¢çš„åˆ—è¡¨ä¸­ä¸ºå¤§å®¶æ•´ç†äº†ä¸€äº›<code>CMake</code>ä¸­å¸¸ç”¨çš„å®ï¼š</p>
<table>
<thead>
<tr>
<th>å®</th>
<th>åŠŸèƒ½</th>
</tr>
</thead>
<tbody><tr>
<td>PROJECT_SOURCE_DIR</td>
<td>ä½¿ç”¨<code>cmake</code>å‘½ä»¤åç´§è·Ÿçš„ç›®å½•ï¼Œä¸€èˆ¬æ˜¯å·¥ç¨‹çš„æ ¹ç›®å½•</td>
</tr>
<tr>
<td>PROJECT_BINARY_DIR</td>
<td>æ‰§è¡Œ<code>cmake</code>å‘½ä»¤çš„ç›®å½•</td>
</tr>
<tr>
<td>CMAKE_CURRENT_SOURCE_DIR</td>
<td>å½“å‰å¤„ç†çš„<code>CMakeLists.txt</code>æ‰€åœ¨çš„è·¯å¾„</td>
</tr>
<tr>
<td>CMAKE_CURRENT_BINARY_DIR</td>
<td><code>target</code> ç¼–è¯‘ç›®å½•</td>
</tr>
<tr>
<td>EXECUTABLE_OUTPUT_PATH</td>
<td>é‡æ–°å®šä¹‰ç›®æ ‡äºŒè¿›åˆ¶å¯æ‰§è¡Œæ–‡ä»¶çš„å­˜æ”¾ä½ç½®</td>
</tr>
<tr>
<td>LIBRARY_OUTPUT_PATH</td>
<td>é‡æ–°å®šä¹‰ç›®æ ‡é“¾æ¥åº“æ–‡ä»¶çš„å­˜æ”¾ä½ç½®</td>
</tr>
<tr>
<td>PROJECT_NAME</td>
<td>è¿”å›é€šè¿‡<code>PROJECT</code>æŒ‡ä»¤å®šä¹‰çš„é¡¹ç›®åç§°</td>
</tr>
<tr>
<td>CMAKE_BINARY_DIR</td>
<td>é¡¹ç›®å®é™…æ„å»ºè·¯å¾„ï¼Œå‡è®¾åœ¨<code>build</code>ç›®å½•è¿›è¡Œçš„æ„å»ºï¼Œé‚£ä¹ˆå¾—åˆ°çš„å°±æ˜¯è¿™ä¸ªç›®å½•çš„è·¯å¾„</td>
</tr>
</tbody></table>
<br>

<h3 id="10-åµŒå¥—çš„CMake"><a href="#10-åµŒå¥—çš„CMake" class="headerlink" title="10. åµŒå¥—çš„CMake"></a>10. åµŒå¥—çš„CMake</h3><p>å¦‚æœé¡¹ç›®å¾ˆå¤§ï¼Œæˆ–è€…é¡¹ç›®ä¸­æœ‰å¾ˆå¤šçš„æºç ç›®å½•ï¼Œåœ¨é€šè¿‡CMakeç®¡ç†é¡¹ç›®çš„æ—¶å€™å¦‚æœåªä½¿ç”¨ä¸€ä¸ªCMakeLists.txtï¼Œé‚£ä¹ˆè¿™ä¸ªæ–‡ä»¶ç›¸å¯¹ä¼šæ¯”è¾ƒå¤æ‚ï¼Œæœ‰ä¸€ç§åŒ–ç¹ä¸ºç®€çš„æ–¹å¼å°±æ˜¯ç»™æ¯ä¸ªæºç ç›®å½•éƒ½æ·»åŠ ä¸€ä¸ªCMakeLists.txtæ–‡ä»¶ï¼ˆå¤´æ–‡ä»¶ç›®å½•ä¸éœ€è¦ï¼‰ï¼Œè¿™æ ·æ¯ä¸ªæ–‡ä»¶éƒ½ä¸ä¼šå¤ªå¤æ‚ï¼Œè€Œä¸”æ›´çµæ´»ï¼Œæ›´å®¹æ˜“ç»´æŠ¤ã€‚</p>
<p>å…ˆæ¥çœ‹ä¸€ä¸‹ä¸‹é¢çš„è¿™ä¸ªçš„ç›®å½•ç»“æ„ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">tree</span></span><br><span class="line">.</span><br><span class="line">â”œâ”€â”€ build</span><br><span class="line">â”œâ”€â”€ calc</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ add.c</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ CMakeLists.txt</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ div.c</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ mult.c</span><br><span class="line">â”‚Â Â  â””â”€â”€ sub.c</span><br><span class="line">â”œâ”€â”€ CMakeLists.txt</span><br><span class="line">â”œâ”€â”€ include</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ calc.h</span><br><span class="line">â”‚Â Â  â””â”€â”€ sort.h</span><br><span class="line">â”œâ”€â”€ sort</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ CMakeLists.txt</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ insert.c</span><br><span class="line">â”‚Â Â  â””â”€â”€ select.c</span><br><span class="line">â”œâ”€â”€ test1</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ calc.cpp</span><br><span class="line">â”‚Â Â  â””â”€â”€ CMakeLists.txt</span><br><span class="line">â””â”€â”€ test2</span><br><span class="line">    â”œâ”€â”€ CMakeLists.txt</span><br><span class="line">    â””â”€â”€ sort.c</span><br><span class="line"></span><br><span class="line">6 directories, 15 files</span><br></pre></td></tr></table></figure>

<ul>
<li><code>include ç›®å½•</code>ï¼šå¤´æ–‡ä»¶ç›®å½•</li>
<li><code>calc ç›®å½•</code>ï¼šç›®å½•ä¸­çš„å››ä¸ªæºæ–‡ä»¶å¯¹åº”çš„åŠ ã€å‡ã€ä¹˜ã€é™¤ç®—æ³•<ul>
<li>å¯¹åº”çš„å¤´æ–‡ä»¶æ˜¯<code>include</code>ä¸­çš„<code>calc.h</code></li>
</ul>
</li>
<li><code>sort ç›®å½•</code> ï¼šç›®å½•ä¸­çš„ä¸¤ä¸ªæºæ–‡ä»¶å¯¹åº”çš„æ˜¯æ’å…¥æ’åºå’Œé€‰æ‹©æ’åºç®—æ³•<ul>
<li>å¯¹åº”çš„å¤´æ–‡ä»¶æ˜¯i<code>nclude</code>ä¸­çš„<code>sort.h</code></li>
</ul>
</li>
<li><code>test1 ç›®å½•</code>ï¼šæµ‹è¯•ç›®å½•ï¼Œå¯¹åŠ ã€å‡ã€ä¹˜ã€é™¤ç®—æ³•è¿›è¡Œæµ‹è¯•</li>
<li><code>test2 ç›®å½•</code>ï¼šæµ‹è¯•ç›®å½•ï¼Œå¯¹æ’åºç®—æ³•è¿›è¡Œæµ‹è¯•</li>
</ul>
<p>å¯ä»¥çœ‹åˆ°å„ä¸ªæºæ–‡ä»¶ç›®å½•æ‰€éœ€è¦çš„<code>CMakeLists.txt</code>æ–‡ä»¶ç°åœ¨å·²ç»æ·»åŠ å®Œæ¯•äº†ã€‚æ¥ä¸‹æ¥åº–ä¸è§£ç‰›ï¼Œæˆ‘ä»¬ä¾æ¬¡åˆ†æä¸€ä¸‹å„ä¸ªæ–‡ä»¶ä¸­éœ€è¦æ·»åŠ çš„å†…å®¹ã€‚</p>
<br>

<h3 id="10-1-èŠ‚ç‚¹å…³ç³»"><a href="#10-1-èŠ‚ç‚¹å…³ç³»" class="headerlink" title="10.1 èŠ‚ç‚¹å…³ç³»"></a>10.1 èŠ‚ç‚¹å…³ç³»</h3><p>ä¼—æ‰€å‘¨çŸ¥ï¼Œ<code>Linux</code>çš„ç›®å½•æ˜¯æ ‘çŠ¶ç»“æ„ï¼Œæ‰€ä»¥<code>åµŒå¥—çš„ CMake ä¹Ÿæ˜¯ä¸€ä¸ªæ ‘çŠ¶ç»“æ„ï¼Œæœ€é¡¶å±‚çš„ CMakeLists.txt æ˜¯æ ¹èŠ‚ç‚¹ï¼Œå…¶æ¬¡éƒ½æ˜¯å­èŠ‚ç‚¹ã€‚</code>å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦äº†è§£ä¸€äº›å…³äº <code>CMakeLists.txt</code> æ–‡ä»¶å˜é‡ä½œç”¨åŸŸçš„ä¸€äº›ä¿¡æ¯ï¼š</p>
<ul>
<li>æ ¹èŠ‚ç‚¹<code>CMakeLists.txt</code>ä¸­çš„å˜é‡å…¨å±€æœ‰æ•ˆ</li>
<li>çˆ¶èŠ‚ç‚¹<code>CMakeLists.txt</code>ä¸­çš„å˜é‡å¯ä»¥åœ¨å­èŠ‚ç‚¹ä¸­ä½¿ç”¨</li>
<li>å­èŠ‚ç‚¹<code>CMakeLists.txt</code>ä¸­çš„å˜é‡åªèƒ½åœ¨å½“å‰èŠ‚ç‚¹ä¸­ä½¿ç”¨</li>
</ul>
<br>

<h3 id="10-2-æ·»åŠ å­ç›®å½•"><a href="#10-2-æ·»åŠ å­ç›®å½•" class="headerlink" title="10.2 æ·»åŠ å­ç›®å½•"></a>10.2 æ·»åŠ å­ç›®å½•</h3><figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">add_subdirectory</span>(source_dir [binary_dir] [EXCLUDE_FROM_ALL])</span><br></pre></td></tr></table></figure>

<ul>
<li><code>source_dir</code>ï¼šæŒ‡å®šäº†<code>CMakeLists.txt</code>æºæ–‡ä»¶å’Œä»£ç æ–‡ä»¶çš„ä½ç½®ï¼Œå…¶å®å°±æ˜¯æŒ‡å®šå­ç›®å½•</li>
<li><code>binary_dir</code>ï¼šæŒ‡å®šäº†è¾“å‡ºæ–‡ä»¶çš„è·¯å¾„ï¼Œä¸€èˆ¬ä¸éœ€è¦æŒ‡å®šï¼Œå¿½ç•¥å³å¯ã€‚</li>
<li><code>EXCLUDE_FROM_ALL</code>ï¼šåœ¨å­è·¯å¾„ä¸‹çš„ç›®æ ‡é»˜è®¤ä¸ä¼šè¢«åŒ…å«åˆ°çˆ¶è·¯å¾„çš„<code>ALL</code>ç›®æ ‡é‡Œï¼Œå¹¶ä¸”ä¹Ÿä¼šè¢«æ’é™¤åœ¨IDEå·¥ç¨‹æ–‡ä»¶ä¹‹å¤–ã€‚ç”¨æˆ·å¿…é¡»æ˜¾å¼æ„å»ºåœ¨å­è·¯å¾„ä¸‹çš„ç›®æ ‡ã€‚</li>
</ul>
<p>é€šè¿‡è¿™ç§æ–¹å¼<code>CMakeLists.txt</code>æ–‡ä»¶ä¹‹é—´çš„çˆ¶å­å…³ç³»å°±è¢«æ„å»ºå‡ºæ¥äº†ã€‚</p>
<h3 id="10-3-ç¼–å†™CMakeLists-txtæ–‡ä»¶"><a href="#10-3-ç¼–å†™CMakeLists-txtæ–‡ä»¶" class="headerlink" title="10.3 ç¼–å†™CMakeLists.txtæ–‡ä»¶"></a>10.3 ç¼–å†™CMakeLists.txtæ–‡ä»¶</h3><h4 id="10-3-1-æ ¹ç›®å½•"><a href="#10-3-1-æ ¹ç›®å½•" class="headerlink" title="10.3.1 æ ¹ç›®å½•"></a>10.3.1 æ ¹ç›®å½•</h4><p>æ ¹ç›®å½•ä¸­çš„ <code>CMakeLists.txt</code>æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">cmake_minimum_required(VERSION 3.0)</span><br><span class="line">project(test)</span><br><span class="line"># å®šä¹‰å˜é‡</span><br><span class="line"># é™æ€åº“ç”Ÿæˆçš„è·¯å¾„</span><br><span class="line">set(LIB_PATH $&#123;CMAKE_CURRENT_SOURCE_DIR&#125;/lib)</span><br><span class="line"># æµ‹è¯•ç¨‹åºç”Ÿæˆçš„è·¯å¾„</span><br><span class="line">set(EXEC_PATH $&#123;CMAKE_CURRENT_SOURCE_DIR&#125;/bin)</span><br><span class="line"># å¤´æ–‡ä»¶ç›®å½•</span><br><span class="line">set(HEAD_PATH $&#123;CMAKE_CURRENT_SOURCE_DIR&#125;/include)</span><br><span class="line"># é™æ€åº“çš„åå­—</span><br><span class="line">set(CALC_LIB calc)</span><br><span class="line">set(SORT_LIB sort)</span><br><span class="line"># å¯æ‰§è¡Œç¨‹åºçš„åå­—</span><br><span class="line">set(APP_NAME_1 test1)</span><br><span class="line">set(APP_NAME_2 test2)</span><br><span class="line"># æ·»åŠ å­ç›®å½•</span><br><span class="line">add_subdirectory(calc)</span><br><span class="line">add_subdirectory(sort)</span><br><span class="line">add_subdirectory(test1)</span><br><span class="line">add_subdirectory(test2)</span><br></pre></td></tr></table></figure>

<p>åœ¨æ ¹èŠ‚ç‚¹å¯¹åº”çš„æ–‡ä»¶ä¸­ä¸»è¦åšäº†ä¸¤ä»¶äº‹æƒ…ï¼šå®šä¹‰å…¨å±€å˜é‡å’Œæ·»åŠ å­ç›®å½•ã€‚</p>
<ul>
<li>å®šä¹‰çš„å…¨å±€å˜é‡ä¸»è¦æ˜¯ç»™å­èŠ‚ç‚¹ä½¿ç”¨ï¼Œç›®çš„æ˜¯ä¸ºäº†æé«˜å­èŠ‚ç‚¹ä¸­çš„<code>CMakeLists.txt</code>æ–‡ä»¶çš„å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§ï¼Œé¿å…å†—ä½™å¹¶é™ä½å‡ºå·®çš„æ¦‚ç‡ã€‚</li>
<li>ä¸€å…±æ·»åŠ äº†å››ä¸ªå­ç›®å½•ï¼Œæ¯ä¸ªå­ç›®å½•ä¸­éƒ½æœ‰ä¸€ä¸ª<code>CMakeLists.txt</code>æ–‡ä»¶ï¼Œè¿™æ ·å®ƒä»¬çš„çˆ¶å­å…³ç³»å°±è¢«ç¡®å®šä¸‹æ¥äº†ã€‚</li>
</ul>
<h4 id="10-3-2-calc-ç›®å½•"><a href="#10-3-2-calc-ç›®å½•" class="headerlink" title="10.3.2 calc ç›®å½•"></a>10.3.2 calc ç›®å½•</h4><p><code>calc</code> ç›®å½•ä¸­çš„ <code>CMakeLists.txt</code>æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">cmake_minimum_required</span>(VERSION <span class="number">3.0</span>)</span><br><span class="line"><span class="keyword">project</span>(CALCLIB)</span><br><span class="line"><span class="keyword">aux_source_directory</span>(./ SRC)</span><br><span class="line"><span class="keyword">include_directories</span>(<span class="variable">$&#123;HEAD_PATH&#125;</span>)</span><br><span class="line"><span class="keyword">set</span>(LIBRARY_OUTPUT_PATH <span class="variable">$&#123;LIB_PATH&#125;</span>)</span><br><span class="line"><span class="keyword">add_library</span>(<span class="variable">$&#123;CALC_LIB&#125;</span> STATIC <span class="variable">$&#123;SRC&#125;</span>)</span><br></pre></td></tr></table></figure>
<ul>
<li>ç¬¬3è¡Œ<code>aux_source_directory</code>ï¼šæœç´¢å½“å‰ç›®å½•ï¼ˆcalcç›®å½•ï¼‰ä¸‹çš„æ‰€æœ‰æºæ–‡ä»¶</li>
<li>ç¬¬4è¡Œ<code>include_directories</code>ï¼šåŒ…å«å¤´æ–‡ä»¶è·¯å¾„ï¼ŒHEAD_PATHæ˜¯åœ¨æ ¹èŠ‚ç‚¹æ–‡ä»¶ä¸­å®šä¹‰çš„</li>
<li>ç¬¬5è¡Œ<code>set</code>ï¼šè®¾ç½®åº“çš„ç”Ÿæˆçš„è·¯å¾„ï¼ŒLIB_PATHæ˜¯åœ¨æ ¹èŠ‚ç‚¹æ–‡ä»¶ä¸­å®šä¹‰çš„</li>
<li>ç¬¬6è¡Œ<code>add_library</code>ï¼šç”Ÿæˆé™æ€åº“ï¼Œé™æ€åº“åå­—CALC_LIBæ˜¯åœ¨æ ¹èŠ‚ç‚¹æ–‡ä»¶ä¸­å®šä¹‰çš„</li>
</ul>
<h4 id="10-3-2-sort-ç›®å½•"><a href="#10-3-2-sort-ç›®å½•" class="headerlink" title="10.3.2 sort ç›®å½•"></a>10.3.2 sort ç›®å½•</h4><p>sort ç›®å½•ä¸­çš„ CMakeLists.txtæ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">cmake_minimum_required</span>(VERSION <span class="number">3.0</span>)</span><br><span class="line"><span class="keyword">project</span>(CALCLIB)</span><br><span class="line"><span class="keyword">aux_source_directory</span>(./ SRC)</span><br><span class="line"><span class="keyword">include_directories</span>(<span class="variable">$&#123;HEAD_PATH&#125;</span>)</span><br><span class="line"><span class="keyword">set</span>(LIBRARY_OUTPUT_PATH <span class="variable">$&#123;LIB_PATH&#125;</span>)</span><br><span class="line"><span class="keyword">add_library</span>(<span class="variable">$&#123;CALC_LIB&#125;</span> SHARED <span class="variable">$&#123;SRC&#125;</span>)</span><br></pre></td></tr></table></figure>
<ul>
<li>ç¬¬6è¡Œ<code>add_library</code>ï¼šç”ŸæˆåŠ¨æ€åº“ï¼ŒåŠ¨æ€åº“åå­—SORT_LIBæ˜¯åœ¨æ ¹èŠ‚ç‚¹æ–‡ä»¶ä¸­å®šä¹‰çš„</li>
</ul>
<p>è¿™ä¸ªæ–‡ä»¶ä¸­çš„å†…å®¹å’Œ<code>calc</code>èŠ‚ç‚¹æ–‡ä»¶ä¸­çš„å†…å®¹ç±»ä¼¼ï¼Œåªä¸è¿‡è¿™æ¬¡ç”Ÿæˆçš„æ˜¯åŠ¨æ€åº“ã€‚</p>
<h4 id="10-3-3-test1-ç›®å½•"><a href="#10-3-3-test1-ç›®å½•" class="headerlink" title="10.3.3 test1 ç›®å½•"></a>10.3.3 test1 ç›®å½•</h4><p>test1 ç›®å½•ä¸­çš„ CMakeLists.txtæ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">cmake_minimum_required</span>(VERSION <span class="number">3.0</span>)</span><br><span class="line"><span class="keyword">project</span>(CALCTEST)</span><br><span class="line"><span class="keyword">aux_source_directory</span>(./ SRC)</span><br><span class="line"><span class="keyword">include_directories</span>(<span class="variable">$&#123;HEAD_PATH&#125;</span>)</span><br><span class="line"><span class="keyword">link_directories</span>(<span class="variable">$&#123;LIB_PATH&#125;</span>)</span><br><span class="line"><span class="keyword">link_libraries</span>(<span class="variable">$&#123;CALC_LIB&#125;</span>)</span><br><span class="line"><span class="keyword">set</span>(EXECUTABLE_OUTPUT_PATH <span class="variable">$&#123;EXEC_PATH&#125;</span>)</span><br><span class="line"><span class="keyword">add_executable</span>(<span class="variable">$&#123;APP_NAME_1&#125;</span> <span class="variable">$&#123;SRC&#125;</span>)</span><br></pre></td></tr></table></figure>
<ul>
<li>ç¬¬4è¡Œinclude_directoriesï¼šæŒ‡å®šå¤´æ–‡ä»¶è·¯å¾„ï¼ŒHEAD_PATHå˜é‡æ˜¯åœ¨æ ¹èŠ‚ç‚¹æ–‡ä»¶ä¸­å®šä¹‰çš„</li>
<li>ç¬¬6è¡Œlink_librariesï¼šæŒ‡å®šå¯æ‰§è¡Œç¨‹åºè¦é“¾æ¥çš„é™æ€åº“ï¼ŒCALC_LIBå˜é‡æ˜¯åœ¨æ ¹èŠ‚ç‚¹æ–‡ä»¶ä¸­å®šä¹‰çš„</li>
<li>ç¬¬7è¡Œsetï¼šæŒ‡å®šå¯æ‰§è¡Œç¨‹åºç”Ÿæˆçš„è·¯å¾„ï¼ŒEXEC_PATHå˜é‡æ˜¯åœ¨æ ¹èŠ‚ç‚¹æ–‡ä»¶ä¸­å®šä¹‰çš„</li>
<li>ç¬¬8è¡Œadd_executableï¼šç”Ÿæˆå¯æ‰§è¡Œç¨‹åºï¼ŒAPP_NAME_1å˜é‡æ˜¯åœ¨æ ¹èŠ‚ç‚¹æ–‡ä»¶ä¸­å®šä¹‰çš„</li>
</ul>
<p>æ­¤å¤„çš„å¯æ‰§è¡Œç¨‹åºé“¾æ¥çš„æ˜¯é™æ€åº“ï¼Œæœ€ç»ˆé™æ€åº“ä¼šè¢«æ‰“åŒ…åˆ°å¯æ‰§è¡Œç¨‹åºä¸­ï¼Œå¯æ‰§è¡Œç¨‹åºå¯åŠ¨ä¹‹åï¼Œé™æ€åº“ä¹Ÿå°±éšä¹‹è¢«åŠ è½½åˆ°å†…å­˜ä¸­äº†ã€‚</p>
<h4 id="10-3-4-test2-ç›®å½•"><a href="#10-3-4-test2-ç›®å½•" class="headerlink" title="10.3.4 test2 ç›®å½•"></a>10.3.4 test2 ç›®å½•</h4><p>test2 ç›®å½•ä¸­çš„ CMakeLists.txtæ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">cmake_minimum_required</span>(VERSION <span class="number">3.0</span>)</span><br><span class="line"><span class="keyword">project</span>(SORTTEST)</span><br><span class="line"><span class="keyword">aux_source_directory</span>(./ SRC)</span><br><span class="line"><span class="keyword">include_directories</span>(<span class="variable">$&#123;HEAD_PATH&#125;</span>)</span><br><span class="line"><span class="keyword">set</span>(EXECUTABLE_OUTPUT_PATH <span class="variable">$&#123;EXEC_PATH&#125;</span>)</span><br><span class="line"><span class="keyword">link_directories</span>(<span class="variable">$&#123;LIB_PATH&#125;</span>)</span><br><span class="line"><span class="keyword">add_executable</span>(<span class="variable">$&#123;APP_NAME_2&#125;</span> <span class="variable">$&#123;SRC&#125;</span>)</span><br><span class="line"><span class="keyword">target_link_libraries</span>(<span class="variable">$&#123;APP_NAME_2&#125;</span> <span class="variable">$&#123;SORT_LIB&#125;</span>)</span><br></pre></td></tr></table></figure>
<ul>
<li>ç¬¬å››è¡Œ<code>include_directories</code>ï¼šåŒ…å«å¤´æ–‡ä»¶è·¯å¾„ï¼ŒHEAD_PATHå˜é‡æ˜¯åœ¨æ ¹èŠ‚ç‚¹æ–‡ä»¶ä¸­å®šä¹‰çš„</li>
<li>ç¬¬äº”è¡Œ<code>set</code>ï¼šæŒ‡å®šå¯æ‰§è¡Œç¨‹åºç”Ÿæˆçš„è·¯å¾„ï¼ŒEXEC_PATHå˜é‡æ˜¯åœ¨æ ¹èŠ‚ç‚¹æ–‡ä»¶ä¸­å®šä¹‰çš„</li>
<li>ç¬¬å…­è¡Œ<code>link_directories</code>ï¼šæŒ‡å®šå¯æ‰§è¡Œç¨‹åºè¦é“¾æ¥çš„åŠ¨æ€åº“çš„è·¯å¾„ï¼ŒLIB_PATHå˜é‡æ˜¯åœ¨æ ¹èŠ‚ç‚¹æ–‡ä»¶ä¸­å®šä¹‰çš„</li>
<li>ç¬¬ä¸ƒè¡Œ<code>add_executable</code>ï¼šç”Ÿæˆå¯æ‰§è¡Œç¨‹åºï¼ŒAPP_NAME_2å˜é‡æ˜¯åœ¨æ ¹èŠ‚ç‚¹æ–‡ä»¶ä¸­å®šä¹‰çš„</li>
<li>ç¬¬å…«è¡Œ<code>target_link_libraries</code>ï¼šæŒ‡å®šå¯æ‰§è¡Œç¨‹åºè¦é“¾æ¥çš„åŠ¨æ€åº“çš„åå­—</li>
</ul>
<p>åœ¨ç”Ÿæˆå¯æ‰§è¡Œç¨‹åºçš„æ—¶å€™ï¼ŒåŠ¨æ€åº“ä¸ä¼šè¢«æ‰“åŒ…åˆ°å¯æ‰§è¡Œç¨‹åºå†…éƒ¨ã€‚å½“å¯æ‰§è¡Œç¨‹åºå¯åŠ¨ä¹‹ååŠ¨æ€åº“ä¹Ÿä¸ä¼šè¢«åŠ è½½åˆ°å†…å­˜ï¼Œåªæœ‰å¯æ‰§è¡Œç¨‹åºè°ƒç”¨äº†åŠ¨æ€åº“ä¸­çš„å‡½æ•°çš„æ—¶å€™ï¼ŒåŠ¨æ€åº“æ‰ä¼šè¢«åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œä¸”å¤šä¸ªè¿›ç¨‹å¯ä»¥å…±ç”¨å†…å­˜ä¸­çš„åŒä¸€ä¸ªåŠ¨æ€åº“ï¼Œæ‰€ä»¥åŠ¨æ€åº“åˆå«å…±äº«åº“ã€‚</p>
<p><strong>æ³¨æ„ï¼šå¼•ç”¨å˜é‡è¦ä½¿ç”¨{},ä¸è¦ç”¨æˆ()</strong></p>
<ul>
<li>set(EXECUTABLE_OUTPUT_PATH <code>$&#123;EXEC_PATH&#125;</code>) å†™æˆå¦‚ä¸‹å°±ä¼šå‡ºé”™ï¼š</li>
<li>set(EXECUTABLE_OUTPUT_PATH <code>$(EXEC_PATH)</code>) å°±ä¼šå‡ºé”™</li>
</ul>
<br>

<h4 id="10-3-4-æ„å»ºé¡¹ç›®"><a href="#10-3-4-æ„å»ºé¡¹ç›®" class="headerlink" title="10.3.4 æ„å»ºé¡¹ç›®"></a>10.3.4 æ„å»ºé¡¹ç›®</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">xuan@DESKTOP-A52B6V9:~/linux/demos/cpro$ cd build/</span><br><span class="line">xuan@DESKTOP-A52B6V9:~/linux/demos/cpro/build$ cmake ..</span><br><span class="line">-- The C compiler identification is GNU 11.4.0</span><br><span class="line">-- The CXX compiler identification is GNU 11.4.0</span><br><span class="line">-- Detecting C compiler ABI info</span><br><span class="line">-- Detecting C compiler ABI info - done</span><br><span class="line">-- Check for working C compiler: /usr/bin/cc - skipped</span><br><span class="line">-- Detecting C compile features</span><br><span class="line">-- Detecting C compile features - done</span><br><span class="line">-- Detecting CXX compiler ABI info</span><br><span class="line">-- Detecting CXX compiler ABI info - done</span><br><span class="line">-- Check for working CXX compiler: /usr/bin/c++ - skipped</span><br><span class="line">-- Detecting CXX compile features</span><br><span class="line">-- Detecting CXX compile features - done</span><br><span class="line">-- Configuring done</span><br><span class="line">-- Generating done</span><br><span class="line">-- Build files have been written to: /home/xuan/linux/demos/cpro/build</span><br><span class="line"></span><br><span class="line">xuan@DESKTOP-A52B6V9:~/linux/demos/cpro/build$ make</span><br><span class="line">[  8%] Building C object calc/CMakeFiles/calc.dir/add.c.o</span><br><span class="line">[ 16%] Building C object calc/CMakeFiles/calc.dir/div.c.o</span><br><span class="line">[ 25%] Building C object calc/CMakeFiles/calc.dir/mult.c.o</span><br><span class="line">[ 33%] Building C object calc/CMakeFiles/calc.dir/sub.c.o</span><br><span class="line">[ 41%] Linking C static library ../../lib/libcalc.a</span><br><span class="line">[ 41%] Built target calc</span><br><span class="line">[ 50%] Building C object sort/CMakeFiles/sort.dir/insert.c.o</span><br><span class="line">[ 58%] Building C object sort/CMakeFiles/sort.dir/select.c.o</span><br><span class="line">[ 66%] Linking C shared library ../../lib/libsort.so</span><br><span class="line">[ 66%] Built target sort</span><br><span class="line">[ 75%] Building C object test2/CMakeFiles/test2.dir/sort.c.o</span><br><span class="line">[ 83%] Linking C executable ../../bin/test2</span><br><span class="line">[ 83%] Built target test2</span><br><span class="line">[ 91%] Building C object test1/CMakeFiles/test1.dir/calc.c.o</span><br><span class="line"><span class="meta prompt_">[100%</span><span class="language-bash">] Linking C executable ../../bin/test1</span></span><br><span class="line"><span class="meta prompt_">[100%</span><span class="language-bash">] Built target test1</span></span><br></pre></td></tr></table></figure>

<p>é€šè¿‡ä¸Šè¿°<code>log</code>å¯ä»¥å¾—åˆ°å¦‚ä¸‹ä¿¡æ¯ï¼š</p>
<ul>
<li>åœ¨é¡¹ç›®æ ¹ç›®å½•çš„<code>libç›®å½•</code>ä¸­ç”Ÿæˆäº†é™æ€åº“<code>libcalc.a</code></li>
<li>åœ¨é¡¹ç›®æ ¹ç›®å½•çš„<code>libç›®å½•</code>ä¸­ç”Ÿæˆäº†åŠ¨æ€åº“<code>libsort.so</code></li>
<li>åœ¨é¡¹ç›®æ ¹ç›®å½•çš„<code>binç›®å½•</code>ä¸­ç”Ÿæˆäº†å¯æ‰§è¡Œç¨‹åº<code>test1</code></li>
<li>åœ¨é¡¹ç›®æ ¹ç›®å½•çš„<code>binç›®å½•</code>ä¸­ç”Ÿæˆäº†å¯æ‰§è¡Œç¨‹åº<code>test2</code></li>
</ul>
<p>ä»¥ä¸‹æ˜¯ç”Ÿæˆçš„æ ‘çŠ¶å›¾ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">tree bin/ lib/</span></span><br><span class="line">bin/</span><br><span class="line">â”œâ”€â”€ test1</span><br><span class="line">â””â”€â”€ test2</span><br><span class="line">lib/</span><br><span class="line">â”œâ”€â”€ libcalc.a</span><br><span class="line">â””â”€â”€ libsort.so</span><br></pre></td></tr></table></figure>

<ul>
<li>åœ¨é¡¹ç›®ä¸­ï¼Œå¦‚æœå°†ç¨‹åºä¸­çš„æŸä¸ªæ¨¡å—åˆ¶ä½œæˆäº†åŠ¨æ€åº“æˆ–è€…é™æ€åº“å¹¶ä¸”åœ¨<code>CMakeLists.txt</code> ä¸­æŒ‡å®šäº†åº“çš„è¾“å‡ºç›®å½•ï¼Œè€Œåå…¶å®ƒæ¨¡å—åˆéœ€è¦åŠ è½½è¿™ä¸ªç”Ÿæˆçš„åº“æ–‡ä»¶ï¼Œæ­¤æ—¶ç›´æ¥ä½¿ç”¨å°±å¯ä»¥äº†ã€‚</li>
<li>å¦‚æœæ²¡æœ‰æŒ‡å®šåº“çš„è¾“å‡ºè·¯å¾„æˆ–è€…éœ€è¦ç›´æ¥åŠ è½½å¤–éƒ¨æä¾›çš„åº“æ–‡ä»¶ï¼Œæ­¤æ—¶å°±éœ€è¦ä½¿ç”¨<code>link_directories($&#123;LIB_PATH&#125;)</code>å°†åº“æ–‡ä»¶è·¯å¾„æŒ‡å®šå‡ºæ¥,ç„¶åé“¾æ¥åº“çš„åå­—<code>link_libraries($&#123;CALC_LIB&#125;)</code>ã€‚</li>
</ul>
<br>

<h3 id="11-æµç¨‹æ§åˆ¶"><a href="#11-æµç¨‹æ§åˆ¶" class="headerlink" title="11. æµç¨‹æ§åˆ¶"></a>11. æµç¨‹æ§åˆ¶</h3><h4 id="11-1-æ¡ä»¶åˆ¤æ–­"><a href="#11-1-æ¡ä»¶åˆ¤æ–­" class="headerlink" title="11.1 æ¡ä»¶åˆ¤æ–­"></a>11.1 æ¡ä»¶åˆ¤æ–­</h4><figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(&lt;condition&gt;)</span><br><span class="line">  &lt;commands&gt;</span><br><span class="line"><span class="keyword">elseif</span>(&lt;condition&gt;) <span class="comment"># å¯é€‰å¿«, å¯ä»¥é‡å¤</span></span><br><span class="line">  &lt;commands&gt;</span><br><span class="line"><span class="keyword">else</span>()              <span class="comment"># å¯é€‰å¿«</span></span><br><span class="line">  &lt;commands&gt;</span><br><span class="line"><span class="keyword">endif</span>()</span><br></pre></td></tr></table></figure>

<h5 id="11-1-1-åŸºæœ¬è¡¨è¾¾å¼"><a href="#11-1-1-åŸºæœ¬è¡¨è¾¾å¼" class="headerlink" title="11.1.1 åŸºæœ¬è¡¨è¾¾å¼"></a>11.1.1 åŸºæœ¬è¡¨è¾¾å¼</h5><ul>
<li><p><code>if(&lt;expression&gt;)</code>: <code>expression</code> æœ‰ä»¥ä¸‹ä¸‰ç§æƒ…å†µï¼šå¸¸é‡ã€å˜é‡ã€å­—ç¬¦ä¸²ã€‚</p>
<ul>
<li>å¦‚æœæ˜¯<code>1</code>, <code>ON</code>, <code>YES</code>, <code>TRUE</code>, <code>Y</code>, <code>éé›¶å€¼</code>ï¼Œ<code>éç©ºå­—ç¬¦ä¸²</code>æ—¶ï¼Œæ¡ä»¶åˆ¤æ–­è¿”å›<code>True</code></li>
<li>å¦‚æœæ˜¯ <code>0</code>, <code>OFF</code>, <code>NO</code>, <code>FALSE</code>, <code>N</code>, <code>IGNORE</code>, <code>NOTFOUND</code>ï¼Œ<code>ç©ºå­—ç¬¦ä¸²</code>æ—¶ï¼Œæ¡ä»¶åˆ¤æ–­è¿”å›<code>False</code></li>
</ul>
</li>
</ul>
<br>

<h5 id="11-1-2-é€»è¾‘åˆ¤æ–­"><a href="#11-1-2-é€»è¾‘åˆ¤æ–­" class="headerlink" title="11.1.2 é€»è¾‘åˆ¤æ–­"></a>11.1.2 é€»è¾‘åˆ¤æ–­</h5><ul>
<li>if(NOT <condition>)</li>
<li>if(<cond1> AND <cond2>)</li>
<li>if(<cond1> OR <cond2>)</li>
</ul>
<br>

<h5 id="11-1-3-æ¯”è¾ƒ"><a href="#11-1-3-æ¯”è¾ƒ" class="headerlink" title="11.1.3 æ¯”è¾ƒ"></a>11.1.3 æ¯”è¾ƒ</h5><ul>
<li><code>if(&lt;variable|string&gt; &lt;COMMAND&gt; &lt;variable|string&gt;)</code></li>
<li>&lt;<code>COMMAND</code>&gt;ä¸ºå¦‚ä¸‹å€¼çš„è§£é‡Šï¼š<ul>
<li><code>LESS</code>ï¼šå¦‚æœå·¦ä¾§æ•°å€¼&#x2F;å­—ç¬¦ä¸²<code>å°äº</code>å³ä¾§ï¼Œè¿”å›<code>True</code></li>
<li><code>GREATER</code>ï¼šå¦‚æœå·¦ä¾§æ•°å€¼&#x2F;å­—ç¬¦ä¸²<code>å¤§äº</code>å³ä¾§ï¼Œè¿”å›<code>True</code></li>
<li><code>EQUAL</code>ï¼šå¦‚æœå·¦ä¾§æ•°å€¼&#x2F;å­—ç¬¦ä¸²<code>ç­‰äº</code>å³ä¾§ï¼Œè¿”å›<code>True</code></li>
<li><code>LESS_EQUAL</code>ï¼šå¦‚æœå·¦ä¾§æ•°å€¼&#x2F;å­—ç¬¦ä¸²<code>å°äºç­‰äº</code>å³ä¾§ï¼Œè¿”å›<code>True</code></li>
<li><code>GREATER_EQUAL</code>ï¼šå¦‚æœå·¦ä¾§æ•°å€¼&#x2F;å­—ç¬¦ä¸²<code>å¤§äºç­‰äº</code>å³ä¾§ï¼Œè¿”å›<code>True</code></li>
</ul>
</li>
</ul>
<br>

<h5 id="11-1-4-æ–‡ä»¶æ“ä½œ"><a href="#11-1-4-æ–‡ä»¶æ“ä½œ" class="headerlink" title="11.1.4 æ–‡ä»¶æ“ä½œ"></a>11.1.4 æ–‡ä»¶æ“ä½œ</h5><p><strong>å­˜åœ¨&#x2F;æ˜¯</strong>è¿”å›<code>True</code>ï¼Œ<strong>ä¸å­˜åœ¨&#x2F;å¦</strong>è¿”å›<code>False</code></p>
<ul>
<li>åˆ¤æ–­æ–‡ä»¶æˆ–è€…ç›®å½•æ˜¯å¦å­˜åœ¨ï¼š<code>if(EXISTS path-to-file-or-directory)</code></li>
<li>åˆ¤æ–­æ˜¯ä¸æ˜¯ç›®å½•ï¼š<code>if(IS_DIRECTORY path)</code><ul>
<li>æ­¤å¤„ç›®å½•çš„ <code>path</code> å¿…é¡»æ˜¯ç»å¯¹è·¯å¾„</li>
</ul>
</li>
<li>åˆ¤æ–­æ˜¯ä¸æ˜¯è½¯è¿æ¥ï¼š<code>if(IS_SYMLINK file-name)</code><ul>
<li>æ­¤å¤„çš„ <code>file-name</code> å¯¹åº”çš„è·¯å¾„å¿…é¡»æ˜¯ç»å¯¹è·¯å¾„</li>
<li>è½¯é“¾æ¥ç›¸å½“äº <code>Windows</code> é‡Œçš„å¿«æ·æ–¹å¼</li>
</ul>
</li>
<li>åˆ¤æ–­æ˜¯ä¸æ˜¯ç»å¯¹è·¯å¾„ï¼š<code>if(IS_ABSOLUTE path)</code><ul>
<li>å¦‚æœç»å¯¹è·¯å¾„æ˜¯Linuxï¼Œè¯¥è·¯å¾„éœ€è¦ä»æ ¹ç›®å½•å¼€å§‹æè¿°</li>
<li>å¦‚æœç»å¯¹è·¯å¾„æ˜¯Windowsï¼Œè¯¥è·¯å¾„éœ€è¦ä»ç›˜ç¬¦å¼€å§‹æè¿°</li>
</ul>
</li>
</ul>
<br>

<h5 id="11-1-5-å…¶ä»–"><a href="#11-1-5-å…¶ä»–" class="headerlink" title="11.1.5 å…¶ä»–"></a>11.1.5 å…¶ä»–</h5><ul>
<li>åˆ¤æ–­æŸä¸ªå…ƒç´ æ˜¯å¦åœ¨åˆ—è¡¨ä¸­ï¼š<code>if(&lt;variable|string&gt; IN_LIST &lt;variable&gt;)</code></li>
<li>æ¯”è¾ƒä¸¤ä¸ªè·¯å¾„æ˜¯å¦ç›¸ç­‰ï¼š<code>if(&lt;variable|string&gt; PATH_EQUAL &lt;variable|string&gt;)</code></li>
</ul>
<br>

<h4 id="11-2-å¾ªç¯"><a href="#11-2-å¾ªç¯" class="headerlink" title="11.2 å¾ªç¯"></a>11.2 å¾ªç¯</h4><p>åœ¨ <code>CMake</code> ä¸­å¾ªç¯æœ‰ä¸¤ç§æ–¹å¼ï¼Œåˆ†åˆ«æ˜¯ï¼š<code>foreach</code>å’Œ<code>while</code>ã€‚</p>
<h5 id="11-2-1-foreach"><a href="#11-2-1-foreach" class="headerlink" title="11.2.1 foreach"></a>11.2.1 foreach</h5><p>ä½¿ç”¨ foreach è¿›è¡Œå¾ªç¯ï¼Œè¯­æ³•æ ¼å¼å¦‚ä¸‹ï¼š</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">foreach</span>(&lt;loop_var&gt; &lt;items&gt;)</span><br><span class="line">    &lt;commands&gt;</span><br><span class="line"><span class="keyword">endforeach</span>()</span><br></pre></td></tr></table></figure>

<ul>
<li><code>foreach(&lt;loop_var&gt; RANGE &lt;stop&gt;)</code><ul>
<li><code>RANGE</code>ï¼šå…³é”®å­—ï¼Œè¡¨ç¤ºè¦éå†èŒƒå›´</li>
<li><code>stop</code>ï¼šè¿™æ˜¯ä¸€ä¸ªæ­£æ•´æ•°ï¼Œè¡¨ç¤ºèŒƒå›´çš„ç»“æŸå€¼ï¼Œåœ¨éå†çš„æ—¶å€™ä» 0 å¼€å§‹ï¼Œæœ€å¤§å€¼ä¸º <code>stop</code>ã€‚</li>
<li><code>loop_var</code>ï¼šå­˜å‚¨æ¯æ¬¡å¾ªç¯å–å‡ºçš„å€¼</li>
</ul>
</li>
</ul>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">cmake_minimum_required</span>(VERSION <span class="number">3.2</span>)</span><br><span class="line"><span class="keyword">project</span>(<span class="keyword">test</span>)</span><br><span class="line"><span class="comment"># å¾ªç¯</span></span><br><span class="line"><span class="keyword">foreach</span>(item RANGE <span class="number">10</span>)</span><br><span class="line">    <span class="keyword">message</span>(STATUS <span class="string">&quot;å½“å‰éå†çš„å€¼ä¸º: $&#123;item&#125;&quot;</span> )</span><br><span class="line"><span class="keyword">endforeach</span>()</span><br></pre></td></tr></table></figure>
<p>ä¸Šé¢ä¾‹å­è¾“å‡º<code>0~10</code></p>
<br>

<ul>
<li><code>foreach(&lt;loop_var&gt; RANGE &lt;start&gt; &lt;stop&gt; [&lt;step&gt;])</code><ul>
<li><code>RANGE</code>ï¼šå…³é”®å­—ï¼Œè¡¨ç¤ºè¦éå†èŒƒå›´</li>
<li><code>start</code>ï¼šè¿™æ˜¯ä¸€ä¸ªæ­£æ•´æ•°ï¼Œè¡¨ç¤ºèŒƒå›´çš„èµ·å§‹å€¼ï¼Œä¹Ÿå°±æ˜¯è¯´æœ€å°å€¼ä¸º <code>start</code></li>
<li><code>stop</code>ï¼šè¿™æ˜¯ä¸€ä¸ªæ­£æ•´æ•°ï¼Œè¡¨ç¤ºèŒƒå›´çš„ç»“æŸå€¼ï¼Œä¹Ÿå°±æ˜¯è¯´æœ€å¤§å€¼ä¸º <code>stop</code></li>
<li><code>step</code>ï¼šæ§åˆ¶æ¯æ¬¡éå†çš„æ—¶å€™ä»¥æ€æ ·çš„æ­¥é•¿å¢é•¿ï¼Œé»˜è®¤ä¸º<code>1</code>ï¼Œå¯ä»¥ä¸è®¾ç½®<br>  -<code>loop_var</code>ï¼šå­˜å‚¨æ¯æ¬¡å¾ªç¯å–å‡ºçš„å€¼</li>
</ul>
</li>
</ul>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">cmake_minimum_required</span>(VERSION <span class="number">3.2</span>)</span><br><span class="line"><span class="keyword">project</span>(<span class="keyword">test</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span>(item RANGE <span class="number">10</span> <span class="number">30</span> <span class="number">2</span>)</span><br><span class="line">    <span class="keyword">message</span>(STATUS <span class="string">&quot;å½“å‰éå†çš„å€¼ä¸º: $&#123;item&#125;&quot;</span> )</span><br><span class="line"><span class="keyword">endforeach</span>()</span><br></pre></td></tr></table></figure>
<p>ä¸Šé¢ä¾‹å­è¾“å‡º<code>10~30</code>,ä»<code>10</code>å¼€å§‹,æ¯æ¬¡å¢é•¿<code>2</code>ã€‚</p>
<br>

<ul>
<li><code>foreach(&lt;loop_var&gt; IN [LISTS [&lt;lists&gt;]] [ITEMS [&lt;items&gt;]])</code><ul>
<li><code>IN</code>ï¼šå…³é”®å­—ï¼Œè¡¨ç¤ºåœ¨ <code>xxx</code> é‡Œè¾¹</li>
<li><code>LISTS</code>ï¼šå…³é”®å­—ï¼Œå¯¹åº”çš„æ˜¯åˆ—è¡¨<code>list</code>ï¼Œé€šè¿‡<code>set</code>ã€<code>list</code>å¯ä»¥è·å¾—</li>
<li><code>ITEMS</code>ï¼šå…³é”®å­—ï¼Œå¯¹åº”çš„ä¹Ÿæ˜¯åˆ—è¡¨</li>
<li><code>loop_var</code>ï¼šå­˜å‚¨æ¯æ¬¡å¾ªç¯å–å‡ºçš„å€¼</li>
</ul>
</li>
</ul>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">cmake_minimum_required</span>(VERSION <span class="number">3.2</span>)</span><br><span class="line"><span class="keyword">project</span>(<span class="keyword">test</span>)</span><br><span class="line"><span class="comment"># åˆ›å»º list</span></span><br><span class="line"><span class="keyword">set</span>(WORD a b c d)</span><br><span class="line"><span class="keyword">set</span>(NAME ace sabo luffy)</span><br><span class="line"><span class="comment"># éå† list</span></span><br><span class="line"><span class="keyword">foreach</span>(item IN LISTS WORD NAME)</span><br><span class="line">    <span class="keyword">message</span>(STATUS <span class="string">&quot;å½“å‰éå†çš„å€¼ä¸º: $&#123;item&#125;&quot;</span> )</span><br><span class="line"><span class="keyword">endforeach</span>()</span><br></pre></td></tr></table></figure>
<p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œåˆ›å»ºäº†ä¸¤ä¸ª <code>list</code> åˆ—è¡¨ï¼Œåœ¨éå†çš„æ—¶å€™å¯¹å®ƒä»¬ä¸¤ä¸ªéƒ½è¿›è¡Œäº†éå†ï¼ˆå¯ä»¥æ ¹æ®å®é™…éœ€æ±‚é€‰æ‹©åŒæ—¶éå†å¤šä¸ªæˆ–è€…åªéå†ä¸€ä¸ªï¼‰</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">cmake_minimum_required</span>(VERSION <span class="number">3.2</span>)</span><br><span class="line"><span class="keyword">project</span>(<span class="keyword">test</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">set</span>(WORD a b c <span class="string">&quot;d e f&quot;</span>)</span><br><span class="line"><span class="keyword">set</span>(NAME ace sabo luffy)</span><br><span class="line"><span class="keyword">foreach</span>(item IN ITEMS <span class="variable">$&#123;WORD&#125;</span> <span class="variable">$&#123;NAME&#125;</span>)</span><br><span class="line">    <span class="keyword">message</span>(STATUS <span class="string">&quot;å½“å‰éå†çš„å€¼ä¸º: $&#123;item&#125;&quot;</span> )</span><br><span class="line"><span class="keyword">endforeach</span>()</span><br></pre></td></tr></table></figure>
<p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œéå†è¿‡ç¨‹ä¸­å°†å…³é”®å­—<code>LISTS</code>æ”¹æˆäº†<code>ITEMS</code>ï¼Œåè¾¹è·Ÿçš„è¿˜æ˜¯ä¸€ä¸ªæˆ–è€…å¤šä¸ªåˆ—è¡¨ï¼Œåªä¸è¿‡æ­¤æ—¶éœ€è¦é€šè¿‡<code>$&#123;&#125;</code>å°†åˆ—è¡¨ä¸­çš„å€¼å–å‡ºã€‚å…¶è¾“å‡ºçš„ä¿¡æ¯å’Œä¸Šä¸€ä¸ªä¾‹å­æ˜¯ä¸€æ ·çš„ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">cd</span> build/</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">cmake ..</span></span><br><span class="line">-- å½“å‰éå†çš„å€¼ä¸º: a</span><br><span class="line">-- å½“å‰éå†çš„å€¼ä¸º: b</span><br><span class="line">-- å½“å‰éå†çš„å€¼ä¸º: c</span><br><span class="line">-- å½“å‰éå†çš„å€¼ä¸º: d e f</span><br><span class="line">-- å½“å‰éå†çš„å€¼ä¸º: ace</span><br><span class="line">-- å½“å‰éå†çš„å€¼ä¸º: sabo</span><br><span class="line">-- å½“å‰éå†çš„å€¼ä¸º: luffy</span><br><span class="line">-- Configuring done</span><br><span class="line">-- Generating done</span><br><span class="line">-- Build files have been written to: /home/robin/abc/a/build</span><br></pre></td></tr></table></figure>

<p>å°ç»†èŠ‚ï¼šåœ¨é€šè¿‡ set ç»„ç»‡åˆ—è¡¨çš„æ—¶å€™ï¼Œå¦‚æœæŸä¸ªå­—ç¬¦ä¸²ä¸­æœ‰ç©ºæ ¼ï¼Œå¯ä»¥é€šè¿‡åŒå¼•å·å°†å…¶åŒ…è£¹èµ·æ¥ï¼Œå…·ä½“çš„æ“ä½œæ–¹æ³•å¯ä»¥å‚è€ƒä¸Šé¢çš„ä¾‹å­ã€‚</p>
<br>

<ul>
<li><code>foreach(&lt;loop_var&gt;... IN ZIP_LISTS &lt;lists&gt;)</code><ul>
<li><code>loop_var</code>ï¼šå­˜å‚¨æ¯æ¬¡å¾ªç¯å–å‡ºçš„å€¼ï¼Œå¯ä»¥æ ¹æ®è¦éå†çš„åˆ—è¡¨çš„æ•°é‡æŒ‡å®šå¤šä¸ªå˜é‡ï¼Œç”¨äºå­˜å‚¨å¯¹åº”çš„åˆ—è¡¨å½“å‰å–å‡ºçš„é‚£ä¸ªå€¼ã€‚<ul>
<li>å¦‚æœæŒ‡å®šäº†å¤šä¸ªå˜é‡åï¼Œå®ƒä»¬çš„æ•°é‡åº”è¯¥å’Œåˆ—è¡¨çš„æ•°é‡ç›¸ç­‰</li>
<li>å¦‚æœåªç»™å‡ºäº†ä¸€ä¸ª <code>loop_var</code>ï¼Œé‚£ä¹ˆå®ƒå°†ä¸€ç³»åˆ—çš„ <code>loop_var_N</code> å˜é‡æ¥å­˜å‚¨å¯¹åº”åˆ—è¡¨ä¸­çš„å½“å‰é¡¹ï¼Œä¹Ÿå°±æ˜¯è¯´ <code>loop_var_0</code> å¯¹åº”ç¬¬ä¸€ä¸ªåˆ—è¡¨ï¼Œ<code>loop_var_1</code> å¯¹åº”ç¬¬äºŒä¸ªåˆ—è¡¨ï¼Œä»¥æ­¤ç±»æ¨â€¦â€¦</li>
<li>å¦‚æœéå†çš„å¤šä¸ªåˆ—è¡¨ä¸­ä¸€ä¸ªåˆ—è¡¨è¾ƒçŸ­ï¼Œå½“å®ƒéå†å®Œæˆä¹‹åå°†ä¸ä¼šå†å‚ä¸åç»­çš„éå†ï¼ˆå› ä¸ºå…¶å®ƒåˆ—è¡¨è¿˜æ²¡æœ‰éå†å®Œï¼‰ã€‚</li>
</ul>
</li>
<li><code>IN</code>ï¼šå…³é”®å­—ï¼Œè¡¨ç¤ºåœ¨ <code>xxx</code> é‡Œè¾¹</li>
<li><code>ZIP_LISTS</code>ï¼šå…³é”®å­—ï¼Œå¯¹åº”çš„æ˜¯åˆ—è¡¨<code>list</code>ï¼Œé€šè¿‡<code>set</code> ã€<code>list</code>å¯ä»¥è·å¾—</li>
</ul>
</li>
</ul>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">cmake_minimum_required</span>(VERSION <span class="number">3.17</span>)</span><br><span class="line"><span class="keyword">project</span>(<span class="keyword">test</span>)</span><br><span class="line"><span class="comment"># é€šè¿‡listç»™åˆ—è¡¨æ·»åŠ æ•°æ®</span></span><br><span class="line"><span class="keyword">list</span>(APPEND WORD hello world <span class="string">&quot;hello world&quot;</span>)</span><br><span class="line"><span class="keyword">list</span>(APPEND NAME ace sabo luffy zoro sanji)</span><br><span class="line"><span class="comment"># éå†åˆ—è¡¨</span></span><br><span class="line"><span class="keyword">foreach</span>(item1 item2 IN ZIP_LISTS WORD NAME)</span><br><span class="line">    <span class="keyword">message</span>(STATUS <span class="string">&quot;å½“å‰éå†çš„å€¼ä¸º: item1 = $&#123;item1&#125;, item2=$&#123;item2&#125;&quot;</span> )</span><br><span class="line"><span class="keyword">endforeach</span>()</span><br><span class="line"></span><br><span class="line"><span class="keyword">message</span>(<span class="string">&quot;=============================&quot;</span>)</span><br><span class="line"><span class="comment"># éå†åˆ—è¡¨</span></span><br><span class="line"><span class="keyword">foreach</span>(item  IN ZIP_LISTS WORD NAME)</span><br><span class="line">    <span class="keyword">message</span>(STATUS <span class="string">&quot;å½“å‰éå†çš„å€¼ä¸º: item1 = $&#123;item_0&#125;, item2=$&#123;item_1&#125;&quot;</span> )</span><br><span class="line"><span class="keyword">endforeach</span>()</span><br></pre></td></tr></table></figure>
<p>åœ¨è¿™ä¸ªä¾‹å­ä¸­å…³äºåˆ—è¡¨æ•°æ®çš„æ·»åŠ æ˜¯é€šè¿‡<code>list</code>æ¥å®ç°çš„ã€‚åœ¨éå†åˆ—è¡¨çš„æ—¶å€™ä¸€å…±ä½¿ç”¨äº†ä¸¤ç§æ–¹å¼ï¼Œä¸€ç§æä¾›äº†å¤šä¸ªå˜é‡æ¥å­˜å‚¨å½“å‰åˆ—è¡¨ä¸­çš„å€¼ï¼Œå¦ä¸€ç§åªæœ‰ä¸€ä¸ªå˜é‡ï¼Œä½†æ˜¯å®é™…å–å€¼çš„æ—¶å€™éœ€è¦é€šè¿‡<code>å˜é‡å_0ã€å˜é‡å_1ã€å˜é‡å_N</code> çš„æ–¹å¼æ¥æ“ä½œï¼Œ<code>æ³¨æ„äº‹é¡¹ï¼šç¬¬ä¸€ä¸ªåˆ—è¡¨å¯¹åº”çš„ç¼–å·æ˜¯0ï¼Œç¬¬ä¸€ä¸ªåˆ—è¡¨å¯¹åº”çš„ç¼–å·æ˜¯0ï¼Œç¬¬ä¸€ä¸ªåˆ—è¡¨å¯¹åº”çš„ç¼–å·æ˜¯0ã€‚</code></p>
<p>ä¸Šé¢çš„ä¾‹å­è¾“å‡ºçš„ç»“æœå¦‚ä¸‹ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">cd</span> build/</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">cmake ..</span></span><br><span class="line">-- å½“å‰éå†çš„å€¼ä¸º: item1 = hello, item2=ace</span><br><span class="line">-- å½“å‰éå†çš„å€¼ä¸º: item1 = world, item2=sabo</span><br><span class="line">-- å½“å‰éå†çš„å€¼ä¸º: item1 = hello world, item2=luffy</span><br><span class="line">-- å½“å‰éå†çš„å€¼ä¸º: item1 = , item2=zoro</span><br><span class="line">-- å½“å‰éå†çš„å€¼ä¸º: item1 = , item2=sanji</span><br><span class="line">=============================</span><br><span class="line">-- å½“å‰éå†çš„å€¼ä¸º: item1 = hello, item2=ace</span><br><span class="line">-- å½“å‰éå†çš„å€¼ä¸º: item1 = world, item2=sabo</span><br><span class="line">-- å½“å‰éå†çš„å€¼ä¸º: item1 = hello world, item2=luffy</span><br><span class="line">-- å½“å‰éå†çš„å€¼ä¸º: item1 = , item2=zoro</span><br><span class="line">-- å½“å‰éå†çš„å€¼ä¸º: item1 = , item2=sanji</span><br><span class="line">-- Configuring done (0.0s)</span><br><span class="line">-- Generating done (0.0s)</span><br><span class="line">-- Build files have been written to: /home/robin/abc/a/build</span><br></pre></td></tr></table></figure>

<br>

<h5 id="11-2-2-while"><a href="#11-2-2-while" class="headerlink" title="11.2.2 while"></a>11.2.2 while</h5><figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">while</span>(&lt;condition&gt;)</span><br><span class="line">    &lt;commands&gt;</span><br><span class="line"><span class="keyword">endwhile</span>()</span><br></pre></td></tr></table></figure>
<p><code>while</code> æ¯”è¾ƒç®€å•å°±ä¸åšæè¿°äº†ã€‚</p>
<br>

<h3 id="12-cmakeè®¾ç½®ç¼–è¯‘å™¨"><a href="#12-cmakeè®¾ç½®ç¼–è¯‘å™¨" class="headerlink" title="12. cmakeè®¾ç½®ç¼–è¯‘å™¨"></a>12. cmakeè®¾ç½®ç¼–è¯‘å™¨</h3><h4 id="12-1-å‘½ä»¤è¡Œ"><a href="#12-1-å‘½ä»¤è¡Œ" class="headerlink" title="12.1 å‘½ä»¤è¡Œ"></a>12.1 å‘½ä»¤è¡Œ</h4><p>åœ¨å‘½ä»¤è¡Œä¸­æŒ‡å®šç¼–è¯‘å™¨ï¼Œä½ å¯ä»¥åœ¨è°ƒç”¨ <code>cmake</code> å‘½ä»¤æ—¶ä½¿ç”¨ <code>-DCMAKE_C_COMPILER</code> å’Œ <code>-DCMAKE_CXX_COMPILER</code> é€‰é¡¹æ¥åˆ†åˆ«ä¸º<code>C</code>å’Œ<code>C++</code>è®¾ç½®ç¼–è¯‘å™¨ã€‚ä¾‹å¦‚ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cmake -DCMAKE_C_COMPILER=gcc -DCMAKE_CXX_COMPILER=g++ /path/to/source</span><br></pre></td></tr></table></figure>

<br>

<h4 id="12-2-CMakeLists-txt"><a href="#12-2-CMakeLists-txt" class="headerlink" title="12.2 CMakeLists.txt"></a>12.2 CMakeLists.txt</h4><p>åœ¨é¡¹ç›®çš„ <code>CMakeLists.txt</code> æ–‡ä»¶ä¸­ï¼Œä½ å¯ä»¥ä½¿ç”¨ <code>set</code> å‘½ä»¤æ¥æŒ‡å®šç¼–è¯‘å™¨ï¼š</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">set</span>(CMAKE_C_COMPILER /user/bin/gcc)</span><br><span class="line"><span class="keyword">set</span>(CMAKE_CXX_COMPILER /user/bin/g++)</span><br></pre></td></tr></table></figure>

<br>

<h4 id="12-3-å·¥å…·é“¾æ–‡ä»¶"><a href="#12-3-å·¥å…·é“¾æ–‡ä»¶" class="headerlink" title="12.3 å·¥å…·é“¾æ–‡ä»¶"></a>12.3 å·¥å…·é“¾æ–‡ä»¶</h4><p><code>CMake</code>å…è®¸ä½¿ç”¨æ‰€è°“çš„â€œå·¥å…·é“¾æ–‡ä»¶â€ï¼ˆtoolchain fileï¼‰æ¥æŒ‡å®šç¼–è¯‘å™¨å’Œå·¥å…·é“¾è®¾ç½®ã€‚è¿™åœ¨è·¨å¹³å°æ„å»ºæ—¶éå¸¸æœ‰ç”¨ã€‚å·¥å…·é“¾æ–‡ä»¶æ˜¯ä¸€ä¸ªæ™®é€šçš„<code>CMake</code>è„šæœ¬ï¼Œå®ƒè®¾ç½®äº†æ„å»ºç³»ç»Ÿæ‰€éœ€çš„ç¼–è¯‘å™¨å’Œå·¥å…·é“¾é€‰é¡¹ã€‚ä¾‹å¦‚ï¼Œåˆ›å»ºä¸€ä¸ªåä¸º <code>toolchain.cmake</code> çš„æ–‡ä»¶ï¼Œå¹¶åœ¨å…¶ä¸­è®¾ç½®ç¼–è¯‘å™¨ï¼š</p>
<pre><code>set(CMAKE_C_COMPILER gcc)
set(CMAKE_CXX_COMPILER g++)
</code></pre>
<p>ç„¶ååœ¨è°ƒç”¨ <code>cmake</code> å‘½ä»¤æ—¶æŒ‡å®šå·¥å…·é“¾æ–‡ä»¶ï¼š</p>
<pre><code>cmake -DCMAKE_TOOLCHAIN_FILE=path/to/toolchain.cmake /path/to/source
</code></pre>
<p>è¯·è®°ä½ï¼Œä¸€æ—¦<code>CMake</code>ç¼“å­˜ç”Ÿæˆï¼Œæ›´æ”¹ç¼–è¯‘å™¨çš„è®¾ç½®å°±éœ€è¦æ¸…ç†<code>CMake</code>ç¼“å­˜å¹¶é‡æ–°è¿è¡Œ<code>CMake</code>é…ç½®ã€‚è¿™æ˜¯å› ä¸º<code>CMake</code>åœ¨ç¬¬ä¸€æ¬¡è¿è¡Œæ—¶ä¼šå°†ç¼–è¯‘å™¨å’Œå·¥å…·é“¾çš„ä¿¡æ¯ç¼“å­˜èµ·æ¥ï¼Œä»¥ä¾¿åç»­æ„å»ºä½¿ç”¨ã€‚</p>
]]></content>
      <categories>
        <category>è‡ªåŠ¨ç¼–è¯‘å·¥å…·</category>
      </categories>
      <tags>
        <tag>Linux</tag>
        <tag>CMake</tag>
      </tags>
  </entry>
  <entry>
    <title>Qt5å­¦ä¹ ç¬”è®°</title>
    <url>/2024/04/30/Qt5%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/</url>
    <content><![CDATA[<h2 id="ç¯å¢ƒæ­å»º"><a href="#ç¯å¢ƒæ­å»º" class="headerlink" title="ç¯å¢ƒæ­å»º"></a>ç¯å¢ƒæ­å»º</h2><ul>
<li><strong>Qtå®˜æ–¹ä¸‹è½½åœ°å€</strong>: <a href="https://download.qt.io/archive/qt/">https://download.qt.io/archive/qt/</a></li>
<li><strong>å‚è€ƒæ•™ç¨‹æ–‡æ¡£</strong>: <a href="https://subingwen.cn/qt/qt-primer/">https://subingwen.cn/qt/qt-primer/</a></li>
</ul>
<br>

<h2 id="é—®é¢˜æ±‡æ€»"><a href="#é—®é¢˜æ±‡æ€»" class="headerlink" title="é—®é¢˜æ±‡æ€»"></a>é—®é¢˜æ±‡æ€»</h2><h3 id="æ‰“å°é—®é¢˜"><a href="#æ‰“å°é—®é¢˜" class="headerlink" title="æ‰“å°é—®é¢˜"></a>æ‰“å°é—®é¢˜</h3><p><strong>é—®é¢˜ç°è±¡ï¼š</strong></p>
<ul>
<li>åœ¨Qt Createrä¸­ï¼Œä½¿ç”¨<code>qDebug()</code>æ‰“å°ä¿¡æ¯æ—¶ï¼Œåœ¨è°ƒè¯•ç•Œé¢ä¸­ï¼Œ<code>qDebug()</code>çš„è¾“å‡ºä¿¡æ¯ä¼šæ˜¾ç¤ºåœ¨è°ƒè¯•ç»ˆç«¯ï¼Œå½“ç›´æ¥è¿è¡Œ<code>.exe</code>æ–‡ä»¶æ—¶ï¼Œ<code>qDebug()</code>çš„è¾“å‡ºä¿¡æ¯ä¼šä¸¢å¤±ã€‚</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line">MainWindow::<span class="built_in">MainWindow</span>(QWidget *parent)</span><br><span class="line">    : <span class="built_in">QMainWindow</span>(parent)</span><br><span class="line">    , <span class="built_in">ui</span>(<span class="keyword">new</span> Ui::MainWindow)</span><br><span class="line">&#123;</span><br><span class="line">    ui-&gt;<span class="built_in">setupUi</span>(<span class="keyword">this</span>);</span><br><span class="line">    <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;è¿™æ˜¯æµ‹è¯•æ‰“å°ç¨‹åº&quot;</span> &lt;&lt; <span class="string">&quot; * &quot;</span> &lt;&lt; <span class="number">10000</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>è§£å†³æ–¹æ³•ï¼š</strong></p>
<ul>
<li>åœ¨<code>qt.pro</code>å·¥ç¨‹æ–‡ä»¶ä¸­ä¸­ï¼Œæ·»åŠ å¦‚ä¸‹ä»£ç ï¼š<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line">CONFIG += c++<span class="number">17</span> console			<span class="comment">//æ·»åŠ console</span></span><br></pre></td></tr></table></figure></li>
<li>å‹¾é€‰ä»¥ä¸‹é€‰é¡¹ï¼š</li>
</ul>
<p><img src="/../pictures/qt_terminal%E9%85%8D%E7%BD%AE.png" alt="qt_terminalé…ç½®"></p>
<p><strong>æ€»ç»“ï¼š</strong></p>
<ul>
<li>éœ€è¦é‡æ–°ç¼–è¯‘ä»£ç ï¼Œ<code>.exe</code>æ–‡ä»¶æ›´æ–°åç”Ÿæ•ˆã€‚</li>
<li>å†æ¬¡ç¼–è¯‘è¿è¡Œæ—¶,ä¼šå¼¹å‡º<code>terminal</code>ã€‚</li>
</ul>
]]></content>
      <categories>
        <category>å›¾å½¢ç•Œé¢</category>
      </categories>
      <tags>
        <tag>Qt</tag>
      </tags>
  </entry>
  <entry>
    <title>Makefileç¬”è®°</title>
    <url>/2024/05/08/Makefile%E7%AC%94%E8%AE%B0/</url>
    <content><![CDATA[<br>

<h2 id="makefileé—®é¢˜æ±‡æ€»"><a href="#makefileé—®é¢˜æ±‡æ€»" class="headerlink" title="makefileé—®é¢˜æ±‡æ€»"></a>makefileé—®é¢˜æ±‡æ€»</h2><h3 id="ä¿®æ”¹-hæ–‡ä»¶æ²¡æœ‰é‡æ–°ç¼–è¯‘"><a href="#ä¿®æ”¹-hæ–‡ä»¶æ²¡æœ‰é‡æ–°ç¼–è¯‘" class="headerlink" title="ä¿®æ”¹.hæ–‡ä»¶æ²¡æœ‰é‡æ–°ç¼–è¯‘"></a>ä¿®æ”¹.hæ–‡ä»¶æ²¡æœ‰é‡æ–°ç¼–è¯‘</h3><ul>
<li>å®šä¹‰<code>COMPILE_FLAGS = -MD</code>æˆ–è€…<code>-MMD</code>, ç¼–è¯‘å™¨æ ‡å¿—ï¼Œç”¨äºç”Ÿæˆ <code>.d</code> æ–‡ä»¶</li>
<li><code>$(BUILD_DIR)</code>ä¸ºç¼–è¯‘æ–‡ä»¶ç›®å½•ï¼Œè·Ÿè¿›è‡ªèº«makefileä¿®æ”¹ï¼ŒåŸæ¥çš„ç¼–è¯‘è§„åˆ™ï¼š</li>
</ul>
<figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line"><span class="keyword">-include</span> <span class="variable">$(<span class="built_in">wildcard</span> <span class="variable">$(BUILD_DIR)</span>/*/*.d)</span>	<span class="comment"># åŒ…å«æ‰€æœ‰ç”Ÿæˆçš„ä¾èµ–æ–‡ä»¶ï¼Œé¿å…é‡å¤ç¼–è¯‘ã€æé«˜æ•ˆç‡</span></span><br></pre></td></tr></table></figure>
<p><code>/*/*.d</code> ä¸ºå½“å‰ç›®å½•ä¸‹çš„äºŒçº§æ‰€æœ‰æ–‡ä»¶æ£€ç´¢ã€‚</p>
<ul>
<li>ä¿®æ”¹ä¸ºä»¥ä¸‹ç¼–è¯‘è§„åˆ™ï¼š<figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æ‰¾åˆ°æ‰€æœ‰çš„ .d æ–‡ä»¶</span></span><br><span class="line">DEP_FILES := <span class="variable">$(<span class="built_in">shell</span> find <span class="variable">$(BUILD_DIR)</span> -type f -name &#x27;*.d&#x27;)</span><span class="comment"># åŒ…å«æ‰€æœ‰ç”Ÿæˆçš„ä¾èµ–æ–‡ä»¶ï¼Œé¿å…é‡å¤ç¼–è¯‘ã€æé«˜æ•ˆç‡</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åŒ…å«æ‰€æœ‰çš„ .d æ–‡ä»¶</span></span><br><span class="line"><span class="keyword">-include</span> <span class="variable">$(DEP_FILES)</span></span><br></pre></td></tr></table></figure>
æˆ–è€…ï¼š<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">-include $(wildcard $(BUILD_DIR)<span class="comment">/**/</span>*.d)</span><br><span class="line">-include $(wildcard $(BUILD_DIR)<span class="comment">/*/*/</span>*.d)</span><br></pre></td></tr></table></figure>
<code>/**/*.d</code> å®ƒå…è®¸ä½ æœç´¢å’ŒåŒ¹é…åµŒå¥—åœ¨ä»»æ„æ·±åº¦çš„ç›®å½•ä¸­çš„æ–‡ä»¶ã€‚<br><code>/*/*/*.d</code> ä¸ºå½“å‰ç›®å½•ä¸‹çš„ä¸‰çº§æ‰€æœ‰æ–‡ä»¶æ£€ç´¢ï¼Œæ ¹æ®å…·ä½“æƒ…å†µä¿®æ”¹ã€‚</li>
</ul>
<br>

<h3 id=""><a href="#" class="headerlink" title="$&lt; å’Œ $^ çš„åŒºåˆ«"></a><code>$&lt;</code> å’Œ <code>$^</code> çš„åŒºåˆ«</h3><p>åœ¨<code>Makefile</code>ä¸­ï¼Œ<code>$&lt;</code> å’Œ <code>$^</code> æ˜¯ä¸¤ä¸ªè‡ªåŠ¨å˜é‡ï¼Œå®ƒä»¬åœ¨è§„åˆ™ä¸­ç”¨æ¥å¼•ç”¨è§„åˆ™çš„ä¾èµ–æ–‡ä»¶ï¼Œä½†å®ƒä»¬çš„ç”¨é€”å’Œè¡Œä¸ºæœ‰æ‰€ä¸åŒï¼š</p>
<ul>
<li><p><code>$&lt;</code> - ä»£è¡¨è§„åˆ™çš„ç¬¬ä¸€ä¸ªä¾èµ–æ–‡ä»¶ã€‚</p>
<ul>
<li>å½“è§„åˆ™æœ‰å¤šä¸ªä¾èµ–æ–‡ä»¶æ—¶ï¼Œ<code>$&lt;</code> åªå¼•ç”¨ç¬¬ä¸€ä¸ªä¾èµ–æ–‡ä»¶ã€‚</li>
<li>å®ƒé€šå¸¸ç”¨äºæŒ‡å®šè¦ç¼–è¯‘çš„æºæ–‡ä»¶ï¼Œç‰¹åˆ«æ˜¯åœ¨ç¼–è¯‘å•ä¸ªç›®æ ‡æ–‡ä»¶æ—¶ã€‚</li>
</ul>
</li>
<li><p><code>$^</code> - ä»£è¡¨è§„åˆ™çš„æ‰€æœ‰ä¾èµ–æ–‡ä»¶ã€‚</p>
<ul>
<li>æ— è®ºè§„åˆ™æœ‰å¤šå°‘ä¸ªä¾èµ–æ–‡ä»¶ï¼Œ<code>$^</code> éƒ½ä¼šå°†å®ƒä»¬å…¨éƒ¨åˆ—å‡ºã€‚</li>
<li>å®ƒå¸¸ç”¨äºé“¾æ¥é˜¶æ®µï¼Œå½“ä½ éœ€è¦å°†å¤šä¸ªç›®æ ‡æ–‡ä»¶é“¾æ¥æˆæœ€ç»ˆçš„å¯æ‰§è¡Œæ–‡ä»¶æ—¶ã€‚</li>
</ul>
</li>
</ul>
<p>ä¸¾ä¸ªä¾‹å­æ¥è¯´æ˜å®ƒä»¬çš„ä¸åŒï¼š</p>
<figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line"><span class="comment"># å‡è®¾æœ‰ä¸€ä¸ªç›®æ ‡æ–‡ä»¶ main.o éœ€è¦ä¸¤ä¸ªæºæ–‡ä»¶ main.c å’Œ utils.c æ¥ç”Ÿæˆ</span></span><br><span class="line"><span class="section">main.o: main.c utils.c</span></span><br><span class="line">    <span class="variable">$(CC)</span> <span class="variable">$(CFLAGS)</span> -c main.c -o <span class="variable">$@</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ$&lt; å°±æ˜¯ main.cï¼Œè€Œ $^ å°±æ˜¯ main.c utils.c</span></span><br></pre></td></tr></table></figure>

<p>å†çœ‹ä¸€ä¸ªç¤ºä¾‹ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line"><span class="variable">$(BUILD_DIR)</span>/%.o: %.c</span><br><span class="line">	@mkdir -p <span class="variable">$(<span class="built_in">dir</span> <span class="variable">$@</span>)</span></span><br><span class="line">	<span class="variable">$(CC)</span> <span class="variable">$(CFLAGS)</span> <span class="variable">$(INCLUDE)</span> <span class="variable">$&lt;</span> -o <span class="variable">$@</span></span><br></pre></td></tr></table></figure>
<p>è¿™ä¸ªè§„åˆ™çš„æ„æ€æ˜¯ï¼Œå¯¹äº<code>$(BUILD_DIR)</code>ç›®å½•ä¸‹çš„æ¯ä¸ª<code>.o</code>æ–‡ä»¶ï¼Œéƒ½æœ‰ä¸€ä¸ªå¯¹åº”çš„<code>.c</code>æ–‡ä»¶ã€‚åœ¨<code>Makefile</code>ä¸­ï¼Œ<code>$&lt;</code> æ˜¯ä¸€ä¸ªè‡ªåŠ¨å˜é‡ï¼Œå®ƒä»£è¡¨å½“å‰è§„åˆ™çš„ç¬¬ä¸€ä¸ªä¾èµ–æ–‡ä»¶ã€‚ç„¶è€Œï¼Œ<code>$&lt;</code> å¹¶ä¸ä¼šç›´æ¥ä¾èµ–æ‰€æœ‰çš„ <code>.c</code> æ–‡ä»¶ï¼Œè€Œæ˜¯ä¾èµ–äºå½“å‰è§„åˆ™çš„ <strong>ç¬¬ä¸€ä¸ªä¾èµ–æ–‡ä»¶</strong>ã€‚</p>
<p>æ€»ç»“ä¸€ä¸‹ï¼š</p>
<ul>
<li>ä½¿ç”¨ <code>$&lt;</code> æ—¶ï¼Œåªæœ‰ç¬¬ä¸€ä¸ªä¾èµ–æ–‡ä»¶ä¼šè¢«è€ƒè™‘ã€‚</li>
<li>ä½¿ç”¨ <code>$^</code> æ—¶ï¼Œæ‰€æœ‰ä¾èµ–æ–‡ä»¶éƒ½ä¼šè¢«è€ƒè™‘ã€‚</li>
</ul>
<p>åœ¨å®é™…ç¼–å†™Makefileæ—¶ï¼Œæ ¹æ®ä½ çš„éœ€è¦é€‰æ‹©åˆé€‚çš„å˜é‡ã€‚</p>
<br>

<h3 id="makefileä¼ªæŒ‡ä»¤"><a href="#makefileä¼ªæŒ‡ä»¤" class="headerlink" title="makefileä¼ªæŒ‡ä»¤"></a>makefileä¼ªæŒ‡ä»¤</h3><p>åœ¨ <code>Makefile</code> ä¸­ï¼Œ<code>.PHONY</code> æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„å£°æ˜ï¼Œç”¨æ¥æŒ‡å‡ºä¸€äº›ç›®æ ‡å¹¶ä¸æ˜¯å®é™…çš„æ–‡ä»¶ï¼Œè€Œæ˜¯ä¸€äº›éœ€è¦æ‰§è¡Œçš„å‘½ä»¤åºåˆ—ã€‚è¿™æ ·åšå¯ä»¥è®© <code>Make</code> å·¥å…·åœ¨é‡åˆ°åŒåæ–‡ä»¶æ—¶ï¼Œä¸ä¼šè¯¯è®¤ä¸ºè¿™äº›ç›®æ ‡æ˜¯è¦æ“ä½œçš„æ–‡ä»¶ï¼Œè€Œæ˜¯è¦æ‰§è¡Œçš„å‘½ä»¤ã€‚</p>
<figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line">.PHONY : clean all copy mix download</span><br><span class="line"></span><br><span class="line"><span class="section">all: <span class="variable">$(TARGET)</span>.bin <span class="variable">$(TARGET)</span>.list <span class="variable">$(TARGET)</span>.hex</span></span><br><span class="line">	<span class="variable">$(SZ)</span> <span class="variable">$(TARGET)</span>.elf</span><br><span class="line">	@make copy</span><br><span class="line">	@make mix</span><br><span class="line">	</span><br><span class="line"><span class="section">copy: <span class="variable">$(TARGET)</span>.bin</span></span><br><span class="line">	cp <span class="variable">$(TARGET)</span>.bin app.bin</span><br><span class="line">	cp ../bootloader/bootloader.bin bootloader.bin</span><br><span class="line"><span class="comment">#	cp $(TARGET).hex app.hex</span></span><br><span class="line"></span><br><span class="line"><span class="section">mix:</span></span><br><span class="line">	./tools/papp_up</span><br><span class="line">	./tools/mix_10K</span><br><span class="line">	<span class="variable">$(OC)</span> -I binary -O ihex --change-addresses 0x8000000 mix.bin mix.hex</span><br><span class="line">	rm bootloader.bin</span><br><span class="line">	rm app.bin</span><br><span class="line">	rm mix.bin</span><br><span class="line"></span><br><span class="line"><span class="section">clean:</span></span><br><span class="line">	rm -rf <span class="variable">$(BUILD_DIR)</span></span><br><span class="line">	rm papp.bin</span><br><span class="line">	rm mix.hex</span><br></pre></td></tr></table></figure>

<ul>
<li><code>Makefile</code>é»˜è®¤æ‰§è¡Œçš„æ˜¯ <strong>ç¬¬ä¸€ä¸ªç›®æ ‡</strong>ï¼ˆä¸åŒ…æ‹¬ä»¥ç‚¹å¼€å¤´çš„ç›®æ ‡ï¼‰<code>all</code>ï¼Œè€Œä¸æ˜¯ <code>.PHONY</code> åçš„ç¬¬ä¸€ä¸ªç›®æ ‡ã€‚<code>.PHONY</code> å®çš„ä½œç”¨æ˜¯é˜²æ­¢<code>Make</code>é”™è¯¯åœ°å°†ä¼ªç›®æ ‡ä¸æ–‡ä»¶ç³»ç»Ÿä¸­çš„æ–‡ä»¶æ··æ·†ã€‚</li>
<li><code>make</code>ä¼šåŠ è½½ä¾èµ–<code>$(TARGET).bin</code> <code>$(TARGET).list</code> <code>$(TARGET).hex</code> <code>$(SZ) $(TARGET).elf</code>ã€‚</li>
<li><code>@</code>ç¬¦å·ä½¿å¾— <code>Make</code> å·¥å…·åœ¨æ‰§è¡Œå‘½ä»¤æ—¶ä¸ä¼šæ‰“å°è¯¥å‘½ä»¤æœ¬èº«,å¦‚<code>make copy</code>ã€‚</li>
<li><strong>æ‹“å±•</strong>ï¼š<code>$(OC) -I binary -O ihex --change-addresses 0x8000000 mix.bin mix.hex</code>è¡¨ç¤ºå°† <code>mix.bin</code> çš„äºŒè¿›åˆ¶æ–‡ä»¶è½¬æ¢ä¸ºåä¸º <code>mix.hex</code> çš„ <code>Intel HEX</code>æ ¼å¼æ–‡ä»¶ï¼Œå¹¶å°†æ‰€æœ‰åœ°å€åç§»è®¾ç½®ä¸º <code>0x8000000</code></li>
</ul>
<br>

<h2 id="n32g452rcçš„makefileè§£æ"><a href="#n32g452rcçš„makefileè§£æ" class="headerlink" title="n32g452rcçš„makefileè§£æ"></a>n32g452rcçš„makefileè§£æ</h2><p><strong><code>makefile</code>æºç ï¼š</strong></p>
<figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Cç¼–è¯‘å™¨çš„å®å®šä¹‰</span></span><br><span class="line">C_DEFS +=  \</span><br><span class="line">-DN32G45X \</span><br><span class="line">-DUSE_STDPERIPH_DRIVER</span><br><span class="line"></span><br><span class="line"><span class="comment"># Cç¼–è¯‘å™¨çš„å¤´æ–‡ä»¶æœç´¢è·¯å¾„</span></span><br><span class="line">INCLUDE +=  \</span><br><span class="line">-ICMSIS/core  \</span><br><span class="line">-ICMSIS/device	\</span><br><span class="line">-Istd_periph_lib/inc</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># APPæºæ–‡ä»¶</span></span><br><span class="line">C_APP_SOURCES +=  \</span><br><span class="line">application/main.c \</span><br><span class="line">application/n32g45x_it.c</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸­é—´å±‚é©±åŠ¨æºæ–‡ä»¶</span></span><br><span class="line">C_DRV_SOURCES +=  \</span><br><span class="line">msp/drv_msp.c \</span><br><span class="line"><span class="variable">$(<span class="built_in">wildcard</span> rtt-nano/src/*.c)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Cç¼–è¯‘å™¨çš„åº•å±‚é©±åŠ¨æºæ–‡ä»¶</span></span><br><span class="line">C_LIB_SOURCES +=  \</span><br><span class="line">CMSIS/device/system_n32g45x.c \</span><br><span class="line">std_periph_lib/src/misc.c \</span><br><span class="line">std_periph_lib/src/n32g45x_rcc.c</span><br><span class="line"></span><br><span class="line">C_SOURCES += <span class="variable">$(C_LIB_SOURCES)</span></span><br><span class="line">C_SOURCES += <span class="variable">$(C_APP_SOURCES)</span></span><br><span class="line">C_SOURCES += <span class="variable">$(C_DRV_SOURCES)</span></span><br><span class="line"></span><br><span class="line">ASM_SOURCES +=  \</span><br><span class="line">CMSIS/device/startup/startup_n32g45x_gcc.S \</span><br><span class="line">rtt-nano/libcpu/arm/cortex-m4/context_gcc.S</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŒ‡å®šäº¤å‰ç¼–è¯‘å·¥å…·é“¾çš„ ç¼–è¯‘å™¨ã€è¿æ¥å™¨ã€åº“ç®¡ç†å™¨ã€</span></span><br><span class="line">CROSS_COMPILE=arm-none-eabi-</span><br><span class="line">CC=<span class="variable">$(CROSS_COMPILE)</span>gcc</span><br><span class="line">LD=<span class="variable">$(CROSS_COMPILE)</span>ld</span><br><span class="line">AR=<span class="variable">$(CROSS_COMPILE)</span>ar</span><br><span class="line">AS=<span class="variable">$(CROSS_COMPILE)</span>as</span><br><span class="line">OC=<span class="variable">$(CROSS_COMPILE)</span>objcopy</span><br><span class="line">OD=<span class="variable">$(CROSS_COMPILE)</span>objdump</span><br><span class="line">SZ=<span class="variable">$(CROSS_COMPILE)</span>size</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŒ‡å®šç›®æ ‡ç¡¬ä»¶çš„æ¶æ„å’Œæµ®ç‚¹è¿ç®—å•å…ƒ   -mfpu=fpv4-sp-d16 -mfloat-abi=hard -mfloat-abi=soft </span></span><br><span class="line">MCU = -mcpu=cortex-m4 -mthumb \</span><br><span class="line">	-ffunction-sections \</span><br><span class="line">	-fdata-sections \</span><br><span class="line">	--specs=nano.specs \</span><br><span class="line">	--specs=nosys.specs \</span><br><span class="line">	-Os -ggdb</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®šä¹‰ç¼–è¯‘Cæºæ–‡ä»¶çš„ç¼–è¯‘é€‰é¡¹ï¼šç¦ç”¨å…±äº«å˜é‡ã€å‡½æ•°å’Œæ•°æ®åˆ†æ®µã€ä¼˜åŒ–çº§åˆ«ã€è°ƒè¯•ä¿¡æ¯çº§åˆ«ã€å¼€å¯æ‰€æœ‰è­¦å‘Šã€ç›®æ ‡æ¶æ„ã€é¢„å®šä¹‰å®</span></span><br><span class="line"><span class="comment"># O0:ç¦ç”¨ä¼˜åŒ–ï¼ŒO1ï¼šåŸºæœ¬ä¼˜åŒ–ï¼ŒO2, O3, Os</span></span><br><span class="line"><span class="comment"># g0:ç¦ç”¨è°ƒè¯•ä¿¡æ¯, g1, g2, g3, g</span></span><br><span class="line">CFLAGS += -c -fno-common \</span><br><span class="line">	--specs=rdimon.specs \</span><br><span class="line">	-std=gnu99 -mabi=aapcs \</span><br><span class="line">	-Wall \</span><br><span class="line">	<span class="variable">$(MCU)</span> \</span><br><span class="line">	<span class="variable">$(C_DEFS)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®šä¹‰é“¾æ¥å™¨è„šæœ¬ã€é“¾æ¥é€‰é¡¹ã€ç›®æ ‡æ–‡ä»¶æ ¼å¼è½¬æ¢é€‰é¡¹ã€åæ±‡ç¼– -nostdlib -lnosys</span></span><br><span class="line">LDSCRIPT=n32g452_flash.ld</span><br><span class="line">LDFLAGS += -Wl,--gc-sections --data-sections -mabi=aapcs <span class="variable">$(MCU)</span> -T<span class="variable">$(LDSCRIPT)</span> \</span><br><span class="line">	-x assembler-with-cpp -Wa,-mimplicit-it=thumb</span><br><span class="line"></span><br><span class="line"><span class="comment"># printfæ‰“å°æµ®ç‚¹æ•°</span></span><br><span class="line"><span class="comment"># LDFLAGS += -lc -lrdimon -u _printf_float</span></span><br><span class="line"></span><br><span class="line">OCFLAGS	= -Obinary</span><br><span class="line">ODFLAGS	= -S</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#è¾“å‡ºç›®å½•å’Œç›®æ ‡æ–‡ä»¶å</span></span><br><span class="line">BUILD_DIR = build</span><br><span class="line">TARGET  = <span class="variable">$(BUILD_DIR)</span>/app</span><br><span class="line"></span><br><span class="line"><span class="comment"># Cæºæ–‡ä»¶ã€æ±‡ç¼–æºæ–‡ä»¶çš„ç›®æ ‡æ–‡ä»¶è·¯å¾„</span></span><br><span class="line">C_OBJECTS = <span class="variable">$(<span class="built_in">addprefix</span> <span class="variable">$(BUILD_DIR)</span>/, $(C_SOURCES:.c=.o)</span>)</span><br><span class="line">ASM_OBJECTS = <span class="variable">$(<span class="built_in">addprefix</span> <span class="variable">$(BUILD_DIR)</span>/, $(ASM_SOURCES:.S=.o)</span>)</span><br><span class="line">OBJECTS += <span class="variable">$(ASM_OBJECTS)</span> <span class="variable">$(C_OBJECTS)</span></span><br><span class="line"></span><br><span class="line">.PHONY : clean all</span><br><span class="line"></span><br><span class="line"><span class="section">all: <span class="variable">$(TARGET)</span>.bin <span class="variable">$(TARGET)</span>.list <span class="variable">$(TARGET)</span>.hex</span></span><br><span class="line">	<span class="variable">$(SZ)</span> <span class="variable">$(TARGET)</span>.elf</span><br><span class="line">	@make copy</span><br><span class="line">	@make mix</span><br><span class="line"></span><br><span class="line"><span class="meta"><span class="keyword">.PHONY</span>: copy</span></span><br><span class="line"></span><br><span class="line"><span class="section">copy: <span class="variable">$(TARGET)</span>.bin</span></span><br><span class="line">	cp <span class="variable">$(TARGET)</span>.bin app.bin</span><br><span class="line">	cp ../bootloader/bootloader.bin bootloader.bin</span><br><span class="line"><span class="comment">#	cp $(TARGET).hex app.hex</span></span><br><span class="line"></span><br><span class="line"><span class="section">mix:</span></span><br><span class="line">	./tools/papp_up</span><br><span class="line">	./tools/mix_10K</span><br><span class="line">	<span class="variable">$(OC)</span> -I binary -O ihex --change-addresses 0x8000000 mix.bin mix.hex</span><br><span class="line">	rm bootloader.bin</span><br><span class="line">	rm app.bin</span><br><span class="line">	rm mix.bin</span><br><span class="line"></span><br><span class="line"><span class="section">clean:</span></span><br><span class="line">	rm -rf <span class="variable">$(BUILD_DIR)</span></span><br><span class="line">	rm papp.bin</span><br><span class="line">	rm mix.hex</span><br><span class="line"></span><br><span class="line">SYS := <span class="variable">$(<span class="built_in">shell</span> uname -a)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">ifeq</span> (<span class="variable">$(<span class="built_in">findstring</span> Microsoft,<span class="variable">$(SYS)</span>)</span>,Microsoft)</span><br><span class="line"><span class="section">COPY_CMD:</span></span><br><span class="line">	cp <span class="variable">$(TARGET)</span>.hex <span class="string">&quot;/mnt/c/Users/Breo/Desktop/iap-tools/linux_download&quot;</span></span><br><span class="line">	wsl.exe -d Ubuntu-20.04 cmd.exe /c <span class="string">&quot;C:\\\Users\\\BREO\\\Desktop\\\iap-tools\\\linux_download\\\program452RC.bat&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="section">COPY_CMD:</span></span><br><span class="line">	echo <span class="string">&quot;å½“å‰ç³»ç»Ÿä¸æ˜¯ WSLï¼Œè·³è¿‡æ‹·è´æ–‡ä»¶æŒ‡ä»¤&quot;</span></span><br><span class="line"><span class="keyword">endif</span></span><br><span class="line"></span><br><span class="line"><span class="section">download:</span></span><br><span class="line">	@make all</span><br><span class="line">	@<span class="variable">$(MAKE)</span> COPY_CMD</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®šä¹‰ç”Ÿæˆç›®æ ‡æ–‡ä»¶çš„è§„åˆ™</span></span><br><span class="line"><span class="variable">$(TARGET)</span>.list: <span class="variable">$(TARGET)</span>.elf</span><br><span class="line">	<span class="variable">$(OD)</span> <span class="variable">$(ODFLAGS)</span> <span class="variable">$&lt;</span> &gt; <span class="variable">$(TARGET)</span>.lst</span><br><span class="line"></span><br><span class="line"><span class="variable">$(TARGET)</span>.bin: <span class="variable">$(TARGET)</span>.elf</span><br><span class="line">	<span class="variable">$(OC)</span> <span class="variable">$(OCFLAGS)</span> <span class="variable">$(TARGET)</span>.elf <span class="variable">$(TARGET)</span>.bin</span><br><span class="line"></span><br><span class="line"><span class="variable">$(TARGET)</span>.elf: <span class="variable">$(OBJECTS)</span></span><br><span class="line">	<span class="variable">$(CC)</span> <span class="variable">$(ASM_OBJECTS)</span> <span class="variable">$(C_OBJECTS)</span> <span class="variable">$(LDFLAGS)</span> -Wl,-Map=<span class="variable">$(TARGET)</span>.map -o <span class="variable">$(TARGET)</span>.elf</span><br><span class="line"></span><br><span class="line"><span class="variable">$(TARGET)</span>.hex: <span class="variable">$(TARGET)</span>.elf</span><br><span class="line">	<span class="variable">$(OC)</span> -O ihex <span class="variable">$&lt;</span> <span class="variable">$@</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®šä¹‰ç¼–è¯‘Cæºæ–‡ä»¶ã€æ±‡ç¼–æºæ–‡ä»¶çš„è§„åˆ™ï¼Œå°†æºæ–‡ä»¶ç¼–è¯‘æˆç›®æ ‡æ–‡ä»¶</span></span><br><span class="line"><span class="variable">$(BUILD_DIR)</span>/%.o: %.c</span><br><span class="line">	mkdir -p <span class="variable">$(<span class="built_in">dir</span> <span class="variable">$@</span>)</span></span><br><span class="line">	<span class="variable">$(CC)</span> <span class="variable">$(INCLUDE)</span> <span class="variable">$(CFLAGS)</span> -MMD -c <span class="variable">$&lt;</span> -o <span class="variable">$@</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$(BUILD_DIR)</span>/%.o: %.S</span><br><span class="line">	mkdir -p <span class="variable">$(<span class="built_in">dir</span> <span class="variable">$@</span>)</span></span><br><span class="line">	<span class="variable">$(CC)</span> <span class="variable">$(INCLUDE)</span> <span class="variable">$(CFLAGS)</span> -c <span class="variable">$&lt;</span> -o <span class="variable">$@</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#-include $(wildcard $(BUILD_DIR)/**/*.d)	# åŒ…å«æ‰€æœ‰ç”Ÿæˆçš„ä¾èµ–æ–‡ä»¶ï¼Œé¿å…é‡å¤ç¼–è¯‘ã€æé«˜æ•ˆç‡</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‰¾åˆ°æ‰€æœ‰çš„ .d æ–‡ä»¶</span></span><br><span class="line">DEP_FILES := <span class="variable">$(<span class="built_in">shell</span> find <span class="variable">$(BUILD_DIR)</span> -type f -name &#x27;*.d&#x27;)</span><span class="comment"># åŒ…å«æ‰€æœ‰ç”Ÿæˆçš„ä¾èµ–æ–‡ä»¶ï¼Œé¿å…é‡å¤ç¼–è¯‘ã€æé«˜æ•ˆç‡</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åŒ…å«æ‰€æœ‰çš„ .d æ–‡ä»¶</span></span><br><span class="line"><span class="keyword">-include</span> <span class="variable">$(DEP_FILES)</span></span><br></pre></td></tr></table></figure>
<p>ä¸‹é¢æ˜¯å¯¹è¿™æ®µä»£ç çš„é€å¥åˆ†æï¼š</p>
<ol>
<li><p>å®å®šä¹‰ (<code>C_DEFS</code>):</p>
<ul>
<li><code>-DN32G45X</code> å’Œ <code>-DUSE_STDPERIPH_DRIVER</code> æ˜¯ç¼–è¯‘å™¨çš„å®å®šä¹‰ï¼Œç”¨äºåœ¨ç¼–è¯‘æ—¶å®šä¹‰ç‰¹å®šçš„é¢„å¤„ç†å˜é‡ã€‚</li>
</ul>
</li>
</ol>
<br>

<ol start="2">
<li><p>å¤´æ–‡ä»¶æœç´¢è·¯å¾„ (<code>INCLUDE</code>):</p>
<p> <code>-ICMSIS/core</code>, <code>-ICMSIS/device</code>, <code>-Istd_periph_lib/inc</code> æŒ‡å®šäº†ç¼–è¯‘å™¨æœç´¢å¤´æ–‡ä»¶çš„è·¯å¾„ã€‚</p>
</li>
</ol>
<br>

<ol start="3">
<li><p>åº”ç”¨å±‚æºæ–‡ä»¶ (<code>C_APP_SOURCES</code>):</p>
<ul>
<li>åˆ—å‡ºäº†åº”ç”¨å±‚çš„ <code>C</code> æºæ–‡ä»¶ã€‚</li>
</ul>
</li>
</ol>
<br>

<ol start="4">
<li><p>ä¸­é—´å±‚é©±åŠ¨æºæ–‡ä»¶ (<code>C_DRV_SOURCES</code>):</p>
<ul>
<li>ä½¿ç”¨ $(wildcard rtt-nano&#x2F;src&#x2F;*.c) æ¥åŒ¹é… rtt-nano&#x2F;src ç›®å½•ä¸‹çš„æ‰€æœ‰ .c æ–‡ä»¶ã€‚</li>
</ul>
</li>
</ol>
<br>

<ol start="5">
<li><p>åº•å±‚é©±åŠ¨æºæ–‡ä»¶ (<code>C_LIB_SOURCES</code>):</p>
<ul>
<li>åˆ—å‡ºäº†åº•å±‚é©±åŠ¨çš„ C æºæ–‡ä»¶ã€‚</li>
</ul>
</li>
</ol>
<br>

<ol start="6">
<li><p>æºæ–‡ä»¶æ±‡æ€» (<code>C_SOURCES</code>):</p>
<ul>
<li>å°†åº”ç”¨å±‚ã€ä¸­é—´å±‚å’Œåº•å±‚é©±åŠ¨çš„æºæ–‡ä»¶æ±‡æ€»åˆ° <code>C_SOURCESã€‚</code></li>
</ul>
</li>
</ol>
<br>

<ol start="7">
<li><p>æ±‡ç¼–æºæ–‡ä»¶ (<code>ASM_SOURCES</code>):</p>
<ul>
<li>åˆ—å‡ºäº†æ±‡ç¼–è¯­è¨€çš„æºæ–‡ä»¶ã€‚</li>
</ul>
</li>
</ol>
<br>

<ol start="8">
<li><p>äº¤å‰ç¼–è¯‘å·¥å…·é“¾ (<code>CROSS_COMPILE</code>, <code>CC</code>, <code>LD</code>, <code>AR</code>, <code>AS</code>, <code>OC</code>, <code>OD</code>, <code>SZ</code>):</p>
<ul>
<li>å®šä¹‰äº†äº¤å‰ç¼–è¯‘å·¥å…·é“¾çš„å‰ç¼€å’Œå„ä¸ªå·¥å…·ï¼ˆç¼–è¯‘å™¨ã€é“¾æ¥å™¨ã€åº“ç®¡ç†å™¨ç­‰ï¼‰çš„å‘½ä»¤ã€‚</li>
</ul>
</li>
</ol>
<br>

<ol start="9">
<li><p>ç›®æ ‡ç¡¬ä»¶çš„æ¶æ„å’Œæµ®ç‚¹è¿ç®—å•å…ƒ (<code>MCU</code>):</p>
<ul>
<li><p><code>-mcpu=cortex-m4</code>:</p>
<ul>
<li>ç¼–è¯‘å™¨ç›®æ ‡å¤„ç†å™¨æ˜¯ <code>Cortex-M4</code> CPU</li>
<li><code>-mcpu=</code> åé¢è·Ÿçš„æ˜¯å…·ä½“çš„ç›®æ ‡ CPU å‹å·</li>
</ul>
</li>
<li><p><code>-mthumb</code>:</p>
<ul>
<li>ç¼–è¯‘å™¨ç”Ÿæˆ <code>Thumb</code> æŒ‡ä»¤é›†çš„ä»£ç ã€‚<code>Thumb</code> æŒ‡ä»¤é›†æ˜¯ <code>ARM</code> æ¶æ„çš„ä¸€ç§<code>16ä½æŒ‡ä»¤é›†</code>,ç”¨äºåµŒå…¥å¼ç³»ç»Ÿä»¥å‡å°‘å†…å­˜å ç”¨å’Œæé«˜ä»£ç å¯†åº¦ã€‚</li>
</ul>
</li>
<li><p><code>-ffunction-sections</code>:</p>
<ul>
<li>å…è®¸ç¼–è¯‘å™¨å°† <strong>æ¯ä¸ªå‡½æ•°</strong> åˆ†åˆ«æ”¾å…¥ç¨‹åºçš„ <strong>å•ç‹¬æ®µ</strong> ä¸­ã€‚è¿™å¯ä»¥ä½¿å¾—é“¾æ¥å™¨åœ¨æœ€ç»ˆçš„é“¾æ¥é˜¶æ®µä¸¢å¼ƒæœªä½¿ç”¨çš„å‡½æ•°ï¼Œä»è€Œ<em>å‡å°æœ€ç»ˆå›ºä»¶çš„å¤§å°</em>ã€‚</li>
</ul>
</li>
<li><p><code>-fdata-sections</code>:</p>
<ul>
<li>ç±»ä¼¼äº <code>-ffunction-sections</code>ï¼Œè¿™ä¸ªé€‰é¡¹å…è®¸ç¼–è¯‘å™¨å°† <strong>ä¸åŒçš„æ•°æ®</strong> æ”¾å…¥ç¨‹åºçš„ <strong>ä¸åŒæ®µ</strong> ä¸­ã€‚è¿™åŒæ ·æœ‰åŠ©äºé“¾æ¥å™¨ä¼˜åŒ–ï¼Œ<code>ç§»é™¤æœªä½¿ç”¨çš„æ•°æ®æ®µ</code>ã€‚</li>
</ul>
</li>
<li><p><code>--specs=nano.specs</code>:</p>
<ul>
<li>è¿™ä¸ªé€‰é¡¹æŒ‡å®šä½¿ç”¨æ–°<code>libnano</code>è§„æ ¼ï¼Œè¿™æ˜¯é’ˆå¯¹å°å‹åµŒå…¥å¼ç³»ç»Ÿçš„ <strong>C æ ‡å‡†åº“çš„ç¼©å‡ç‰ˆæœ¬</strong>ã€‚å®ƒæä¾›äº†æ¯”æ ‡å‡†<code> C</code> åº“ <strong>æ›´å°çš„å ç”¨ç©ºé—´</strong>ï¼Œé€‚åˆèµ„æºå—é™çš„ç³»ç»Ÿã€‚</li>
</ul>
</li>
<li><p><code>--specs=nosys.specs</code>:</p>
<ul>
<li>è¿™ä¸ªé€‰é¡¹æŒ‡å®šç¼–è¯‘å™¨ä½¿ç”¨ <code>nosys</code> ä½œä¸ºç³»ç»Ÿè°ƒç”¨çš„é»˜è®¤è¿”å›å€¼ã€‚åœ¨åµŒå…¥å¼ç³»ç»Ÿä¸­ï¼Œç³»ç»Ÿè°ƒç”¨å¯èƒ½å¹¶ä¸æ€»æ˜¯å¯ç”¨ï¼Œè¿™ä¸ªé€‰é¡¹ <strong>å…è®¸ç¼–è¯‘å™¨ç”Ÿæˆä¸ä¾èµ–ç³»ç»Ÿè°ƒç”¨çš„ä»£ç </strong>ã€‚</li>
</ul>
</li>
<li><p><code>-Os</code>:</p>
<ul>
<li>è¿™ä¸ªé€‰é¡¹æŒ‡ç¤ºç¼–è¯‘å™¨<code>ä¼˜åŒ–å¤§å°</code>ã€‚ç¼–è¯‘å™¨ä¼šå°è¯•åœ¨ä¸ç‰ºç‰²å¤ªå¤šæ€§èƒ½çš„æƒ…å†µä¸‹ï¼Œç”Ÿæˆå°½å¯èƒ½å°çš„ä»£ç ã€‚è¿˜æœ‰ <code>-O0(æ— ä¼˜åŒ–)</code>, <code>-O1</code>, <code>-O2</code>, <code>-O3</code>, <code>-Og</code>(ä¼˜åŒ–è°ƒè¯•,ä¸æ˜¯ä¼˜åŒ–æ€§èƒ½æˆ–å¤§å°)</li>
</ul>
</li>
<li><p><code>-ggdb</code>:</p>
<ul>
<li>è¿™ä¸ªé€‰é¡¹ç”¨äºç”Ÿæˆè°ƒè¯•ä¿¡æ¯ã€‚<code>-g</code> è®©ç¼–è¯‘å™¨åœ¨å¯¹è±¡æ–‡ä»¶ä¸­åŒ…å«è°ƒè¯•ä¿¡æ¯ï¼Œä½¿å¾—å¼€å‘è€…å¯ä»¥ä½¿ç”¨è°ƒè¯•å™¨ï¼ˆå¦‚ <code>GDB</code>ï¼‰æ¥è°ƒè¯•ç¨‹åºã€‚</li>
</ul>
</li>
<li><p><code>-mfpu=fpv4-sp-d16</code>(æœªä½¿ç”¨):</p>
<ul>
<li>ç¬¦åˆ <code>FPU ç‰ˆæœ¬ 4ï¼ˆFPv4ï¼‰</code>çš„æµ®ç‚¹å•å…ƒï¼Œå®ƒæ”¯æŒå•ç²¾åº¦ï¼ˆ<code>single-precision</code>ï¼‰å’ŒåŒç²¾åº¦ï¼ˆ<code>double-precision</code>ï¼‰æµ®ç‚¹è¿ç®—ã€‚<code>-sp-d16</code> è¡¨ç¤ºè¯¥ <code>FPU</code> æ‹¥æœ‰ <code>16</code> ä¸ªåŒç²¾åº¦å¯„å­˜å™¨ï¼Œå®ƒä»¬è¢«ç»„ç»‡ä¸º <code>32</code> ä¸ªå•ç²¾åº¦å¯„å­˜å™¨ã€‚</li>
</ul>
</li>
<li><p><code>-mfloat-abi=hard</code>(æœªä½¿ç”¨):</p>
<ul>
<li>è¿™ä¸ªé€‰é¡¹æŒ‡å®šä½¿ç”¨â€œç¡¬â€æµ®ç‚¹ <code>ABI</code>ï¼Œæ„å‘³ç€æµ®ç‚¹è¿ç®—å°†ä½¿ç”¨ç›®æ ‡ç¡¬ä»¶çš„ FPU æ‰§è¡Œï¼Œå¹¶ä¸”æµ®ç‚¹å‡½æ•°ï¼ˆå¦‚ <code>sin</code>ã€<code>cos</code>ã€<code>sqrt</code> ç­‰ï¼‰å°†è¢«å®ç°ä¸ºç›´æ¥è°ƒç”¨ç¡¬ä»¶æ”¯æŒçš„æµ®ç‚¹æŒ‡ä»¤ã€‚è¿™é€šå¸¸å¯ä»¥æé«˜æ€§èƒ½ï¼Œå› ä¸º <strong>æµ®ç‚¹è¿ç®—æ›´å¿«</strong>ï¼Œä½†å¯èƒ½ä¼š <strong>å¢åŠ å›ºä»¶çš„å¤§å°</strong>ï¼Œå› ä¸ºéœ€è¦åŒ…å« FPU çš„æŒ‡ä»¤é›†ã€‚</li>
</ul>
</li>
<li><p><code>-mfloat-abi=soft</code>(æœªä½¿ç”¨):</p>
<ul>
<li>soft æµ®ç‚¹ ABI æŒ‡å®šæµ®ç‚¹è¿ç®—å°†é€šè¿‡è½¯ä»¶åº“å®ç°ï¼Œè€Œä¸æ˜¯ç›´æ¥ä½¿ç”¨ç¡¬ä»¶ FPUã€‚è¿™ç§æ–¹å¼å¯ä»¥ <strong>ç”Ÿæˆæ›´å°çš„ä»£ç </strong>ï¼Œå› ä¸ºä¸éœ€è¦åŒ…å« FPU çš„æŒ‡ä»¤é›†ï¼Œä½†è¿è¡Œæ—¶çš„ <strong>æµ®ç‚¹è¿ç®—ä¼šè¾ƒæ…¢</strong>ï¼Œå› ä¸ºå®ƒä»¬éœ€è¦é€šè¿‡è½¯ä»¶æ¨¡æ‹Ÿã€‚</li>
</ul>
</li>
</ul>
<p> <strong>æ³¨æ„ï¼š</strong><code>-mfpu=fpv4-sp-d16</code> ä¸ <code>-mfloat-abi=hard</code> æˆ– <code>-mfloat-abi=soft</code> é€‰é¡¹ä¸€èµ·ä½¿ç”¨ã€‚</p>
</li>
</ol>
<br>

<ol start="10">
<li>ç¼–è¯‘é€‰é¡¹ (<code>CFLAGS</code>):<br>å®šä¹‰äº†ç¼–è¯‘ <code>C</code> æºæ–‡ä»¶æ—¶ä½¿ç”¨çš„é€‰é¡¹,<code>$(MCU)</code> å’Œ <code>$(C_DEFS)</code>ä¸Šé¢æœ‰è§£é‡Šï¼Œä¸è¿‡å¤šé˜è¿°ã€‚<ul>
<li><code>-c</code>:<ul>
<li>è¿™ä¸ªé€‰é¡¹å‘Šè¯‰ç¼–è¯‘å™¨ <strong>ä»…ç¼–è¯‘æºä»£ç </strong> æ–‡ä»¶è€Œ <strong>ä¸è¿›è¡Œé“¾æ¥</strong>ã€‚ç¼–è¯‘å™¨ä¼šä¸ºæ¯ä¸ªæºæ–‡ä»¶ç”Ÿæˆä¸€ä¸ªç›®æ ‡ï¼ˆ<code>object</code>ï¼‰æ–‡ä»¶ï¼Œè¿™äº›ç›®æ ‡æ–‡ä»¶ <strong>éšåå¯ä»¥è¢«é“¾æ¥</strong> å™¨é“¾æ¥æˆ<strong>å¯æ‰§è¡Œæ–‡ä»¶</strong>æˆ–<strong>åº“</strong>ã€‚</li>
</ul>
</li>
<li><code>-fno-common</code>:<ul>
<li>åœ¨ä¸€äº›ç³»ç»Ÿä¸­ï¼Œ<code>-fcommon</code> æ˜¯é»˜è®¤è¡Œä¸ºï¼Œå®ƒå…è®¸å­˜åœ¨å¤šä¸ªæœªåˆå§‹åŒ–çš„ç›¸åŒå¤§å°çš„å…¨å±€å˜é‡æˆ–é™æ€å˜é‡ï¼Œå®ƒä»¬åœ¨<strong>é“¾æ¥æ—¶åˆå¹¶ä¸ºä¸€ä¸ª</strong>ã€‚<code>-fno-common</code> é€‰é¡¹ç¦ç”¨äº†è¿™ä¸€è¡Œä¸ºï¼Œè¦æ±‚æ¯ä¸ªå…¨å±€å˜é‡æˆ–é™æ€å˜é‡éƒ½æœ‰å…¶è‡ªå·±çš„å†…å­˜ä½ç½®ã€‚è¿™åœ¨åµŒå…¥å¼ç³»ç»Ÿæˆ–æŸäº›ç‰¹å®šç³»ç»Ÿä¸­å¯èƒ½æ˜¯å¿…éœ€çš„ã€‚</li>
</ul>
</li>
<li><code>--specs=rdimon.specs</code>:<ul>
<li>è¿™ä¸ªé€‰é¡¹æŒ‡å®šä½¿ç”¨ <code>rdimon.specs</code> æ–‡ä»¶ä½œä¸ºç¼–è¯‘å™¨çš„è§„æ ¼è¯´æ˜ã€‚è§„æ ¼è¯´æ˜æ–‡ä»¶åŒ…å«äº†ç‰¹å®šäºç³»ç»Ÿçš„ç¼–è¯‘å’Œé“¾æ¥è§„åˆ™ï¼Œ<code>rdimon.specs</code> å¯èƒ½æ˜¯æŒ‡æŸä¸ªç‰¹å®šå®æ—¶æ“ä½œç³»ç»Ÿï¼ˆ<code>RTOS</code>ï¼‰æˆ–åµŒå…¥å¼å¹³å°çš„è§„æ ¼ã€‚</li>
</ul>
</li>
<li><code>-std=gnu99</code>:<ul>
<li>è¿™ä¸ªé€‰é¡¹æŒ‡å®šç¼–è¯‘å™¨éµå¾ª <code>ISO C99</code> æ ‡å‡†ï¼ŒåŒæ—¶åŒ…æ‹¬ GNU çš„æ‰©å±•ã€‚gnu99 æ„å‘³ç€é™¤äº†æ ‡å‡†çš„ <code>C99</code> ç‰¹æ€§å¤–ï¼Œç¼–è¯‘å™¨è¿˜ä¼šæ¥å— GNU C çš„ç‰¹å®šæ‰©å±•ã€‚</li>
</ul>
</li>
<li><code>-mabi=aapcs</code>:<ul>
<li>è¿™ä¸ªé€‰é¡¹æŒ‡å®šä½¿ç”¨ <code>ARM</code> æ¶æ„ç¨‹åºè°ƒç”¨æ ‡å‡†ï¼ˆ<code>AAPCSï¼ŒARM Architecture Procedure Call Standard</code>ï¼‰ã€‚<code>AAPCS</code> å®šä¹‰äº†å‡½æ•°è°ƒç”¨æ—¶çš„å‚æ•°ä¼ é€’ã€è¿”å›å€¼ä»¥åŠå¯„å­˜å™¨ä½¿ç”¨ç­‰è§„åˆ™ã€‚</li>
</ul>
</li>
<li><code>-Wall</code>:<ul>
<li>è¿™ä¸ªé€‰é¡¹å‘Šè¯‰ç¼–è¯‘å™¨æ‰“å¼€å¤§å¤šæ•°è­¦å‘Šä¿¡æ¯ã€‚è™½ç„¶ <code>-Wall</code> å¹¶ä¸æ‰“å¼€æ‰€æœ‰çš„è­¦å‘Šé€‰é¡¹ï¼Œä½†å®ƒä¼šå¯ç”¨å¤§é‡æ ‡å‡†è­¦å‘Šï¼Œå¸®åŠ©å¼€å‘è€…å‘ç°æ½œåœ¨çš„é—®é¢˜ã€‚</li>
</ul>
</li>
</ul>
</li>
</ol>
<br>

<ol start="11">
<li><p>é“¾æ¥å™¨è„šæœ¬å’Œé“¾æ¥é€‰é¡¹ (<code>LDSCRIPT</code>, <code>LDFLAGS</code>):</p>
<ul>
<li><code>LDSCRIPT=n32g452_flash.ld</code><ul>
<li>é“¾æ¥å™¨ä½¿ç”¨çš„è„šæœ¬</li>
</ul>
</li>
<li><code>-Wl,--gc-sections</code><ul>
<li><code>Wl</code> æ˜¯å‘Šè¯‰ <code>GCC</code> åé¢çš„é€‰é¡¹æ˜¯ä¼ é€’ç»™é“¾æ¥å™¨çš„</li>
<li><code>--gc-sections</code> å‘Šè¯‰é“¾æ¥å™¨åœ¨æœ€ç»ˆçš„å¯æ‰§è¡Œæ–‡ä»¶ä¸­åˆ é™¤æœªä½¿ç”¨çš„ä»£ç æ®µï¼Œå‡å°ç¨‹åºå¤§å°ã€‚</li>
</ul>
</li>
<li><code>--data-sections</code>:<ul>
<li>è¿™ä¸ªé€‰é¡¹ç±»ä¼¼äº <code>--gc-sections</code>ï¼Œä½†å®ƒä¸“é—¨ç”¨äºæ•°æ®æ®µã€‚å®ƒå…è®¸é“¾æ¥å™¨ç§»é™¤æœªä½¿ç”¨çš„æ•°æ®æ®µï¼Œè¿›ä¸€æ­¥å‡å°ç¨‹åºå¤§å°ã€‚</li>
</ul>
</li>
<li><code>-mabi=aapcs</code>:<ul>
<li>è¿™ä¸ªé€‰é¡¹æŒ‡å®šäº†åº”ç”¨ç¨‹åºäºŒè¿›åˆ¶æ¥å£ï¼ˆ<code>ABI</code>ï¼‰ã€‚<code>aapcs</code> ä»£è¡¨ <code>ARM æ¶æ„</code>è¿‡ç¨‹è°ƒç”¨æ ‡å‡†ï¼Œå®ƒå®šä¹‰äº† <code>ARM æ¶æ„</code>ä¸­å‡½æ•°è°ƒç”¨çš„è§„åˆ™ï¼ŒåŒ…æ‹¬å¦‚ä½•ä¼ é€’å‚æ•°ã€å¦‚ä½•ç®¡ç†å †æ ˆç­‰ã€‚</li>
</ul>
</li>
<li><code>-T$(LDSCRIPT)</code>:<ul>
<li><code>-T</code> æ˜¯<strong>é“¾æ¥å™¨é€‰é¡¹</strong>ï¼Œç”¨æ¥æŒ‡å®š<strong>é“¾æ¥è„šæœ¬æ–‡ä»¶</strong>ã€‚é“¾æ¥è„šæœ¬åŒ…å«äº†æœ‰å…³å¦‚ä½•é“¾æ¥ç¨‹åºçš„é™„åŠ ä¿¡æ¯ï¼Œæ¯”å¦‚å†…å­˜å¸ƒå±€ã€å„ç§æ®µçš„ä½ç½®ç­‰ã€‚<code>$(LDSCRIPT)</code> æ˜¯ä¸€ä¸ª <code>Makefile</code> å˜é‡ï¼Œå®ƒçš„å€¼æ˜¯é“¾æ¥è„šæœ¬æ–‡ä»¶çš„åç§°ï¼Œé€šå¸¸æ˜¯ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶ï¼Œå‘Šè¯‰é“¾æ¥å™¨å¦‚ä½•ç»„ç»‡å†…å­˜ä¸­çš„æ®µã€‚</li>
</ul>
</li>
<li><code>-x assembler-with-cpp</code>:<ul>
<li>è¿™ä¸ªé€‰é¡¹å‘Šè¯‰é“¾æ¥å™¨å°†<strong>æ‰€æœ‰è¾“å…¥æ–‡ä»¶</strong>è§†ä¸º<strong>é¢„å¤„ç†è¿‡</strong>çš„<strong>æ±‡ç¼–æºæ–‡ä»¶</strong>ã€‚è¿™é€šå¸¸ç”¨äºç¡®ä¿é“¾æ¥å™¨æ­£ç¡®å¤„ç†ç”± <strong>C é¢„å¤„ç†å™¨</strong>ç”Ÿæˆçš„<strong>æ±‡ç¼–ä»£ç </strong>ã€‚</li>
</ul>
</li>
<li><code>-Wa,-mimplicit-it=thumb</code>:<ul>
<li>è¿™æ˜¯ä¼ é€’ç»™æ±‡ç¼–å™¨çš„é€‰é¡¹ï¼ˆé€šè¿‡ <code>-Wa</code> å‰ç¼€ï¼‰ã€‚<code>-mimplicit-it=thumb</code> æŒ‡å®šé»˜è®¤çš„æŒ‡ä»¤é›†ä¸º <code>Thumb</code> æ¨¡å¼ï¼Œè¿™æ˜¯ <code>ARM æ¶æ„</code>çš„ä¸€ç§ <code>16 ä½æŒ‡ä»¤é›†</code>ï¼Œç”¨äºå‡å°ä»£ç å¤§å°ã€‚</li>
</ul>
</li>
</ul>
</li>
</ol>
<br>

<ol start="12">
<li>ç›®æ ‡æ–‡ä»¶æ ¼å¼è½¬æ¢é€‰é¡¹ (<code>OCFLAGS</code>, <code>ODFLAGS</code>):<br>- <code>OCFLAGS = -Obinary</code><br>- <code>ODFLAGS = -S</code></li>
</ol>
<br>

<ol start="13">
<li>è¾“å‡ºç›®å½•å’Œç›®æ ‡æ–‡ä»¶å (<code>BUILD_DIR</code>, <code>TARGET</code>):<ul>
<li>å®šä¹‰äº†æ„å»ºè¾“å‡ºç›®å½•å’Œæœ€ç»ˆç›®æ ‡æ–‡ä»¶çš„åç§°ã€‚</li>
</ul>
</li>
</ol>
<br>

<ol start="14">
<li>ç›®æ ‡æ–‡ä»¶çš„ç”Ÿæˆ (<code>C_OBJECTS</code>, <code>ASM_OBJECTS</code>, <code>OBJECTS</code>):<ul>
<li><code>C_OBJECTS = $(addprefix $(BUILD_DIR)/, $(C_SOURCES:.c=.o))</code><ul>
<li><code>$(C_SOURCES:.c=.o)</code>å°†æ‰€æœ‰çš„ <code>C</code> æºæ–‡ä»¶åˆ—è¡¨ <code>$(C_SOURCES)</code> ä¸­çš„æ¯ä¸ª <code>.c</code> æ‰©å±•åæ›¿æ¢ä¸º <code>.o</code> æ‰©å±•åï¼Œå¾—åˆ°ç›®æ ‡æ–‡ä»¶ï¼ˆ<code>object files</code>ï¼‰åˆ—è¡¨ã€‚</li>
<li><code>$(addprefix $(BUILD_DIR)/, ...) </code>ä¸ºæ¯ä¸ª <code>.o</code> æ–‡ä»¶<strong>åŠ å‰ç¼€</strong>åŠ ä¸Šæ„å»ºç›®å½• <code>$(BUILD_DIR)/</code> çš„è·¯å¾„ã€‚</li>
<li><code>C_OBJECTS</code> å˜é‡åŒ…å«äº†æ‰€æœ‰ <code>C</code> æºæ–‡ä»¶å¯¹åº”çš„ã€å¸¦æœ‰å®Œæ•´è·¯å¾„çš„ç›®æ ‡æ–‡ä»¶åˆ—è¡¨ã€‚</li>
</ul>
</li>
<li><code>ASM_OBJECTS = $(addprefix $(BUILD_DIR)/, $(ASM_SOURCES:.S=.o))</code>:<ul>
<li>è¿™è¡Œä»£ç çš„é€»è¾‘ä¸ <code>C_OBJECTS</code> ç±»ä¼¼ï¼Œä½†æ˜¯é’ˆå¯¹æ±‡ç¼–æºæ–‡ä»¶ <code>$(ASM_SOURCES)</code>ã€‚</li>
<li>å®ƒå°†æ‰€æœ‰ <code>.S</code> æºæ–‡ä»¶æ‰©å±•åæ›¿æ¢ä¸º <code>.o</code>ï¼Œç„¶åæ·»åŠ æ„å»ºç›®å½•çš„å‰ç¼€ï¼Œç”Ÿæˆæ±‡ç¼–è¯­è¨€ç›®æ ‡æ–‡ä»¶çš„åˆ—è¡¨ã€‚</li>
</ul>
</li>
<li><code>OBJECTS += $(ASM_OBJECTS) $(C_OBJECTS)</code>:<ul>
<li>è¿™è¡Œä»£ç ä½¿ç”¨ <code>+=</code> æ“ä½œç¬¦å°† <code>$(ASM_OBJECTS)</code> å’Œ <code>$(C_OBJECTS)</code> åˆ—è¡¨ä¸­çš„æ‰€æœ‰ç›®æ ‡æ–‡ä»¶æ·»åŠ åˆ° <code>OBJECTS</code> å˜é‡ä¸­ã€‚</li>
<li>OBJECTS å˜é‡é€šå¸¸ç”¨äºè¡¨ç¤ºæ‰€æœ‰éœ€è¦é“¾æ¥çš„æ–‡ä»¶çš„åˆ—è¡¨ï¼Œå®ƒå¯èƒ½å·²ç»åŒ…å«äº†ä¸€äº›å…¶ä»–ç›®æ ‡æ–‡ä»¶ï¼Œè¿™é‡Œé€šè¿‡ <code>+=</code> æ“ä½œç¬¦å°†<code>æ±‡ç¼–</code>å’Œ <code>C</code> è¯­è¨€çš„ç›®æ ‡æ–‡ä»¶åˆ—è¡¨è¿½åŠ è¿›å»ã€‚</li>
<li>æœ€ç»ˆï¼Œ<code>OBJECTS </code>åŒ…å«äº†æ‰€æœ‰éœ€è¦è¢«é“¾æ¥å™¨ç”¨æ¥ç”Ÿæˆæœ€ç»ˆå¯æ‰§è¡Œæ–‡ä»¶æˆ–åº“æ–‡ä»¶çš„ç›®æ ‡æ–‡ä»¶ã€‚</li>
</ul>
</li>
</ul>
</li>
</ol>
<br>

<ol start="15">
<li>ä¼ªç›®æ ‡ (<code>.PHONY</code>):<ul>
<li>å®šä¹‰äº† <code>clean</code>, <code>all</code>, <code>copy</code>, <code>mix</code>, <code>download</code> ç­‰ä¼ªç›®æ ‡ï¼Œç”¨äºæ‰§è¡Œç‰¹å®šçš„å‘½ä»¤åºåˆ—ã€‚</li>
</ul>
</li>
</ol>
<br>

<ol start="16">
<li>æ¡ä»¶å‘½ä»¤ (<code>SYS</code>, <code>ifeq</code>):<ul>
<li><code>SYS := $(shell uname -a)</code>:<ul>
<li>è¿™è¡Œä½¿ç”¨ <code>uname -a</code> å‘½ä»¤æ¥è·å–å½“å‰ç³»ç»Ÿçš„å†…æ ¸ä¿¡æ¯ï¼Œå¹¶å°†è¾“å‡ºèµ‹å€¼ç»™ <code>SYS</code> å˜é‡ã€‚<code>$(shell ...)</code> å‘½ä»¤ä¼šåœ¨ <code>shell</code> ä¸­æ‰§è¡Œæ‹¬å·å†…çš„å†…å®¹ï¼Œå¹¶è¿”å›å…¶è¾“å‡ºã€‚</li>
</ul>
</li>
<li><code>ifeq ($(findstring Microsoft,$(SYS)),Microsoft)</code>:<ul>
<li>è¿™æ˜¯ä¸€ä¸ªæ¡ä»¶è¯­å¥ï¼Œç”¨äºæ£€æŸ¥ <code>SYS</code> å˜é‡ä¸­æ˜¯å¦åŒ…å«å­—ç¬¦ä¸² â€œ<code>Microsoft</code>â€œã€‚<code>$(findstring ...)</code> å‡½æ•°åœ¨ <code>SYS</code> çš„å€¼ä¸­æœç´¢ â€œ<code>Microsoft</code>â€œ å­—ç¬¦ä¸²ã€‚å¦‚æœæ‰¾åˆ°ï¼Œè¿”å› â€œ<code>Microsoft</code>â€œï¼›å¦åˆ™è¿”å›ç©ºå­—ç¬¦ä¸²ã€‚</li>
<li><code>ifeq</code> æ£€æŸ¥ <code>$(findstring Microsoft,$(SYS))</code> çš„ç»“æœæ˜¯å¦ç­‰äº â€œ<code>Microsoft</code>â€œã€‚å¦‚æœæ˜¯ï¼Œå°†æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤</li>
</ul>
</li>
<li><code>wsl.exe -d Ubuntu-20.04 cmd.exe /c &quot;C:\\\Users\\\BREO\\\Desktop\\\iap-tools\\\linux_download\\\program452RC.bat&quot;</code>:<ul>
<li>ä½¿ç”¨ <code>wsl.exe</code> è°ƒç”¨ <code>WSL</code> ç¯å¢ƒã€‚</li>
<li><code>-d Ubuntu-20.04</code>ä¸­ï¼Œ<code>-d</code> é€‰é¡¹å…è®¸ä½ é€‰æ‹©ä¸€ä¸ªç‰¹å®šçš„å‘è¡Œç‰ˆæ¥å¯åŠ¨,è¿™é‡Œæ˜¯<code>Ubuntu-20.04</code>ã€‚</li>
<li><code>cmd.exe</code>:è¿™æ˜¯ <code>Windows</code> çš„å‘½ä»¤è¡Œè§£é‡Šå™¨ï¼Œæ¥è¿è¡Œä¸€ä¸ª <code>Windows æ‰¹å¤„ç†è„šæœ¬</code>ã€‚</li>
<li><code>/c</code>: å‘Šè¯‰ <code>cmd.exe</code> æ‰§è¡ŒæŒ‡å®šçš„å‘½ä»¤ï¼Œç„¶åå…³é—­çª—å£ã€‚</li>
<li><code>&quot;C:\\\...bat&quot;</code>: éœ€è¦æ‰§è¡Œè„šæœ¬çš„è·¯å¾„ã€‚</li>
<li>**ä¸çŸ¥é“ä¸ºä»€ä¹ˆè¦ç”¨<code>\\\</code>**ã€‚</li>
</ul>
</li>
</ul>
</li>
</ol>
<br>

<ol start="17">
<li>ç”Ÿæˆç›®æ ‡æ–‡ä»¶çš„è§„åˆ™ (<code>$(TARGET).list</code>, <code>$(TARGET).bin</code>, <code>$(TARGET).elf</code>, <code>$(TARGET).hex</code>):<ul>
<li><code>$(TARGET).list: $(TARGET).elf</code>:(ä»¥ä¸‹è§„åˆ™ç±»ä¼¼)<ul>
<li><code>$(TARGET).list</code>: <code>$@</code>(<strong>ç›®æ ‡æ–‡ä»¶</strong>)</li>
<li><code>$(TARGET).elf</code>: <code>$&lt;</code>(<strong>è¾“å…¥æ–‡ä»¶</strong>)</li>
</ul>
</li>
<li><code>$(OD) $(ODFLAGS) $&lt; &gt; $(TARGET).lst</code>:<ul>
<li>è¿™æ˜¯ä¸Šè¿°è§„åˆ™çš„å‘½ä»¤éƒ¨åˆ†ã€‚<code>$(OD)</code> æ˜¯ <code>objdump</code> å·¥å…·çš„å˜é‡ï¼Œ<code>$(ODFLAGS)</code> æ˜¯ <code>objdump</code> çš„ç›¸å…³å‚æ•°ã€‚<code>$&lt;</code> æ˜¯è‡ªåŠ¨å˜é‡ï¼Œè¡¨ç¤ºç¬¬ä¸€ä¸ªä¾èµ–æ–‡ä»¶ï¼Œä¹Ÿå°±æ˜¯ <code>$(TARGET).elf</code>ã€‚</li>
<li>å‘½ä»¤ä½¿ç”¨ <code>objdump</code> æå– <code>.elf</code> æ–‡ä»¶çš„æ±‡ç¼–å†…å®¹ï¼Œå¹¶é‡å®šå‘è¾“å‡ºåˆ° <code>$(TARGET).lst</code> æ–‡ä»¶ã€‚</li>
</ul>
</li>
<li><code>$(OC) $(OCFLAGS) $(TARGET).elf $(TARGET).bin</code>:<ul>
<li>è¿™æ˜¯ä¸Šè¿°è§„åˆ™çš„å‘½ä»¤éƒ¨åˆ†ã€‚<code>$(OC)</code> æ˜¯ <code>objcopy</code> å·¥å…·çš„å˜é‡ï¼Œ<code>$(OCFLAGS)</code> æ˜¯ <code>objcopy</code> çš„ç›¸å…³å‚æ•°ã€‚</li>
<li>å‘½ä»¤ä½¿ç”¨ <code>objcopy</code> ä» <code>.elf</code> æ–‡ä»¶ç”ŸæˆäºŒè¿›åˆ¶æ ¼å¼çš„ <code>.bin</code> æ–‡ä»¶ã€‚</li>
</ul>
</li>
<li><code>$(CC) $(ASM_OBJECTS) $(C_OBJECTS) $(LDFLAGS) -Wl,-Map=$(TARGET).map -o $(TARGET).elf</code>:<ul>
<li>è¿™æ˜¯ <strong>é“¾æ¥å‘½ä»¤</strong>ï¼Œä½¿ç”¨ <code>$(CC)</code> ç¼–è¯‘å™¨ï¼ˆå®é™…ä¸Šæ˜¯é“¾æ¥å™¨ï¼‰æ¥é“¾æ¥å¯¹è±¡æ–‡ä»¶ <code>$(ASM_OBJECTS)</code> å’Œ <code>$(C_OBJECTS)</code>ï¼Œä»¥åŠé“¾æ¥å™¨æ ‡å¿— <code>$(LDFLAGS)</code>ã€‚</li>
<li><code>-Wl,-Map=$(TARGET).map</code> é€‰é¡¹å‘Šè¯‰é“¾æ¥å™¨ç”Ÿæˆä¸€ä¸ªå†…å­˜æ˜ å°„æ–‡ä»¶ <code>$(TARGET).map</code>ã€‚</li>
<li><code>-o $(TARGET).elf</code> æŒ‡å®šäº†è¾“å‡ºçš„ <strong>å¯æ‰§è¡Œæ–‡ä»¶</strong>åã€‚</li>
</ul>
</li>
<li><code>$(OC) -O ihex $&lt; $@</code>:<ul>
<li>è¿™æ˜¯ä¸Šè¿°è§„åˆ™çš„å‘½ä»¤éƒ¨åˆ†ï¼Œä½¿ç”¨ <code>objcopy</code> çš„ <code>-O ihex</code> é€‰é¡¹å°†è¾“å…¥æ–‡ä»¶ï¼ˆ<code>$&lt;</code>ï¼‰è½¬æ¢ä¸º <code>Intel HEX</code> æ ¼å¼ï¼Œå¹¶å‘½åä¸º <code>$@</code>ï¼Œå³ <code>$(TARGET).hex</code>ã€‚</li>
</ul>
</li>
<li><code>mkdir -p $(dir $@)</code><ul>
<li>è¿™æ¡å‘½ä»¤ç¡®ä¿ç›®æ ‡æ–‡ä»¶çš„ç›®å½•å­˜åœ¨ã€‚<code>$(dir $@)</code> è·å–ç›®æ ‡æ–‡ä»¶çš„ç›®å½•è·¯å¾„ï¼Œ<code>mkdir -p</code> å‘½ä»¤ <strong>åˆ›å»ºè¿™ä¸ªç›®å½•ï¼ˆå¦‚æœå®ƒè¿˜ä¸å­˜åœ¨ï¼‰</strong>ã€‚</li>
</ul>
</li>
<li><code>$(CC) $(INCLUDE) $(CFLAGS) -MMD -c $&lt; -o $@</code><ul>
<li>è¿™æ˜¯ç¼–è¯‘å•ä¸ª <code>C</code> æºæ–‡ä»¶çš„å‘½ä»¤ã€‚å®ƒä½¿ç”¨ <code>$(CC)</code> ç¼–è¯‘å™¨ï¼Œ<code>$(INCLUDE)</code> åŒ…å«è·¯å¾„ï¼Œ<code>$(CFLAGS)</code> ç¼–è¯‘é€‰é¡¹ï¼Œ<code>-c</code> é€‰é¡¹æ¥ç¼–è¯‘ä¸é“¾æ¥ï¼Œ<code>-MMD</code> ç”Ÿæˆä¾èµ–æ–‡ä»¶ï¼Œ<code>$&lt;</code> æ˜¯æºæ–‡ä»¶ï¼Œ<code>$@</code> æ˜¯ç›®æ ‡æ–‡ä»¶ã€‚</li>
</ul>
</li>
<li><code>$(BUILD_DIR)/%.o: %.S</code>:<ul>
<li>è¿™æ˜¯ä¸€ä¸ªæ¨¡å¼è§„åˆ™ï¼Œç”¨äºä» <code>.S</code> æ±‡ç¼–æºæ–‡ä»¶ç”Ÿæˆ <code>.o</code> ç›®æ ‡æ–‡ä»¶ï¼Œå…¶å‘½ä»¤ä¸ä¸Šé¢ç¼–è¯‘ <code>C</code> æ–‡ä»¶çš„å‘½ä»¤ç±»ä¼¼ï¼Œä½†æ˜¯é€šå¸¸ <strong>ä¸åŒ…å«ç¼–è¯‘é€‰é¡¹</strong>ï¼Œå› ä¸ºæ±‡ç¼–è¯­è¨€çš„å¤„ç†æ–¹å¼ä¸ <code>C</code> è¯­è¨€ä¸åŒã€‚</li>
</ul>
</li>
<li><code>-include $(wildcard $(BUILD_DIR)/**/*.d)</code>:<ul>
<li><code>$(wildcard *.c)</code> ä¼šåˆ—å‡ºå½“å‰ç›®å½•ä¸‹æ‰€æœ‰çš„ <code>.c</code> æ–‡ä»¶ã€‚</li>
<li><code>$(wildcard $(BUILD_DIR)/**/*.d)</code> ä¼šåˆ—å‡º <code>$(BUILD_DIR)</code> ç›®å½•ä¸‹çš„æ‰€æœ‰ <code>.d</code> æ–‡ä»¶ã€‚</li>
</ul>
</li>
<li><code>DEP_FILES := $(shell find $(BUILD_DIR) -type f -name &#39;*.d&#39;)</code>,<code>-include $(DEP_FILES)</code>:<ul>
<li><code>find</code> è¿™æ˜¯ä¸€ä¸ª <code>find</code> å‘½ä»¤ï¼Œç”¨äºåœ¨æ–‡ä»¶ç³»ç»Ÿä¸­æœç´¢æ–‡ä»¶ã€‚</li>
<li><code>$(BUILD_DIR)</code> æ˜¯ä¹‹å‰å®šä¹‰çš„ <code>Makefile</code> å˜é‡ï¼Œè¡¨ç¤ºæ„å»ºç›®å½•çš„è·¯å¾„ã€‚</li>
<li><code>-type f</code> æŒ‡å®š <code>find</code> å‘½ä»¤åªæœç´¢æ–‡ä»¶ï¼ˆä¸åŒ…æ‹¬ç›®å½•ï¼‰ã€‚</li>
<li><code>-name &#39;*.d&#39;</code> å®šä¹‰äº†æœç´¢çš„æ–‡ä»¶åæ¨¡å¼ï¼Œ<code>*.d</code> åŒ¹é…æ‰€æœ‰ä»¥ <code>.d</code> ç»“å°¾çš„æ–‡ä»¶ï¼Œè¿™é€šå¸¸æ˜¯ç”±ç¼–è¯‘å™¨ç”Ÿæˆçš„ä¾èµ–æ–‡ä»¶ã€‚</li>
<li><code>-include $(DEP_FILES)</code>ï¼š <code>make</code> å°†ä¼šåŒ…å«è¿™äº› <code>.d</code> ,è¿™äº›æ–‡ä»¶åŒ…å«äº†<strong>å¤´æ–‡ä»¶çš„ä¾èµ–ä¿¡æ¯</strong>,ä»è€Œç¡®ä¿ <code>make</code> èƒ½å¤Ÿæ­£ç¡®åœ°<strong>æ£€æµ‹åˆ°æºæ–‡ä»¶çš„ä¾èµ–å…³ç³»</strong>ï¼Œå¹¶ä¸”åœ¨<strong>æºæ–‡ä»¶</strong>æˆ–å…¶<strong>å¤´æ–‡ä»¶</strong>å‘ç”Ÿå˜åŒ–æ—¶<strong>é‡æ–°ç¼–è¯‘</strong>ç›¸åº”çš„ç›®æ ‡æ–‡ä»¶ã€‚</li>
</ul>
</li>
</ul>
</li>
</ol>
<br>

<ol start="18">
<li><p>ç¼–è¯‘Cæºæ–‡ä»¶å’Œæ±‡ç¼–æºæ–‡ä»¶çš„è§„åˆ™ (<code>$(BUILD_DIR)/%.o: %.c</code>, <code>$(BUILD_DIR)/%.o: %.S</code>):</p>
<ul>
<li>å®šä¹‰äº†å¦‚ä½•ç¼–è¯‘ <code>C</code> å’Œæ±‡ç¼–æºæ–‡ä»¶ä¸º <code>.o</code> ç›®æ ‡æ–‡ä»¶ã€‚</li>
</ul>
</li>
</ol>
<br>

<ol start="19">
<li>åŒ…å«ç”Ÿæˆçš„ä¾èµ–æ–‡ä»¶ <code>(-include $(wildcard $(BUILD_DIR)/**/*.d), DEP_FILES)</code>:<ul>
<li>ä½¿ç”¨ <code>find</code> å‘½ä»¤æ‰¾åˆ°æ‰€æœ‰çš„ <code>.d</code> æ–‡ä»¶ï¼Œç„¶åä½¿ç”¨ <code>-include</code> æŒ‡ä»¤åŒ…å«è¿™äº›æ–‡ä»¶ï¼Œä»¥ç¡®ä¿ <code>Make</code> èƒ½å¤Ÿè·Ÿè¸ªæºæ–‡ä»¶çš„å˜åŒ–å¹¶é¿å…ä¸å¿…è¦çš„é‡æ–°ç¼–è¯‘ã€‚</li>
</ul>
</li>
</ol>
<br>

<h2 id="æ ‡å‡†makefileåŸºæœ¬è¯­æ³•"><a href="#æ ‡å‡†makefileåŸºæœ¬è¯­æ³•" class="headerlink" title="æ ‡å‡†makefileåŸºæœ¬è¯­æ³•"></a>æ ‡å‡†makefileåŸºæœ¬è¯­æ³•</h2><p>[å‚è€ƒæ–‡æ¡£]ï¼š<a href="https://seisman.github.io/how-to-write-makefile/index.html">https://seisman.github.io/how-to-write-makefile/index.html</a></p>
<h3 id="ä¹¦å†™è§„åˆ™"><a href="#ä¹¦å†™è§„åˆ™" class="headerlink" title="ä¹¦å†™è§„åˆ™"></a>ä¹¦å†™è§„åˆ™</h3><h4 id="è§„åˆ™çš„è¯­æ³•"><a href="#è§„åˆ™çš„è¯­æ³•" class="headerlink" title="è§„åˆ™çš„è¯­æ³•"></a>è§„åˆ™çš„è¯­æ³•</h4><figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line">targets : prerequisites</span><br><span class="line">    command</span><br><span class="line">    ...</span><br></pre></td></tr></table></figure>
<p>æˆ–æ˜¯è¿™æ ·ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line">targets : prerequisites ; command</span><br><span class="line">    command</span><br><span class="line">    ...</span><br></pre></td></tr></table></figure>
<p>å¦‚æœå‘½ä»¤å¤ªé•¿ï¼Œä½ å¯ä»¥ä½¿ç”¨åæ–œæ ï¼ˆ <code>\</code> ï¼‰ä½œä¸ºæ¢è¡Œç¬¦</p>
<br>

<h4 id="åœ¨è§„åˆ™ä¸­ä½¿ç”¨é€šé…ç¬¦"><a href="#åœ¨è§„åˆ™ä¸­ä½¿ç”¨é€šé…ç¬¦" class="headerlink" title="åœ¨è§„åˆ™ä¸­ä½¿ç”¨é€šé…ç¬¦"></a>åœ¨è§„åˆ™ä¸­ä½¿ç”¨é€šé…ç¬¦</h4><p><code>make</code>æ”¯æŒä¸‰ä¸ªé€šé…ç¬¦ï¼š <code>*</code> ï¼Œ <code>?</code> å’Œ <code>~</code> ã€‚è¿™æ˜¯å’Œ<code>Unix</code>çš„<code>B-Shell</code>æ˜¯ç›¸åŒçš„ã€‚</p>
<ul>
<li><code>*</code>ï¼šé€šé…ç¬¦ä»£æ›¿äº†ä½ ä¸€ç³»åˆ—çš„æ–‡ä»¶ï¼Œå¦‚ <code>*.c</code> è¡¨ç¤ºæ‰€æœ‰åç¼€ä¸ºcçš„æ–‡ä»¶ã€‚ä¸€ä¸ªéœ€è¦æˆ‘ä»¬æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬çš„æ–‡ä»¶åä¸­æœ‰é€šé…ç¬¦ï¼Œå¦‚ï¼š <code>*</code> ï¼Œé‚£ä¹ˆå¯ä»¥ç”¨è½¬ä¹‰å­—ç¬¦ <code>\</code> ï¼Œå¦‚ <code>\*</code> æ¥è¡¨ç¤ºçœŸå®çš„ <code>*</code> å­—ç¬¦ï¼Œè€Œä¸æ˜¯ä»»æ„é•¿åº¦çš„å­—ç¬¦ä¸²ã€‚<figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line"><span class="section">clean:</span></span><br><span class="line">    rm -f *.o</span><br></pre></td></tr></table></figure>
<code>clean</code>æ˜¯æ“ä½œç³»ç»Ÿ<code>Shell</code>æ‰€æ”¯æŒçš„é€šé…ç¬¦ã€‚<figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line">objects = *.o</span><br></pre></td></tr></table></figure>
<code>objects</code>çš„å€¼å°±æ˜¯ <code>*.o</code>, å¹¶ä¸æ˜¯è¯´ *.o ä¼šå±•å¼€ï¼Œ å¦‚éœ€å±•å¼€è¿›è¡Œä»¥ä¸‹æ“ä½œã€‚<figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line">objects := <span class="variable">$(<span class="built_in">wildcard</span> *.o)</span></span><br></pre></td></tr></table></figure>
<strong>ç¤ºä¾‹1</strong>ï¼š<figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line">var = <span class="variable">$(<span class="built_in">shell</span> echo &quot;Hello, World!&quot;)</span></span><br></pre></td></tr></table></figure></li>
<li><code>:=</code> å’Œ <code>=</code>åŒºåˆ«ï¼š<ul>
<li><code>=</code> (é€’å½’å±•å¼€):<strong>ç¤ºä¾‹1</strong>æ¯æ¬¡å¼•ç”¨ <code>$(var)</code> æ—¶ï¼Œ<code>Make</code> éƒ½ä¼šæ‰§è¡Œ <code>echo &quot;Hello, World!&quot;</code></li>
<li><code>:=</code> (ç›´æ¥å±•å¼€):<strong>ç¤ºä¾‹1</strong>æ¯æ¬¡å¼•ç”¨ <code>$(var)</code> çš„å€¼åœ¨ <code>Makefile</code> è§£ææ—¶è®¾ç½®ä¸º <code>&quot;Hello, World!&quot;</code></li>
</ul>
</li>
</ul>
<p><strong>ç¤ºä¾‹2</strong><br>å¯å†™å‡ºç¼–è¯‘å¹¶é“¾æ¥æ‰€æœ‰ <code>.c</code> å’Œ <code>.o</code> æ–‡ä»¶ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line">objects := <span class="variable">$(<span class="built_in">patsubst</span> %.c,%.o,$(<span class="built_in">wildcard</span> *.c)</span>)</span><br><span class="line">foo : <span class="variable">$(objects)</span></span><br><span class="line">    cc -o foo <span class="variable">$(objects)</span></span><br></pre></td></tr></table></figure>
<ul>
<li><code>patsubst</code> å‡½æ•°ç”¨äºå°†ç¬¬ä¸€ä¸ªå‚æ•°ä¸­åŒ¹é…ç¬¬äºŒä¸ªå‚æ•°æ¨¡å¼çš„éƒ¨åˆ†æ›¿æ¢ä¸ºç¬¬ä¸‰ä¸ªå‚æ•°ä¸­çš„ç›¸åº”æ¨¡å¼</li>
<li><code>patsubst</code> å‡½æ•°ç”¨äºå°† <code>*.c</code> æ›¿æ¢ä¸º <code>*.o</code>ï¼Œ<code>wildcard</code> å‡½æ•°ç”¨äºè·å–å½“å‰ç›®å½•ä¸‹æ‰€æœ‰ <code>.c</code> æ–‡ä»¶ã€‚</li>
</ul>
<br>

<h4 id="æ–‡ä»¶æœç´¢"><a href="#æ–‡ä»¶æœç´¢" class="headerlink" title="æ–‡ä»¶æœç´¢"></a>æ–‡ä»¶æœç´¢</h4><figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line">VPATH = src:../headers</span><br></pre></td></tr></table></figure>
<ul>
<li><code>Makefile</code>æ–‡ä»¶ä¸­çš„ç‰¹æ®Šå˜é‡ <code>VPATH</code>,å½“<code>make</code>å°±ä¼šåœ¨å½“å‰ç›®å½•æ‰¾ä¸åˆ°çš„æƒ…å†µä¸‹ï¼Œåˆ°æ‰€æŒ‡å®šçš„ç›®å½•ä¸­å»æ‰¾å¯»æ–‡ä»¶äº†ã€‚</li>
<li>â€œ<code>src</code>â€å’Œâ€œ<code>../headers</code>â€ï¼Œmakeä¼šæŒ‰ç…§è¿™ä¸ªé¡ºåºè¿›è¡Œæœç´¢ã€‚ç›®å½•ç”±â€œ<code>å†’å·</code>â€åˆ†éš”ã€‚ï¼ˆå½“ç„¶ï¼Œå½“å‰ç›®å½•æ°¸è¿œæ˜¯æœ€é«˜ä¼˜å…ˆæœç´¢çš„åœ°æ–¹ï¼‰ã€‚</li>
</ul>
<figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line"><span class="keyword">vpath</span> &lt;pattern&gt; &lt;directories&gt;</span><br><span class="line"><span class="keyword">vpath</span> %.h ../headers</span><br></pre></td></tr></table></figure>
<ul>
<li><code>vpath</code>ä½¿ç”¨æ–¹æ³•ä¸­çš„<code>&lt;pattern&gt;</code>éœ€è¦åŒ…å« <code>%</code> å­—ç¬¦ã€‚ <code>%</code> çš„æ„æ€æ˜¯åŒ¹é…<code>é›¶</code>æˆ–<code>è‹¥å¹²å­—ç¬¦</code>ï¼Œï¼ˆéœ€å¼•ç”¨ <code>%</code> ï¼Œä½¿ç”¨ <code>\</code> ï¼‰ä¾‹å¦‚ï¼Œ <code>%.h</code> è¡¨ç¤ºæ‰€æœ‰ä»¥ <code>.h</code> ç»“å°¾çš„æ–‡ä»¶ã€‚<code>&lt;pattern&gt;</code>æŒ‡å®šäº†è¦æœç´¢çš„æ–‡ä»¶é›†ï¼Œè€Œ<code>&lt;directories&gt;</code>åˆ™æŒ‡å®šäº†<code>&lt;pattern&gt;</code>çš„æ–‡ä»¶é›†çš„æœç´¢çš„ç›®å½•ã€‚</li>
</ul>
<br>

<h4 id="ä¼ªç›®æ ‡"><a href="#ä¼ªç›®æ ‡" class="headerlink" title="ä¼ªç›®æ ‡"></a>ä¼ªç›®æ ‡</h4><figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line">.PHONY : clean</span><br><span class="line">clean :</span><br><span class="line">    rm *.o temp</span><br></pre></td></tr></table></figure>
<p>ä¼ªç›®æ ‡ä¸€èˆ¬æ²¡æœ‰ä¾èµ–çš„æ–‡ä»¶ã€‚ä½†æ˜¯ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ä¸ºä¼ªç›®æ ‡æŒ‡å®šæ‰€ä¾èµ–çš„æ–‡ä»¶ã€‚ä¼ªç›®æ ‡åŒæ ·å¯ä»¥ä½œä¸ºâ€œ<strong>é»˜è®¤ç›®æ ‡</strong>â€ï¼Œåªè¦å°†å…¶æ”¾åœ¨<strong>ç¬¬ä¸€ä¸ª</strong>ã€‚</p>
<figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line">all : prog1 prog2 prog3</span><br><span class="line">.PHONY : all</span><br><span class="line"></span><br><span class="line">prog1 : prog1.o utils.o</span><br><span class="line">    cc -o prog1 prog1.o utils.o</span><br><span class="line"></span><br><span class="line">prog2 : prog2.o</span><br><span class="line">    cc -o prog2 prog2.o</span><br><span class="line"></span><br><span class="line">prog3 : prog3.o sort.o utils.o</span><br><span class="line">    cc -o prog3 prog3.o sort.o utils.o</span><br></pre></td></tr></table></figure>
<ul>
<li><code>Makefile</code>ä¸­çš„ç¬¬ä¸€ä¸ªç›®æ ‡ä¼šè¢«ä½œä¸ºå…¶<strong>é»˜è®¤ç›®æ ‡</strong>ã€‚æˆ‘ä»¬å£°æ˜äº†ä¸€ä¸ªâ€œ<code>all</code>â€çš„ä¼ªç›®æ ‡ï¼Œå…¶ä¾èµ–äºå…¶å®ƒä¸‰ä¸ªç›®æ ‡ã€‚ç”±äºé»˜è®¤ç›®æ ‡çš„ç‰¹æ€§æ˜¯ï¼Œæ€»æ˜¯è¢«æ‰§è¡Œçš„ï¼Œä½†ç”±äºâ€œ<code>all</code>â€åˆæ˜¯ä¸€ä¸ªä¼ªç›®æ ‡ï¼Œä¼ªç›®æ ‡åªæ˜¯ä¸€ä¸ªæ ‡ç­¾ä¸ä¼šç”Ÿæˆæ–‡ä»¶ï¼Œæ‰€ä»¥ä¸ä¼šæœ‰â€œ<code>all</code>â€æ–‡ä»¶äº§ç”Ÿã€‚äºæ˜¯ï¼Œå…¶å®ƒä¸‰ä¸ªç›®æ ‡çš„è§„åˆ™æ€»æ˜¯ä¼šè¢«å†³è®®ã€‚ä¹Ÿå°±è¾¾åˆ°äº†æˆ‘ä»¬ä¸€å£æ°”ç”Ÿæˆå¤šä¸ªç›®æ ‡çš„ç›®çš„ã€‚</li>
<li><code>.PHONY : all</code> å£°æ˜äº†â€œ<code>all</code>â€è¿™ä¸ªç›®æ ‡ä¸ºâ€œä¼ªç›®æ ‡â€ã€‚ï¼ˆæ³¨ï¼šè¿™é‡Œçš„æ˜¾å¼â€œ<code>.PHONY : all</code>â€ ä¸å†™çš„è¯ä¸€èˆ¬æƒ…å†µä¹Ÿå¯ä»¥æ­£ç¡®çš„æ‰§è¡Œï¼Œè¿™æ ·<code>make</code>å¯é€šè¿‡éšå¼è§„åˆ™æ¨å¯¼å‡ºï¼Œ â€œ<code>all</code>â€ æ˜¯ä¸€ä¸ªä¼ªç›®æ ‡ï¼Œæ‰§è¡Œ<code>make</code>ä¸ä¼šç”Ÿæˆâ€œ<code>all</code>â€æ–‡ä»¶ï¼Œè€Œæ‰§è¡Œåé¢çš„å¤šä¸ªç›®æ ‡ã€‚å»ºè®®ï¼šæ˜¾å¼å†™å‡ºæ˜¯ä¸€ä¸ªå¥½ä¹ æƒ¯ã€‚ï¼‰</li>
</ul>
<br>

<h4 id="å¤šç›®æ ‡"><a href="#å¤šç›®æ ‡" class="headerlink" title="å¤šç›®æ ‡"></a>å¤šç›®æ ‡</h4><p><code>Makefile</code>çš„è§„åˆ™ä¸­çš„ç›®æ ‡å¯ä»¥ä¸æ­¢ä¸€ä¸ªï¼Œå…¶æ”¯æŒå¤šç›®æ ‡ï¼Œæœ‰å¯èƒ½æˆ‘ä»¬çš„å¤šä¸ªç›®æ ‡åŒæ—¶ä¾èµ–äºä¸€ä¸ªæ–‡ä»¶ï¼Œå¹¶ä¸”å…¶ç”Ÿæˆçš„å‘½ä»¤å¤§ä½“ç±»ä¼¼ã€‚</p>
<figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line">bigoutput littleoutput : text.g</span><br><span class="line">    generate text.g -<span class="variable">$(<span class="built_in">subst</span> output,,<span class="variable">$@</span>)</span> &gt; <span class="variable">$@</span></span><br></pre></td></tr></table></figure>
<p>ä¸Šè¿°è§„åˆ™ç­‰ä»·äºï¼š</p>
<figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line">bigoutput : text.g</span><br><span class="line">    generate text.g -big &gt; bigoutput</span><br><span class="line">littleoutput : text.g</span><br><span class="line">    generate text.g -little &gt; littleoutput</span><br></pre></td></tr></table></figure>
<p>å…¶ä¸­ï¼Œ<code>-$(subst output,,$@)</code>ä¸­çš„ <code>$</code> è¡¨ç¤ºæ‰§è¡Œä¸€ä¸ª<code>Makefile</code>çš„å‡½æ•°ï¼Œå‡½æ•°åä¸º<code>subst</code>ï¼Œåé¢çš„ä¸ºå‚æ•°ã€‚å…³äºå‡½æ•°ï¼Œå°†åœ¨åé¢è®²è¿°ã€‚è¿™é‡Œçš„è¿™ä¸ªå‡½æ•°æ˜¯æ›¿æ¢å­—ç¬¦ä¸²çš„æ„æ€ï¼Œ <code>$@</code> è¡¨ç¤ºç›®æ ‡çš„é›†åˆï¼Œå°±åƒä¸€ä¸ªæ•°ç»„ï¼Œ <code>$@</code> ä¾æ¬¡å–å‡ºç›®æ ‡ï¼Œå¹¶æ‰§äºå‘½ä»¤ã€‚</p>
<ul>
<li><code>$(subst from,to,text)</code><ul>
<li><code>from</code> æ˜¯æ‚¨æƒ³è¦æ›¿æ¢çš„å­—ç¬¦ä¸²ã€‚</li>
<li><code>to</code> æ˜¯æ‚¨æƒ³è¦æ›¿æ¢æˆçš„æ–°å­—ç¬¦ä¸²ã€‚</li>
<li><code>text</code> æ˜¯åŸå§‹æ–‡æœ¬ã€‚</li>
</ul>
</li>
<li><code>generate text.g -$(subst output,,$@) &gt; $@</code>ä¸­çš„â€<code>&gt;</code>â€œ æ˜¯ä¸€ä¸ª<code>shell</code>å‘½ä»¤ï¼Œç”¨äºå°† <code>generate text.g -$(subst output,,$@)</code> çš„è¾“å‡ºé‡å®šå‘åˆ°å³ä¾§<code>$@</code>æ–‡ä»¶ä¸­ã€‚</li>
</ul>
<br>

<h4 id="é™æ€æ¨¡å¼"><a href="#é™æ€æ¨¡å¼" class="headerlink" title="é™æ€æ¨¡å¼"></a>é™æ€æ¨¡å¼</h4><p>é™æ€æ¨¡å¼å¯ä»¥æ›´åŠ å®¹æ˜“åœ°å®šä¹‰å¤šç›®æ ‡çš„è§„åˆ™ï¼Œå¯ä»¥è®©æˆ‘ä»¬çš„è§„åˆ™å˜å¾—æ›´åŠ çš„æœ‰å¼¹æ€§å’Œçµæ´»ã€‚æˆ‘ä»¬è¿˜æ˜¯å…ˆæ¥çœ‹ä¸€ä¸‹è¯­æ³•ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line">&lt;targets ...&gt; : &lt;target-pattern&gt; : &lt;prereq-patterns ...&gt;</span><br><span class="line">    &lt;commands&gt;</span><br><span class="line">    ...</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬çš„â€œ<strong>ç›®æ ‡æ¨¡å¼</strong>â€æˆ–æ˜¯â€œ<strong>ä¾èµ–æ¨¡å¼</strong>â€ä¸­éƒ½åº”è¯¥æœ‰ <code>%</code> è¿™ä¸ªå­—ç¬¦ï¼Œå¦‚æœä½ çš„æ–‡ä»¶åä¸­æœ‰ <code>%</code> é‚£ä¹ˆä½ å¯ä»¥ä½¿ç”¨åæ–œæ  <code>\</code> è¿›è¡Œè½¬ä¹‰ï¼Œæ¥æ ‡æ˜çœŸå®çš„ <code>%</code> å­—ç¬¦ã€‚çœ‹ä¸€ä¸ªä¾‹å­ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line">objects = foo.o bar.o</span><br><span class="line"></span><br><span class="line"><span class="section">all: <span class="variable">$(objects)</span></span></span><br><span class="line"></span><br><span class="line"><span class="variable">$(objects)</span>: %.o: %.c</span><br><span class="line">    <span class="variable">$(CC)</span> -c <span class="variable">$(CFLAGS)</span> <span class="variable">$&lt;</span> -o <span class="variable">$@</span></span><br></pre></td></tr></table></figure>
<ul>
<li>æˆ‘ä»¬çš„ç›®æ ‡ä»<code>$object</code>ä¸­è·å–</li>
<li><code>%.o</code> è¡¨æ˜è¦æ‰€æœ‰ä»¥ <code>.o</code> ç»“å°¾çš„ç›®æ ‡ï¼Œä¹Ÿå°±æ˜¯ <code>foo.o</code> <code>bar.o</code>,ä¹Ÿå°±æ˜¯å˜é‡ <code>$object</code> é›†åˆçš„æ¨¡å¼</li>
<li>ä¾èµ–æ¨¡å¼ <code>%.c</code> åˆ™å–æ¨¡å¼ <code>%.o</code> çš„ <code>%</code> ï¼Œä¹Ÿå°±æ˜¯ <code>foo</code> <code>bar</code> ï¼Œå¹¶ä¸ºå…¶åŠ ä¸‹ <code>.c</code> çš„åç¼€ï¼Œäºæ˜¯ï¼Œæˆ‘ä»¬çš„ä¾èµ–ç›®æ ‡å°±æ˜¯ <code>foo.c</code> <code>bar.c </code></li>
<li>å‘½ä»¤ä¸­çš„ <code>$&lt;</code> å’Œ <code>$@</code> åˆ™æ˜¯è‡ªåŠ¨åŒ–å˜é‡ï¼Œ <code>$&lt;</code> è¡¨ç¤º <strong>ç¬¬ä¸€ä¸ªä¾èµ–æ–‡ä»¶</strong>ï¼Œ <code>$@</code> è¡¨ç¤º <strong>ç›®æ ‡é›†</strong>ï¼ˆä¹Ÿå°±æ˜¯â€œ<code>foo.o</code> <code>bar.o</code>â€ï¼‰</li>
</ul>
<p>ä¸Šé¢çš„è§„åˆ™å±•å¼€åç­‰ä»·äºä¸‹é¢çš„è§„åˆ™ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line">foo.o : foo.c</span><br><span class="line">    <span class="variable">$(CC)</span> -c <span class="variable">$(CFLAGS)</span> foo.c -o foo.o</span><br><span class="line">bar.o : bar.c</span><br><span class="line">    <span class="variable">$(CC)</span> -c <span class="variable">$(CFLAGS)</span> bar.c -o bar.o</span><br></pre></td></tr></table></figure>
<p>å¦‚æœæˆ‘ä»¬çš„ <code>%.o</code> æœ‰å‡ ç™¾ä¸ªï¼Œä½¿ç”¨â€œ<strong>é™æ€æ¨¡å¼è§„åˆ™</strong>â€å¾ˆæ–¹ä¾¿ï¼Œå†çœ‹ä¸€ä¸ªä¾‹å­ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line">files = foo.elc bar.o lose.o</span><br><span class="line"></span><br><span class="line"><span class="variable">$(<span class="built_in">filter</span> %.o,<span class="variable">$(files)</span>)</span>: %.o: %.c</span><br><span class="line">    <span class="variable">$(CC)</span> -c <span class="variable">$(CFLAGS)</span> <span class="variable">$&lt;</span> -o <span class="variable">$@</span></span><br><span class="line"><span class="variable">$(<span class="built_in">filter</span> %.elc,<span class="variable">$(files)</span>)</span>: %.elc: %.el</span><br><span class="line">    emacs -f batch-byte-compile <span class="variable">$&lt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li><code>$(filter %.o,$(files))</code>è¡¨ç¤ºè°ƒç”¨<code>Makefile</code>çš„<code>filter</code>å‡½æ•°ï¼Œè¿‡æ»¤â€œ<code>$files</code>â€é›†ï¼Œåªè¦å…¶ä¸­æ¨¡å¼ä¸ºâ€œ<code>%.o</code>â€çš„å†…å®¹ã€‚</li>
</ul>
<br>

<h4 id="è‡ªåŠ¨ç”Ÿæˆä¾èµ–æ€§"><a href="#è‡ªåŠ¨ç”Ÿæˆä¾èµ–æ€§" class="headerlink" title="è‡ªåŠ¨ç”Ÿæˆä¾èµ–æ€§"></a>è‡ªåŠ¨ç”Ÿæˆä¾èµ–æ€§</h4><p>åœ¨<code>Makefile</code>ä¸­ï¼Œæˆ‘ä»¬çš„ä¾èµ–å…³ç³»å¯èƒ½ä¼šéœ€è¦åŒ…å«ä¸€ç³»åˆ—çš„å¤´æ–‡ä»¶ï¼Œæ¯”å¦‚ï¼Œå¦‚æœæˆ‘ä»¬çš„<code>main.c</code>ä¸­æœ‰ä¸€å¥ <code>#include &quot;defs.h&quot;</code> ï¼Œé‚£ä¹ˆæˆ‘ä»¬çš„ä¾èµ–å…³ç³»åº”è¯¥æ˜¯ï¼š</p>
<pre><code>main.o : main.c defs.h
</code></pre>
<p>ä½†æ˜¯ï¼Œå¦‚æœæ˜¯ä¸€ä¸ªæ¯”è¾ƒå¤§å‹çš„å·¥ç¨‹ï¼Œä½ å¿…éœ€æ¸…æ¥šå“ªäº›Cæ–‡ä»¶åŒ…å«äº†å“ªäº›å¤´æ–‡ä»¶,ä¾‹å¦‚ï¼Œå¦‚æœæˆ‘ä»¬æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤:</p>
<pre><code>cc -M main.c
</code></pre>
<p>å…¶è¾“å‡ºæ˜¯ï¼š</p>
<pre><code>main.o : main.c defs.h
</code></pre>
<p>éœ€è¦æé†’ä¸€å¥çš„æ˜¯ï¼Œå¦‚æœä½ ä½¿ç”¨<code>GNU</code>çš„<code>C/C++</code>ç¼–è¯‘å™¨ï¼Œä½ å¾—ç”¨ <code>-MM</code> å‚æ•°ï¼Œä¸ç„¶ï¼Œ<code>-M</code> å‚æ•°ä¼šæŠŠä¸€äº› <strong>æ ‡å‡†åº“çš„å¤´æ–‡ä»¶ä¹ŸåŒ…å«è¿›æ¥</strong>ã€‚</p>
<ul>
<li><code>gcc -M main.c</code>çš„è¾“å‡ºæ˜¯:<figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line"><span class="section">main.o: main.c defs.h /usr/include/stdio.h /usr/include/features.h \</span></span><br><span class="line">    /usr/<span class="keyword">include</span>/sys/cdefs.h /usr/<span class="keyword">include</span>/gnu/stubs.h \</span><br><span class="line">    /usr/lib/gcc-lib/i486-suse-linux/2.95.3/<span class="keyword">include</span>/stddef.h \</span><br><span class="line">    /usr/<span class="keyword">include</span>/bits/types.h /usr/<span class="keyword">include</span>/bits/pthreadtypes.h \</span><br><span class="line">    /usr/<span class="keyword">include</span>/bits/sched.h /usr/<span class="keyword">include</span>/libio.h \</span><br><span class="line">    /usr/<span class="keyword">include</span>/_G_config.h /usr/<span class="keyword">include</span>/wchar.h \</span><br><span class="line">    /usr/<span class="keyword">include</span>/bits/wchar.h /usr/<span class="keyword">include</span>/gconv.h \</span><br><span class="line">    /usr/lib/gcc-lib/i486-suse-linux/2.95.3/<span class="keyword">include</span>/stdarg.h \</span><br><span class="line">    /usr/<span class="keyword">include</span>/bits/stdio_lim.h</span><br></pre></td></tr></table></figure></li>
<li><code>gcc -MM main.c</code>çš„è¾“å‡ºåˆ™æ˜¯:<figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line"><span class="section">main.o: main.c defs.h</span></span><br></pre></td></tr></table></figure></li>
<li><code>GNU</code>ç»„ç»‡å»ºè®®æŠŠç¼–è¯‘å™¨ä¸ºæ¯ä¸€ä¸ªæºæ–‡ä»¶çš„è‡ªåŠ¨ç”Ÿæˆçš„ä¾èµ–å…³ç³»æ”¾åˆ°ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼Œä¸ºæ¯ä¸€ä¸ª <code>name.c</code> çš„æ–‡ä»¶éƒ½ç”Ÿæˆä¸€ä¸ª <code>name.d</code> çš„<code>Makefile</code>æ–‡ä»¶ï¼Œ <code>.d</code> æ–‡ä»¶ä¸­å°±å­˜æ”¾å¯¹åº” <code>.c</code> æ–‡ä»¶çš„ä¾èµ–å…³ç³»ã€‚</li>
<li>æˆ‘ä»¬å¯ä»¥å†™å‡º <code>.c</code> æ–‡ä»¶å’Œ <code>.d</code> æ–‡ä»¶çš„ä¾èµ–å…³ç³»ï¼Œå¹¶è®©<code>make</code>è‡ªåŠ¨æ›´æ–°æˆ–ç”Ÿæˆ <code>.d</code> æ–‡ä»¶ï¼Œå¹¶æŠŠå…¶åŒ…å«åœ¨æˆ‘ä»¬çš„ä¸»<code>Makefile</code>ä¸­ï¼Œè¿™æ ·ï¼Œæˆ‘ä»¬å°±å¯ä»¥è‡ªåŠ¨åŒ–åœ°ç”Ÿæˆæ¯ä¸ªæ–‡ä»¶çš„ä¾èµ–å…³ç³»äº†ã€‚</li>
</ul>
<figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line"><span class="section">%.d: %.c</span></span><br><span class="line">    @set -e; rm -f <span class="variable">$@</span>; \</span><br><span class="line">    <span class="variable">$(CC)</span> -M <span class="variable">$(CPPFLAGS)</span> <span class="variable">$&lt;</span> &gt; <span class="variable">$@</span>.$$$$; \</span><br><span class="line">    sed &#x27;s,\(<span class="variable">$*</span>\)\.o[ :]*,\1.o <span class="variable">$@</span> : ,g&#x27; &lt; <span class="variable">$@</span>.$$$$ &gt; <span class="variable">$@</span>; \</span><br><span class="line">    rm -f <span class="variable">$@</span>.$$$$</span><br></pre></td></tr></table></figure>
<ul>
<li>è§„åˆ™çš„æ„æ€æ˜¯ï¼Œæ‰€æœ‰çš„ <code>.d</code> æ–‡ä»¶ä¾èµ–äº <code>.c</code> æ–‡ä»¶</li>
<li><code>rm -f $@</code> çš„æ„æ€æ˜¯åˆ é™¤æ‰€æœ‰çš„ç›®æ ‡ï¼Œä¹Ÿå°±æ˜¯ <code>.d</code> æ–‡ä»¶</li>
<li>ç¬¬äºŒè¡Œçš„æ„æ€æ˜¯ï¼Œä¸ºæ¯ä¸ªä¾èµ–æ–‡ä»¶ <code>$&lt;</code> ï¼Œä¹Ÿå°±æ˜¯ <code>.c</code> æ–‡ä»¶ç”Ÿæˆä¾èµ–æ–‡ä»¶ï¼Œ <code>$@</code> è¡¨ç¤ºæ¨¡å¼ <code>%.d</code> æ–‡ä»¶ï¼Œå¦‚æœæœ‰ä¸€ä¸ª<code>C</code>æ–‡ä»¶æ˜¯<code>name.c</code>ï¼Œé‚£ä¹ˆ <code>%</code> å°±æ˜¯ <code>name</code> ï¼Œ <code>$$$$</code> æ„ä¸ºä¸€ä¸ªéšæœºç¼–å·ï¼Œç¬¬äºŒè¡Œç”Ÿæˆçš„æ–‡ä»¶æœ‰å¯èƒ½æ˜¯â€œ<code>name.d.12345</code>â€</li>
<li>ç¬¬ä¸‰è¡Œä½¿ç”¨<code>sed</code>å‘½ä»¤åšäº†ä¸€ä¸ªæ›¿æ¢ï¼Œå…³äº<code>sed</code>å‘½ä»¤çš„ç”¨æ³•è¯·å‚çœ‹ç›¸å…³çš„ä½¿ç”¨æ–‡æ¡£</li>
<li>ç¬¬å››è¡Œå°±æ˜¯åˆ é™¤ä¸´æ—¶æ–‡ä»¶</li>
</ul>
<p>æ€»è€Œè¨€ä¹‹ï¼Œè¿™ä¸ªæ¨¡å¼è¦åšçš„äº‹å°±æ˜¯åœ¨ç¼–è¯‘å™¨ç”Ÿæˆçš„ä¾èµ–å…³ç³»ä¸­åŠ å…¥ <code>.d</code> æ–‡ä»¶çš„ä¾èµ–ï¼Œå³æŠŠä¾èµ–å…³ç³»ï¼š</p>
<pre><code>main.o : main.c defs.h
</code></pre>
<p>è½¬æˆï¼š</p>
<pre><code>main.o main.d : main.c defs.h
</code></pre>
<p>äºæ˜¯ï¼Œæˆ‘ä»¬çš„ <code>.d</code> æ–‡ä»¶ä¹Ÿä¼šè‡ªåŠ¨æ›´æ–°äº†ï¼Œå¹¶ä¼šè‡ªåŠ¨ç”Ÿæˆäº†, ä½ è¿˜å¯ä»¥åœ¨è¿™ä¸ª <code>.d</code> æ–‡ä»¶ä¸­åŠ å…¥çš„ä¸åªæ˜¯ä¾èµ–å…³ç³»ï¼ŒåŒ…æ‹¬ç”Ÿæˆçš„å‘½ä»¤ä¹Ÿå¯ä¸€å¹¶åŠ å…¥ï¼Œè®©æ¯ä¸ª <code>.d</code> æ–‡ä»¶éƒ½åŒ…å«ä¸€ä¸ªå®Œæ•´çš„è§„åˆ™, ä¾‹å¦‚ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line">sources = foo.c bar.c</span><br><span class="line"></span><br><span class="line"><span class="keyword">include</span> $(sources:.c=.d)</span><br></pre></td></tr></table></figure>
<ul>
<li><code>$(sources:.c=.d)</code> ä¸­çš„ <code>.c=.d</code> çš„æ„æ€æ˜¯åšä¸€ä¸ªæ›¿æ¢ï¼ŒæŠŠå˜é‡ <code>$(sources)</code> æ‰€æœ‰ <code>.c</code> çš„å­—ä¸²éƒ½æ›¿æ¢æˆ <code>.d</code></li>
<li>å› ä¸º<code>include</code>æ˜¯æŒ‰æ¬¡åºæ¥è½½å…¥æ–‡ä»¶ï¼Œæœ€å…ˆè½½å…¥çš„ <code>.d</code> æ–‡ä»¶ä¸­çš„ç›®æ ‡ä¼šæˆä¸ºé»˜è®¤ç›®æ ‡ã€‚</li>
</ul>
<br>

<h3 id="ä¹¦å†™å‘½ä»¤"><a href="#ä¹¦å†™å‘½ä»¤" class="headerlink" title="ä¹¦å†™å‘½ä»¤"></a>ä¹¦å†™å‘½ä»¤</h3><h4 id="æ˜¾ç¤ºå‘½ä»¤"><a href="#æ˜¾ç¤ºå‘½ä»¤" class="headerlink" title="æ˜¾ç¤ºå‘½ä»¤"></a>æ˜¾ç¤ºå‘½ä»¤</h4><figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line">@echo æ­£åœ¨ç¼–è¯‘XXXæ¨¡å—......</span><br></pre></td></tr></table></figure>
<p>å½“<code>make</code>æ‰§è¡Œæ—¶ï¼Œä¼šè¾“å‡ºâ€œæ­£åœ¨ç¼–è¯‘XXXæ¨¡å—â€¦â€¦â€å­—ä¸²ï¼Œä½†ä¸ä¼šè¾“å‡ºå‘½ä»¤ï¼Œå¦‚æœæ²¡æœ‰â€œ<code>@</code>â€ï¼Œé‚£ä¹ˆï¼Œ<code>make</code>å°†è¾“å‡º:</p>
<figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line">echo æ­£åœ¨ç¼–è¯‘XXXæ¨¡å—......		//è¾“å‡ºå‘½ä»¤</span><br><span class="line">æ­£åœ¨ç¼–è¯‘XXXæ¨¡å—......</span><br></pre></td></tr></table></figure>
<ul>
<li>å¦‚æœ<code>make</code>æ‰§è¡Œæ—¶ï¼Œå¸¦å…¥<code>make</code>å‚æ•° <code>-n</code> æˆ– <code>--just-print</code> ï¼Œé‚£ä¹ˆå…¶åªæ˜¯æ˜¾ç¤ºå‘½ä»¤ï¼Œä½†ä¸ä¼šæ‰§è¡Œå‘½ä»¤ã€‚</li>
<li><code>make</code>å‚æ•° <code>-s</code> æˆ– <code>--silent</code> æˆ– <code>--quiet</code> åˆ™æ˜¯å…¨é¢ç¦æ­¢å‘½ä»¤çš„æ˜¾ç¤ºã€‚</li>
</ul>
<h4 id="å‘½ä»¤æ‰§è¡Œ"><a href="#å‘½ä»¤æ‰§è¡Œ" class="headerlink" title="å‘½ä»¤æ‰§è¡Œ"></a>å‘½ä»¤æ‰§è¡Œ</h4><p>å½“ä¾èµ–ç›®æ ‡æ–°äºç›®æ ‡æ—¶ï¼Œä¹Ÿå°±æ˜¯å½“è§„åˆ™çš„ç›®æ ‡éœ€è¦è¢«æ›´æ–°æ—¶ï¼Œmakeä¼šä¸€æ¡ä¸€æ¡çš„æ‰§è¡Œå…¶åçš„å‘½ä»¤ã€‚å¦‚æœä½ è¦è®©ä¸Šä¸€æ¡å‘½ä»¤çš„ç»“æœåº”ç”¨åœ¨ä¸‹ä¸€æ¡å‘½ä»¤æ—¶ï¼Œä½ åº”è¯¥ä½¿ç”¨åˆ†å·åˆ†éš”è¿™ä¸¤æ¡å‘½ä»¤ã€‚æ¯”å¦‚ä½ çš„ç¬¬ä¸€æ¡å‘½ä»¤æ˜¯<code>cd</code>å‘½ä»¤ï¼Œä½ å¸Œæœ›ç¬¬äºŒæ¡å‘½ä»¤å¾—åœ¨<code>cd</code>ä¹‹åçš„åŸºç¡€ä¸Šè¿è¡Œï¼Œé‚£ä¹ˆä½ å°±ä¸èƒ½æŠŠè¿™ä¸¤æ¡å‘½ä»¤å†™åœ¨ä¸¤è¡Œä¸Šï¼Œè€Œåº”è¯¥æŠŠè¿™ä¸¤æ¡å‘½ä»¤å†™åœ¨ä¸€è¡Œä¸Šï¼Œç”¨åˆ†å·åˆ†éš”ã€‚</p>
<ul>
<li>ç¤ºä¾‹ä¸€ï¼š<figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line"><span class="section">exec:</span></span><br><span class="line">    cd /home/hchen</span><br><span class="line">    pwd</span><br></pre></td></tr></table></figure></li>
</ul>
<figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line"><span class="section">exec:</span></span><br><span class="line">    cd /home/hchen; pwd</span><br></pre></td></tr></table></figure>
<p>å½“æˆ‘ä»¬æ‰§è¡Œ <code>make exec</code> æ—¶ï¼Œç¬¬ä¸€ä¸ªä¾‹å­ä¸­çš„<code>cd</code>æ²¡æœ‰ä½œç”¨ï¼Œ<code>pwd</code>ä¼šæ‰“å°å‡ºå½“å‰çš„<code>Makefile</code>ç›®å½•ï¼Œè€Œç¬¬äºŒä¸ªä¾‹å­ä¸­ï¼Œ<code>cd</code>å°±èµ·ä½œç”¨äº†ï¼Œ<code>pwd</code>ä¼šæ‰“å°å‡ºâ€œ<code>/home/hchen</code>â€ã€‚</p>
<h4 id="å‘½ä»¤å‡ºé”™"><a href="#å‘½ä»¤å‡ºé”™" class="headerlink" title="å‘½ä»¤å‡ºé”™"></a>å‘½ä»¤å‡ºé”™</h4><p>å¿½ç•¥å‘½ä»¤çš„å‡ºé”™ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨<code>Makefile</code>çš„å‘½ä»¤è¡Œå‰åŠ ä¸€ä¸ªå‡å· <code>-</code> ï¼ˆåœ¨<code>Tab</code>é”®ä¹‹åï¼‰ï¼Œæ ‡è®°ä¸ºä¸ç®¡å‘½ä»¤å‡ºä¸å‡ºé”™éƒ½è®¤ä¸ºæ˜¯æˆåŠŸçš„ã€‚å¦‚ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line"><span class="section">clean:</span></span><br><span class="line">    -rm -f *.o</span><br></pre></td></tr></table></figure>
<ul>
<li>è¿˜æœ‰ä¸€ä¸ªå…¨å±€çš„åŠæ³•æ˜¯ï¼Œç»™<code>make</code>åŠ ä¸Š <code>-i</code> æˆ–æ˜¯ <code>--ignore-errors</code> å‚æ•°ï¼Œé‚£ä¹ˆï¼Œ<code>Makefile</code>ä¸­æ‰€æœ‰å‘½ä»¤éƒ½ä¼šå¿½ç•¥é”™è¯¯ã€‚å¦‚æœä¸€ä¸ªè§„åˆ™æ˜¯ä»¥ <code>.IGNORE</code> ä½œä¸ºç›®æ ‡çš„ï¼Œé‚£ä¹ˆè¿™ä¸ªè§„åˆ™ä¸­çš„æ‰€æœ‰å‘½ä»¤å°†ä¼šå¿½ç•¥é”™è¯¯ã€‚</li>
<li>è¿˜æœ‰ä¸€ä¸ªè¦æä¸€ä¸‹çš„<code>make</code>çš„å‚æ•°çš„æ˜¯ <code>-k</code> æˆ–æ˜¯ <code>--keep-going </code>ï¼Œè¿™ä¸ªå‚æ•°çš„æ„æ€æ˜¯ï¼Œå¦‚æœæŸè§„åˆ™ä¸­çš„å‘½ä»¤å‡ºé”™äº†ï¼Œé‚£ä¹ˆå°± <strong>ç»ˆæ­¢è¯¥è§„åˆ™</strong> çš„æ‰§è¡Œï¼Œä½† <strong>ç»§ç»­æ‰§è¡Œå…¶å®ƒè§„åˆ™</strong>ã€‚</li>
</ul>
<h4 id="åµŒå¥—æ‰§è¡Œmake"><a href="#åµŒå¥—æ‰§è¡Œmake" class="headerlink" title="åµŒå¥—æ‰§è¡Œmake"></a>åµŒå¥—æ‰§è¡Œmake</h4><p>åœ¨ä¸€äº›å¤§çš„å·¥ç¨‹ä¸­ï¼Œæˆ‘ä»¬ä¼šæŠŠæˆ‘ä»¬ä¸åŒæ¨¡å—æˆ–æ˜¯ä¸åŒåŠŸèƒ½çš„æºæ–‡ä»¶æ”¾åœ¨ä¸åŒçš„ç›®å½•ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æ¯ä¸ªç›®å½•ä¸­éƒ½ä¹¦å†™ä¸€ä¸ªè¯¥ç›®å½•çš„<code>Makefile</code></p>
<p>ä¾‹å¦‚ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªå­ç›®å½•å«<code>subdir</code>ï¼Œè¿™ä¸ªç›®å½•ä¸‹æœ‰ä¸ª<code>Makefile</code>æ–‡ä»¶ï¼Œæ¥æŒ‡æ˜äº†è¿™ä¸ªç›®å½•ä¸‹æ–‡ä»¶çš„ç¼–è¯‘è§„åˆ™ã€‚é‚£ä¹ˆæˆ‘ä»¬æ€»æ§çš„<code>Makefile</code>å¯ä»¥è¿™æ ·ä¹¦å†™ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line"><span class="section">subsystem:</span></span><br><span class="line">    cd subdir &amp;&amp; <span class="variable">$(MAKE)</span></span><br></pre></td></tr></table></figure>
<p>å…¶ç­‰ä»·äºï¼š</p>
<figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line"><span class="section">subsystem:</span></span><br><span class="line">    <span class="variable">$(MAKE)</span> -C subdir</span><br></pre></td></tr></table></figure>
<ul>
<li><p><code>Makefile</code>çš„<code>-C</code>é€‰é¡¹ï¼Œå¯ä»¥æŒ‡å®šç¼–è¯‘ç›®å½•ï¼Œ<code>-f</code>é€‰é¡¹å¯ä»¥æŒ‡å®šç¼–è¯‘æ–‡ä»¶ã€‚</p>
</li>
<li><p>å®šä¹‰<code>$(MAKE)</code>å®å˜é‡çš„æ„æ€æ˜¯ï¼Œä¹Ÿè®¸æˆ‘ä»¬çš„<code>make</code>éœ€è¦ä¸€äº›å‚æ•°ï¼Œæ‰€ä»¥å®šä¹‰æˆä¸€ä¸ªå˜é‡æ¯”è¾ƒåˆ©äºç»´æŠ¤ã€‚è¿™ä¸¤ä¸ªä¾‹å­çš„æ„æ€éƒ½æ˜¯å…ˆè¿›å…¥â€œ<code>subdir</code>â€ç›®å½•ï¼Œç„¶åæ‰§è¡Œ<code>make</code>å‘½ä»¤ã€‚</p>
</li>
<li><p>æˆ‘ä»¬æŠŠè¿™ä¸ª<code>Makefile</code>å«åšâ€œ<code>æ€»æ§Makefile</code>â€ï¼Œ<code>æ€»æ§Makefile</code>çš„<strong>å˜é‡</strong>å¯ä»¥ä¼ é€’åˆ°<code>ä¸‹çº§çš„Makefile</code>ä¸­ï¼ˆå¦‚æœä½ æ˜¾ç¤ºçš„å£°æ˜ï¼‰ï¼Œä½†æ˜¯<strong>ä¸ä¼šè¦†ç›–</strong>ä¸‹å±‚çš„<code>Makefile</code>ä¸­æ‰€å®šä¹‰çš„å˜é‡ï¼Œé™¤éæŒ‡å®šäº† <code>-e</code> å‚æ•°ã€‚</p>
</li>
<li><p>å¦‚æœä½ è¦ä¼ é€’å˜é‡åˆ°ä¸‹çº§<code>Makefile</code>ä¸­ï¼Œé‚£ä¹ˆä½ å¯ä»¥ä½¿ç”¨è¿™æ ·çš„å£°æ˜: <code>export &lt;variable ...&gt;;</code></p>
</li>
<li><p>å¦‚æœä½ ä¸æƒ³è®©æŸäº›å˜é‡ä¼ é€’åˆ°ä¸‹çº§<code>Makefile</code>ä¸­ï¼Œé‚£ä¹ˆä½ å¯ä»¥è¿™æ ·å£°æ˜: <code>unexport &lt;variable ...&gt;;</code></p>
</li>
<li><p>å¦‚æœä½ è¦ä¼ é€’æ‰€æœ‰çš„å˜é‡ï¼Œé‚£ä¹ˆï¼Œåªè¦ä¸€ä¸ª<code>export</code>å°±è¡Œäº†ã€‚åé¢ä»€ä¹ˆä¹Ÿä¸ç”¨è·Ÿï¼Œè¡¨ç¤ºä¼ é€’æ‰€æœ‰çš„å˜é‡ã€‚<br>ç¤ºä¾‹ä¸€ï¼š</p>
<p>  export variable &#x3D; value<br>  &#x2F;&#x2F; å…¶ç­‰ä»·äºï¼š<br>  variable &#x3D; value<br>  export variable<br>  &#x2F;&#x2F; å…¶ç­‰ä»·äºï¼š<br>  export variable :&#x3D; value<br>  &#x2F;&#x2F; å…¶ç­‰ä»·äºï¼š<br>  variable :&#x3D; value<br>  export variable</p>
</li>
</ul>
<p>ç¤ºä¾‹äºŒï¼š</p>
<pre><code>export variable += value
// å…¶ç­‰ä»·äºï¼š
variable += value
export variable
</code></pre>
<ul>
<li>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæœ‰ä¸¤ä¸ªå˜é‡ï¼Œä¸€ä¸ªæ˜¯ <code>SHELL</code> ï¼Œä¸€ä¸ªæ˜¯ <code>MAKEFLAGS</code> ï¼Œè¿™ä¸¤ä¸ªå˜é‡ä¸ç®¡ä½ æ˜¯å¦<code>export</code>ï¼Œå…¶æ€»æ˜¯è¦ <strong>ä¼ é€’åˆ°ä¸‹å±‚</strong> <code>Makefile</code>ä¸­ï¼Œç‰¹åˆ«æ˜¯ <code>MAKEFLAGS</code> å˜é‡ï¼Œå…¶ä¸­åŒ…å«äº†<code>make</code>çš„ <strong>å‚æ•°ä¿¡æ¯</strong>ï¼Œå¦‚æœæˆ‘ä»¬æ‰§è¡Œâ€œ<code>æ€»æ§Makefile</code>â€æ—¶æœ‰<code>make</code>å‚æ•°æˆ–æ˜¯åœ¨ä¸Šå±‚ <code>Makefile</code>ä¸­å®šä¹‰äº†è¿™ä¸ªå˜é‡ï¼Œé‚£ä¹ˆ <code>MAKEFLAGS</code> å˜é‡å°†ä¼šæ˜¯è¿™äº›å‚æ•°ï¼Œå¹¶ä¼šä¼ é€’åˆ°ä¸‹å±‚<code>Makefile</code>ä¸­ï¼Œè¿™æ˜¯ä¸€ä¸ªç³»ç»Ÿçº§çš„ç¯å¢ƒå˜é‡ã€‚</li>
<li>ä½†æ˜¯<code>make</code>å‘½ä»¤ä¸­çš„æœ‰å‡ ä¸ªå‚æ•°å¹¶ä¸å¾€ä¸‹ä¼ é€’ï¼Œå®ƒä»¬æ˜¯ <code>-C</code> , <code>-f</code> , <code>-h</code>, <code>-o</code> å’Œ <code>-W</code> ï¼ˆæœ‰å…³<code>Makefile</code>å‚æ•°çš„ç»†èŠ‚å°†åœ¨åé¢è¯´æ˜ï¼‰ï¼Œå¦‚æœä½ ä¸æƒ³å¾€ä¸‹å±‚ä¼ é€’å‚æ•°ï¼Œé‚£ä¹ˆï¼Œä½ å¯ä»¥è¿™æ ·æ¥ï¼š<figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line"><span class="section">subsystem:</span></span><br><span class="line">cd subdir &amp;&amp; <span class="variable">$(MAKE)</span> MAKEFLAGS=</span><br></pre></td></tr></table></figure></li>
<li>å¦‚æœä½ å®šä¹‰äº†ç¯å¢ƒå˜é‡ <code>MAKEFLAGS</code> ï¼Œé‚£ä¹ˆä½ å¾—ç¡®ä¿¡å…¶ä¸­çš„é€‰é¡¹æ˜¯å¤§å®¶éƒ½ä¼šç”¨åˆ°çš„ï¼Œå¦‚æœå…¶ä¸­æœ‰ <code>-t</code> , <code>-n</code> å’Œ <code>-q</code> å‚æ•°ï¼Œé‚£ä¹ˆå°†ä¼šæœ‰è®©ä½ æ„æƒ³ä¸åˆ°çš„ç»“æœï¼Œæˆ–è®¸ä¼šè®©ä½ å¼‚å¸¸åœ°ææ…Œã€‚</li>
<li>è¿˜æœ‰ä¸€ä¸ªåœ¨â€œ<strong>åµŒå¥—æ‰§è¡Œ</strong>â€ä¸­æ¯”è¾ƒæœ‰ç”¨çš„å‚æ•°ï¼Œ <code>-w</code> æˆ–æ˜¯ <code>--print-directory</code> ä¼šåœ¨<code>make</code>çš„è¿‡ç¨‹ä¸­è¾“å‡ºä¸€äº›ä¿¡æ¯ï¼Œè®©ä½ çœ‹åˆ°ç›®å‰çš„å·¥ä½œç›®å½•ã€‚æ¯”å¦‚ï¼Œå¦‚æœæˆ‘ä»¬çš„ä¸‹çº§<code>make</code>ç›®å½•æ˜¯â€œ<code>/home/hchen/gnu/make</code>â€ï¼Œå¦‚æœæˆ‘ä»¬ä½¿ç”¨ <code>make -w</code> æ¥æ‰§è¡Œï¼Œé‚£ä¹ˆå½“è¿›å…¥è¯¥ç›®å½•æ—¶ï¼Œæˆ‘ä»¬ä¼šçœ‹åˆ°:<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">make: Entering directory `/home/hchen/gnu/make&#x27;.</span><br></pre></td></tr></table></figure>
è€Œåœ¨å®Œæˆä¸‹å±‚makeåç¦»å¼€ç›®å½•æ—¶ï¼Œæˆ‘ä»¬ä¼šçœ‹åˆ°:<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">make: Leaving directory `/home/hchen/gnu/make&#x27;</span><br></pre></td></tr></table></figure></li>
<li>å½“ä½ ä½¿ç”¨ <code>-C</code> å‚æ•°æ¥æŒ‡å®š<code>make</code>ä¸‹å±‚<code>Makefile</code>æ—¶ï¼Œ <code>-w</code> ä¼šè¢«è‡ªåŠ¨æ‰“å¼€çš„ã€‚å¦‚æœå‚æ•°ä¸­æœ‰ <code>-s</code> ï¼ˆ <code>--slient</code> ï¼‰æˆ–æ˜¯ <code>--no-print-directory</code> ï¼Œé‚£ä¹ˆï¼Œ <code>-w</code> æ€»æ˜¯å¤±æ•ˆçš„ã€‚</li>
</ul>
<br>

<h4 id="å®šä¹‰å‘½ä»¤åŒ…"><a href="#å®šä¹‰å‘½ä»¤åŒ…" class="headerlink" title="å®šä¹‰å‘½ä»¤åŒ…"></a>å®šä¹‰å‘½ä»¤åŒ…</h4><p>å¦‚æœMakefileä¸­å‡ºç°ä¸€äº›ç›¸åŒå‘½ä»¤åºåˆ—ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥ä¸ºè¿™äº›ç›¸åŒçš„å‘½ä»¤åºåˆ—å®šä¹‰ä¸€ä¸ªå˜é‡ã€‚å®šä¹‰è¿™ç§å‘½ä»¤åºåˆ—çš„è¯­æ³•ä»¥ <code>define</code> å¼€å§‹ï¼Œä»¥ <code>endef</code> ç»“æŸï¼Œå¦‚:</p>
<figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line"><span class="keyword">define</span> run-yacc</span><br><span class="line">yacc <span class="variable">$(<span class="built_in">firstword</span> <span class="variable">$^</span>)</span></span><br><span class="line">mv y.tab.c <span class="variable">$@</span></span><br><span class="line"><span class="keyword">endef</span></span><br></pre></td></tr></table></figure>
<ul>
<li>è¿™é‡Œï¼Œâ€œrun-yaccâ€æ˜¯è¿™ä¸ªå‘½ä»¤åŒ…çš„åå­—ï¼Œå…¶ä¸è¦å’ŒMakefileä¸­çš„å˜é‡é‡åã€‚åœ¨ define å’Œ endef ä¸­çš„ä¸¤è¡Œå°±æ˜¯å‘½ä»¤åºåˆ—ã€‚è¿™ä¸ªå‘½ä»¤åŒ…ä¸­çš„ç¬¬ä¸€ä¸ªå‘½ä»¤æ˜¯è¿è¡ŒYaccç¨‹åºï¼Œå› ä¸ºYaccç¨‹åºæ€»æ˜¯ç”Ÿæˆâ€œy.tab.câ€çš„æ–‡ä»¶ï¼Œæ‰€ä»¥ç¬¬äºŒè¡Œçš„å‘½ä»¤å°±æ˜¯æŠŠè¿™ä¸ªæ–‡ä»¶æ”¹æ”¹åå­—ã€‚è¿˜æ˜¯æŠŠè¿™ä¸ªå‘½ä»¤åŒ…æ”¾åˆ°ä¸€ä¸ªç¤ºä¾‹ä¸­æ¥çœ‹çœ‹å§ã€‚</li>
</ul>
<figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line">foo.c : foo.y</span><br><span class="line">    $(run-yacc)</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬å¯ä»¥çœ‹è§ï¼Œè¦ä½¿ç”¨è¿™ä¸ªå‘½ä»¤åŒ…ï¼Œæˆ‘ä»¬å°±å¥½åƒä½¿ç”¨å˜é‡ä¸€æ ·ã€‚åœ¨è¿™ä¸ªå‘½ä»¤åŒ…çš„ä½¿ç”¨ä¸­ï¼Œå‘½ä»¤åŒ…â€œ<code>run-yacc</code>â€ä¸­çš„ <code>$^</code> å°±æ˜¯ <code>foo.y</code> ï¼Œ <code>$@</code> å°±æ˜¯ <code>foo.c</code> ï¼ˆæœ‰å…³è¿™ç§ä»¥ <code>$</code> å¼€å¤´çš„ç‰¹æ®Šå˜é‡ï¼Œæˆ‘ä»¬ä¼šåœ¨åé¢ä»‹ç»ï¼‰ï¼Œ<code>make</code>åœ¨æ‰§è¡Œå‘½ä»¤åŒ…æ—¶ï¼Œå‘½ä»¤åŒ…ä¸­çš„æ¯ä¸ªå‘½ä»¤ä¼šè¢«ä¾æ¬¡ç‹¬ç«‹æ‰§è¡Œã€‚</p>
<br>

<h3 id="ä½¿ç”¨å‡½æ•°"><a href="#ä½¿ç”¨å‡½æ•°" class="headerlink" title="ä½¿ç”¨å‡½æ•°"></a>ä½¿ç”¨å‡½æ•°</h3><h4 id="å‡½æ•°çš„è°ƒç”¨è¯­æ³•"><a href="#å‡½æ•°çš„è°ƒç”¨è¯­æ³•" class="headerlink" title="å‡½æ•°çš„è°ƒç”¨è¯­æ³•"></a>å‡½æ•°çš„è°ƒç”¨è¯­æ³•</h4><p>å‡½æ•°è°ƒç”¨ï¼Œå¾ˆåƒå˜é‡çš„ä½¿ç”¨ï¼Œä¹Ÿæ˜¯ä»¥ <code>$</code> æ¥æ ‡è¯†çš„ï¼Œå…¶è¯­æ³•å¦‚ä¸‹ï¼š</p>
<pre><code>$(&lt;function&gt; &lt;arguments&gt;)    
// æˆ–è€…
$&#123;&lt;function&gt; &lt;arguments&gt;&#125;
</code></pre>
<h4 id="å­—ç¬¦ä¸²å¤„ç†å‡½æ•°"><a href="#å­—ç¬¦ä¸²å¤„ç†å‡½æ•°" class="headerlink" title="å­—ç¬¦ä¸²å¤„ç†å‡½æ•°"></a>å­—ç¬¦ä¸²å¤„ç†å‡½æ•°</h4><h5 id="subst"><a href="#subst" class="headerlink" title="subst"></a>subst</h5><figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line"><span class="variable">$(<span class="built_in">subst</span> &lt;from&gt;,&lt;to&gt;,&lt;text&gt;)</span></span><br></pre></td></tr></table></figure>
<ul>
<li>åç§°ï¼šå­—ç¬¦ä¸²æ›¿æ¢å‡½æ•°</li>
<li>åŠŸèƒ½ï¼šæŠŠå­—ä¸² <code>&lt;text&gt;</code> ä¸­çš„ <code>&lt;from&gt;</code> å­—ç¬¦ä¸²æ›¿æ¢æˆ <code>&lt;to&gt;</code> ã€‚</li>
<li>è¿”å›ï¼šå‡½æ•°è¿”å›è¢«æ›¿æ¢è¿‡åçš„å­—ç¬¦ä¸²ã€‚</li>
</ul>
<h5 id="patsubst"><a href="#patsubst" class="headerlink" title="patsubst"></a>patsubst</h5><figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line"><span class="variable">$(<span class="built_in">patsubst</span> &lt;pattern&gt;,&lt;replacement&gt;,&lt;text&gt;)</span></span><br></pre></td></tr></table></figure>
<ul>
<li>åç§°ï¼š<strong>æ¨¡å¼</strong> å­—ç¬¦ä¸²æ›¿æ¢å‡½æ•°ã€‚</li>
<li>åŠŸèƒ½ï¼šæŸ¥æ‰¾ <code>&lt;text&gt;</code> ä¸­çš„å•è¯ï¼ˆå•è¯ä»¥â€œ<strong>ç©ºæ ¼</strong>â€ã€â€œ<strong>Tab</strong>â€æˆ–â€œ<strong>å›è½¦</strong>â€â€œ<strong>æ¢è¡Œ</strong>â€åˆ†éš”ï¼‰æ˜¯å¦ç¬¦åˆæ¨¡å¼ <code>&lt;pattern&gt;</code> ï¼Œå¦‚æœåŒ¹é…çš„è¯ï¼Œåˆ™ä»¥ <code>&lt;replacement&gt;</code> æ›¿æ¢ã€‚è¿™é‡Œï¼Œ <code>&lt;pattern&gt;</code> å¯ä»¥åŒ…æ‹¬é€šé…ç¬¦ <code>%</code> ï¼Œè¡¨ç¤ºä»»æ„é•¿åº¦çš„å­—ä¸²ã€‚å¦‚æœ <code>&lt;replacement&gt;</code> ä¸­ä¹ŸåŒ…å« <code>%</code> ï¼Œé‚£ä¹ˆï¼Œ <code>&lt;replacement&gt;</code> ä¸­çš„è¿™ä¸ª <code>%</code> å°†æ˜¯ <code>&lt;pattern&gt;</code> ä¸­çš„é‚£ä¸ª % æ‰€ä»£è¡¨çš„å­—ä¸²ã€‚ï¼ˆå¯ä»¥ç”¨ <code>\</code> æ¥è½¬ä¹‰ï¼Œä»¥ <code>\%</code> æ¥è¡¨ç¤ºçœŸå®å«ä¹‰çš„ <code>%</code> å­—ç¬¦ï¼‰</li>
<li>è¿”å›ï¼šå‡½æ•°è¿”å›è¢«æ›¿æ¢è¿‡åçš„å­—ç¬¦ä¸²ã€‚</li>
<li>ç¤ºä¾‹ï¼š<figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line"><span class="variable">$(<span class="built_in">patsubst</span> %.c,%.o,x.c.c bar.c)</span></span><br></pre></td></tr></table></figure>
æŠŠå­—ä¸² <code>x.c.c</code> <code>bar.c</code> ç¬¦åˆæ¨¡å¼ <code>%.c</code> çš„å•è¯æ›¿æ¢æˆ <code>%.o</code> ï¼Œè¿”å›ç»“æœæ˜¯ <code>x.c.o</code> <code>bar.o</code></li>
</ul>
<h5 id="strip"><a href="#strip" class="headerlink" title="strip"></a>strip</h5><pre><code>$(strip &lt;string&gt;)
</code></pre>
<ul>
<li>åç§°ï¼šå»ç©ºæ ¼å‡½æ•°ã€‚</li>
<li>åŠŸèƒ½ï¼šå»æ‰ <code>&lt;string&gt;</code> å­—ä¸²ä¸­å¼€å¤´å’Œç»“å°¾çš„ç©ºå­—ç¬¦ã€‚</li>
<li>è¿”å›ï¼šè¿”å›è¢«å»æ‰ç©ºæ ¼çš„å­—ç¬¦ä¸²å€¼ã€‚</li>
<li>ç¤ºä¾‹ï¼š<figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line"><span class="variable">$(<span class="built_in">strip</span> a b c )</span></span><br></pre></td></tr></table></figure>
æŠŠå­—ä¸²<code>a b c</code> å»æ‰å¼€å¤´å’Œç»“å°¾çš„ç©ºæ ¼ï¼Œç»“æœæ˜¯ <code>a b c</code>ã€‚</li>
</ul>
<h5 id="findstring"><a href="#findstring" class="headerlink" title="findstring"></a>findstring</h5><pre><code>$(findstring &lt;find&gt;,&lt;in&gt;)
</code></pre>
<ul>
<li>åç§°ï¼šæŸ¥æ‰¾å­—ç¬¦ä¸²å‡½æ•°</li>
<li>åŠŸèƒ½ï¼šåœ¨å­—ä¸² <in> ä¸­æŸ¥æ‰¾ <find> å­—ä¸²ã€‚</li>
<li>è¿”å›ï¼šå¦‚æœæ‰¾åˆ°ï¼Œé‚£ä¹ˆè¿”å› <find> ï¼Œå¦åˆ™è¿”å›ç©ºå­—ç¬¦ä¸²ã€‚</li>
<li>ç¤ºä¾‹ï¼š<figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line"><span class="variable">$(<span class="built_in">findstring</span> a,a b c)</span></span><br><span class="line"><span class="variable">$(<span class="built_in">findstring</span> a,b c)</span></span><br></pre></td></tr></table></figure>
ç¬¬ä¸€ä¸ªå‡½æ•°è¿”å› <code>a</code> å­—ç¬¦ä¸²ï¼Œç¬¬äºŒä¸ªè¿”å›<code>ç©º</code>å­—ç¬¦ä¸²</li>
</ul>
<h5 id="æ··åˆæ€»ç»“"><a href="#æ··åˆæ€»ç»“" class="headerlink" title="æ··åˆæ€»ç»“"></a>æ··åˆæ€»ç»“</h5><pre><code>override CFLAGS += $(patsubst %,-I%,$(subst :, ,$(VPATH)))
</code></pre>
<p>å¦‚æœæˆ‘ä»¬çš„ <code>$(VPATH)</code> å€¼æ˜¯ <code>src:../headers </code>ï¼Œé‚£ä¹ˆ <code>$(patsubst %,-I%,$(subst :, ,$(VPATH)))</code> å°†è¿”å› <code>-Isrc -I../headers</code> ï¼Œè¿™æ­£æ˜¯<code>cc</code>æˆ–<code>gcc</code>æœç´¢å¤´æ–‡ä»¶è·¯å¾„çš„å‚æ•°ã€‚</p>
<p><strong>æ³¨</strong>ï¼šå‡½æ•°å¤ªå¤šï¼Œä¸åšæ¦‚è¿°ã€‚è¯¦è§ï¼š<a href="https://seisman.github.io/how-to-write-makefile/functions.html">https://seisman.github.io/how-to-write-makefile/functions.html</a><br><strong>ä¾‹ç¨‹</strong>ï¼š<a href="https://github.com/XUAN9527/linux_test/tree/main/make_demo">https://github.com/XUAN9527/linux_test/tree/main/make_demo</a></p>
<br>

<h2 id="Makefileæ­é…Kconfigä½¿ç”¨"><a href="#Makefileæ­é…Kconfigä½¿ç”¨" class="headerlink" title="Makefileæ­é…Kconfigä½¿ç”¨"></a>Makefileæ­é…Kconfigä½¿ç”¨</h2><p>è¯ä¸å¤šè¯´ï¼Œæˆ‘ä»¬ä¸€èˆ¬ä½¿ç”¨<code>menuconfig</code>+<code>Kconfig</code>çš„æ–¹å¼è¿›è¡Œç‰ˆæœ¬é…ç½®ï¼Œè¿™é‡Œç®€å•çš„ç¬”è®°ä¸€ä¸ª<code>Python</code>è§£æå™¨ç‰ˆæœ¬çš„å®ç°<code>Kconfiglib</code>ã€‚<br>[å‚è€ƒé“¾æ¥1]ï¼š<a href="https://cstriker1407.info/blog/kconfiglib-simple-note/">https://cstriker1407.info/blog/kconfiglib-simple-note/</a><br>[å‚è€ƒé“¾æ¥2]ï¼š<a href="https://juejin.cn/post/7101836149915648030">https://juejin.cn/post/7101836149915648030</a></p>
<h3 id="ç¯å¢ƒæ­å»º"><a href="#ç¯å¢ƒæ­å»º" class="headerlink" title="ç¯å¢ƒæ­å»º"></a>ç¯å¢ƒæ­å»º</h3><ul>
<li>å®‰è£…å¿…é¡»ç»„ä»¶ï¼š<code>Python3</code> + <code>kconfiglib</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo apt update</span><br><span class="line">sudo apt install python3</span><br><span class="line">sudo apt install python3-pip</span><br><span class="line">pip3 install kconfiglib</span><br></pre></td></tr></table></figure>

<ul>
<li>éªŒè¯å®‰è£…:<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">python3 --version</span></span><br><span class="line">Python 3.10.14</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">pip3 show kconfiglib</span></span><br><span class="line">Name: kconfiglib</span><br><span class="line">Version: 14.1.0</span><br><span class="line">...</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="å®ç°ç¤ºä¾‹"><a href="#å®ç°ç¤ºä¾‹" class="headerlink" title="å®ç°ç¤ºä¾‹"></a>å®ç°ç¤ºä¾‹</h3><ul>
<li><p>åœ¨è·Ÿç›®å½•ä¸‹åˆ›å»º<code>Kconfig</code>æ–‡ä»¶ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">mainmenu &quot;N32l40x 128K MCU, Flash Configuration&quot;</span><br><span class="line">config SPI_FLASH_ENABLE</span><br><span class="line">  bool &quot;spi flash enable&quot;</span><br><span class="line">  default n</span><br><span class="line">  help </span><br><span class="line">  config spi flash enable/disable</span><br><span class="line"></span><br><span class="line">menu &quot;Internal Flash Configuration&quot;</span><br><span class="line">depends on !SPI_FLASH_ENABLE</span><br><span class="line">config INTER_BOOTLOAD_FIRMWARE_SIZE</span><br><span class="line">    int &quot;bootloader fireware size (K)&quot;</span><br><span class="line">    range 10 32</span><br><span class="line">    default 10</span><br><span class="line">    help</span><br><span class="line">    config bootloader fireware size</span><br><span class="line"></span><br><span class="line">config INTER_FACTORY_FIRMWARE_SIZE</span><br><span class="line">    int &quot;factory fireware size (K)&quot;</span><br><span class="line">    range 56 96</span><br><span class="line">    default 56</span><br><span class="line">    help</span><br><span class="line">    config factory fireware size 56K/96K</span><br><span class="line"></span><br><span class="line">config INTER_APPLICATION_FIRMWARE_SIZE</span><br><span class="line">    int &quot;application fireware size (K)&quot;</span><br><span class="line">    range 56 96</span><br><span class="line">    default 56</span><br><span class="line">    help</span><br><span class="line">    config application fireware size 56K/96K</span><br><span class="line"></span><br><span class="line">config INTER_DOWNLOAD_AREA_SIZE</span><br><span class="line">    int &quot;download fireware size (K)&quot;</span><br><span class="line">    range 56 96</span><br><span class="line">    default 56</span><br><span class="line">    help</span><br><span class="line">    config download area size 56K/96K</span><br><span class="line"></span><br><span class="line">config INTER_UPGRADE_DATA_SIZE</span><br><span class="line">    int &quot;upgrade data size (K)&quot;</span><br><span class="line">    range 2 4</span><br><span class="line">    default 2</span><br><span class="line">    help</span><br><span class="line">    config upgrade data size 2K/4K</span><br><span class="line"></span><br><span class="line">config INTER_DCD_DATA_SIZE</span><br><span class="line">    int &quot;dcd data size (K)&quot;</span><br><span class="line">    range 2 4</span><br><span class="line">    default 2</span><br><span class="line">    help</span><br><span class="line">    config dcd data size 2K/4K</span><br><span class="line"></span><br><span class="line">config INTER_USER_DATA_SIZE</span><br><span class="line">    int &quot;user data size (K)&quot;</span><br><span class="line">    range 2 408</span><br><span class="line">    default 2</span><br><span class="line">    help</span><br><span class="line">    config user data size 2K/408K; 2k - inter flash; 408K - outerflash</span><br><span class="line">endmenu</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>shell</code>æ‰§è¡Œ<code>menuconfig</code>æŒ‡ä»¤ï¼š</p>
</li>
</ul>
<p><img src="/../pictures/menuconfig.png" alt="menuconfig"><br><img src="/../pictures/menusubconfig.png" alt="menusubconfig"></p>
<ul>
<li>é€‰æ‹©å¥½éœ€è¦çš„å‚æ•°åï¼Œä¿å­˜é€€å‡ºï¼Œç”Ÿæˆ<code>.config</code>é…ç½®æ–‡ä»¶ã€‚</li>
<li><code>shell</code>æ‰§è¡Œ<code>genconfig</code>æŒ‡ä»¤ï¼Œå°†<code>.config</code>æ–‡ä»¶ç”Ÿæˆ<code>config.h</code>æ–‡ä»¶ï¼Œå¯ä¾›ç¨‹åºè°ƒç”¨ã€‚</li>
<li>å¦‚éœ€æ­é…<code>makefile</code>ä½¿ç”¨ï¼Œåˆ™éœ€è¦å°†<code>config.h</code>æ–‡ä»¶æ·»åŠ åˆ°<code>Makefile</code>ä¸­,æ·»åŠ ä»¥ä¸‹ä¾èµ–è§„åˆ™ã€‚<figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line"><span class="section">all: genconfig ...</span></span><br><span class="line">	...</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="section">menuconfig:</span></span><br><span class="line">	menuconfig</span><br><span class="line">	@echo <span class="string">&quot;menuconfig running!&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="section">genconfig:</span></span><br><span class="line">	genconfig</span><br><span class="line">	@echo <span class="string">&quot;genconfig .config &gt; config.h complete!&quot;</span></span><br></pre></td></tr></table></figure>
æ‰§è¡Œ<code>make menuconfig</code>è¿›è¡Œé…ç½®ï¼Œ<code>make</code>ç¼–è¯‘ç”Ÿæˆå³å¯ã€‚</li>
</ul>
<h2 id="makefileéšè—æ‰“å°è¾“å‡º"><a href="#makefileéšè—æ‰“å°è¾“å‡º" class="headerlink" title="makefileéšè—æ‰“å°è¾“å‡º"></a>makefileéšè—æ‰“å°è¾“å‡º</h2><ul>
<li><p>ä»¥ä¸‹æ˜¯<code>makefile</code>ä½¿ç”¨<code>make</code>ç¼–è¯‘çš„<code>shell</code>è¾“å‡ºä¿¡æ¯ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">xuan@DESKTOP-A52B6V9:~/work/wireless-charging/app$ make</span><br><span class="line">mkdir -p build/application/</span><br><span class="line">arm-none-eabi-gcc -ICMSIS/core -ICMSIS/device -Istd_periph_lib/inc -Iuser -Imsp -Idriver -Iapplication/inc -Icomponents/letter_shell -Icomponents/iap -Icomponents/ntc -Icomponents/soft_timer -Icomponents/comp_misc_lib -Icomponents/flexibleButton -Icomponents/aw9523b -c -fno-common --specs=rdimon.specs -std=gnu99 -mabi=aapcs -Wall -mcpu=cortex-m4 -mthumb -mfpu=fpv4-sp-d16 -mfloat-abi=hard -ffunction-sections -fdata-sections -lm --specs=nosys.specs --specs=nano.specs -Os -ggdb -DN32L40X -DUSE_STDPERIPH_DRIVER -D__FPU_PRESENT=1 -MMD -c application/main.c -o build/application/main.o</span><br><span class="line">arm-none-eabi-gcc build/CMSIS/device/startup/startup_n32l40x_gcc.o build/CMSIS/device/system_n32l40x.o build/std_periph_lib/src/n32l40x_rcc.o build/std_periph_lib/src/n32l40x_tim.o build/std_periph_lib/src/n32l40x_adc.o build/std_periph_lib/src/n32l40x_dma.o build/std_periph_lib/src/n32l40x_usart.o build/std_periph_lib/src/n32l40x_iwdg.o build/std_periph_lib/src/n32l40x_flash.o build/std_periph_lib/src/n32l40x_gpio.o build/std_periph_lib/src/n32l40x_spi.o build/std_periph_lib/src/misc.o build/application/main.o build/application/n32l40x_it.o build/application/system_work.o build/user/module_battery.o build/user/module_botton.o build/user/module_led.o build/user/module_power.o build/user/module_storage.o build/user/shell_debug.o build/user/user_board.o build/msp/board.o build/msp/drv_msp.o build/driver/drv_adc.o build/driver/drv_flash.o build/driver/drv_gpio.o build/driver/drv_iwdg.o build/driver/drv_pwm_gpio.o build/driver/drv_pwm_input.o build/driver/drv_usart.o build/driver/drv_spi_led.o build/driver/drv_i2c.o build/driver/drv_i2c_bit_ops.o build/components/comp_misc_lib/comp_misc_lib.o build/components/flexibleButton/flexible_button.o build/components/iap/af_utils.o build/components/iap/dcd_port.o build/components/iap/dcd_user.o build/components/iap/iap.o build/components/iap/ymodem.o build/components/letter_shell/log.o build/components/letter_shell/shell.o build/components/letter_shell/shell_cmd_list.o build/components/letter_shell/shell_companion.o build/components/letter_shell/shell_ext.o build/components/letter_shell/shell_port.o build/components/ntc/ntc.o build/components/soft_timer/soft_timer.o build/components/aw9523b/aw9523b.o -Wl,--gc-sections --data-sections -mabi=aapcs -mcpu=cortex-m4 -mthumb -mfpu=fpv4-sp-d16 -mfloat-abi=hard -ffunction-sections -fdata-sections -lm --specs=nosys.specs --specs=nano.specs -Os -ggdb -Tn32l40x_flash.ld -x assembler-with-cpp -Wa,-mimplicit-it=thumb -Wl,-Map=build/app.map -o build/app.elf</span><br><span class="line">arm-none-eabi-objcopy -Obinary build/app.elf build/app.bin</span><br><span class="line">arm-none-eabi-objdump -S build/app.elf &gt; build/app.lst</span><br><span class="line">arm-none-eabi-objcopy -O ihex build/app.elf build/app.hex</span><br><span class="line">arm-none-eabi-size build/app.elf</span><br><span class="line">   text    data     bss     dec     hex filename</span><br><span class="line">  29280     292   11888   41460    a1f4 build/app.elf</span><br><span class="line">make[1]: Entering directory &#x27;/home/xuan/work/wireless-charging/app&#x27;</span><br><span class="line">cp build/app.bin app.bin</span><br><span class="line">cp ../bootloader/bootloader.bin bootloader.bin</span><br><span class="line">make[1]: Leaving directory &#x27;/home/xuan/work/wireless-charging/app&#x27;</span><br><span class="line">make[1]: Entering directory &#x27;/home/xuan/work/wireless-charging/app&#x27;</span><br><span class="line">./tools/papp_up</span><br><span class="line">./tools/mix_10K</span><br><span class="line">arm-none-eabi-objcopy -I binary -O ihex --change-addresses 0x8000000 mix.bin mix.hex</span><br><span class="line">rm bootloader.bin</span><br><span class="line">rm app.bin</span><br><span class="line">rm mix.bin</span><br><span class="line">make[1]: Leaving directory &#x27;/home/xuan/work/wireless-charging/app&#x27;</span><br></pre></td></tr></table></figure>
</li>
<li><p>ä»¥ä¸‹æ˜¯<code>makefile</code>çš„ä»£ç ï¼š</p>
<figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line">.PHONY : clean all</span><br><span class="line"></span><br><span class="line"><span class="section">all: <span class="variable">$(TARGET)</span>.bin <span class="variable">$(TARGET)</span>.list <span class="variable">$(TARGET)</span>.hex</span></span><br><span class="line">	<span class="variable">$(SZ)</span> <span class="variable">$(TARGET)</span>.elf</span><br><span class="line">	@make copy</span><br><span class="line">	@make mix</span><br><span class="line"></span><br><span class="line"><span class="meta"><span class="keyword">.PHONY</span>: copy download</span></span><br><span class="line"></span><br><span class="line"><span class="section">copy: <span class="variable">$(TARGET)</span>.bin</span></span><br><span class="line">	cp <span class="variable">$(TARGET)</span>.bin app.bin</span><br><span class="line">	cp ../bootloader/bootloader.bin bootloader.bin</span><br><span class="line"></span><br><span class="line"><span class="section">mix:</span></span><br><span class="line">	./tools/papp_up</span><br><span class="line">	./tools/mix_10K</span><br><span class="line">	<span class="variable">$(OC)</span> -I binary -O ihex --change-addresses 0x8000000 mix.bin mix.hex</span><br><span class="line">	rm bootloader.bin</span><br><span class="line">	rm app.bin</span><br><span class="line">	rm mix.bin</span><br><span class="line"></span><br><span class="line"><span class="section">clean:</span></span><br><span class="line">	rm -rf <span class="variable">$(OUTPUT_DIR)</span></span><br><span class="line">	rm papp.bin</span><br><span class="line">	rm mix.hex</span><br><span class="line"></span><br><span class="line">SYS := <span class="variable">$(<span class="built_in">shell</span> uname -a)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">ifeq</span> (<span class="variable">$(<span class="built_in">findstring</span> Microsoft,<span class="variable">$(SYS)</span>)</span>,Microsoft)</span><br><span class="line"><span class="section">COPY_CMD:</span></span><br><span class="line">	cp <span class="variable">$(OUTPUT_DIR)</span>/app.hex <span class="string">&quot;/mnt/c/Users/Breo/Desktop/iap-tools/linux_download/&quot;</span></span><br><span class="line">	wsl.exe -d Ubuntu-20.04 cmd.exe /c <span class="string">&quot;C:\\\Users\\\BREO\\\Desktop\\\iap-tools\\\linux_download\\\program.bat&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="section">COPY_CMD:</span></span><br><span class="line">	echo <span class="string">&quot;å½“å‰ç³»ç»Ÿä¸æ˜¯ WSLï¼Œè·³è¿‡æ‹·è´æ–‡ä»¶æŒ‡ä»¤&quot;</span></span><br><span class="line"><span class="keyword">endif</span></span><br><span class="line"></span><br><span class="line"><span class="section">download:</span></span><br><span class="line">	@make all</span><br><span class="line">	@<span class="variable">$(MAKE)</span> COPY_CMD</span><br></pre></td></tr></table></figure></li>
<li><p>ä½¿ç”¨<code>@</code>å’Œ<code>--no-print</code>æ¥éšè—æ‰“å°ä¿¡æ¯ï¼Œæ”¹è¿›åï¼š</p>
<figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line">.PHONY : clean all</span><br><span class="line"></span><br><span class="line"><span class="section">all: <span class="variable">$(TARGET)</span>.bin <span class="variable">$(TARGET)</span>.list <span class="variable">$(TARGET)</span>.hex</span></span><br><span class="line">	<span class="variable">$(SZ)</span> <span class="variable">$(TARGET)</span>.elf</span><br><span class="line">	@make --no-print copy</span><br><span class="line">	@make --no-print mix</span><br><span class="line">	</span><br><span class="line"><span class="meta"><span class="keyword">.PHONY</span>: copy</span></span><br><span class="line"></span><br><span class="line"><span class="section">copy: <span class="variable">$(TARGET)</span>.bin</span></span><br><span class="line">	@cp <span class="variable">$(TARGET)</span>.bin app.bin</span><br><span class="line">	@cp ../bootloader/bootloader.bin bootloader.bin</span><br><span class="line"></span><br><span class="line"><span class="section">mix:</span></span><br><span class="line">	@./tools/papp_up</span><br><span class="line">	@./tools/mix_10K</span><br><span class="line">	@<span class="variable">$(OC)</span> -I binary -O ihex --change-addresses 0x8000000 mix.bin mix.hex</span><br><span class="line">	@rm bootloader.bin</span><br><span class="line">	@rm app.bin</span><br><span class="line">	@rm mix.bin</span><br><span class="line"></span><br><span class="line"><span class="section">clean:</span></span><br><span class="line">	-rm -rf <span class="variable">$(OUTPUT_DIR)</span></span><br><span class="line">	-rm papp.bin</span><br><span class="line">	-rm mix.hex</span><br><span class="line"></span><br><span class="line">SYS := <span class="variable">$(<span class="built_in">shell</span> uname -a)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">ifeq</span> (<span class="variable">$(<span class="built_in">findstring</span> Microsoft,<span class="variable">$(SYS)</span>)</span>,Microsoft)</span><br><span class="line"><span class="section">COPY_CMD:</span></span><br><span class="line">	cp <span class="variable">$(TARGET)</span>.hex <span class="string">&quot;/mnt/c/Users/Breo/Desktop/iap-tools/linux_download/&quot;</span></span><br><span class="line">	wsl.exe -d Ubuntu-20.04 cmd.exe /c <span class="string">&quot;C:\\\Users\\\BREO\\\Desktop\\\iap-tools\\\linux_download\\\program.bat&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="section">COPY_CMD:</span></span><br><span class="line">	echo <span class="string">&quot;å½“å‰ç³»ç»Ÿä¸æ˜¯ WSLï¼Œè·³è¿‡æ‹·è´æ–‡ä»¶æŒ‡ä»¤&quot;</span></span><br><span class="line"><span class="keyword">endif</span></span><br><span class="line"></span><br><span class="line"><span class="section">download:</span></span><br><span class="line">	@make all</span><br><span class="line">	@<span class="variable">$(MAKE)</span> COPY_CMD</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ul>
]]></content>
      <categories>
        <category>ç¼–è¯‘å·¥å…·</category>
      </categories>
      <tags>
        <tag>Linux</tag>
        <tag>Makefile</tag>
      </tags>
  </entry>
  <entry>
    <title>Cotex-M4å¯åŠ¨è¯¦è§£</title>
    <url>/2024/05/29/Cotex-M4%E5%90%AF%E5%8A%A8%E8%AF%A6%E8%A7%A3/</url>
    <content><![CDATA[<h2 id="å¯åŠ¨æ–‡ä»¶"><a href="#å¯åŠ¨æ–‡ä»¶" class="headerlink" title="å¯åŠ¨æ–‡ä»¶"></a>å¯åŠ¨æ–‡ä»¶</h2><p><code>startup_n32l40x_gcc.s</code> æ–‡ä»¶ä¸ºä¾‹ï¼Œä»¥ä¸‹æ˜¯æºä»£ç ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">/**</span><br><span class="line">  ****************************************************************************</span><br><span class="line">  Copyright (c) 2019, Nations Technologies Inc.</span><br><span class="line"></span><br><span class="line">  All rights reserved.</span><br><span class="line">  ****************************************************************************</span><br><span class="line"></span><br><span class="line">  Redistribution and use in source and binary forms, with or without</span><br><span class="line">  modification, are permitted provided that the following conditions are met:</span><br><span class="line"></span><br><span class="line">  - Redistributions of source code must retain the above copyright notice,</span><br><span class="line">  this list of conditions and the disclaimer below.</span><br><span class="line"></span><br><span class="line">  Nations&#x27; name may not be used to endorse or promote products derived from</span><br><span class="line">  this software without specific prior written permission.</span><br><span class="line"></span><br><span class="line">  DISCLAIMER: THIS SOFTWARE IS PROVIDED BY NATIONS &quot;AS IS&quot; AND ANY EXPRESS OR</span><br><span class="line">  IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF</span><br><span class="line">  MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT ARE</span><br><span class="line">  DISCLAIMED. IN NO EVENT SHALL NATIONS BE LIABLE FOR ANY DIRECT, INDIRECT,</span><br><span class="line">  INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT</span><br><span class="line">  LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA,</span><br><span class="line">  OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF</span><br><span class="line">  LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING</span><br><span class="line">  NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE,</span><br><span class="line">  EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</span><br><span class="line">  ****************************************************************************</span><br><span class="line"> **/</span><br><span class="line"> </span><br><span class="line">/*</span><br><span class="line">* Amount of memory (in bytes) allocated for Stack</span><br><span class="line">* Tailor this value to your application needs</span><br><span class="line">* &lt;h&gt; Stack Configuration</span><br><span class="line">*   &lt;o&gt; Stack Size (in Bytes) &lt;0x0-0xFFFFFFFF:8&gt;</span><br><span class="line">* &lt;/h&gt;</span><br><span class="line">*/</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line">******************************************************************************</span><br><span class="line">* @file      startup_n32l40x_gcc.s</span><br><span class="line">******************************************************************************</span><br><span class="line">*/</span><br><span class="line">    </span><br><span class="line">  .syntax unified</span><br><span class="line">  .cpu cortex-m4</span><br><span class="line">  .fpu softvfp</span><br><span class="line">  .thumb</span><br><span class="line"></span><br><span class="line">.global  g_pfnVectors</span><br><span class="line">.global  Default_Handler</span><br><span class="line"></span><br><span class="line">/* start address for the initialization values of the .data section. </span><br><span class="line">defined in linker script */</span><br><span class="line">.word  _sidata</span><br><span class="line">/* start address for the .data section. defined in linker script */  </span><br><span class="line">.word  _sdata</span><br><span class="line">/* end address for the .data section. defined in linker script */</span><br><span class="line">.word  _edata</span><br><span class="line">/* start address for the .bss section. defined in linker script */</span><br><span class="line">.word  _sbss</span><br><span class="line">/* end address for the .bss section. defined in linker script */</span><br><span class="line">.word  _ebss</span><br><span class="line">/* stack used for SystemInit_ExtMemCtl; always internal RAM used */</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * @brief  This is the code that gets called when the processor first</span><br><span class="line"> *          starts execution following a reset event. Only the absolutely</span><br><span class="line"> *          necessary set is performed, after which the application</span><br><span class="line"> *          supplied main() routine is called. </span><br><span class="line"> * @param  None</span><br><span class="line"> * @retval : None</span><br><span class="line">*/</span><br><span class="line"></span><br><span class="line">  .section  .text.Reset_Handler</span><br><span class="line">  .weak  Reset_Handler</span><br><span class="line">  .type  Reset_Handler, %function</span><br><span class="line">  Reset_Handler:  </span><br><span class="line"></span><br><span class="line">/* Copy the data segment initializers from flash to SRAM */  </span><br><span class="line">  movs  r1, #0</span><br><span class="line">  b  LoopCopyDataInit</span><br><span class="line"></span><br><span class="line">CopyDataInit:</span><br><span class="line">  ldr  r3, =_sidata</span><br><span class="line">  ldr  r3, [r3, r1]</span><br><span class="line">  str  r3, [r0, r1]</span><br><span class="line">  adds  r1, r1, #4</span><br><span class="line">    </span><br><span class="line">LoopCopyDataInit:</span><br><span class="line">  ldr  r0, =_sdata</span><br><span class="line">  ldr  r3, =_edata</span><br><span class="line">  adds  r2, r0, r1</span><br><span class="line">  cmp  r2, r3</span><br><span class="line">  bcc  CopyDataInit</span><br><span class="line">  ldr  r2, =_sbss</span><br><span class="line">  b  LoopFillZerobss</span><br><span class="line">/* Zero fill the bss segment. */  </span><br><span class="line">FillZerobss:</span><br><span class="line">  movs  r3, #0</span><br><span class="line">  str  r3, [r2], #4</span><br><span class="line">    </span><br><span class="line">LoopFillZerobss:</span><br><span class="line">  ldr  r3, = _ebss</span><br><span class="line">  cmp  r2, r3</span><br><span class="line">  bcc  FillZerobss</span><br><span class="line"></span><br><span class="line">/* Call the clock system intitialization function.*/</span><br><span class="line">  bl  SystemInit   </span><br><span class="line">/* Call static constructors */</span><br><span class="line">  bl __libc_init_array</span><br><span class="line">/* Call the application&#x27;s entry point.*/</span><br><span class="line">  bl  main</span><br><span class="line">  bx  lr    </span><br><span class="line">.size  Reset_Handler, .-Reset_Handler</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * @brief  This is the code that gets called when the processor receives an </span><br><span class="line"> *         unexpected interrupt.  This simply enters an infinite loop, preserving</span><br><span class="line"> *         the system state for examination by a debugger.</span><br><span class="line"> * @param  None     </span><br><span class="line"> * @retval None       </span><br><span class="line">*/</span><br><span class="line">    .section  .text.Default_Handler,&quot;ax&quot;,%progbits</span><br><span class="line">Default_Handler:</span><br><span class="line">Infinite_Loop:</span><br><span class="line">  b  Infinite_Loop</span><br><span class="line">  .size  Default_Handler, .-Default_Handler</span><br><span class="line">/******************************************************************************</span><br><span class="line">*</span><br><span class="line">* The minimal vector table for a Cortex M3. Note that the proper constructs</span><br><span class="line">* must be placed on this to ensure that it ends up at physical address</span><br><span class="line">* 0x0000.0000.</span><br><span class="line">* </span><br><span class="line">*******************************************************************************/</span><br><span class="line">   .section  .isr_vector,&quot;a&quot;,%progbits</span><br><span class="line">  .type  g_pfnVectors, %object</span><br><span class="line">  .size  g_pfnVectors, .-g_pfnVectors</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">g_pfnVectors:</span><br><span class="line">  .word  _estack</span><br><span class="line">  .word  Reset_Handler</span><br><span class="line">  .word  NMI_Handler</span><br><span class="line">  .word  HardFault_Handler</span><br><span class="line">  .word  MemManage_Handler</span><br><span class="line">  .word  BusFault_Handler</span><br><span class="line">  .word  UsageFault_Handler</span><br><span class="line">  .word  0</span><br><span class="line">  .word  0</span><br><span class="line">  .word  0</span><br><span class="line">  .word  0</span><br><span class="line">  .word  SVC_Handler</span><br><span class="line">  .word  DebugMon_Handler</span><br><span class="line">  .word  0</span><br><span class="line">  .word  PendSV_Handler</span><br><span class="line">  .word  SysTick_Handler</span><br><span class="line">  </span><br><span class="line">  /* External Interrupts */</span><br><span class="line">  .word     WWDG_IRQHandler                     /* Window WatchDog                      */                                        </span><br><span class="line">  .word     PVD_IRQHandler                      /* PVD through EXTI Line detection      */                        </span><br><span class="line">  .word     TAMPER_IRQHandler                   /* Tamper                               */            </span><br><span class="line">  .word     RTC_WKUP_IRQHandler                 /* RTC Wakeup                           */                      </span><br><span class="line">  .word     FLASH_IRQHandler                    /* FLASH                                */                                          </span><br><span class="line">  .word     RCC_IRQHandler                      /* RCC                                  */                                            </span><br><span class="line">  .word     EXTI0_IRQHandler                    /* EXTI Line0                           */                        </span><br><span class="line">  .word     EXTI1_IRQHandler                    /* EXTI Line1                           */                          </span><br><span class="line">  .word     EXTI2_IRQHandler                    /* EXTI Line2                           */                          </span><br><span class="line">  .word     EXTI3_IRQHandler                    /* EXTI Line3                           */                          </span><br><span class="line">  .word     EXTI4_IRQHandler                    /* EXTI Line4                           */                          </span><br><span class="line">  .word     DMA_Channel1_IRQHandler            /* DMA1 Channel 1                       */                  </span><br><span class="line">  .word     DMA_Channel2_IRQHandler            /* DMA1 Channel 2                       */                   </span><br><span class="line">  .word     DMA_Channel3_IRQHandler            /* DMA1 Channel 3                       */                   </span><br><span class="line">  .word     DMA_Channel4_IRQHandler            /* DMA1 Channel 4                       */                   </span><br><span class="line">  .word     DMA_Channel5_IRQHandler            /* DMA1 Channel 5                       */                   </span><br><span class="line">  .word     DMA_Channel6_IRQHandler            /* DMA1 Channel 6                       */                   </span><br><span class="line">  .word     DMA_Channel7_IRQHandler            /* DMA1 Channel 7                       */       </span><br><span class="line">  .word     DMA_Channel8_IRQHandler             /* DMA1 Channel 8                       */ </span><br><span class="line">  .word     ADC_IRQHandler                      /* ADC                                  */                   </span><br><span class="line">  .word     USB_HP_IRQHandler                   /* USB High Priority                    */                         </span><br><span class="line">  .word     USB_LP_IRQHandler                   /* USB Low  Priority                    */                          </span><br><span class="line">  .word     COMP_1_2_IRQHandler                 /* COMP1 &amp; COMP2 through EXTI line 21/22    */                          </span><br><span class="line">  .word     EXTI9_5_IRQHandler                  /* EXTI Line 9..5                       */                          </span><br><span class="line">  .word     TIM1_BRK_IRQHandler                 /* TIM1 Break                           */</span><br><span class="line">  .word     TIM1_UP_IRQHandler                  /* TIM1 Update                          */         </span><br><span class="line">  .word     TIM1_TRG_COM_IRQHandler             /* TIM1 Trigger and Commutation         */</span><br><span class="line">  .word     TIM1_CC_IRQHandler                  /* TIM1 Capture Compare                 */                          </span><br><span class="line">  .word     TIM2_IRQHandler                     /* TIM2                                 */                   </span><br><span class="line">  .word     TIM3_IRQHandler                     /* TIM3                                 */                   </span><br><span class="line">  .word     TIM4_IRQHandler                     /* TIM4                                 */                   </span><br><span class="line">  .word     I2C1_EV_IRQHandler                  /* I2C1 Event                           */                          </span><br><span class="line">  .word     I2C1_ER_IRQHandler                  /* I2C1 Error                           */                          </span><br><span class="line">  .word     I2C2_EV_IRQHandler                  /* I2C2 Event                           */                          </span><br><span class="line">  .word     I2C2_ER_IRQHandler                  /* I2C2 Error                           */                            </span><br><span class="line">  .word     SPI1_IRQHandler                     /* SPI1                                 */                   </span><br><span class="line">  .word     SPI2_IRQHandler                     /* SPI2                                 */                   </span><br><span class="line">  .word     USART1_IRQHandler                   /* USART1                               */                   </span><br><span class="line">  .word     USART2_IRQHandler                   /* USART2                               */                   </span><br><span class="line">  .word     USART3_IRQHandler                   /* USART3                               */                   </span><br><span class="line">  .word     EXTI15_10_IRQHandler                /* EXTI Line 15..10                     */                          </span><br><span class="line">  .word     RTCAlarm_IRQHandler                 /* RTC Alarm through EXTI Line          */                 </span><br><span class="line">  .word     USBWakeUp_IRQHandler                /* USB Wakeup from suspend              */                       </span><br><span class="line">  .word     TIM8_BRK_IRQHandler                 /* TIM8 Break                           */         </span><br><span class="line">  .word     TIM8_UP_IRQHandler                  /* TIM8 Update                          */         </span><br><span class="line">  .word     TIM8_TRG_COM_IRQHandler             /* TIM8 Trigger and Commutation         */</span><br><span class="line">  .word     TIM8_CC_IRQHandler                  /* TIM8 Capture Compare                 */                          </span><br><span class="line">  .word     UART4_IRQHandler                    /* UART4                                */                   </span><br><span class="line">  .word     UART5_IRQHandler                    /* UART5                                */       </span><br><span class="line">  .word     LPUART_IRQHandler                   /* LPUART                               */</span><br><span class="line">  .word     TIM5_IRQHandler                     /* TIM5                                 */   </span><br><span class="line">  .word     TIM6_IRQHandler                     /* TIM6                                 */                   </span><br><span class="line">  .word     TIM7_IRQHandler                     /* TIM7                                 */</span><br><span class="line">  .word     CAN_TX_IRQHandler                   /* CAN TX                               */                          </span><br><span class="line">  .word     CAN_RX0_IRQHandler                  /* CAN RX0                              */                          </span><br><span class="line">  .word     CAN_RX1_IRQHandler                  /* CAN RX1                              */                          </span><br><span class="line">  .word     CAN_SCE_IRQHandler                  /* CAN SCE                              */                          </span><br><span class="line">  .word     LPUART_WKUP_IRQHandler              /* LPUART_WKUP                          */                   </span><br><span class="line">  .word     LPTIM_WKUP_IRQHandler               /* LPTIM_WKUP                           */                   </span><br><span class="line">  .word     LCD_IRQHandler                      /* LCD                                  */                   </span><br><span class="line">  .word     SAC_IRQHandler                      /* SAC                                  */                   </span><br><span class="line">  .word     MMU_IRQHandler                      /* MMU                                  */</span><br><span class="line">  .word     TSC_IRQHandler                      /* TSC                                  */</span><br><span class="line">  .word     RAMC_PERR_IRQHandler                /* RAMC ERR                             */</span><br><span class="line">  .word     TIM9_IRQHandler                     /* TIM9                                 */</span><br><span class="line">  .word     UCDR_IRQHandler                     /* UCDR ERR                             */</span><br><span class="line"></span><br><span class="line">/*******************************************************************************</span><br><span class="line">*</span><br><span class="line">* Provide weak aliases for each Exception handler to the Default_Handler. </span><br><span class="line">* As they are weak aliases, any function with the same name will override </span><br><span class="line">* this definition.</span><br><span class="line">* </span><br><span class="line">*******************************************************************************/</span><br><span class="line">   .weak      NMI_Handler</span><br><span class="line">   .thumb_set NMI_Handler,Default_Handler</span><br><span class="line">  </span><br><span class="line">   .weak      HardFault_Handler</span><br><span class="line">   .thumb_set HardFault_Handler,Default_Handler</span><br><span class="line">  </span><br><span class="line">   .weak      MemManage_Handler</span><br><span class="line">   .thumb_set MemManage_Handler,Default_Handler</span><br><span class="line">  </span><br><span class="line">   .weak      BusFault_Handler</span><br><span class="line">   .thumb_set BusFault_Handler,Default_Handler</span><br><span class="line"></span><br><span class="line">   .weak      UsageFault_Handler</span><br><span class="line">   .thumb_set UsageFault_Handler,Default_Handler</span><br><span class="line"></span><br><span class="line">   .weak      SVC_Handler</span><br><span class="line">   .thumb_set SVC_Handler,Default_Handler</span><br><span class="line"></span><br><span class="line">   .weak      DebugMon_Handler</span><br><span class="line">   .thumb_set DebugMon_Handler,Default_Handler</span><br><span class="line"></span><br><span class="line">   .weak      PendSV_Handler</span><br><span class="line">   .thumb_set PendSV_Handler,Default_Handler</span><br><span class="line"></span><br><span class="line">   .weak      SysTick_Handler</span><br><span class="line">   .thumb_set SysTick_Handler,Default_Handler              </span><br><span class="line">  </span><br><span class="line">   .weak      WWDG_IRQHandler                   </span><br><span class="line">   .thumb_set WWDG_IRQHandler,Default_Handler      </span><br><span class="line">                  </span><br><span class="line">   .weak      PVD_IRQHandler      </span><br><span class="line">   .thumb_set PVD_IRQHandler,Default_Handler</span><br><span class="line">               </span><br><span class="line">   .weak      TAMPER_IRQHandler            </span><br><span class="line">   .thumb_set TAMPER_IRQHandler,Default_Handler</span><br><span class="line">            </span><br><span class="line">   .weak      RTC_WKUP_IRQHandler                  </span><br><span class="line">   .thumb_set RTC_WKUP_IRQHandler,Default_Handler</span><br><span class="line">            </span><br><span class="line">   .weak      FLASH_IRQHandler         </span><br><span class="line">   .thumb_set FLASH_IRQHandler,Default_Handler</span><br><span class="line">                  </span><br><span class="line">   .weak      RCC_IRQHandler      </span><br><span class="line">   .thumb_set RCC_IRQHandler,Default_Handler</span><br><span class="line">                  </span><br><span class="line">   .weak      EXTI0_IRQHandler         </span><br><span class="line">   .thumb_set EXTI0_IRQHandler,Default_Handler</span><br><span class="line">                  </span><br><span class="line">   .weak      EXTI1_IRQHandler         </span><br><span class="line">   .thumb_set EXTI1_IRQHandler,Default_Handler</span><br><span class="line">                     </span><br><span class="line">   .weak      EXTI2_IRQHandler         </span><br><span class="line">   .thumb_set EXTI2_IRQHandler,Default_Handler </span><br><span class="line">                 </span><br><span class="line">   .weak      EXTI3_IRQHandler         </span><br><span class="line">   .thumb_set EXTI3_IRQHandler,Default_Handler</span><br><span class="line">                        </span><br><span class="line">   .weak      EXTI4_IRQHandler         </span><br><span class="line">   .thumb_set EXTI4_IRQHandler,Default_Handler</span><br><span class="line">                  </span><br><span class="line">   .weak      DMA_Channel1_IRQHandler               </span><br><span class="line">   .thumb_set DMA_Channel1_IRQHandler,Default_Handler</span><br><span class="line">         </span><br><span class="line">   .weak      DMA_Channel2_IRQHandler               </span><br><span class="line">   .thumb_set DMA_Channel2_IRQHandler,Default_Handler</span><br><span class="line">                  </span><br><span class="line">   .weak      DMA_Channel3_IRQHandler               </span><br><span class="line">   .thumb_set DMA_Channel3_IRQHandler,Default_Handler</span><br><span class="line">                  </span><br><span class="line">   .weak      DMA_Channel4_IRQHandler               </span><br><span class="line">   .thumb_set DMA_Channel4_IRQHandler,Default_Handler </span><br><span class="line">                 </span><br><span class="line">   .weak      DMA_Channel5_IRQHandler              </span><br><span class="line">   .thumb_set DMA_Channel5_IRQHandler,Default_Handler</span><br><span class="line">                  </span><br><span class="line">   .weak      DMA_Channel6_IRQHandler               </span><br><span class="line">   .thumb_set DMA_Channel6_IRQHandler,Default_Handler</span><br><span class="line">                  </span><br><span class="line">   .weak      DMA_Channel7_IRQHandler               </span><br><span class="line">   .thumb_set DMA_Channel7_IRQHandler,Default_Handler</span><br><span class="line"></span><br><span class="line">   .weak      DMA_Channel8_IRQHandler               </span><br><span class="line">   .thumb_set DMA_Channel8_IRQHandler,Default_Handler</span><br><span class="line">   </span><br><span class="line">   .weak      ADC_IRQHandler      </span><br><span class="line">   .thumb_set ADC_IRQHandler,Default_Handler</span><br><span class="line">               </span><br><span class="line">   .weak      USB_HP_IRQHandler   </span><br><span class="line">   .thumb_set USB_HP_IRQHandler,Default_Handler</span><br><span class="line">            </span><br><span class="line">   .weak      USB_LP_IRQHandler                  </span><br><span class="line">   .thumb_set USB_LP_IRQHandler,Default_Handler</span><br><span class="line"></span><br><span class="line">   .weak      COMP_1_2_IRQHandler                  </span><br><span class="line">   .thumb_set COMP_1_2_IRQHandler,Default_Handler</span><br><span class="line"> </span><br><span class="line">   .weak      EXTI9_5_IRQHandler   </span><br><span class="line">   .thumb_set EXTI9_5_IRQHandler,Default_Handler</span><br><span class="line">            </span><br><span class="line">   .weak      TIM1_BRK_IRQHandler            </span><br><span class="line">   .thumb_set TIM1_BRK_IRQHandler,Default_Handler</span><br><span class="line">            </span><br><span class="line">   .weak      TIM1_UP_IRQHandler            </span><br><span class="line">   .thumb_set TIM1_UP_IRQHandler,Default_Handler</span><br><span class="line">      </span><br><span class="line">   .weak      TIM1_TRG_COM_IRQHandler      </span><br><span class="line">   .thumb_set TIM1_TRG_COM_IRQHandler,Default_Handler</span><br><span class="line">      </span><br><span class="line">   .weak      TIM1_CC_IRQHandler   </span><br><span class="line">   .thumb_set TIM1_CC_IRQHandler,Default_Handler</span><br><span class="line">                  </span><br><span class="line">   .weak      TIM2_IRQHandler            </span><br><span class="line">   .thumb_set TIM2_IRQHandler,Default_Handler</span><br><span class="line">                  </span><br><span class="line">   .weak      TIM3_IRQHandler            </span><br><span class="line">   .thumb_set TIM3_IRQHandler,Default_Handler</span><br><span class="line">                  </span><br><span class="line">   .weak      TIM4_IRQHandler            </span><br><span class="line">   .thumb_set TIM4_IRQHandler,Default_Handler</span><br><span class="line">                  </span><br><span class="line">   .weak      I2C1_EV_IRQHandler   </span><br><span class="line">   .thumb_set I2C1_EV_IRQHandler,Default_Handler</span><br><span class="line">                     </span><br><span class="line">   .weak      I2C1_ER_IRQHandler   </span><br><span class="line">   .thumb_set I2C1_ER_IRQHandler,Default_Handler</span><br><span class="line">                     </span><br><span class="line">   .weak      I2C2_EV_IRQHandler   </span><br><span class="line">   .thumb_set I2C2_EV_IRQHandler,Default_Handler</span><br><span class="line">                  </span><br><span class="line">   .weak      I2C2_ER_IRQHandler   </span><br><span class="line">   .thumb_set I2C2_ER_IRQHandler,Default_Handler</span><br><span class="line">                           </span><br><span class="line">   .weak      SPI1_IRQHandler            </span><br><span class="line">   .thumb_set SPI1_IRQHandler,Default_Handler</span><br><span class="line">                        </span><br><span class="line">   .weak      SPI2_IRQHandler            </span><br><span class="line">   .thumb_set SPI2_IRQHandler,Default_Handler</span><br><span class="line">                  </span><br><span class="line">   .weak      USART1_IRQHandler      </span><br><span class="line">   .thumb_set USART1_IRQHandler,Default_Handler</span><br><span class="line">                     </span><br><span class="line">   .weak      USART2_IRQHandler      </span><br><span class="line">   .thumb_set USART2_IRQHandler,Default_Handler</span><br><span class="line">                     </span><br><span class="line">   .weak      USART3_IRQHandler      </span><br><span class="line">   .thumb_set USART3_IRQHandler,Default_Handler</span><br><span class="line">                  </span><br><span class="line">   .weak      EXTI15_10_IRQHandler               </span><br><span class="line">   .thumb_set EXTI15_10_IRQHandler,Default_Handler</span><br><span class="line">               </span><br><span class="line">   .weak      RTCAlarm_IRQHandler               </span><br><span class="line">   .thumb_set RTCAlarm_IRQHandler,Default_Handler</span><br><span class="line">            </span><br><span class="line">   .weak      USBWakeUp_IRQHandler         </span><br><span class="line">   .thumb_set USBWakeUp_IRQHandler,Default_Handler</span><br><span class="line">            </span><br><span class="line">   .weak      TIM8_BRK_IRQHandler         </span><br><span class="line">   .thumb_set TIM8_BRK_IRQHandler,Default_Handler</span><br><span class="line">         </span><br><span class="line">   .weak      TIM8_UP_IRQHandler            </span><br><span class="line">   .thumb_set TIM8_UP_IRQHandler,Default_Handler</span><br><span class="line">         </span><br><span class="line">   .weak      TIM8_TRG_COM_IRQHandler      </span><br><span class="line">   .thumb_set TIM8_TRG_COM_IRQHandler,Default_Handler</span><br><span class="line">      </span><br><span class="line">   .weak      TIM8_CC_IRQHandler   </span><br><span class="line">   .thumb_set TIM8_CC_IRQHandler,Default_Handler</span><br><span class="line">                  </span><br><span class="line">   .weak      UART4_IRQHandler         </span><br><span class="line">   .thumb_set UART4_IRQHandler,Default_Handler</span><br><span class="line">                  </span><br><span class="line">   .weak      UART5_IRQHandler         </span><br><span class="line">   .thumb_set UART5_IRQHandler,Default_Handler</span><br><span class="line">   </span><br><span class="line">   .weak      LPUART_IRQHandler         </span><br><span class="line">   .thumb_set LPUART_IRQHandler,Default_Handler</span><br><span class="line">                  </span><br><span class="line">   .weak      TIM5_IRQHandler            </span><br><span class="line">   .thumb_set TIM5_IRQHandler,Default_Handler</span><br><span class="line">                  </span><br><span class="line">   .weak      TIM6_IRQHandler                  </span><br><span class="line">   .thumb_set TIM6_IRQHandler,Default_Handler</span><br><span class="line">               </span><br><span class="line">   .weak      TIM7_IRQHandler            </span><br><span class="line">   .thumb_set TIM7_IRQHandler,Default_Handler</span><br><span class="line">            </span><br><span class="line">   .weak      CAN_TX_IRQHandler   </span><br><span class="line">   .thumb_set CAN_TX_IRQHandler,Default_Handler</span><br><span class="line">                           </span><br><span class="line">   .weak      CAN_RX0_IRQHandler                  </span><br><span class="line">   .thumb_set CAN_RX0_IRQHandler,Default_Handler</span><br><span class="line">                           </span><br><span class="line">   .weak      CAN_RX1_IRQHandler                  </span><br><span class="line">   .thumb_set CAN_RX1_IRQHandler,Default_Handler</span><br><span class="line">                           </span><br><span class="line">   .weak      CAN_SCE_IRQHandler                  </span><br><span class="line">   .thumb_set CAN_SCE_IRQHandler,Default_Handler</span><br><span class="line">                           </span><br><span class="line">   .weak      LPUART_WKUP_IRQHandler      </span><br><span class="line">   .thumb_set LPUART_WKUP_IRQHandler,Default_Handler</span><br><span class="line">                     </span><br><span class="line">   .weak      LPTIM_WKUP_IRQHandler               </span><br><span class="line">   .thumb_set LPTIM_WKUP_IRQHandler,Default_Handler</span><br><span class="line"></span><br><span class="line">   .weak      LCD_IRQHandler            </span><br><span class="line">   .thumb_set LCD_IRQHandler,Default_Handler</span><br><span class="line">   </span><br><span class="line">   .weak      SAC_IRQHandler            </span><br><span class="line">   .thumb_set SAC_IRQHandler,Default_Handler</span><br><span class="line">               </span><br><span class="line">   .weak      MMU_IRQHandler                  </span><br><span class="line">   .thumb_set MMU_IRQHandler,Default_Handler   </span><br><span class="line"></span><br><span class="line">   .weak      TSC_IRQHandler                  </span><br><span class="line">   .thumb_set TSC_IRQHandler,Default_Handler  </span><br><span class="line">    </span><br><span class="line">   .weak      RAMC_PERR_IRQHandler                  </span><br><span class="line">   .thumb_set RAMC_PERR_IRQHandler,Default_Handler  </span><br><span class="line">    </span><br><span class="line">   .weak      TIM9_IRQHandler                  </span><br><span class="line">   .thumb_set TIM9_IRQHandler,Default_Handler  </span><br><span class="line">   </span><br><span class="line">   .weak      UCDR_IRQHandler                  </span><br><span class="line">   .thumb_set UCDR_IRQHandler,Default_Handler  </span><br><span class="line">   </span><br><span class="line">/************************ (C) COPYRIGHT Nations Technologies Inc *****END OF FILE****/</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<br>

<p><strong>ä»¥ä¸‹ä¸ºè¿™æ®µ<code>assembly</code>ä»£ç çš„æ³¨é‡Š</strong>ï¼š</p>
<pre><code>.syntax unified
</code></pre>
<p>æŒ‡å®šç»Ÿä¸€çš„<code>ARM</code>å’Œ<code>Thumb</code>æŒ‡ä»¤é›†è¯­æ³•ã€‚</p>
<pre><code>.cpu cortex-m4
.fpu softvfp
.thumb
</code></pre>
<p>æŒ‡å®šç›®æ ‡<code>CPU</code>ä¸º<code>Cortex-M4</code>ï¼Œæµ®ç‚¹å•å…ƒä¸ºè½¯ä»¶å®ç°ï¼ˆ<code>softvfp</code>ï¼‰ï¼Œå¹¶ä½¿ç”¨<code>Thumb</code>æŒ‡ä»¤é›†ã€‚</p>
<pre><code>.global  g_pfnVectors
.global  Default_Handler
</code></pre>
<p>å£°æ˜å…¨å±€ç¬¦å·<code>g_pfnVectors</code>å’Œ<code>Default_Handler</code>ï¼Œä½¿å…¶åœ¨å…¶ä»–æ±‡ç¼–æ–‡ä»¶æˆ–<code>C</code>ä»£ç ä¸­ä¹Ÿå¯è®¿é—®ã€‚</p>
<pre><code>.section  .text.Reset_Handler
.weak  Reset_Handler
.type  Reset_Handler, %function
</code></pre>
<p>å®šä¹‰äº†ä¸€ä¸ªåä¸º<code>.text.Reset_Handler</code>çš„ä»£ç æ®µï¼Œå¹¶å£°æ˜<code>Reset_Handler</code>å‡½æ•°è¾ƒå¼±ï¼Œæ„å‘³ç€å¦‚æœæœ‰å…¶ä»–åŒåå‡½æ•°ï¼Œå°†è¦†ç›–æ­¤å£°æ˜ã€‚</p>
<pre><code>Reset_Handler:	
</code></pre>
<p>å®šä¹‰<code>Reset_Handler</code>å‡½æ•°çš„å¼€å§‹ã€‚</p>
<pre><code>movs  r1, #0
b  LoopCopyDataInit
</code></pre>
<p>å°†å¯„å­˜å™¨r1æ¸…é›¶ï¼Œå¹¶è·³è½¬åˆ°<code>LoopCopyDataInit</code>æ ‡ç­¾ã€‚</p>
<pre><code>CopyDataInit:
ldr  r3, =_sidata
ldr  r3, [r3, r1]
str  r3, [r0, r1]
adds  r1, r1, #4
</code></pre>
<p>å®šä¹‰<code>CopyDataInit</code>ä»£ç å—ï¼Œä»<code>_sidata</code>åœ°å€å¼€å§‹å¤åˆ¶åˆå§‹åŒ–æ•°æ®åˆ°æ•°æ®æ®µ(<code>_sdata</code>è‡³<code>_edata</code>)ã€‚</p>
<pre><code>LoopCopyDataInit:
ldr  r0, =_sdata
ldr  r3, =_edata
adds  r2, r0, r1
cmp  r2, r3
bcc  CopyDataInit
</code></pre>
<p>åˆ›å»ºä¸€ä¸ªå¾ªç¯ï¼Œå°†åˆå§‹åŒ–æ•°æ®ä»<code>_sidata</code>å¤åˆ¶åˆ°<code>_sdata</code>ï¼Œç›´åˆ°<code>_edata</code>ã€‚</p>
<pre><code>ldr  r2, =_sbss
b  LoopFillZerobss
</code></pre>
<p>å°†<code>r2</code>å¯„å­˜å™¨åŠ è½½åˆ°<code>BSS</code>æ®µçš„èµ·å§‹åœ°å€ï¼Œå¹¶è·³è½¬åˆ°<code>LoopFillZerobss</code>ã€‚</p>
<pre><code>FillZerobss:
movs  r3, #0
str  r3, [r2], #4
</code></pre>
<p>å°†<code>BSS</code>æ®µçš„æ¯ä¸ªä½ç½®åˆå§‹åŒ–ä¸º<code>0</code>ã€‚</p>
<pre><code>LoopFillZerobss:
ldr  r3, = _ebss
cmp  r2, r3
bcc  FillZerobss
</code></pre>
<p>åˆ›å»ºä¸€ä¸ªå¾ªç¯ï¼Œå°†<code>BSS</code>æ®µä»<code>_sbss</code>åˆ°<code>_ebss</code>çš„æ‰€æœ‰å­—èŠ‚åˆå§‹åŒ–ä¸º<code>0</code>ã€‚</p>
<pre><code>bl  SystemInit   
bl __libc_init_array
bl  main
bx  lr    
</code></pre>
<p>è°ƒç”¨ç³»ç»Ÿåˆå§‹åŒ–å‡½æ•°<code>SystemInit</code>ï¼Œè°ƒç”¨<code>C++</code>é™æ€å¯¹è±¡æ„é€ å‡½æ•°<code>__libc_init_array</code>ï¼Œç„¶åè°ƒç”¨<code>main</code>å‡½æ•°ï¼Œå¹¶ä»<code>Reset_Handler</code>è¿”å›ã€‚</p>
<pre><code>.size  Reset_Handler, .-Reset_Handler
</code></pre>
<p>æŒ‡å®š<code>Reset_Handler</code>å‡½æ•°çš„å¤§å°ã€‚</p>
<pre><code>.section  .text.Default_Handler,&quot;ax&quot;,%progbits
</code></pre>
<p>å®šä¹‰ä¸€ä¸ªæ–°çš„ä»£ç æ®µï¼Œç”¨äºé»˜è®¤çš„ä¸­æ–­å¤„ç†å‡½æ•°ã€‚</p>
<p>Default_Handler:<br>Infinite_Loop:<br>  b  Infinite_Loop<br>å®šä¹‰<code>Default_Handler</code>å‡½æ•°ï¼Œå¦‚æœå¤„ç†å™¨æ¥æ”¶åˆ°æœªå¤„ç†çš„ä¸­æ–­ï¼Œåˆ™è¿›å…¥æ— é™å¾ªç¯ã€‚</p>
<pre><code>.size  Default_Handler, .-Default_Handler
</code></pre>
<p>æŒ‡å®š<code>Default_Handler</code>å‡½æ•°çš„å¤§å°ã€‚</p>
<pre><code>.section  .isr_vector,&quot;a&quot;,%progbits
</code></pre>
<p>å®šä¹‰ä¸­æ–­å‘é‡è¡¨çš„ä»£ç æ®µã€‚</p>
<pre><code>g_pfnVectors:
</code></pre>
<p>å®šä¹‰ä¸­æ–­å‘é‡è¡¨çš„å¼€å§‹ã€‚</p>
<pre><code>.word  _estack
.word  Reset_Handler
...
</code></pre>
<p>ä¸­æ–­å‘é‡è¡¨åŒ…å«äº†ç³»ç»Ÿå †æ ˆçš„é¡¶ç«¯ã€é‡ç½®å¤„ç†ç¨‹åºçš„åœ°å€å’Œå…¶ä»–ä¸­æ–­å¤„ç†ç¨‹åºçš„åœ°å€ã€‚</p>
<pre><code>.weak      NMI_Handler
.thumb_set NMI_Handler,Default_Handler
</code></pre>
<p>å£°æ˜<code>NMI_Handler</code>ä¸ºå¼±å¼•ç”¨ï¼Œå¹¶å°†å…¶é»˜è®¤åœ°å€è®¾ç½®ä¸º<code>Default_Handler</code>ã€‚<br>è¿™æ®µä»£ç çš„å…¶ä½™éƒ¨åˆ†ç»§ç»­å®šä¹‰ä¸­æ–­å‘é‡è¡¨å’Œæä¾›ä¸­æ–­å¤„ç†ç¨‹åºçš„å¼±å¼•ç”¨ï¼Œä»¥ä¾¿åœ¨æ²¡æœ‰æä¾›ç‰¹å®šä¸­æ–­å¤„ç†ç¨‹åºæ—¶ä½¿ç”¨é»˜è®¤å¤„ç†ç¨‹åºã€‚</p>
]]></content>
      <categories>
        <category>åµŒå…¥å¼</category>
        <category>å¯åŠ¨æ–‡ä»¶</category>
      </categories>
      <tags>
        <tag>MCU</tag>
      </tags>
  </entry>
  <entry>
    <title>I.MX6ULLå¼€å‘æŒ‡å—</title>
    <url>/2024/07/13/I.MX6ULL%E5%BC%80%E5%8F%91%E6%8C%87%E5%8D%97/</url>
    <content><![CDATA[<h2 id="å¼€å‘ç¯å¢ƒæ­å»º"><a href="#å¼€å‘ç¯å¢ƒæ­å»º" class="headerlink" title="å¼€å‘ç¯å¢ƒæ­å»º"></a>å¼€å‘ç¯å¢ƒæ­å»º</h2><h3 id="è™šæ‹Ÿæœºå®‰è£…"><a href="#è™šæ‹Ÿæœºå®‰è£…" class="headerlink" title="è™šæ‹Ÿæœºå®‰è£…"></a>è™šæ‹Ÿæœºå®‰è£…</h3><ol>
<li>ä¸‹è½½å®‰è£…VMware Workstation Proå·¥å…·ã€‚</li>
<li>ä¸‹è½½å®‰è£…ubuntu 20.04 LTSç³»ç»Ÿé•œåƒã€‚</li>
<li>å¿«é€Ÿåˆ›å»ºè™šæ‹Ÿæœºã€‚</li>
<li>é…ç½®è™šæ‹Ÿæœºç¯å¢ƒã€‚</li>
</ol>
<ul>
<li><p>è™šæ‹Ÿæœº-è®¾ç½®(è§ä»¥ä¸‹å›¾ç‰‡)ï¼š<br><img src="/../pictures/ubuntu%E9%85%8D%E7%BD%AE1.png" alt="ubuntué…ç½®"><br><img src="/../pictures/ubuntu%E9%85%8D%E7%BD%AE2.png" alt="ubuntué…ç½®"><br><img src="/../pictures/ubuntu%E9%85%8D%E7%BD%AE3.png" alt="ubuntué…ç½®"></p>
</li>
<li><p>ç½‘ç»œé€‚é…å™¨å¯æŒ‰è‡ªå·±éœ€è¦è®¾ç½®ã€‚<br><img src="/../pictures/ubuntu%E9%85%8D%E7%BD%AE4.png" alt="ubuntué…ç½®"></p>
</li>
</ul>
<ol start="5">
<li>å¯åŠ¨è™šæ‹Ÿæœºï¼Œè¿›å…¥<code>ubuntu</code>ç³»ç»Ÿã€‚</li>
</ol>
<ul>
<li><p>è¿›å…¥ç³»ç»Ÿåä¼šè‡ªåŠ¨å¼¹å‡º<code>DVD</code>, é‡Œé¢æœ‰<code>VMware Tools</code>çš„å‹ç¼©åŒ…ã€‚</p>
</li>
<li><p>å¤åˆ¶å‹ç¼©åŒ…åˆ°<code>Donwnloads</code>ç›®å½•ä¸‹ï¼Œè§£å‹ã€‚</p>
</li>
<li><p>æ‰§è¡Œ<code>sudo ./vmware-install.pl</code>å®‰è£…ã€‚ </p>
</li>
<li><p>è§£å†³Windowså’ŒUbuntuä¹‹é—´å¤åˆ¶ç²˜è´´é—®é¢˜ã€‚</p>
<ul>
<li>è¾“å…¥å®‰è£…å‘½ä»¤ï¼šsudo apt install open-vm-tools</li>
<li>è¾“å…¥å‘½ä»¤ï¼šsudo apt install open-vm-tools-desktop</li>
</ul>
</li>
</ul>
<p><strong>æ³¨æ„</strong>ï¼šè¾“å…¥ç¬¬ä¸€æ¡å‘½ä»¤åï¼Œç­‰å¾…å®‰è£…ï¼Œé‡åˆ°é€‰æ‹©<code>Y/N</code>ï¼Œé€‰æ‹©<code>Y</code>ï¼›ç¬¬ä¸€æ¡å®‰è£…å®Œæˆåï¼Œè¾“å…¥ç¬¬äºŒæ¡å‘½ä»¤ï¼ŒåŒæ ·é‡åˆ°é€‰æ‹©<code>Y/N</code>ï¼Œé€‰æ‹©<code>Y</code>ã€‚<br>å®‰è£…å®Œæ¯•åï¼Œåˆ‡è®°ï¼šä¸€å®šè¦<strong>é‡æ–°å¯åŠ¨Linuxç³»ç»Ÿ</strong>æ‰å¯ä»¥åŒå‘å¤åˆ¶ç²˜è´´ã€‚</p>
<h3 id="è™šæ‹Ÿæœºå®‰è£…é…ç½®é‡åˆ°çš„é—®é¢˜"><a href="#è™šæ‹Ÿæœºå®‰è£…é…ç½®é‡åˆ°çš„é—®é¢˜" class="headerlink" title="è™šæ‹Ÿæœºå®‰è£…é…ç½®é‡åˆ°çš„é—®é¢˜"></a>è™šæ‹Ÿæœºå®‰è£…é…ç½®é‡åˆ°çš„é—®é¢˜</h3><p><a href="https://segmentfault.com/a/1190000039918994">æ¡¥æ¥æ¨¡å¼èµ„æ–™(ä»…ä¾›å‚è€ƒ)</a></p>
<ul>
<li>å°è¯•è§£å†³æ— æ³•ä½¿ç”¨æ¡¥æ¥ä½¿ç”¨ä¸PCæœºç›¸åŒIPä¸Šç½‘<ul>
<li>è™šæ‹Ÿç½‘ç»œç¼–è¾‘å™¨-è¿˜åŸé»˜è®¤è®¾ç½®ï¼ˆè¯¥è¿‡ç¨‹ä¼šå¸è½½è™šæ‹Ÿç½‘å¡ï¼Œé‡æ–°å®‰è£…é€‚é…å™¨ï¼‰</li>
<li>æ¡¥æ¥æ¨¡å¼å¯åŠ¨</li>
<li>ç¬”è¯•è¿˜ä¸èƒ½å…³é—­ç½‘ç»œæœåŠ¡ï¼Œ<code>ubuntu</code>å†…éƒ¨é…ç½®<code>IPv4</code>ï¼ˆå…ˆæ‰“å¼€<code>PCä¸»æœº</code>ä»¥å¤ªç½‘ï¼ŒæŒ‰ä¸‹å›¾æ‰€ç¤ºæ‰‹åŠ¨å¡«å†™<code>åœ°å€</code>å’Œ<code>DNS</code>ï¼‰,é‡æ–°å¯åŠ¨ç½‘ç»œæœåŠ¡ã€‚</li>
</ul>
</li>
</ul>
<p><img src="/../pictures/%E8%99%9A%E6%8B%9F%E7%BD%91%E7%BB%9C%E7%BC%96%E8%BE%91%E5%99%A8.png" alt="è™šæ‹Ÿç½‘ç»œ"><br><img src="/../pictures/PC%E6%9C%BAIPv4%E9%85%8D%E7%BD%AE.png" alt="PCä»¥å¤ªç½‘é…ç½®"><br><img src="/../pictures/ubuntu%E7%BD%91%E7%BB%9C%E9%85%8D%E7%BD%AE.png" alt="ubuntuç½‘ç»œé…ç½®"></p>
<ul>
<li>è™šæ‹Ÿæœºå³ä¸‹è§’çš„USBæ˜¯ç°çš„ï¼Œä¸èƒ½é“¾æ¥&#x2F;æ–­å¼€ã€‚</li>
</ul>
<p><a href="https://blog.csdn.net/weixin_44259058/article/details/127639566">å‚è€ƒèµ„æ–™</a><br><br></p>
<h2 id="Ubootç§»æ¤"><a href="#Ubootç§»æ¤" class="headerlink" title="Ubootç§»æ¤"></a>Ubootç§»æ¤</h2><p><a href="https://www.eet-china.com/mp/a68264.html">å‚è€ƒèµ„æ–™</a></p>
<h3 id="I-MX6ULLå¯åŠ¨æ¨¡å¼"><a href="#I-MX6ULLå¯åŠ¨æ¨¡å¼" class="headerlink" title="I.MX6ULLå¯åŠ¨æ¨¡å¼"></a>I.MX6ULLå¯åŠ¨æ¨¡å¼</h3><p><img src="/../pictures/IMX6ULL%E5%90%AF%E5%8A%A8%E6%8B%A8%E7%A0%81%E5%9B%BE.png" alt="IMX6ULLå¯åŠ¨æ‹¨ç å›¾"></p>
<h3 id="Ubootç¼–è¯‘çƒ§å½•"><a href="#Ubootç¼–è¯‘çƒ§å½•" class="headerlink" title="Ubootç¼–è¯‘çƒ§å½•"></a>Ubootç¼–è¯‘çƒ§å½•</h3><ul>
<li><p>å°†<code>uboot</code>å‹ç¼©æ–‡ä»¶<code>uboot-imx-rel_imx_4.1.15_2.1.1_ga_alientek_v2.4.tar.bz2</code>æ”¾åˆ°<code>/home/xuan/linux/</code>ç›®å½•ä¸‹ã€‚</p>
</li>
<li><p>å°†<code>uboot</code>æ–‡ä»¶<code>tar -xjvf uboot-imx-rel_imx_4.1.15_2.1.1_ga_alientek_v2.4.tar.bz2</code> è§£å‹åˆ°è¯¥ç›®å½•ä¸‹ã€‚</p>
</li>
<li><p><code>cd /home/xuan/linux/uboot-imx-rel_imx_4.1.15_2.1.1_ga_alientek_v2.4</code></p>
</li>
<li><p>ç¼–å†™ä»¥ä¸‹è„šæœ¬ï¼š(<code>mx6ull_14x14_evk_emmc.sh</code>)</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line">make ARCH=arm CROSS_COMPILE=arm-linux-gnueabihf- distclean</span><br><span class="line">make ARCH=arm CROSS_COMPILE=arm-linux-gnueabihf- mx6ull_alientek_emmc_defconfig</span><br><span class="line">make ARCH=arm CROSS_COMPILE=arm-linux-gnueabihf- V=1 -j12</span><br></pre></td></tr></table></figure></li>
<li><p>æ‰§è¡Œè„šæœ¬ï¼š<code>./mx6ull_14x14_evk_emmc.sh</code></p>
</li>
</ul>
<h4 id="Ubootçƒ§å½•åˆ°SDå¡"><a href="#Ubootçƒ§å½•åˆ°SDå¡" class="headerlink" title="Ubootçƒ§å½•åˆ°SDå¡"></a>Ubootçƒ§å½•åˆ°SDå¡</h4><ul>
<li>æ’ä¸Š<code>SDå¡</code>ï¼Œå¯åŠ¨<code>uboot</code>, <code>SD</code>å¡å’Œ<code>EMMC</code>é©±åŠ¨æ£€æŸ¥:<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">mmc dev 0</span><br><span class="line">mmc info</span><br><span class="line"></span><br><span class="line">mmc dev 1</span><br><span class="line">mmc info</span><br></pre></td></tr></table></figure></li>
<li>çƒ§å†™éªŒè¯ä¸é©±åŠ¨æµ‹è¯•<ul>
<li>æŒ‚è½½<code>SDå¡</code>ï¼Œä¸åšæè¿°ï¼ŒæŒ‚è½½ä¸Šä¹‹å<code>ls /dev/sd*</code>æ˜¾ç¤ºã€‚</li>
<li>æ‰§è¡Œä»¥ä¸‹<code>shell</code>æŒ‡ä»¤ã€‚<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cd ~/linux/uboot-alientek-v2.4		//è¿›å…¥ubootæ–‡ä»¶å¤¹	</span><br><span class="line">chmod 777 imxdownload 				//ç»™äºˆ imxdownload å¯æ‰§è¡Œæƒé™</span><br><span class="line">./imxdownload u-boot.bin /dev/sdb 	//çƒ§å†™åˆ° SD å¡ä¸­ï¼Œä¸èƒ½çƒ§å†™åˆ°/dev/sda æˆ– sda1 é‡Œé¢</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<br>

<ul>
<li><code>U-Boot</code> å›¾å½¢åŒ–é…ç½®</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo apt-get install build-essential</span><br><span class="line">sudo apt-get install libncurses5-dev</span><br><span class="line"></span><br><span class="line">make mx6ull_alientek_emmc_defconfig</span><br><span class="line">make menuconfig</span><br></pre></td></tr></table></figure>

<ul>
<li>é…ç½®ç½‘å£çš„ç¯å¢ƒå˜é‡ï¼Œå¼€å‘æ¿ä¸Šçš„<code>ENET2</code>,ä¸Šç”µè¿›å…¥<code>uboot</code>,æ‰“å¼€çš„<code>USB_TTL</code>å¯¹åº”çš„ä¸²å£æ§åˆ¶å°ã€‚<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">env default -a;saveenv				//defaultå¥½åƒæœ‰é—®é¢˜</span><br><span class="line">setenv ipaddr 192.168.104.130		//å¼€å‘æ¿ ip åœ°å€</span><br><span class="line">setenv ethaddr b8:ae:1d:01:00:00	//å¼€å‘æ¿çš„MACåœ°å€ï¼Œä¸€å®šè¦è®¾ç½®, å¦‚æœ‰å¤šå—å¼€å‘æ¿ï¼ŒMACéœ€ä¸ä¸€è‡´</span><br><span class="line">setenv gatewayip 192.168.104.1		//ç½‘å…³åœ°å€</span><br><span class="line">setenv netmask 255.255.240.0		//å­ç½‘æ©ç </span><br><span class="line">setenv serverip 192.168.104.129		//æœåŠ¡å™¨ IP åœ°å€ï¼Œä¹Ÿå°±æ˜¯ Ubuntu ä¸»æœº IP åœ°å€ï¼Œç”¨äºè°ƒè¯•ä»£ç ã€‚</span><br><span class="line">saveenv</span><br></pre></td></tr></table></figure></li>
</ul>
<br>

<h2 id="Linuxå†…æ ¸ç§»æ¤"><a href="#Linuxå†…æ ¸ç§»æ¤" class="headerlink" title="Linuxå†…æ ¸ç§»æ¤"></a>Linuxå†…æ ¸ç§»æ¤</h2><h3 id="ç§»æ¤æ­¥éª¤"><a href="#ç§»æ¤æ­¥éª¤" class="headerlink" title="ç§»æ¤æ­¥éª¤"></a>ç§»æ¤æ­¥éª¤</h3><p><strong>1. Ubuntuä¸‹æ­å»ºç½‘ç»œä¼ è¾“ç¯å¢ƒ</strong></p>
<p><strong>1.1 æ­å»ºç½‘ç»œtftpæœåŠ¡</strong></p>
<ul>
<li><p>æ‰§è¡Œä»¥ä¸‹æŒ‡ä»¤ï¼Œå®‰è£…<code>xinetd</code>: </p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo apt-get install xinetd</span><br></pre></td></tr></table></figure>
</li>
<li><p>æŸ¥è¯¢<code>/etc/</code>ä¸‹æ˜¯å¦å­˜åœ¨ <code>xinetd.conf</code> æ–‡ä»¶ï¼Œæ²¡æœ‰çš„è¯åˆ™è‡ªå·±æ–°å»ºä¸€ä¸ªã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ls /etc/xinetd.conf</span><br><span class="line">sudo vi /etc/xinetd.conf</span><br></pre></td></tr></table></figure>
</li>
<li><p>åˆ›å»ºå‡ºæ¥çš„æ–‡ä»¶æ˜¯ç©ºç™½çš„ï¼Œ ä¿®æ”¹ <code>xinetd.conf</code> æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Simple configuration file <span class="keyword">for</span> xinetd</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># Some defaults, and include /etc/xinetd.d/</span></span></span><br><span class="line">defaults</span><br><span class="line">&#123;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Please note that you need a log_type line to be able to use log_on_success</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">and log_on_failure. The default is the following :</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">log_type = SYSLOG daemon info</span></span><br><span class="line">&#125;</span><br><span class="line">includedir /etc/xinetd.d</span><br></pre></td></tr></table></figure>
</li>
<li><p>æ–°å»º <code>TFTP</code> ç›®å½•ï¼Œè¿™é‡Œå»ºç«‹åœ¨&#x2F;home&#x2F;xuan&#x2F;linux ç›®å½•ä¸‹ï¼Œç›®å½•åä¸º tftpã€‚å°† tftp ç›®å½•èµ‹äºˆå¯è¯»å¯å†™å¯æ‰§è¡Œæƒé™ã€‚</p>
</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">mkdir -p /home/xuan/linux/tftp</span><br><span class="line">sudo chmod 777 /home/xuan/linux/tftp/</span><br><span class="line">cd /home/xuan/linux/</span><br><span class="line">ls</span><br></pre></td></tr></table></figure>

<ul>
<li><p>æ‰§è¡Œä»¥ä¸‹ç¨‹åºå®‰è£… <code>tftp-hpa</code> å’Œ <code>tftpd-hpa</code> æœåŠ¡ç¨‹åº</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo apt-get install tftp-hpa tftpd-hpa</span><br><span class="line">sudo vi /etc/default/tftpd-hpa</span><br></pre></td></tr></table></figure>
</li>
<li><p>æ‰§è¡Œä»¥ä¸‹æŒ‡ä»¤åˆ›å»º<code>/etc/xinetd.d/tftp</code>é…ç½®æ–‡ä»¶ã€‚ï¼ˆå¦‚æœæ²¡æœ‰ <code>xinetd.d</code> è¿™ä¸ªç›®å½•ï¼Œå¯ä»¥å…ˆè‡ªå·±æ‰‹åŠ¨åˆ›å»ºï¼‰,æ³¨æ„ <code>server_args = -s</code> åé¢è¦æ·»åŠ è‡ªå·±çš„ <code>tftp</code> å·¥ä½œè·¯å¾„ã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">server tftp</span><br><span class="line">&#123;</span><br><span class="line">socket_type = dgram</span><br><span class="line">wait = yes</span><br><span class="line">disable = no</span><br><span class="line">user = root</span><br><span class="line">protocol = udp</span><br><span class="line">server = /usr/sbin/in.tftpd</span><br><span class="line">server_args = -s /home/xuan/linux/tftp -c</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">log_on_success += PID HOST DURATION</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">log_on_failure += HOST</span></span><br><span class="line">per_source = 11</span><br><span class="line">cps =100 2</span><br><span class="line">flags =IPv4</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>ä¿®æ”¹&#x2F;æ·»åŠ  <code>tftp</code> æ–‡ä»¶åï¼Œ æ‰§è¡Œä»¥ä¸‹æŒ‡ä»¤é‡å¯ <code>tftpd-hpa</code>, é‡å¯ <code>xinetd</code> æœåŠ¡ã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo service tftpd-hpa restart</span><br><span class="line">sudo service xinetd restart</span><br></pre></td></tr></table></figure>
</li>
<li><p>ç¡®ä¿ç½‘ç»œç¯å¢ƒæ­£å¸¸ï¼Œ<code>Ubuntu</code>ã€<code>Windows</code>å’Œ<code>å¼€å‘æ¿</code>èƒ½ç›¸äº’ <code>ping</code> é€šã€‚</p>
<ul>
<li>å¼€å‘æ¿ IPï¼š 192.168.104.130</li>
<li>è™šæ‹Ÿæœº IPï¼š 192.168.104.129</li>
<li>ç”µè„‘ç½‘å£çš„ IPï¼š 192.168.104.29</li>
</ul>
</li>
</ul>
<br>

<p><strong>1.2 æ­å»ºç½‘ç»œnfsæœåŠ¡</strong></p>
<ul>
<li><p>åœ¨ <code>Ubuntu</code> ç»ˆç«¯æ‰§è¡Œä»¥ä¸‹æŒ‡ä»¤å®‰è£… <code>NFS</code></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo apt-get install nfs-kernel-server</span><br></pre></td></tr></table></figure>
</li>
<li><p>æ–°å»º <code>NFS</code> å…±äº«ç›®å½•ï¼Œå¹¶ç»™äºˆ <code>NFS</code> ç›®å½•å¯è¯»å¯å†™å¯æ‰§è¡Œæƒé™ã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo mkdir /home/xuan/linux/nfs</span><br><span class="line">sudo chmod 777 /home/xuan/linux/nfs/</span><br></pre></td></tr></table></figure>
</li>
<li><p>æ‰§è¡Œä»¥ä¸‹æŒ‡ä»¤æ‰“å¼€ <code>etc/exports</code> æ–‡ä»¶</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo vi /etc/exports</span><br></pre></td></tr></table></figure>
</li>
<li><p>è¿›å…¥ <code>etc/exports</code> æ–‡ä»¶ï¼Œåœ¨æœ€åæ·»åŠ å¦‚ä¸‹å†…å®¹</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">/home/alientek/linux/nfs *(rw,sync,no_root_squash)</span><br></pre></td></tr></table></figure></li>
</ul>
<p><code>/home/alientek/linux/nfs</code> è¡¨ç¤º <code>NFS</code> å…±äº«çš„ç›®å½•<br><code>*</code>è¡¨ç¤ºå…è®¸æ‰€æœ‰çš„ç½‘ç»œæ®µè®¿é—®<br><code>rw</code> è¡¨ç¤ºè®¿é—®è€…å…·æœ‰å¯è¯»å†™æƒé™<br><code>sync</code> è¡¨ç¤ºå°†ç¼“å­˜å†™å…¥è®¾å¤‡ä¸­ï¼Œå¯ä»¥è¯´æ˜¯åŒæ­¥ç¼“å­˜çš„æ„æ€<br><code>no_root_squash</code> è¡¨ç¤ºè®¿é—®è€…å…·æœ‰ <code>root</code> æƒé™ã€‚</p>
<ul>
<li><p>æ‰§è¡Œä»¥ä¸‹æŒ‡ä»¤é‡å¯ <code>NFS</code> æœåŠ¡å™¨, æŸ¥çœ‹ <code>NFS</code> å…±äº«ç›®å½•ã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo /etc/init.d/nfs-kernel-server restart</span><br><span class="line">showmount -e</span><br></pre></td></tr></table></figure>
</li>
<li><p>è®¾ç½® <code>NFS</code> æœåŠ¡å¼€æœºè‡ªå¯</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo systemctl enable nfs-kernel-server</span><br><span class="line">sudo reboot</span><br></pre></td></tr></table></figure>
</li>
<li><p>æµ‹è¯• <code>NFS</code> æœåŠ¡ï¼Œæ‰§è¡Œä»¥ä¸‹æŒ‡ä»¤è®¾ç½®å¼€å‘æ¿ <code>IP</code>ï¼Œåˆ›å»ºä¸€ä¸ª <code>get</code> ç›®å½•ï¼Œå°†è™šæ‹Ÿæœºï¼ˆ<code>192.168.104.129</code>ï¼‰ <code>NFS</code> å…±äº«ç›®<br>å½•æŒ‚è½½åˆ°åˆ°å¼€å‘æ¿çš„ <code>get</code> ç›®å½•ä¸­ã€‚</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">mkdir get</span><br><span class="line">mount -t nfs -o nolock,nfsvers=3 192.168.104.129:/home/xuan/linux/nfs get/</span><br></pre></td></tr></table></figure>
</li>
<li><p>æŸ¥çœ‹æŒ‚è½½çš„ <code>NFS</code> ç›®å½•ï¼š<code>df</code>, æ˜¾ç¤ºå¦‚ä¸‹ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">192.168.104.129:/home/xuan/linux/nfs 204795392 14416896 179902464   8% /home/root/get</span><br></pre></td></tr></table></figure></li>
<li><p>å¸è½½ <code>NFS</code> ç›®å½•ï¼š<code>umount get</code></p>
</li>
</ul>
<br>

<p><strong>2. æ‹·è´å†…æ ¸æ–‡ä»¶</strong></p>
<ul>
<li><p>å°†å†…æ ¸å‹ç¼©æ–‡ä»¶<code>linux-imx-rel_imx_4.1.15_2.1.1_ga_alientek_v2.4.tar.bz2</code>æ”¾åˆ°<code>/home/xuan/linux/linux-imx-rel_imx_4.1.15_2.1.1_ga_alientek_v2.4</code>ç›®å½•ä¸‹ã€‚</p>
</li>
<li><p>å°†å†…æ ¸æ–‡ä»¶<code>tar -xjvf linux-imx-rel_imx_4.1.15_2.1.1_ga_alientek_v2.4.tar.bz2</code> è§£å‹åˆ°è¯¥ç›®å½•ä¸‹ã€‚</p>
</li>
</ul>
<p><strong>3. ç¼–è¯‘å†…æ ¸æ–‡ä»¶</strong></p>
<p>æŒ‰ä»¥ä¸‹æ­¥éª¤è¿›è¡Œç¼–è¯‘ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">make clean 					//ç¬¬ä¸€æ¬¡ç¼–è¯‘ Linux å†…æ ¸ä¹‹å‰å…ˆæ¸…ç†ä¸€ä¸‹</span><br><span class="line">make imx_v7_mfg_defconfig 	//é…ç½® Linux å†…æ ¸</span><br><span class="line">make -j16					//ç¼–è¯‘ Linux å†…æ ¸</span><br></pre></td></tr></table></figure>
<p>å‘ç°ç¼–è¯‘æŠ¥é”™ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">  LZO     arch/arm/boot/compressed/piggy.lzo</span><br><span class="line">/bin/sh: 1: lzop: not found</span><br><span class="line">make[2]: *** [arch/arm/boot/compressed/Makefile:180ï¼šarch/arm/boot/compressed/piggy.lzo] é”™è¯¯ 1</span><br><span class="line">make[1]: *** [arch/arm/boot/Makefile:52ï¼šarch/arm/boot/compressed/vmlinux] é”™è¯¯ 2</span><br><span class="line">make: *** [arch/arm/Makefile:316ï¼šzImage] é”™è¯¯ 2</span><br><span class="line">make: *** æ­£åœ¨ç­‰å¾…æœªå®Œæˆçš„ä»»åŠ¡....</span><br></pre></td></tr></table></figure>
<p>è§£å†³æ–¹æ³•ï¼š</p>
<ol>
<li>å®‰è£…lzopï¼šsudo apt install lzop</li>
<li>æ·»åŠ lzopåˆ°ç¯å¢ƒå˜é‡ï¼šexport PATH&#x3D;$PATH:&#x2F;usr&#x2F;bin(ç›´æ¥å®‰è£…çš„ä¸éœ€è¦æ·»åŠ ç¯å¢ƒå˜é‡)</li>
<li>é‡æ–°ç¼–è¯‘ï¼šmake -j16</li>
</ol>
<br>

<ul>
<li>è‹¥æ‰§è¡Œ <code>./mx6ull_alientek_emmc.sh</code></li>
</ul>
<p>å‘ç°ç¼–è¯‘æŠ¥é”™ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">&lt;command-line&gt;: fatal error: curses.h: æ²¡æœ‰é‚£ä¸ªæ–‡ä»¶æˆ–ç›®å½•</span><br></pre></td></tr></table></figure>
<p>è§£å†³æ–¹æ³•ï¼š</p>
<ul>
<li>æ‰§è¡Œ <code>make ARCH=arm CROSS_COMPILE=arm-linux-gnueabihf- menuconfig</code> åæŠ¥é”™ <code>fatal error:curses.h:</code>æ²¡æœ‰é‚£ä¸ªæ–‡ä»¶æˆ–ç›®å½•ï¼Œè¿™ä¸ªæ˜¯å°‘äº†æŸä¸ªåº“ï¼Œæ‰§è¡Œå¦‚ä¸‹æŒ‡ä»¤å®‰è£…åº“ï¼š<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo apt-get install libncurses*</span><br></pre></td></tr></table></figure></li>
</ul>
<br>

<p><strong>4. æ•´ç†ç¼–è¯‘åçš„é•œåƒæ–‡ä»¶</strong></p>
<p><code>Linux</code> å†…æ ¸ç¼–è¯‘å®Œæˆä»¥åä¼šåœ¨ <code>arch/arm/boot</code> ç›®å½•ä¸‹ç”Ÿæˆ <code>zImage</code> é•œåƒæ–‡ä»¶ï¼Œå¦‚æœä½¿ç”¨è®¾å¤‡æ ‘<br>çš„è¯è¿˜ä¼šåœ¨ <code>arch/arm/boot/dtb</code> ç›®å½•ä¸‹å¼€å‘æ¿å¯¹åº”çš„.dtb(è®¾å¤‡æ ‘)æ–‡ä»¶ï¼Œæ¯”å¦‚ <code>imx6ull-alientek-emmc.dtb</code><br>å°±æ˜¯ <code>NXP</code> å®˜æ–¹çš„ <code>I.MX6ULL EVKå¼€å‘æ¿</code>å¯¹åº”çš„è®¾å¤‡æ ‘æ–‡ä»¶ã€‚è‡³æ­¤æˆ‘ä»¬å¾—åˆ°ä¸¤ä¸ªæ–‡ä»¶ï¼š</p>
<ul>
<li><code>Linux</code> å†…æ ¸é•œåƒæ–‡ä»¶ï¼š <code>zImageã€‚</code></li>
<li><code>NXP</code>å®˜æ–¹<code>I.MX6ULL EVKå¼€å‘æ¿</code>å¯¹åº”çš„è®¾å¤‡æ ‘æ–‡ä»¶ï¼š imx6ull-alientek-emmc.dtbã€‚</li>
</ul>
<br>

<p><strong>5. å†…æ ¸å¯åŠ¨æµ‹è¯•</strong></p>
<ul>
<li><p>ä¿®æ”¹<code>uboot</code> ä¸­çš„ç¯å¢ƒå˜é‡ <code>bootargs</code></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">console=ttymxc0,115200 root=/dev/mmcblk1p2 rootwait rw</span><br></pre></td></tr></table></figure>
</li>
<li><p>å°†ä¸Šä¸€å°èŠ‚ç¼–è¯‘å‡ºæ¥çš„ <code>zImage</code> å’Œ <code>imx6ull-alientek-emmc.dtb</code> å¤åˆ¶åˆ° <code>Ubuntu</code> ä¸­çš„ <code>tftp</code> ç›®å½•ä¸‹ï¼Œ<br>å› ä¸ºæˆ‘ä»¬è¦åœ¨ <code>uboot</code> ä¸­ä½¿ç”¨ <code>tftp</code> å‘½ä»¤å°†å…¶ä¸‹è½½åˆ°å¼€å‘æ¿ä¸­ï¼Œæ‹·è´å‘½ä»¤å¦‚ä¸‹ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cp arch/arm/boot/zImage /home/xuan/linux/tftpboot/ -f</span><br><span class="line">cp arch/arm/boot/dtb/imx6ull-alientek-emmc.dtb /home/xuan/linux/tftpboot/ -f</span><br></pre></td></tr></table></figure>
</li>
<li><p>æ‹·è´å®Œæˆä»¥åå°±å¯ä»¥æµ‹è¯•äº†ï¼Œå¯åŠ¨å¼€å‘æ¿ï¼Œè¿›å…¥ <code>uboot</code> å‘½ä»¤è¡Œæ¨¡å¼ï¼Œç„¶åè¾“å…¥å¦‚ä¸‹å‘½ä»¤å°†<br><code>zImage</code> å’Œ <code>imx6ull-alientek-emmc.dtb</code> ä¸‹è½½åˆ°å¼€å‘æ¿ä¸­ï¼š</p>
</li>
</ul>
<p><strong>ä»tftpå¯åŠ¨ï¼š</strong></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">tftp 80800000 zImage</span><br><span class="line">tftp 83000000 imx6ull-alientek-emmc.dtb</span><br><span class="line">bootz 80800000 - 83000000</span><br></pre></td></tr></table></figure>

<p><strong>ä»EMMCå¯åŠ¨ï¼š</strong></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">fatload mmc 1:1 80800000 zImage</span><br><span class="line">fatload mmc 1:1 83000000 imx6ull-alientek-emmc.dtb</span><br><span class="line">bootz 80800000 - 83000000</span><br></pre></td></tr></table></figure>
<p>æˆ–è€…åœ¨ubootä¸­ä¿å­˜ç¯å¢ƒå˜é‡ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">setenv bootcmd &#x27;mmc dev 1;fatload mmc 1:1 80800000 zImage;fatload mmc 1:1 83000000 imx6ull-alientek-emmc.dtb;bootz 80800000 - 83000000&#x27;</span><br><span class="line">setenv bootargs &#x27;console=ttymxc0,115200 root=/dev/mmcblk1p2 rootwait rw&#x27;</span><br><span class="line">saveenv</span><br></pre></td></tr></table></figure>

<br>

<h3 id="ä»ç½‘ç»œå¯åŠ¨Linuxç³»ç»Ÿ"><a href="#ä»ç½‘ç»œå¯åŠ¨Linuxç³»ç»Ÿ" class="headerlink" title="ä»ç½‘ç»œå¯åŠ¨Linuxç³»ç»Ÿ"></a>ä»ç½‘ç»œå¯åŠ¨Linuxç³»ç»Ÿ</h3><p><a href="https://blog.angustar.com/archives/system-migration-and-rootfs-construction-based-on-i-mx6ull-2.html">ç§»æ¤å‚è€ƒèµ„æ–™</a></p>
<h4 id="ä½¿ç”¨tftpbootå¯åŠ¨ä¼ è¾“ã€‚"><a href="#ä½¿ç”¨tftpbootå¯åŠ¨ä¼ è¾“ã€‚" class="headerlink" title="ä½¿ç”¨tftpbootå¯åŠ¨ä¼ è¾“ã€‚"></a>ä½¿ç”¨<code>tftpboot</code>å¯åŠ¨ä¼ è¾“ã€‚</h4><ul>
<li>æ‹¨ç åˆ°ä»<code>SD</code>å¡å¯åŠ¨ï¼Œå¼€å‘æ¿ä¸Šç”µ&#x2F;<code>RESET</code>ï¼Œè¿›å…¥<code>uboot</code>ã€‚</li>
<li>åœ¨<code>uboot</code>é…ç½®<code>bootargs</code>å’Œ<code>bootcmd</code>å‚æ•°å¹¶ä¿å­˜ã€‚</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">//`root=/dev/mmcblk1p2 rootwait rw` ä¸ºä½¿ç”¨ eMMC ä¸­å·²æœ‰çš„æ ¹æ–‡ä»¶ç³»ç»Ÿ</span><br><span class="line">setenv bootargs &#x27;console=ttymxc0,115200 root=/dev/mmcblk1p2 rootwait rw&#x27;	</span><br><span class="line">setenv bootcmd &#x27;tftp 80800000 zImage; tftp 83000000 imx6ull-alientek-emmc.dtb; bootz 80800000 - 83000000&#x27;</span><br><span class="line">saveenv</span><br></pre></td></tr></table></figure>
<ul>
<li>è¾“å…¥<code>boot</code>å¯åŠ¨</li>
</ul>
<h4 id="ä½¿ç”¨nfsæŒ‚è½½rootfsã€‚"><a href="#ä½¿ç”¨nfsæŒ‚è½½rootfsã€‚" class="headerlink" title="ä½¿ç”¨nfsæŒ‚è½½rootfsã€‚"></a>ä½¿ç”¨<code>nfs</code>æŒ‚è½½<code>rootfs</code>ã€‚</h4><ul>
<li>æ‹¨ç åˆ°ä»<code>SD</code>å¡å¯åŠ¨ï¼Œå¼€å‘æ¿ä¸Šç”µ&#x2F;<code>RESET</code>ï¼Œè¿›å…¥<code>uboot</code>ã€‚</li>
<li>åœ¨<code>uboot</code>é…ç½®<code>bootargs</code>å‚æ•°å¹¶ä¿å­˜ã€‚<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">setenv bootargs &#x27;console=ttymxc0,115200 root=/dev/nfs nfsroot=192.168.104.129:/home/xuan/linux/nfs/rootfs,proto=tcp rw ip=192.168.104.130:192.168.104.129:192.168.104.1:255.255.240.0::eth0:off&#x27; 		//è®¾ç½® bootargs</span><br><span class="line">saveenv 				//ä¿å­˜ç¯å¢ƒå˜é‡</span><br></pre></td></tr></table></figure></li>
<li>è¾“å…¥<code>boot</code>å¯åŠ¨</li>
</ul>
<br>

<p><strong>Error solving</strong></p>
<p>[å‚è€ƒèµ„æ–™]ï¼š<a href="https://blog.csdn.net/weixin_44256228/article/details/113830253">https://blog.csdn.net/weixin_44256228/article/details/113830253</a>)</p>
<ul>
<li>æ˜¾ç¤ºæŒ‚è½½å¤±è´¥ï¼Œä¸€å¤§å †é”™è¯¯ï¼Œæ˜¾ç¤ºæ²¡æŒ‚è½½ä¸Š</li>
<li><code>IMX6ULL</code>é€šè¿‡NFSæŒ‚è½½æ ¹æ–‡ä»¶ç³»ç»Ÿå¤±è´¥çš„æ–¹æ³•<ul>
<li>ä¿®æ”¹<code>/etc/default/nfs-kernel-server</code><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo vi /etc/default/nfs-kernel-server</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><code>nfs-kernel-server</code>æ–‡ä»¶ä¿®æ”¹å†…å®¹å¦‚ä¸‹ï¼š<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Number of servers to start up</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">RPCNFSDCOUNT=8</span></span><br><span class="line">RPCNFSDCOUNT=&quot;-V 2 8&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Runtime priority of server (see <span class="built_in">nice</span>(1))</span></span><br><span class="line">RPCNFSDPRIORITY=0</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Options <span class="keyword">for</span> rpc.mountd.</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">If you have a port-based firewall, you might want to <span class="built_in">set</span> up</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">a fixed port here using the --port option. For more information,</span> </span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">see rpc.mountd(8) or http://wiki.debian.org/SecuringNFS</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">To <span class="built_in">disable</span> NFSv4 on the server, specify <span class="string">&#x27;--no-nfs-version 4&#x27;</span> here</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">RPCMOUNTDOPTS=<span class="string">&quot;--manage-gids&quot;</span></span></span><br><span class="line">RPCMOUNTDOPTS=&quot;-V 2 --manage-gids&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Do you want to start the svcgssd daemon? It is only required <span class="keyword">for</span> Kerberos</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">exports. Valid alternatives are <span class="string">&quot;yes&quot;</span> and <span class="string">&quot;no&quot;</span>; the default is <span class="string">&quot;no&quot;</span>.</span></span><br><span class="line">NEED_SVCGSSD=&quot;&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Options <span class="keyword">for</span> rpc.svcgssd.</span></span><br><span class="line">RPCSVCGSSDOPTS=&quot;--nfs-version 2,3,4 --debug --syslog&quot;</span><br></pre></td></tr></table></figure></li>
<li>é‡å¯NFSæœåŠ¡å™¨<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo service nfs-kernel-server restart</span><br></pre></td></tr></table></figure></li>
<li>é‡æ–°å¼€æœºæŒ‚è½½ï¼Œé—®é¢˜è§£å†³ã€‚</li>
</ul>
<br>

<h2 id="Linuxé©±åŠ¨å¼€å‘"><a href="#Linuxé©±åŠ¨å¼€å‘" class="headerlink" title="Linuxé©±åŠ¨å¼€å‘"></a>Linuxé©±åŠ¨å¼€å‘</h2><h3 id="è€å­—ç¬¦é©±åŠ¨å¼€å‘ï¼ˆæ‰‹åŠ¨åˆ›å»ºèŠ‚ç‚¹ï¼‰"><a href="#è€å­—ç¬¦é©±åŠ¨å¼€å‘ï¼ˆæ‰‹åŠ¨åˆ›å»ºèŠ‚ç‚¹ï¼‰" class="headerlink" title="è€å­—ç¬¦é©±åŠ¨å¼€å‘ï¼ˆæ‰‹åŠ¨åˆ›å»ºèŠ‚ç‚¹ï¼‰"></a>è€å­—ç¬¦é©±åŠ¨å¼€å‘ï¼ˆæ‰‹åŠ¨åˆ›å»ºèŠ‚ç‚¹ï¼‰</h3><ul>
<li><p><code>led</code>é©±åŠ¨çš„<code>Makefile</code>æ–‡ä»¶å¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">KERNELDIR := /home/xuan/linux/linux-ga</span><br><span class="line">CURRENT_PATH := $(shell pwd)</span><br><span class="line">obj-m := led.o</span><br><span class="line">build: kernel_modules</span><br><span class="line">kernel_modules:</span><br><span class="line">$(MAKE) -C $(KERNELDIR) M=$(CURRENT_PATH) modules</span><br><span class="line">clean:</span><br><span class="line">$(MAKE) -C $(KERNELDIR) M=$(CURRENT_PATH) clean</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>make</code>ç¼–è¯‘, ç”Ÿæˆ<code>led.ko</code>æ–‡ä»¶, è¿™ä¸ªæ˜¯å†…æ ¸æ¨¡å—ï¼ˆKernel Moduleï¼‰æ–‡ä»¶ï¼Œå¾ˆé‡è¦ã€‚</p>
</li>
<li><p>ç¼–è¯‘<code>app</code>æ–‡ä»¶ï¼Œè¾“å…¥å¦‚ä¸‹å‘½ä»¤ï¼š<br>arm-linux-gnueabihf-gcc ledApp.c -o ledApp</p>
</li>
<li><p>å¤åˆ¶åˆ°<code>rootfs</code>ä¸­ï¼Œè‹¥æ²¡æœ‰<code>rootfs/lib/modules/4.1.15/</code>,å…ˆå»ºç«‹æ–‡ä»¶å¤¹ï¼Œè¾“å…¥å¦‚ä¸‹å‘½ä»¤ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">mkdir -p /home/xuan/linux/nfs/rootfs/lib/modules/4.1.15/</span><br><span class="line">sudo cp led.ko led /home/xuan/linux/nfs/rootfs/lib/modules/4.1.15/ -f</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>nfs</code>æŒ‚è½½<code>rootfs</code>ï¼Œè¿›å…¥å¼€å‘æ¿</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cd /lib/modules/4.1.15</span><br></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">depmod 					//ç¬¬ä¸€æ¬¡åŠ è½½é©±åŠ¨çš„æ—¶å€™éœ€è¦è¿è¡Œæ­¤å‘½ä»¤</span><br><span class="line">insmod led.ko</span><br><span class="line">æˆ–è€…</span><br><span class="line">modprobe led.ko 		//åŠ è½½ led.ko é©±åŠ¨æ–‡ä»¶</span><br></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cat /proc/devices		//æŸ¥çœ‹å½“å‰ç³»ç»Ÿä¸­æœ‰æ²¡æœ‰ led è¿™ä¸ªè®¾å¤‡</span><br><span class="line">mknod /dev/led c 200 0		//åˆ›å»ºè®¾å¤‡èŠ‚ç‚¹æ–‡ä»¶</span><br><span class="line">./ledApp /dev/led 1		//äº®ç¯</span><br><span class="line">./ledApp /dev/led 0		//ç­ç¯</span><br></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">rmmod led.ko</span><br><span class="line">æˆ–è€…</span><br><span class="line">modprobe -r led.ko 		//å¸è½½ led.ko é©±åŠ¨æ–‡ä»¶</span><br></pre></td></tr></table></figure></li>
</ul>
<br>

<h3 id="è€å­—ç¬¦é©±åŠ¨å¼€å‘ï¼ˆè‡ªåŠ¨åˆ›å»ºèŠ‚ç‚¹ï¼‰"><a href="#è€å­—ç¬¦é©±åŠ¨å¼€å‘ï¼ˆè‡ªåŠ¨åˆ›å»ºèŠ‚ç‚¹ï¼‰" class="headerlink" title="è€å­—ç¬¦é©±åŠ¨å¼€å‘ï¼ˆè‡ªåŠ¨åˆ›å»ºèŠ‚ç‚¹ï¼‰"></a>è€å­—ç¬¦é©±åŠ¨å¼€å‘ï¼ˆè‡ªåŠ¨åˆ›å»ºèŠ‚ç‚¹ï¼‰</h3><ul>
<li><p>ç¼–å†™ <code>Makefile</code> æ–‡ä»¶</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">KERNELDIR := /home/xuan/linux/linux-ga</span><br><span class="line">CURRENT_PATH := $(shell pwd)</span><br><span class="line"></span><br><span class="line">obj-m := newchrled.o</span><br><span class="line"></span><br><span class="line">build: kernel_modules</span><br><span class="line"></span><br><span class="line">kernel_modules:</span><br><span class="line"><span class="meta prompt_">	$</span><span class="language-bash">(MAKE) -C $(KERNELDIR) M=$(CURRENT_PATH) modules</span></span><br><span class="line"></span><br><span class="line">clean:</span><br><span class="line"><span class="meta prompt_">	$</span><span class="language-bash">(MAKE) -C $(KERNELDIR) M=$(CURRENT_PATH) clean</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>ç¼–è¯‘å‡ºé©±åŠ¨æ¨¡å—æ–‡ä»¶,ç¼–è¯‘æˆåŠŸä»¥åå°±ä¼šç”Ÿæˆä¸€ä¸ªåä¸º<code>newchrled.ko</code>çš„é©±åŠ¨æ¨¡å—æ–‡ä»¶</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cd ~/linux/drivers/03_newchrled</span><br><span class="line">make -j32</span><br><span class="line">arm-linux-gnueabihf-gcc ledApp.c -o ledApp</span><br><span class="line">cp ledApp newchrled.ko ~/linux/nfs/rootfs/lib/modules/4.1.15</span><br></pre></td></tr></table></figure>
</li>
<li><p>é‡æ–°ä¸Šç”µè¿è¡Œå¼€å‘æ¿</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cd /lib/modules/4.1.15</span><br><span class="line">depmod 						//ç¬¬ä¸€æ¬¡åŠ è½½é©±åŠ¨çš„æ—¶å€™éœ€è¦è¿è¡Œæ­¤å‘½ä»¤</span><br><span class="line">modprobe newchrled.ko 		//åŠ è½½é©±åŠ¨</span><br><span class="line">ls /dev/newchrled -l		//æŸ¥çœ‹/dev/newchrdev è¿™ä¸ªè®¾å¤‡èŠ‚ç‚¹æ–‡ä»¶æ˜¯å¦å­˜åœ¨</span><br><span class="line">./ledApp /dev/newchrled 1 	//æ‰“å¼€ LED ç¯</span><br><span class="line">./ledApp /dev/newchrled 0 	//å…³é—­ LED ç¯</span><br><span class="line">rmmod newchrled.ko</span><br></pre></td></tr></table></figure></li>
</ul>
<br>

<h3 id="Linux-è®¾å¤‡æ ‘"><a href="#Linux-è®¾å¤‡æ ‘" class="headerlink" title="Linux è®¾å¤‡æ ‘"></a>Linux è®¾å¤‡æ ‘</h3><p>ä»¥LEDç‚¹ç¯é©±åŠ¨ä¸ºä¾‹ä¸»è¦æ­¥éª¤ï¼š</p>
<ul>
<li>ä¿®æ”¹è®¾å¤‡æ ‘(.dtsæ–‡ä»¶),è·Ÿæ ¹èŠ‚ç‚¹ä¸‹æ·»åŠ è®¾å¤‡å­èŠ‚ç‚¹ï¼Œå­èŠ‚ç‚¹æ·»åŠ å±æ€§ï¼Œä¸¾ä¾‹ï¼š<figure class="highlight dts"><table><tr><td class="code"><pre><span class="line"><span class="title class_">alphaled</span> <span class="punctuation">&#123;</span></span><br><span class="line">	<span class="meta">#address-cells = &lt;1&gt;;</span></span><br><span class="line">	<span class="meta">#size-cells = &lt;1&gt;;</span></span><br><span class="line">	<span class="attr">compatible</span> <span class="operator">=</span> <span class="string">&quot;atkalpha-led&quot;</span><span class="punctuation">;</span></span><br><span class="line">	<span class="attr">status</span> <span class="operator">=</span> <span class="string">&quot;okay&quot;</span><span class="punctuation">;</span></span><br><span class="line">	<span class="attr">reg</span> <span class="operator">=</span> <span class="params">&lt; <span class="number">0X020C406C</span> <span class="number">0X04</span> /* CCM_CCGR1_BASE */</span></span><br><span class="line"><span class="params">	<span class="number">0X020E0068</span> <span class="number">0X04</span> /* SW_MUX_GPIO1_IO03_BASE */</span></span><br><span class="line"><span class="params">	<span class="number">0X020E02F4</span> <span class="number">0X04</span> /* SW_PAD_GPIO1_IO03_BASE */</span></span><br><span class="line"><span class="params">	<span class="number">0X0209C000</span> <span class="number">0X04</span> /* GPIO1_DR_BASE */</span></span><br><span class="line"><span class="params">	<span class="number">0X0209C004</span> <span class="number">0X04</span> &gt;</span><span class="punctuation">;</span> <span class="comment">/* GPIO1_GDIR_BASE */</span></span><br><span class="line"><span class="punctuation">&#125;;</span></span><br></pre></td></tr></table></figure></li>
<li>åœ¨<code>linux</code>ç›®å½•ä¸‹é‡æ–°ç¼–è¯‘è®¾å¤‡æ ‘ï¼š<code>make dtbs</code></li>
<li>ç¼–è¯‘å®Œæˆä»¥åå¾—åˆ°<code>imx6ull-alientek-emmc.dtb</code>ï¼Œä½¿ç”¨æ–°çš„ <code>imx6ull-alientek-emmc.dtb</code>å¯åŠ¨<code>Linux</code>å†…æ ¸</li>
<li><code>Linux</code>å¯åŠ¨æˆåŠŸä»¥åè¿›å…¥åˆ°<code>/proc/device-tree/</code>ç›®å½•ä¸­æŸ¥çœ‹æ˜¯å¦æœ‰<code>alphaled</code>è¿™ä¸ªèŠ‚ç‚¹,è‹¥æ²¡æœ‰åˆ™ä¿®æ”¹å¤±è´¥</li>
<li>ç¼–å†™<code>dtsled.c</code>æ–‡ä»¶å’Œæ–‡ä»¶<code>ledApp.c</code>,ä¿®æ”¹<code>Makefile</code>ä¸­çš„<code>KERNELDIR</code>å‚æ•°ä¸º<code>/home/xuan/linux/linux-ga</code><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">make -j32</span><br><span class="line">arm-linux-gnueabihf-gcc ledApp.c -o ledApp</span><br></pre></td></tr></table></figure></li>
<li>ç¼–è¯‘å‡ºæ¥çš„<code>dtsled.ko</code>å’Œ<code>ledApp</code>è¿™ä¸¤ä¸ªæ–‡ä»¶æ‹·è´åˆ°<code>rootfs/lib/modules/4.1.15</code>ç›®å½•ä¸­ï¼Œ<strong>é‡å¯å¼€å‘æ¿</strong>ï¼Œè¿›å…¥åˆ°ç›®å½•<code>lib/modules/4.1.15</code>ä¸­ï¼Œè¾“å…¥å¦‚ä¸‹å‘½ä»¤åŠ è½½<code>dtsled.ko</code>é©±åŠ¨æ¨¡å—ï¼š<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">depmod 				//ç¬¬ä¸€æ¬¡åŠ è½½é©±åŠ¨çš„æ—¶å€™éœ€è¦è¿è¡Œæ­¤å‘½ä»¤</span><br><span class="line">modprobe dtsled.ko 		//åŠ è½½é©±åŠ¨</span><br><span class="line">./ledApp /dev/dtsled 1 		//æ‰“å¼€ LED ç¯</span><br><span class="line">./ledApp /dev/dtsled 0 		//å…³é—­ LED ç¯</span><br><span class="line">rmmod dtsled.ko</span><br></pre></td></tr></table></figure></li>
</ul>
<br>

<h3 id="pinctrl-å’Œ-gpio-å­ç³»ç»Ÿå®éªŒ"><a href="#pinctrl-å’Œ-gpio-å­ç³»ç»Ÿå®éªŒ" class="headerlink" title="pinctrl å’Œ gpio å­ç³»ç»Ÿå®éªŒ"></a>pinctrl å’Œ gpio å­ç³»ç»Ÿå®éªŒ</h3><h4 id="pinctrl-å­ç³»ç»Ÿä»‹ç»"><a href="#pinctrl-å­ç³»ç»Ÿä»‹ç»" class="headerlink" title="pinctrl å­ç³»ç»Ÿä»‹ç»"></a>pinctrl å­ç³»ç»Ÿä»‹ç»</h4><p><code>pinctrl</code> å­ç³»ç»Ÿä¸»è¦å·¥ä½œå†…å®¹å¦‚ä¸‹ï¼š</p>
<ul>
<li>è·å–è®¾å¤‡æ ‘ä¸­ <code>pin</code> ä¿¡æ¯ã€‚</li>
<li>æ ¹æ®è·å–åˆ°çš„ <code>pin</code> ä¿¡æ¯æ¥è®¾ç½® <code>pin</code> çš„å¤ç”¨åŠŸèƒ½</li>
<li>æ ¹æ®è·å–åˆ°çš„ <code>pin</code> ä¿¡æ¯æ¥è®¾ç½® <code>pin</code> çš„ç”µæ°”ç‰¹æ€§ï¼Œæ¯”å¦‚ä¸Š&#x2F;ä¸‹æ‹‰ã€é€Ÿåº¦ã€é©±åŠ¨èƒ½åŠ›ç­‰ã€‚</li>
</ul>
<p>å¯¹äºæˆ‘ä»¬ä½¿ç”¨è€…æ¥è®²ï¼Œåªéœ€è¦åœ¨è®¾å¤‡æ ‘é‡Œé¢è®¾ç½®å¥½æŸä¸ª <code>pin</code> çš„ç›¸å…³å±æ€§å³å¯ï¼Œå…¶ä»–çš„åˆå§‹åŒ–å·¥ä½œå‡ç”± <code>pinctrl</code> å­ç³»ç»Ÿæ¥å®Œæˆï¼Œ <code>pinctrl</code> å­ç³»ç»Ÿæºç ç›®å½•ä¸º <code>drivers/pinctrl</code>ã€‚</p>
<br>

<h4 id="è®¾å¤‡æ ‘ä¸­æ·»åŠ -pinctrl-èŠ‚ç‚¹æ¨¡æ¿"><a href="#è®¾å¤‡æ ‘ä¸­æ·»åŠ -pinctrl-èŠ‚ç‚¹æ¨¡æ¿" class="headerlink" title="è®¾å¤‡æ ‘ä¸­æ·»åŠ  pinctrl èŠ‚ç‚¹æ¨¡æ¿"></a>è®¾å¤‡æ ‘ä¸­æ·»åŠ  pinctrl èŠ‚ç‚¹æ¨¡æ¿</h4><ul>
<li>åˆ›å»ºå¯¹åº”çš„èŠ‚ç‚¹ï¼Œæ‰“å¼€ <code>imx6ull-alientek-emmc.dts</code>ï¼Œåœ¨ <code>iomuxc</code> èŠ‚ç‚¹ä¸­çš„ <code>imx6ul-evk</code> å­èŠ‚ç‚¹ä¸‹æ·»åŠ  â€œ<code>pinctrl_test</code>â€ èŠ‚ç‚¹</li>
<li>æ·»åŠ  â€œ<code>fsl,pins</code>â€ å±æ€§ï¼Œåå­—ä¸€å®šè¦ä¸ºâ€œ<code>fsl,pins</code>â€ï¼Œå› ä¸ºå¯¹äº <code>I.MX</code> ç³»åˆ— <code>SOC</code> è€Œè¨€ï¼Œ <code>pinctrl</code> é©±åŠ¨ç¨‹åºæ˜¯é€šè¿‡è¯»å–â€œ<code>fsl,pins</code>â€å±æ€§å€¼æ¥è·å– <code>PIN</code> çš„é…ç½®ä¿¡æ¯</li>
</ul>
<figure class="highlight dts"><table><tr><td class="code"><pre><span class="line"><span class="symbol">pinctrl_test:</span> <span class="title class_">testgrp</span> <span class="punctuation">&#123;</span></span><br><span class="line">	<span class="comment">/* å…·ä½“çš„ PIN ä¿¡æ¯ */</span></span><br><span class="line">		<span class="attr">fsl,pins</span> <span class="operator">=</span> <span class="params">&lt;</span></span><br><span class="line"><span class="params">			MX6UL_PAD_GPIO1_IO00__GPIO1_IO00 config 	/*config æ˜¯å…·ä½“è®¾ç½®å€¼*/</span></span><br><span class="line"><span class="params">		&gt;</span><span class="punctuation">;</span></span><br><span class="line">	<span class="punctuation">&#125;;</span></span><br><span class="line"><span class="punctuation">&#125;;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>è‡³æ­¤ï¼Œæˆ‘ä»¬å·²ç»åœ¨ <code>imx6ull-alientek-emmc.dts</code> æ–‡ä»¶ä¸­æ·»åŠ å¥½äº† <code>test</code> è®¾å¤‡æ‰€ä½¿ç”¨çš„ <code>PIN</code> é…ç½®ä¿¡æ¯ã€‚</li>
</ul>
<br>

<h4 id="gpioå­ç³»ç»Ÿ"><a href="#gpioå­ç³»ç»Ÿ" class="headerlink" title="gpioå­ç³»ç»Ÿ"></a>gpioå­ç³»ç»Ÿ</h4><br>

<h4 id="gpioå®éªŒ"><a href="#gpioå®éªŒ" class="headerlink" title="gpioå®éªŒ"></a>gpioå®éªŒ</h4><ul>
<li><p>æ·»åŠ  <code>pinctrl</code> èŠ‚ç‚¹, ï¼Œæ‰“å¼€ <code>imx6ull-alientekemmc.dts</code>ï¼Œåœ¨ <code>iomuxc</code> èŠ‚ç‚¹çš„ <code>imx6ul-evk</code> å­èŠ‚ç‚¹ä¸‹åˆ›å»ºä¸€ä¸ªåä¸ºâ€œ<code>pinctrl_led</code>â€çš„å­èŠ‚ç‚¹</p>
<figure class="highlight dts"><table><tr><td class="code"><pre><span class="line"><span class="symbol">pinctrl_led:</span> <span class="title class_">ledgrp</span> <span class="punctuation">&#123;</span></span><br><span class="line">	<span class="attr">fsl,pins</span> <span class="operator">=</span> <span class="params">&lt;</span></span><br><span class="line"><span class="params">		MX6UL_PAD_GPIO1_IO03__GPIO1_IO03 <span class="number">0x10B0</span> /* LED0 */</span></span><br><span class="line"><span class="params">	&gt;</span><span class="punctuation">;</span></span><br><span class="line"><span class="punctuation">&#125;;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>æ·»åŠ  <code>LED</code> è®¾å¤‡èŠ‚ç‚¹, åœ¨æ ¹èŠ‚ç‚¹â€œ<code>/</code>â€ä¸‹åˆ›å»º <code>LED</code> ç¯èŠ‚ç‚¹ï¼ŒèŠ‚ç‚¹åä¸ºâ€œ<code>gpioled</code>â€</p>
<figure class="highlight dts"><table><tr><td class="code"><pre><span class="line"><span class="title class_">gpioled</span> <span class="punctuation">&#123;</span></span><br><span class="line">	<span class="meta">#address-cells = &lt;1&gt;;</span></span><br><span class="line">	<span class="meta">#size-cells = &lt;1&gt;;</span></span><br><span class="line">	<span class="attr">compatible</span> <span class="operator">=</span> <span class="string">&quot;atkalpha-gpioled&quot;</span><span class="punctuation">;</span></span><br><span class="line">	<span class="attr">pinctrl-names</span> <span class="operator">=</span> <span class="string">&quot;default&quot;</span><span class="punctuation">;</span></span><br><span class="line">	pinctrl<span class="number">-0</span> = <span class="params">&lt;<span class="variable">&amp;pinctrl_led</span>&gt;</span><span class="punctuation">;</span></span><br><span class="line">	<span class="attr">led-gpio</span> <span class="operator">=</span> <span class="params">&lt;<span class="variable">&amp;gpio1</span> <span class="number">3</span> GPIO_ACTIVE_LOW&gt;</span><span class="punctuation">;</span></span><br><span class="line">	<span class="attr">status</span> <span class="operator">=</span> <span class="string">&quot;okay&quot;</span><span class="punctuation">;</span></span><br><span class="line"><span class="punctuation">&#125;;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>æ£€æŸ¥ <code>PIN</code> æ˜¯å¦è¢«å…¶ä»–å¤–è®¾ä½¿ç”¨</p>
<ul>
<li>æ£€æŸ¥ <code>pinctrl</code> è®¾ç½®ã€‚</li>
<li>å¦‚æœè¿™ä¸ª <code>PIN</code> é…ç½®ä¸º <code>GPIO</code> çš„è¯ï¼Œæ£€æŸ¥è¿™ä¸ª <code>GPIO</code> æœ‰æ²¡æœ‰è¢«åˆ«çš„å¤–è®¾ä½¿ç”¨ã€‚</li>
</ul>
</li>
<li><p>åœ¨æœ¬ç« å®éªŒä¸­ <code>LED</code> ç¯ä½¿ç”¨çš„ <code>PIN</code> ä¸º <code>GPIO1_IO03</code>ï¼Œåœ¨ <code>imx6ull-alientek-emmc.dts</code> ä¸­ï¼Œå…ˆæ£€æŸ¥ <code>GPIO_IO03</code> è¿™ä¸ª <code>PIN</code> æœ‰æ²¡æœ‰è¢«å…¶ä»–çš„ <code>pinctrl</code> èŠ‚ç‚¹ä½¿ç”¨ã€‚</p>
</li>
<li><p>å¦‚åˆ«çš„æ¨¡å—æœ‰ä½¿ç”¨åˆ°<code>GPIO_IO03</code>ï¼Œéœ€è¦æ³¨é‡Šæ‰ã€‚</p>
</li>
</ul>
<br>

<h3 id="Linux-èœ‚é¸£å™¨å®éªŒ"><a href="#Linux-èœ‚é¸£å™¨å®éªŒ" class="headerlink" title="Linux èœ‚é¸£å™¨å®éªŒ"></a>Linux èœ‚é¸£å™¨å®éªŒ</h3><ul>
<li><p>æ‰“å¼€<code>imx6ull-alientekemmc.dts</code>ï¼Œåœ¨ <code>iomuxc</code> èŠ‚ç‚¹çš„ <code>imx6ul-evk</code> å­èŠ‚ç‚¹ä¸‹åˆ›å»ºä¸€ä¸ªåä¸ºâ€œ<code>pinctrl_beep</code>â€çš„å­èŠ‚ç‚¹</p>
<figure class="highlight dts"><table><tr><td class="code"><pre><span class="line"><span class="symbol">pinctrl_beep:</span> <span class="title class_">beepgrp</span> <span class="punctuation">&#123;</span></span><br><span class="line">	<span class="attr">fsl,pins</span> <span class="operator">=</span> <span class="params">&lt;</span></span><br><span class="line"><span class="params">		MX6ULL_PAD_SNVS_TAMPER1__GPIO5_IO01 <span class="number">0x10B0</span> /* beep */</span></span><br><span class="line"><span class="params">	&gt;</span><span class="punctuation">;</span></span><br><span class="line"><span class="punctuation">&#125;;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>åœ¨æ ¹èŠ‚ç‚¹â€œ<code>/</code>â€ä¸‹åˆ›å»º <code>BEEP</code> èŠ‚ç‚¹ï¼ŒèŠ‚ç‚¹åä¸ºâ€œ<code>beep</code>â€</p>
<figure class="highlight dts"><table><tr><td class="code"><pre><span class="line"><span class="title class_">beep</span> <span class="punctuation">&#123;</span></span><br><span class="line">	<span class="meta">#address-cells = &lt;1&gt;;</span></span><br><span class="line">	<span class="meta">#size-cells = &lt;1&gt;;</span></span><br><span class="line">	<span class="attr">compatible</span> <span class="operator">=</span> <span class="string">&quot;atkalpha-beep&quot;</span><span class="punctuation">;</span></span><br><span class="line">	<span class="attr">pinctrl-names</span> <span class="operator">=</span> <span class="string">&quot;default&quot;</span><span class="punctuation">;</span></span><br><span class="line">	pinctrl<span class="number">-0</span> = <span class="params">&lt;<span class="variable">&amp;pinctrl_beep</span>&gt;</span><span class="punctuation">;</span></span><br><span class="line">	<span class="attr">beep-gpio</span> <span class="operator">=</span> <span class="params">&lt;<span class="variable">&amp;gpio5</span> <span class="number">1</span> GPIO_ACTIVE_HIGH&gt;</span><span class="punctuation">;</span></span><br><span class="line">	<span class="attr">status</span> <span class="operator">=</span> <span class="string">&quot;okay&quot;</span><span class="punctuation">;</span></span><br><span class="line"><span class="punctuation">&#125;;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>æ£€æŸ¥ <code>PIN</code> æ˜¯å¦è¢«å…¶ä»–å¤–è®¾ä½¿ç”¨</p>
</li>
<li><p>èœ‚é¸£å™¨é©±åŠ¨ç¨‹åºç¼–å†™</p>
</li>
<li><p>ç¼–å†™æµ‹è¯• <code>APP</code></p>
</li>
<li><p>ç¼–è¯‘é©±åŠ¨ç¨‹åº: <code>make -j32</code></p>
</li>
<li><p>ç¼–è¯‘æµ‹è¯• <code>APP</code>: <code>arm-linux-gnueabihf-gcc beepApp.c -o beepApp</code></p>
</li>
<li><p>å¼€å‘æ¿è¿è¡Œæµ‹è¯•</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">depmod 			//ç¬¬ä¸€æ¬¡åŠ è½½é©±åŠ¨çš„æ—¶å€™éœ€è¦è¿è¡Œæ­¤å‘½ä»¤</span><br><span class="line">modprobe beep.ko 	//åŠ è½½é©±åŠ¨</span><br><span class="line">./beepApp /dev/beep 1 	//æ‰“å¼€èœ‚é¸£å™¨</span><br><span class="line">./beepApp /dev/beep 0 	//å…³é—­èœ‚é¸£å™¨</span><br><span class="line">rmmod beep.ko</span><br></pre></td></tr></table></figure></li>
</ul>
<br>

]]></content>
      <categories>
        <category>åµŒå…¥å¼</category>
        <category>ç¯å¢ƒæ­å»º</category>
      </categories>
      <tags>
        <tag>Linux</tag>
        <tag>I.MX6ULL</tag>
        <tag>NXP</tag>
      </tags>
  </entry>
  <entry>
    <title>Gitä½¿ç”¨å°è´´å£«</title>
    <url>/2023/12/21/Git%E5%B0%8F%E8%B4%B4%E5%A3%AB/</url>
    <content><![CDATA[<h2 id="å¸¸ç”¨å‘½ä»¤è¡¨"><a href="#å¸¸ç”¨å‘½ä»¤è¡¨" class="headerlink" title="å¸¸ç”¨å‘½ä»¤è¡¨"></a>å¸¸ç”¨å‘½ä»¤è¡¨</h2><table>
<thead>
<tr>
<th>å‘½ä»¤åç§°</th>
<th>å‘½ä»¤</th>
<th>å¤‡æ³¨</th>
</tr>
</thead>
<tbody><tr>
<td>å…‹éš†å·¥ç¨‹</td>
<td>git clone xxx</td>
<td>xxxä¸ºå…‹éš†é“¾æ¥</td>
</tr>
<tr>
<td>æš‚å­˜æ–‡ä»¶ä¿®æ”¹ã€åˆ é™¤</td>
<td>git add -u</td>
<td>æš‚å­˜æ–‡ä»¶ä¿®æ”¹ã€åˆ é™¤</td>
</tr>
<tr>
<td>æš‚å­˜æ–‡ä»¶ä¿®æ”¹ã€æ–°å»º</td>
<td>git add .</td>
<td>æš‚å­˜æ–‡ä»¶ä¿®æ”¹ã€æ–°å»º</td>
</tr>
<tr>
<td>æš‚å­˜æ–‡ä»¶ä¿®æ”¹ã€åˆ é™¤ã€æ–°å»º</td>
<td>git add -A</td>
<td>æš‚å­˜æ–‡ä»¶ä¿®æ”¹ã€åˆ é™¤ã€æ–°å»º</td>
</tr>
<tr>
<td>æš‚å­˜æ–‡ä»¶</td>
<td>git add xxx</td>
<td>xxxå¯ä¸ºç›®å½•ã€æ–‡ä»¶ï¼Œä¸º.æ—¶æš‚å­˜æ‰€æœ‰</td>
</tr>
<tr>
<td>å–æ¶ˆæ‰€æœ‰å·²æš‚å­˜æ–‡ä»¶</td>
<td>git reset HEAD .</td>
<td>æ”¾å¼ƒæ‰€æœ‰æš‚å­˜ï¼Œä¸ä¼šå–æ¶ˆä¿®æ”¹</td>
</tr>
<tr>
<td>å–æ¶ˆæŒ‡å®šæ–‡ä»¶çš„æš‚å­˜</td>
<td>git reset HEAD filepathname</td>
<td>æ”¾å¼ƒæŒ‡å®šæ–‡ä»¶çš„æš‚å­˜</td>
</tr>
<tr>
<td>æ”¾å¼ƒæœªæš‚å­˜çš„æŒ‡å®šæ–‡ä»¶çš„ä¿®æ”¹</td>
<td>git checkout â€“ filepathname</td>
<td>æ”¾å¼ƒæœªæš‚å­˜çš„æ–‡ä»¶ä¿®æ”¹</td>
</tr>
<tr>
<td>æ”¾å¼ƒæœªæš‚å­˜çš„æ–‡ä»¶ä¿®æ”¹</td>
<td>git checkout .</td>
<td>ä¸ä¼šåˆ é™¤æ–°å»ºçš„ï¼Œæœªè¢«gitè·Ÿè¸ªçš„æ–‡ä»¶</td>
</tr>
<tr>
<td>æ˜¾ç¤ºå°†è¦è¢«åˆ é™¤çš„æ–‡ä»¶</td>
<td>git clean -n</td>
<td>æ˜¾ç¤ºå°†è¦è¢«åˆ é™¤çš„æ–‡ä»¶</td>
</tr>
<tr>
<td>åˆ é™¤å·¥ä½œåŒºæ–°å¢çš„æ–‡ä»¶ã€æ–‡ä»¶å¤¹</td>
<td>git clean -df</td>
<td>åˆ é™¤æ–°å¢çš„æ–‡ä»¶å’Œæ–°å¢çš„æ–‡ä»¶å¤¹</td>
</tr>
<tr>
<td>åˆ é™¤å·¥ä½œåŒºæ–°å¢çš„æ–‡ä»¶</td>
<td>git clean -f</td>
<td>åˆ é™¤å½“å‰ç›®å½•ä¸‹æ‰€æœ‰æ²¡è¢«trackè¿‡çš„æ–‡ä»¶ï¼Œ.gitignoreæŒ‡å®šçš„æ–‡ä»¶å’Œæ–‡ä»¶å¤¹ä¸ä¼šè¢«åˆ é™¤</td>
</tr>
<tr>
<td>æäº¤</td>
<td>git commit -m â€œxxxxxâ€</td>
<td>xxxä¸ºå¤‡æ³¨ä¿¡æ¯</td>
</tr>
<tr>
<td>æŸ¥çœ‹ä¿®æ”¹çš„åœ°æ–¹</td>
<td>git diff xxx</td>
<td>æŸ¥çœ‹ä¿®æ”¹çš„åœ°æ–¹</td>
</tr>
<tr>
<td>æŸ¥çœ‹å·¥ä½œåŒºã€æš‚å­˜åŒº</td>
<td>git status</td>
<td>æŸ¥çœ‹å·¥ä½œåŒºã€æš‚å­˜åŒº</td>
</tr>
<tr>
<td>æ‹‰å–</td>
<td>git pull</td>
<td>åœ¨ä¸»ç›®å½•ä¸‹æ“ä½œ</td>
</tr>
<tr>
<td>åˆå¹¶åˆ†æ”¯</td>
<td>git merge dev</td>
<td>æŠŠdevåˆ†æ”¯åˆå¹¶åˆ°å½“å‰åˆ†æ”¯</td>
</tr>
<tr>
<td>åˆå¹¶ç›®æ ‡åˆ†æ”¯çš„æŒ‡å®šæ–‡ä»¶</td>
<td>git merge dev â€“no-ff filepathname</td>
<td>åˆå¹¶ç›®æ ‡åˆ†æ”¯çš„æŒ‡å®šæ–‡ä»¶</td>
</tr>
<tr>
<td>æ¨é€</td>
<td>git push</td>
<td>æ¨é€</td>
</tr>
<tr>
<td>å¼ºåˆ¶æ¨é€</td>
<td>git push -f origin master</td>
<td>é€‚ç”¨äºæœ¬åœ°å›é€€ç‰ˆæœ¬åä¿®æ”¹æ¨é€ï¼Œmasterä¸ºåˆ†æ”¯å</td>
</tr>
<tr>
<td>æ›´æ–°è¿œç¨‹åˆ†æ”¯åˆ—è¡¨</td>
<td>git remote update origin â€“prune</td>
<td>ä¸è¿œç¨‹ä¿æŒåŒæ­¥</td>
</tr>
<tr>
<td>æ›´æ–°å­æ¨¡å—</td>
<td>git submodule update â€“init</td>
<td>é¦–æ¬¡åå¯ä¸å¸¦â€“init</td>
</tr>
<tr>
<td>åˆ‡æ¢åˆ°æŸä¸€æœ¬åœ°åˆ†æ”¯</td>
<td>git checkout dev</td>
<td>devä¸ºåˆ†æ”¯å</td>
</tr>
<tr>
<td>æŸ¥çœ‹æœ¬åœ°åˆ†æ”¯</td>
<td>git branch</td>
<td>æŸ¥çœ‹æœ¬åœ°åˆ†æ”¯</td>
</tr>
<tr>
<td>åˆ‡æ¢åˆ°æœ¬åœ°æŸä¸ªåˆ†æ”¯</td>
<td>git checkout dev</td>
<td>åˆ‡æ¢åˆ°æœ¬åœ°æŸä¸ªåˆ†æ”¯</td>
</tr>
<tr>
<td>æŸ¥çœ‹æœ¬åœ°åˆ†æ”¯ä¸è¿œç¨‹åˆ†æ”¯çš„å…³è”æƒ…å†µ</td>
<td>git branch -vv</td>
<td>æŸ¥çœ‹æœ¬åœ°åˆ†æ”¯ä¸è¿œç¨‹åˆ†æ”¯çš„å…³è”æƒ…å†µ</td>
</tr>
<tr>
<td>æŸ¥çœ‹è¿œç¨‹åˆ†æ”¯</td>
<td>git branch -a</td>
<td>æŸ¥çœ‹è¿œç¨‹åˆ†æ”¯</td>
</tr>
<tr>
<td>åˆ›å»ºæœ¬åœ°åˆ†æ”¯å¹¶åˆ‡æ¢</td>
<td>git checkout -b V1.1</td>
<td>V1.1ä¸ºåˆ†æ”¯å</td>
</tr>
<tr>
<td>åˆ›å»ºè¿œç¨‹åˆ†æ”¯</td>
<td>git push â€“set-upstream origin V1.1</td>
<td>å»ºç«‹æœ¬åœ°åˆ†æ”¯ä¸æ–°å»ºè¿œç¨‹åˆ†æ”¯çš„å…³è”</td>
</tr>
<tr>
<td>æ–°å»ºæœ¬åœ°åˆ†æ”¯å¹¶è·Ÿè¸ªè¿œç¨‹åˆ†æ”¯</td>
<td>git branch dev origin&#x2F;dev</td>
<td>devä¸ºåˆ†æ”¯åç§°</td>
</tr>
<tr>
<td>æ–°å»ºæœ¬åœ°åˆ†æ”¯å¹¶è·Ÿè¸ªè¿œç¨‹åˆ†æ”¯ä¸”åˆ‡æ¢</td>
<td>git checkout -b dev origin&#x2F;dev</td>
<td>æœ¬åœ°æ–°å»ºåˆ†æ”¯ dev ï¼Œè·Ÿè¸ªè¿œç¨‹çš„åŒååˆ†æ”¯ dev</td>
</tr>
<tr>
<td>æœ¬åœ°æ–°å»ºåˆ†æ”¯ dev ï¼Œè·Ÿè¸ªè¿œç¨‹çš„åŒååˆ†æ”¯ dev</td>
<td>git checkout â€“track origin&#x2F;dev</td>
<td>æœ¬åœ°æ–°å»ºåˆ†æ”¯ dev ï¼Œè·Ÿè¸ªè¿œç¨‹çš„åŒååˆ†æ”¯ dev</td>
</tr>
<tr>
<td>è·å–è¿œç¨‹åœ°å€åŠé€šä¿¡æ–¹å¼</td>
<td>git remote -v</td>
<td>ä»¥gitå¼€å¤´ä¸ºsshåè®®</td>
</tr>
<tr>
<td>æ›´æ–°æœ¬åœ°ä»“åº“çš„remoteåœ°å€</td>
<td>git remote set-url origin xxx</td>
<td>xxxä¸ºè¿œç¨‹åœ°å€</td>
</tr>
<tr>
<td>å›é€€åˆ°ä¸Šä¸€ä¸ªç‰ˆæœ¬</td>
<td>git reset â€“hard HEAD^</td>
<td>åˆ é™¤å·¥ä½œåŒºçš„æ”¹åŠ¨ä»£ç ï¼Œæ’¤é”€commitã€add</td>
</tr>
<tr>
<td>å›é€€åˆ°ä¸ŠXä¸ªç‰ˆæœ¬</td>
<td>git reset â€“hard HEAD~3</td>
<td>~4ï¼Œåˆ é™¤æœŸé—´çš„æ‰€æœ‰æ”¹åŠ¨ï¼Œæ’¤é”€commitã€add</td>
</tr>
<tr>
<td>æ’¤é”€æäº¤ï¼ˆcommitï¼‰</td>
<td>git reset â€“soft HEAD^</td>
<td>ä¸åˆ é™¤å·¥ä½œåŒºçš„æ”¹åŠ¨ä»£ç ï¼Œä¸æ’¤é”€add</td>
</tr>
<tr>
<td>æŸ¥çœ‹ä»£ç æäº¤è®°å½•</td>
<td>git log</td>
<td>æŸ¥çœ‹ä»£ç æäº¤è®°å½•</td>
</tr>
<tr>
<td>åˆ é™¤æœ¬åœ°åˆ†æ”¯</td>
<td>git branch -d Chapater6</td>
<td>Chapater6ä¸ºåˆ†æ”¯å</td>
</tr>
<tr>
<td>åˆ é™¤è¿œç¨‹åˆ†æ”¯</td>
<td>git push origin â€“delete Chapater6</td>
<td></td>
</tr>
<tr>
<td>åˆ é™¤æœ¬åœ°æ ‡ç­¾</td>
<td>git tag -d rel1</td>
<td>rel1ä¸ºæ ‡ç­¾å</td>
</tr>
<tr>
<td>æŸ¥çœ‹æ‰€æœ‰æœ¬åœ°æ ‡ç­¾</td>
<td>git tag -l</td>
<td></td>
</tr>
<tr>
<td>åˆ é™¤è¿œç¨‹æ ‡ç­¾</td>
<td>git push â€“delete origin prod1.0</td>
<td></td>
</tr>
<tr>
<td>æŸ¥çœ‹è¿œç¨‹ä»“åº“ä¿¡æ¯</td>
<td>git remote show origin</td>
<td>æŸ¥çœ‹è¿œç¨‹ä»“åº“ä¿¡æ¯</td>
</tr>
</tbody></table>
<h2 id="æ³¨æ„é¡¹åŠæ‰©å±•é—®é¢˜è§£ç­”"><a href="#æ³¨æ„é¡¹åŠæ‰©å±•é—®é¢˜è§£ç­”" class="headerlink" title="æ³¨æ„é¡¹åŠæ‰©å±•é—®é¢˜è§£ç­”"></a>æ³¨æ„é¡¹åŠæ‰©å±•é—®é¢˜è§£ç­”</h2><h3 id="æ‰§è¡Œ-git-pull-ä¼šè¦†ç›–æœ¬åœ°çš„ä¿®æ”¹å—ï¼Ÿ"><a href="#æ‰§è¡Œ-git-pull-ä¼šè¦†ç›–æœ¬åœ°çš„ä¿®æ”¹å—ï¼Ÿ" class="headerlink" title="æ‰§è¡Œ git pull ä¼šè¦†ç›–æœ¬åœ°çš„ä¿®æ”¹å—ï¼Ÿ"></a>æ‰§è¡Œ git pull ä¼šè¦†ç›–æœ¬åœ°çš„ä¿®æ”¹å—ï¼Ÿ</h3><p>æ²¡æœ‰å†²çªçš„æƒ…å†µä¸‹ï¼Œè¿œç«¯ä¼šç›´æ¥æ›´æ–°è‡³æœ¬åœ°ä¸Šï¼Œä½†ä¸ä¼šæ”¹å˜æœ¬åœ°æœªæäº¤çš„å˜åŠ¨ï¼›å¦‚æœæœ¬åœ°ä¿®æ”¹å·²æäº¤ï¼Œåˆ™ä¼šæ‰§è¡Œä¸€ä¸ªè¿œç«¯åˆ†æ”¯å’Œæœ¬åœ°åˆ†æ”¯çš„åˆå¹¶</p>
<h3 id="git-fetch-å’Œ-git-pull-çš„åŒºåˆ«ä¸è”ç³»"><a href="#git-fetch-å’Œ-git-pull-çš„åŒºåˆ«ä¸è”ç³»" class="headerlink" title="git fetch å’Œ git pull çš„åŒºåˆ«ä¸è”ç³»"></a>git fetch å’Œ git pull çš„åŒºåˆ«ä¸è”ç³»</h3><p><code>git fetch</code>ç”¨äºä»è¿œç¨‹ä»“åº“è·å–æœ€æ–°çš„æäº¤ï¼Œä¿å­˜åˆ°æœ¬åœ°çš„è¿œç¨‹è·Ÿè¸ªåˆ†æ”¯ä¸­ï¼ˆ<code>FETCH_HEAD</code>ï¼‰ï¼Œå¯ä»¥é€šè¿‡æŸ¥çœ‹æ­¤åˆ†æ”¯äº†è§£è¿œç¨‹ä»“åº“çš„æ›´æ–°æƒ…å†µ</p>
<ul>
<li><code>git diff FETCH_HEAD</code>æ¯”è¾ƒæŸ¥çœ‹è¯¥åˆ†æ”¯å’Œå½“å‰å·¥ä½œåˆ†æ”¯çš„å†…å®¹</li>
</ul>
<br>

<p><code>git pull</code>ä¼šè‡ªåŠ¨è·å–è¿œç¨‹ä»“åº“çš„æ›´æ–°ï¼Œå¹¶ä¸”åˆå¹¶åˆ°å½“å‰åˆ†æ”¯ä¸Šï¼Œç›¸å½“äº<code>git fetch</code> + <code>git merge FETCH_HEAD</code></p>
<ul>
<li>å°†è¿œç¨‹ä»“åº“ä¸­æŒ‡å®šåˆ†æ”¯çš„æœ€æ–°æäº¤ ID ä¿å­˜åˆ°æœ¬åœ°çš„ FETCH_HEAD åˆ†æ”¯ä¸­</li>
<li>å°† FETCH_HEAD åˆ†æ”¯åˆå¹¶åˆ°å½“å‰å·¥ä½œåˆ†æ”¯ä¸­</li>
</ul>
<h3 id="å¦‚ä½•å–æ¶ˆæŒ‡å®šæ–‡ä»¶çš„ä¿®æ”¹-æš‚å­˜-æäº¤ï¼Ÿ"><a href="#å¦‚ä½•å–æ¶ˆæŒ‡å®šæ–‡ä»¶çš„ä¿®æ”¹-æš‚å­˜-æäº¤ï¼Ÿ" class="headerlink" title="å¦‚ä½•å–æ¶ˆæŒ‡å®šæ–‡ä»¶çš„ä¿®æ”¹&#x2F;æš‚å­˜&#x2F;æäº¤ï¼Ÿ"></a>å¦‚ä½•å–æ¶ˆæŒ‡å®šæ–‡ä»¶çš„ä¿®æ”¹&#x2F;æš‚å­˜&#x2F;æäº¤ï¼Ÿ</h3><ul>
<li><p>å½“æ–‡ä»¶è¿˜æ²¡æš‚å­˜ï¼Œä¿®æ”¹è¿˜åœç•™ç€å·¥ä½œåŒºæ—¶ï¼Œæ‰§è¡Œ<code>git checkout -- &lt;file&gt;</code>å–æ¶ˆæ–‡ä»¶çš„ä¿®æ”¹ï¼ˆæ³¨æ„è¦å¸¦<code>--</code>ï¼‰ï¼Œæ‰§è¡Œ<code>git checkout .</code>å–æ¶ˆæ‰€æœ‰å·¥ä½œåŒºçš„æ›´æ”¹</p>
</li>
<li><p>å½“æ–‡ä»¶å·²ç»æš‚å­˜æ—¶ï¼Œæ‰§è¡Œ<code>git reset &lt;file&gt;</code>å–æ¶ˆæš‚å­˜ä½¿å…¶å›åˆ°å·¥ä½œåŒºï¼Œæ‰§è¡Œ<code>git reset .</code>å–æ¶ˆæ‰€æœ‰æš‚å­˜</p>
</li>
<li><p>å½“æ–‡ä»¶å·²ç»æäº¤æ—¶ï¼Œæ‰§è¡Œ<code>git reset --soft HEAD^</code>ï¼Œå°†æœ€è¿‘çš„ä¸€æ¬¡æäº¤è®°å½•å–æ¶ˆï¼Œå¹¶å°†æ‰€æœ‰å†…å®¹è¿”å›è‡³å·¥ä½œåŒºï¼Œå¯ä»¥é‡æ–°ç¼–è¾‘ã€æäº¤æˆ–è€…å–æ¶ˆä¿®æ”¹</p>
</li>
</ul>
<p>æ³¨æ„ï¼šæœ€è¿‘çš„æäº¤å·²ç»å–æ¶ˆï¼Œè€Œè¿œç«¯çš„æäº¤è¿˜ä¿æŒï¼Œæ­¤æ—¶å¦‚æœéœ€è¦åŒæ­¥æäº¤ï¼Œæ‰§è¡Œ<code>git push -f</code>å¼ºåˆ¶è¦†ç›–è¿œç«¯ä»“åº“ï¼Œéœ€è¦å®¡æ…å†³å®šã€‚å¦å¤–ï¼Œå¯ä»¥é‡‡å–<code>git revert HEAD</code>åˆ›å»ºä¸€ä¸ªæ–°çš„æäº¤è¾¾åˆ°åå‘æŠµæ¶ˆæœ€è¿‘æäº¤çš„ç›®çš„ã€‚</p>
<h3 id="å¦‚ä½•è§£å†³åˆ†æ”¯åˆå¹¶å†²çª"><a href="#å¦‚ä½•è§£å†³åˆ†æ”¯åˆå¹¶å†²çª" class="headerlink" title="å¦‚ä½•è§£å†³åˆ†æ”¯åˆå¹¶å†²çª"></a>å¦‚ä½•è§£å†³åˆ†æ”¯åˆå¹¶å†²çª</h3><p>å½“æœ¬åœ°ä¸¤ä¸ªåˆ†æ”¯åˆå¹¶æ—¶ï¼Œæˆ–è€…æ˜¯è¿œç«¯åˆ†æ”¯ä¸æœ¬åœ°åˆ†æ”¯åˆå¹¶æ—¶ï¼Œå¦‚æœæœ‰å†²çªï¼Œè§£å†³æµç¨‹å¦‚ä¸‹ï¼š</p>
<ul>
<li><p>å½“æ‰§è¡Œ<code>git pull</code>åˆå¹¶è¿œç«¯åˆ†æ”¯çš„æ›´æ”¹åˆ°æœ¬åœ°åˆ†æ”¯ï¼Œæˆ–è€…æ‰§è¡Œ<code>git merge dev</code>å°†æœ¬åœ°çš„devåˆ†æ”¯åˆå¹¶åˆ°å½“å‰åˆ†æ”¯ï¼ŒGit ä¼šä¸­æ­¢åˆå¹¶ï¼Œå¹¶æ˜¾ç¤ºä¸€ä¸ªæ¶ˆæ¯ï¼Œåˆ—å‡ºå­˜åœ¨å†²çªçš„æ–‡ä»¶</p>
</li>
<li><p>æ­¤æ—¶å¯ä»¥æ‰‹åŠ¨ç¼–è¾‘å†²çªæ–‡ä»¶ï¼šæ‰“å¼€å†²çªçš„æ–‡ä»¶ï¼ŒGit ä¼šåœ¨æœ‰å†²çªçš„åœ°æ–¹æ’å…¥ç‰¹æ®Šçš„æ ‡è®°ï¼Œå¦‚ <code>&lt;&lt;&lt;&lt;&lt;&lt;&lt;, =======, &gt;&gt;&gt;&gt;&gt;&gt;&gt;</code>ï¼Œç¼–è¾‘æ–‡ä»¶è¿›è¡Œåˆé€‚çš„æ›´æ”¹åï¼Œä½¿ç”¨<code>git add &lt;file&gt;</code>æš‚å­˜å†²çªçš„æ–‡ä»¶<br>å†²çªæ–‡ä»¶ç¤ºä¾‹å¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;&lt;&lt;&lt;&lt;&lt;&lt; HEAD</span><br><span class="line">æœ¬åœ°æ›´æ”¹çš„å†…å®¹</span><br><span class="line">=======</span><br><span class="line">è¿œç«¯æ›´æ”¹çš„å†…å®¹</span><br><span class="line">&gt;&gt;&gt;&gt;&gt;&gt;&gt; &lt;commit&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>ä½¿ç”¨<code>git commit</code>æäº¤è§£å†³å†²çªåçš„æ›´æ”¹ï¼Œæ­¤æ—¶ä¼šè¿›å…¥æäº¤ä¿¡æ¯çš„ç¼–è¾‘ç•Œé¢ï¼ŒGit é€šå¸¸ä¼šåœ¨å…¶ä¸­è‡ªåŠ¨å¡«å……ä¸€ä¸ªåˆå¹¶æäº¤ä¿¡æ¯ï¼Œä¹Ÿå¯ä»¥è‡ªè¡Œä¿®æ”¹ã€‚</p>
<blockquote>
<p>å½“ç„¶ä¹Ÿå¯ä»¥ç›´æ¥æ‰§è¡Œ<code>git commit -m &quot;commit message&quot;</code>ï¼Œcommit message åˆ™ä¸ºæ­¤æ¬¡åˆ†æ”¯åˆå¹¶çš„æäº¤ä¿¡æ¯ã€‚</p>
</blockquote>
</li>
</ul>
<br>

<h3 id="æœ¬åœ°åˆ†æ”¯ä¸è¿œç«¯åˆ†æ”¯å„æœ‰ä¸€ä¸ªæ–°çš„æäº¤æ—¶çš„åšæ³•"><a href="#æœ¬åœ°åˆ†æ”¯ä¸è¿œç«¯åˆ†æ”¯å„æœ‰ä¸€ä¸ªæ–°çš„æäº¤æ—¶çš„åšæ³•" class="headerlink" title="æœ¬åœ°åˆ†æ”¯ä¸è¿œç«¯åˆ†æ”¯å„æœ‰ä¸€ä¸ªæ–°çš„æäº¤æ—¶çš„åšæ³•"></a>æœ¬åœ°åˆ†æ”¯ä¸è¿œç«¯åˆ†æ”¯å„æœ‰ä¸€ä¸ªæ–°çš„æäº¤æ—¶çš„åšæ³•</h3><p>å½“æœ¬åœ°åˆ†æ”¯æœ‰ä¸€ä¸ªæäº¤ï¼Œè€Œè¿œç«¯åˆ†æ”¯ä¹Ÿæœ‰ä¸€ä¸ªæ–°çš„æäº¤æ—¶ï¼Œå¦‚æœä½¿ç”¨<code>sourcetree</code>è¿›è¡Œæ‹‰å–ï¼Œä¼šæç¤ºé”™è¯¯ï¼Œæœ‰ä»¥ä¸‹è§£å†³æ–¹æ³•ï¼š</p>
<ul>
<li><p><strong>åˆ›å»ºä¸€ä¸ªåˆå¹¶æäº¤ï¼š</strong> å°†è¿œç«¯åˆ†æ”¯çš„æ›´æ”¹åˆå¹¶åˆ°æœ¬åœ°åˆ†æ”¯ï¼Œè¿™ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„â€œåˆå¹¶æäº¤â€ï¼ˆmerge commitï¼‰ï¼Œå°†ä¸¤ä¸ªåˆ†æ”¯çš„æ›´æ”¹å†å²åˆå¹¶åœ¨ä¸€èµ·ã€‚å¯ä»¥ç”¨å‘½ä»¤è¡Œç›´æ¥æ‰§è¡Œ<code>git pull</code></p>
<br>
</li>
<li><p><strong>å˜åŸºï¼š</strong> æ‰§è¡Œ<code>git pull --rebase</code>ï¼Œç›¸å½“äº<code>git fetch</code>+<code>git rebase</code>ï¼Œæ­¤è¿‡ç¨‹ä¸ä¼šåˆ›å»ºåˆå¹¶æäº¤ï¼Œä»…ä¼šæŠŠè¿œç«¯çš„æäº¤å’Œæœ¬åœ°çš„æäº¤é‡å†™æˆä¸€ä¸ªçº¿æ€§çš„æäº¤å†å²ã€‚</p>
<blockquote>
<p>å¦‚æœå­˜åœ¨ä¿®æ”¹å†²çªçš„è¯ï¼Œgitä¼šåœæ­¢å˜åŸºè¿‡ç¨‹ï¼Œæç¤ºç”¨æˆ·æ‰“å¼€æ–‡ä»¶æ‰‹åŠ¨è§£å†³å†²çªã€‚æ­¤æ—¶ç”¨æˆ·ä¿®æ”¹å®Œå†²çªåï¼Œæ‰§è¡Œ<code>git add &lt;file&gt;</code>ï¼Œå†æ‰§è¡Œ<code>git rebase --continue</code>ï¼Œgitåˆ™ä¼šç»§ç»­æ‰§è¡Œå˜åŸºè¿‡ç¨‹ã€‚</p>
</blockquote>
</li>
</ul>
<h3 id="git-commmitç›¸å…³æ‰©å±•"><a href="#git-commmitç›¸å…³æ‰©å±•" class="headerlink" title="git commmitç›¸å…³æ‰©å±•"></a>git commmitç›¸å…³æ‰©å±•</h3><p>å½“ä½¿ç”¨<code>git commit</code>æ—¶ï¼Œä¼šè¿›å…¥nanoç¼–è¾‘å™¨ï¼Œæ­¤æ—¶å¯ä»¥ç¼–è¾‘æ–‡æœ¬ï¼ŒæŒ‰<code>ctrl + x</code>é€€å‡ºï¼ŒæŒ‰<code>y</code>ä¿å­˜ï¼Œé€‰æ‹©ä¿å­˜æ—¶ä¼šå†æ¬¡æç¤ºç¡®è®¤æ–‡ä»¶åï¼Œç›´æ¥æŒ‰<code>Enter</code>å³å¯ä¿å­˜æäº¤ã€‚</p>
<p>å½“ç„¶ï¼Œå¯ä»¥æ‰§è¡Œ<code>git config --global core.editor vim</code>åˆ‡æ¢ä¸ºvimç¼–è¾‘å™¨ã€‚</p>
<h4 id="git-commitæäº¤è§„èŒƒ"><a href="#git-commitæäº¤è§„èŒƒ" class="headerlink" title="git commitæäº¤è§„èŒƒ"></a>git commitæäº¤è§„èŒƒ</h4><ul>
<li><a href="https://www.cnblogs.com/anly95/p/13163384.html">git commit ä»£ç æäº¤è§„èŒƒ</a></li>
</ul>
<p>åŸºäºAngularå›¢é˜Ÿçš„Gitæäº¤æŒ‡å—å¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;type&gt;(&lt;scope&gt;): &lt;subject&gt;</span><br><span class="line">&lt;BLANK LINE&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;BLANK LINE&gt;</span><br><span class="line">&lt;footer&gt;</span><br></pre></td></tr></table></figure>

<p><strong>typeï¼ˆç±»å‹ï¼‰</strong>ï¼šæè¿°æäº¤çš„ç±»åˆ«ï¼Œå¦‚ featï¼ˆæ–°ç‰¹æ€§ï¼‰ã€fixï¼ˆä¿®å¤bugï¼‰ã€docsï¼ˆæ–‡æ¡£æ›´æ–°ï¼‰ã€styleï¼ˆä»£ç æ ¼å¼æ”¹å˜ï¼‰ã€refactorï¼ˆä»£ç é‡æ„ï¼‰ã€perfï¼ˆæ€§èƒ½ä¼˜åŒ–ï¼‰ã€testï¼ˆæ·»åŠ æˆ–ä¿®æ”¹æµ‹è¯•ï¼‰ã€choreï¼ˆå…¶ä»–ä¸ä¿®æ”¹srcæˆ–testçš„æ›´æ”¹ï¼‰ç­‰ã€‚<br><strong>scopeï¼ˆèŒƒå›´ï¼‰</strong>ï¼šæè¿°æäº¤å½±å“çš„ä»£ç æ¨¡å—æˆ–åŠŸèƒ½ï¼Œå¦‚ apiã€authã€ui ç­‰ã€‚<br><strong>subjectï¼ˆä¸»é¢˜ï¼‰</strong>ï¼šç®€æ´æ˜äº†åœ°æè¿°æ‰€åšçš„æ›´æ”¹ï¼Œé€šå¸¸ä¸è¶…è¿‡50ä¸ªå­—ç¬¦ï¼Œå¹¶ä¸”ä½¿ç”¨ç°åœ¨æ—¶æ€ï¼Œå¦‚â€œFix bugâ€è€Œä¸æ˜¯â€œFixed bugâ€ã€‚<br><strong>bodyï¼ˆæ­£æ–‡ï¼‰</strong>ï¼šæ›´è¯¦ç»†åœ°æè¿°æ›´æ”¹çš„å†…å®¹ã€åŸå› å’Œå½±å“ï¼Œå¦‚æœéœ€è¦çš„è¯ã€‚å¯ä»¥åˆ†æˆå¤šè¡Œï¼Œä½†æ¯è¡Œä¸è¶…è¿‡72ä¸ªå­—ç¬¦ã€‚<br><strong>footerï¼ˆé¡µè„šï¼‰</strong>ï¼šæäº¤ä¿¡æ¯çš„æœ€åä¸€éƒ¨åˆ†ï¼Œå¯ä»¥åŒ…å«å…³é—­çš„issueã€å…³è”çš„pull requestæˆ–breaking changesç­‰ä¿¡æ¯ã€‚<br><br></p>
<p>ä¸€ä¸ªå…·ä½“çš„æäº¤ä¿¡æ¯ç¤ºä¾‹å¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">fix(auth): ä¿®å¤ç™»å½•æ—¶çš„ç©ºæŒ‡é’ˆå¼‚å¸¸</span><br><span class="line"></span><br><span class="line">åœ¨ç”¨æˆ·å°è¯•ä½¿ç”¨nullé‚®ç®±åœ°å€ç™»å½•æ—¶ï¼Œç³»ç»Ÿä¼šæŠ›å‡ºç©ºæŒ‡é’ˆå¼‚å¸¸ã€‚è¿™æ¬¡æ›´æ”¹é€šè¿‡åœ¨è°ƒç”¨ç™»å½•æ–¹æ³•ä¹‹å‰æ£€æŸ¥é‚®ç®±åœ°å€æ˜¯å¦ä¸ºç©ºæ¥ä¿®å¤è¿™ä¸ªé—®é¢˜ã€‚</span><br><span class="line"></span><br><span class="line">æ­¤å¤–ï¼Œè¿™æ¬¡æ›´æ”¹è¿˜å¢åŠ äº†ä¸€ä¸ªè­¦å‘Šæ—¥å¿—ï¼Œä»¥ä¾¿äºç›‘æ§ç³»ç»Ÿåœ¨ç”¨æˆ·å°è¯•ä½¿ç”¨æ— æ•ˆæ•°æ®ç™»å½•æ—¶çš„è¡Œä¸ºã€‚</span><br><span class="line"></span><br><span class="line">Closes #123</span><br></pre></td></tr></table></figure>
<p>è§£é‡Šå¦‚ä¸‹ï¼š</p>
<ul>
<li>type æ˜¯ fixï¼Œè¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªbugä¿®å¤</li>
<li>scope æ˜¯ authï¼Œè¡¨ç¤ºæ›´æ”¹å½±å“çš„æ˜¯è®¤è¯æ¨¡å—</li>
<li>subject æ˜¯ â€œä¿®å¤ç™»å½•æ—¶çš„ç©ºæŒ‡é’ˆå¼‚å¸¸â€ï¼Œç®€æ´åœ°æè¿°äº†æ›´æ”¹çš„å†…å®¹</li>
<li>body æä¾›äº†æ›´è¯¦ç»†çš„æ›´æ”¹æè¿°å’Œä¸Šä¸‹æ–‡ï¼ŒåŒ…æ‹¬ä¸ºä»€ä¹ˆè¿›è¡Œè¿™ä¸ªæ›´æ”¹ä»¥åŠå®ƒçš„å½±å“</li>
<li>footer åŒ…å«äº†ä¸€ä¸ªå…³è”çš„issueç¼–å· #123ï¼Œè¡¨ç¤ºè¿™ä¸ªæäº¤è§£å†³äº†è¯¥issue</li>
</ul>
<h2 id="åŸºç¡€éå…¸å‹æ“ä½œ"><a href="#åŸºç¡€éå…¸å‹æ“ä½œ" class="headerlink" title="åŸºç¡€éå…¸å‹æ“ä½œ"></a>åŸºç¡€éå…¸å‹æ“ä½œ</h2><h3 id="æœ¬åœ°gité…ç½®"><a href="#æœ¬åœ°gité…ç½®" class="headerlink" title="æœ¬åœ°gité…ç½®"></a>æœ¬åœ°gité…ç½®</h3><br>

<p><strong>é…ç½®æœ¬åœ°ä¸è¿œç«¯çš„SSHå¯†é’¥è¿æ¥æµç¨‹ï¼š</strong></p>
<ul>
<li>æœ¬åœ°ç”ŸæˆSSHå…¬é’¥å’Œç§é’¥(å¦‚æœæ²¡æœ‰çš„è¯ï¼Œå¦ï¼Œlinuxä¸‹å…¬é’¥é€šå¸¸å­˜æ”¾äº<code>~/.ssh/*.pub</code>)<ul>
<li><code>ssh-keygen -t rsa -b 4096 -C xxx@xxx.com</code></li>
</ul>
</li>
<li>å¤åˆ¶å…¬é’¥ï¼Œæ·»åŠ è‡³è¿œç«¯å¹³å°çš„SSHè®¾ç½®ä¸Š<br></li>
</ul>
<p><strong>æŸ¥çœ‹æœ¬åœ°é…ç½®ï¼š</strong></p>
<ul>
<li><code>git config --list</code>æŸ¥çœ‹å½“å‰é¡¹ç›®çš„æ‰€æœ‰é…ç½®</li>
<li><code>git config --global --list</code>æŸ¥çœ‹å…¨å±€é…ç½®<br></li>
</ul>
<p><strong>ä¿®æ”¹ç”¨æˆ·å(å…¨å±€&#x2F;å½“å‰é¡¹ç›®)</strong></p>
<p>æ­¤ç”¨æˆ·åå³æäº¤æ—¥å¿—ä¸Šæ‰€å±•ç¤ºçš„ç”¨æˆ·åç§°</p>
<ul>
<li>ä¿®æ”¹å…¨å±€ç”¨æˆ·åï¼š<code>git config --global user.name &quot;xxx&quot;</code>ï¼Œå½±å“ç”¨æˆ·çš„æ‰€æœ‰ä»“åº“</li>
<li>ä¿®æ”¹å½“å‰è·¯å¾„é¡¹ç›®çš„ç”¨æˆ·åï¼š<code>git config user.name &quot;xxx&quot;</code></li>
<li>æŸ¥çœ‹å…¨å±€ç”¨æˆ·åï¼š<code>git config user.name</code><br></li>
</ul>
<p><strong>åˆå§‹åŒ–æœ¬åœ°å·¥ç¨‹å¹¶ä¸è¿œç«¯å·²æœ‰ä»“åº“çš„mainåˆ†æ”¯å…³è”ï¼š</strong></p>
<ul>
<li>è¿›å…¥å·¥ç¨‹æ ¹ç›®å½•ï¼Œ<code>git init</code>åˆå§‹åŒ–æœ¬åœ°ä»“åº“</li>
<li>æ·»åŠ è¿œç¨‹ä»“åº“ï¼š<code>git remote add origin &lt;è¿œç¨‹ä»“åº“åœ°å€&gt;</code></li>
<li><code>git branch -M main</code>å°†å½“å‰åˆ†æ”¯é‡å‘½åä¸º<code>main</code>ï¼ŒMå³<code>--move --force</code>çš„ç¼©å†™ã€‚ï¼ˆå¯ä»¥åˆ†åˆ«è¾“å…¥<code>git add --all</code>ï¼Œ<code>git commit -m &quot;first commit&quot;</code>å®Œæˆå¯¹æœ¬åœ°åˆ†æ”¯çš„é¦–æ¬¡æäº¤ï¼‰</li>
<li>ä½¿ç”¨<code>git pull origin main</code>ï¼Œå°†è¿œç¨‹ä»“åº“çš„mainåˆ†æ”¯æ‹‰å–åˆ°æœ¬åœ°ï¼Œæˆ–è€…<code>git push -u origin main -f</code>å°†æœ¬åœ°çš„xxxåˆ†æ”¯å¼ºåˆ¶æ¨é€åˆ°è¿œç«¯mainåˆ†æ”¯ï¼Œå…¶ä¸­-uæ˜¯<code>--set-upstream</code>çš„ç¼©å†™ï¼Œåç»­ä¼šä¿æŒè¿™ä¸ªè·Ÿè¸ªå…³ç³»</li>
</ul>
<h3 id="æ ‡ç­¾ç›¸å…³æ“ä½œ"><a href="#æ ‡ç­¾ç›¸å…³æ“ä½œ" class="headerlink" title="æ ‡ç­¾ç›¸å…³æ“ä½œ"></a>æ ‡ç­¾ç›¸å…³æ“ä½œ</h3><p><strong>å…‹éš†è¿œç¨‹ä»“åº“ä¸ŠæŒ‡å®šæ ‡ç­¾å¯¹åº”çš„å·¥ç¨‹ï¼š</strong></p>
<ul>
<li>æ¨¡æ¿ï¼š<code>git clone -b v1.0.0 https://github.com/example/my_repo</code>â€“å…‹éš†ä»“åº“ <a href="https://github.com/example/my_repo">https://github.com/example/my_repo</a> ä¸­æ ‡ç­¾ v1.0.0 å¯¹åº”çš„æºç åˆ°å½“å‰ç›®å½•</li>
<li>å¦‚ï¼š<code>git clone -b OpenHarmony-v4.0-Release https://gitee.com/openharmony/kernel_liteos_m.git</code></li>
</ul>
<h3 id="æœ¬åœ°ä»“åº“åŒæ—¶æ¨é€è¿œç«¯çš„å¤šä¸ªå¹³å°ï¼ˆæ¨é€giteeã€githubï¼‰"><a href="#æœ¬åœ°ä»“åº“åŒæ—¶æ¨é€è¿œç«¯çš„å¤šä¸ªå¹³å°ï¼ˆæ¨é€giteeã€githubï¼‰" class="headerlink" title="æœ¬åœ°ä»“åº“åŒæ—¶æ¨é€è¿œç«¯çš„å¤šä¸ªå¹³å°ï¼ˆæ¨é€giteeã€githubï¼‰"></a>æœ¬åœ°ä»“åº“åŒæ—¶æ¨é€è¿œç«¯çš„å¤šä¸ªå¹³å°ï¼ˆæ¨é€giteeã€githubï¼‰</h3><p><strong>æ–¹æ³•ä¸€ï¼šä¸ºè¿œç¨‹ä»“åº“æŒ‡å®šå¤šä¸ªåœ°å€</strong></p>
<ul>
<li>åœ¨æœ¬åœ°ä»“åº“çš„æ ¹ç›®å½•æœ‰<code>.git</code>éšè—ç›®å½•ï¼Œæ‰¾åˆ°<code>.git/config</code>æ–‡ä»¶ï¼Œæ‰“å¼€ç¼–è¾‘ï¼Œå¦‚ä¸‹æ‰€ç¤º</li>
<li>å…¶ä¸­ä»£ç è¡Œ<code>url = git@gitee.com:Jindu-Chen/jindu-chen.git</code>ä¸ºæ–°å¢ï¼ˆé¦–å…ˆéœ€è¦åœ¨è¿œç¨‹åˆ›å»º&#x2F;æ‹¥æœ‰æ­¤ä»“åº“ï¼Œå¹¶ä¸”æœ¬åœ°ç”¨æˆ·å·²ç»é…ç½®å¥½ä¸giteeã€githubçš„è¿æ¥ï¼‰</li>
<li>ä¿å­˜é€€å‡ºï¼Œæ­¤æ—¶ä¿®æ”¹æœ¬åœ°ä»£ç å¹¶æäº¤ï¼Œä¼šåŒæ—¶æ¨é€åˆ°ä¸¤ä¸ªè¿œç«¯<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[core]</span><br><span class="line">        repositoryformatversion = 0</span><br><span class="line">        filemode = true</span><br><span class="line">        bare = false</span><br><span class="line">        logallrefupdates = true</span><br><span class="line">[remote &quot;origin&quot;]</span><br><span class="line">        url = git@gitee.com:Jindu-Chen/jindu-chen.git       # æ–°æ·»åŠ è¡Œ</span><br><span class="line">        url = git@github.com:Jindu-Chen/Jindu-Chen.github.io.git</span><br><span class="line">        fetch = +refs/heads/*:refs/remotes/origin/*</span><br><span class="line">[branch &quot;main&quot;]</span><br><span class="line">        remote = origin</span><br><span class="line">        merge = refs/heads/main</span><br><span class="line">[user]</span><br><span class="line">        name = Jindu Chen</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="gitignoreå¿½ç•¥è§„åˆ™"><a href="#gitignoreå¿½ç•¥è§„åˆ™" class="headerlink" title=".gitignoreå¿½ç•¥è§„åˆ™"></a>.gitignoreå¿½ç•¥è§„åˆ™</h3><ul>
<li><p>åœ¨gité¡¹ç›®æ ¹ç›®å½•ä¸‹åˆ›å»º.gitignoreæ–‡ä»¶ï¼Œç„¶åæ·»åŠ éœ€è¦å¿½ç•¥è·Ÿè¸ªçš„æ–‡ä»¶é€‰é¡¹</p>
<ul>
<li>.gitignoreæ–‡ä»¶ä»…å¯¹å½“å‰ç›®å½•åŠå…¶å­ç›®å½•èµ·ä½œç”¨</li>
</ul>
</li>
<li><p>æ­¤å‰å·²ç»è¢«è·Ÿè¸ªçš„æ–‡ä»¶ï¼Œæ·»åŠ .gitignoreæ— æ•ˆ</p>
<blockquote>
<p>æ‰§è¡Œ<code>git rm --cached /path/to/remove</code>å–æ¶ˆè·Ÿè¸ªï¼Œç„¶åæäº¤æ¨é€</p>
</blockquote>
</li>
<li><p>å¼ºè¡Œè·Ÿè¸ªè¢«.gitignoreå¿½ç•¥çš„æŸä¸ªæŒ‡å®šæ–‡ä»¶<br><code>git add -f /path/to/add</code>æˆ–è€… åœ¨.gitignoreæ–‡ä»¶åæ·»åŠ <code>!path/to/track</code>(<code>!</code>è¡¨ç¤ºè¦†ç›–å‰é¢çš„å¿½ç•¥è§„åˆ™)<br>å¦‚ï¼š<code>git add -f hello.bin</code> or æ·»åŠ <code>!hello.bin</code></p>
</li>
</ul>
<p><strong>é™„ä¸Šä¸€ä¸ªè‡ªç”¨çš„.gitignoreæ–‡ä»¶ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">.vscode</span><br><span class="line">.history</span><br><span class="line">build</span><br><span class="line">Listings</span><br><span class="line">Objects</span><br><span class="line"></span><br><span class="line"># Listing Files</span><br><span class="line">*.i</span><br><span class="line">*.lst</span><br><span class="line">*.map</span><br><span class="line"></span><br><span class="line"># Object Files</span><br><span class="line">*.axf</span><br><span class="line">*.b[0-2][0-9]</span><br><span class="line">*.b3[0-1]</span><br><span class="line">*.bak</span><br><span class="line">*.build_log.htm</span><br><span class="line">*.crf</span><br><span class="line">*.d</span><br><span class="line">*.dep</span><br><span class="line">*.elf</span><br><span class="line">*.htm</span><br><span class="line">*.iex</span><br><span class="line">*.lnp</span><br><span class="line">*.o</span><br><span class="line">*.obj</span><br><span class="line">*.sbr</span><br><span class="line"></span><br><span class="line"># Firmware Files</span><br><span class="line">*.bin</span><br><span class="line">*.h86</span><br><span class="line">*.hex</span><br><span class="line"></span><br><span class="line"># Debugger Files</span><br><span class="line">.ini</span><br></pre></td></tr></table></figure>


<h3 id="ç‰ˆæœ¬å‘å¸ƒ"><a href="#ç‰ˆæœ¬å‘å¸ƒ" class="headerlink" title="ç‰ˆæœ¬å‘å¸ƒ"></a>ç‰ˆæœ¬å‘å¸ƒ</h3><h2 id="è¿›é˜¶æ“ä½œ"><a href="#è¿›é˜¶æ“ä½œ" class="headerlink" title="è¿›é˜¶æ“ä½œ"></a>è¿›é˜¶æ“ä½œ</h2><h3 id="é’©å­é…ç½®-Git-Hooks"><a href="#é’©å­é…ç½®-Git-Hooks" class="headerlink" title="é’©å­é…ç½®(Git Hooks)"></a>é’©å­é…ç½®(Git Hooks)</h3><ul>
<li>Hook å³åœ¨æ‰§è¡ŒæŸä¸ªäº‹ä»¶ä¹‹å‰æˆ–ä¹‹åè¿›è¡Œä¸€äº›å…¶ä»–é¢å¤–çš„æ“ä½œï¼Œå¦‚ä¸‹<ul>
<li>è‡ªåŠ¨éƒ¨ç½²ä»£ç </li>
<li>è‡ªåŠ¨è¿›è¡Œä»£ç å®¡æŸ¥</li>
<li>å®‰å…¨å®¡æŸ¥</li>
<li>æ—¥å¿—è®°å½•</li>
<li>é€šçŸ¥ç”¨æˆ·</li>
</ul>
</li>
<li>Gitæœ‰è®¸å¤šçš„äº‹ä»¶ï¼ˆcommitã€push ç­‰ç­‰ï¼‰ï¼Œæ¯ä¸ªäº‹ä»¶ä¹Ÿåº”äº†æœ‰ä¸åŒçš„é’©å­ï¼ˆå¦‚ commit å‰ï¼Œcommit åï¼‰</li>
<li>ä½¿ç”¨ï¼šæš‚ç•¥</li>
</ul>
<h3 id="å­æ¨¡å—"><a href="#å­æ¨¡å—" class="headerlink" title="å­æ¨¡å—"></a>å­æ¨¡å—</h3><ul>
<li><p>å¯¹äºéœ€è¦æµæ°´çº¿è‡ªåŠ¨åŒ–ä½œä¸šç¼–è¯‘çš„é¡¹ç›®ï¼Œå¯ä»¥å°†å…¶å·¥å…·é“¾å•ç‹¬å­˜æ”¾ï¼Œä½œä¸ºå­æ¨¡å—è¢«è°ƒç”¨</p>
</li>
<li><p>åˆ é™¤é¡¹ç›®å†…å·²æœ‰çš„å­æ¨¡å—é…ç½®ï¼Œå°†å…¶è½¬åŒ–ä¸ºæœ¬é¡¹ç›®å†…å®¹</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">cd ./path/to/submodule</span><br><span class="line">rm -rf .git</span><br><span class="line"></span><br><span class="line"># at project root directory</span><br><span class="line">git rm --cached ./path/to/submodule</span><br><span class="line">git add --all</span><br><span class="line">git commit -m &quot;xxx&quot;</span><br><span class="line">git push</span><br></pre></td></tr></table></figure>
</li>
<li><p>å…‹éš†åŒ…å«å­æ¨¡å—çš„ä»“åº“åï¼Œå­æ¨¡å—çš„æ‹‰å–<br>  <code>git submodule update --init --recursive</code></p>
</li>
</ul>
<h2 id="éå…¸å‹é—®é¢˜è§£å†³æ–¹æ¡ˆ"><a href="#éå…¸å‹é—®é¢˜è§£å†³æ–¹æ¡ˆ" class="headerlink" title="éå…¸å‹é—®é¢˜è§£å†³æ–¹æ¡ˆ"></a>éå…¸å‹é—®é¢˜è§£å†³æ–¹æ¡ˆ</h2><h3 id="åŒä¸€Linuxä¸»æœº-å¤šgithubè´¦æˆ·çš„æƒé™æŠ¥é”™é—®é¢˜"><a href="#åŒä¸€Linuxä¸»æœº-å¤šgithubè´¦æˆ·çš„æƒé™æŠ¥é”™é—®é¢˜" class="headerlink" title="åŒä¸€Linuxä¸»æœº-å¤šgithubè´¦æˆ·çš„æƒé™æŠ¥é”™é—®é¢˜"></a>åŒä¸€Linuxä¸»æœº-å¤šgithubè´¦æˆ·çš„æƒé™æŠ¥é”™é—®é¢˜</h3><p>æ˜æ˜å·²ç»é…ç½®å¥½æœ¬åœ°ä¸ Github äº‘ç«¯çš„ SSH å¯†é’¥ï¼Œä½†ä¾æ—§æŠ¥é”™ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ERROR: Permission to xxx.git denied to xxx.</span><br><span class="line">fatal: æ— æ³•è¯»å–è¿œç¨‹ä»“åº“ã€‚</span><br><span class="line">è¯·ç¡®è®¤æ‚¨æœ‰æ­£ç¡®çš„è®¿é—®æƒé™å¹¶ä¸”ä»“åº“å­˜åœ¨ã€‚</span><br></pre></td></tr></table></figure>
<br>

<p>è§£å†³æ­¥éª¤å¦‚ä¸‹ï¼š</p>
<ul>
<li>å¦‚æœéœ€è¦ä½¿ç”¨ä¸¤ä¸ªä¸åŒçš„ Github è´¦æˆ·ï¼Œåˆ™éœ€è¦åœ¨æœ¬åœ°ä¸»æœºä¸Šç”Ÿæˆä¸¤ä¸ªç›¸åº”çš„ SSH Keyï¼Œå°†å…¬é’¥åˆ†åˆ«æ·»åŠ åˆ°ä¸åŒ Github è´¦æˆ·ä¸Š</li>
<li>ç”±äºä¸»æœºæœ‰ä¸¤ä¸ª SSH Keyï¼Œå¯¼è‡´ Github æ— æ³•è¯†åˆ«å¯¹åº”å…³ç³»ï¼Œæ‰€ä»¥ä¼šæŠ¥é”™æƒé™é—®é¢˜</li>
<li>è¿™æ—¶ï¼Œéœ€è¦ç”¨æˆ·æ‰‹åŠ¨é…ç½®å¯¹åº”æ˜ å°„å…³ç³»ï¼Œç»™å¦ä¸€ä¸ª Github è´¦æˆ·çš„ç«™ç‚¹<strong>èµ·ä¸€ä¸ªåˆ«å</strong>ï¼Œèµ·åˆ°åŒºåˆ†ä½œç”¨å³å¯</li>
<li>è¿›å…¥ .ssh æ–‡ä»¶å¤¹ â€“ <code>cd ~/.ssh</code>ï¼Œåˆ›å»ºé…ç½®æ–‡ä»¶ â€“ <code>vim config</code>ï¼Œæ·»åŠ å†…å®¹å¦‚ä¸‹ï¼š<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#Default GitHub</span><br><span class="line">Host github.com             # é€‰å®šä¸€ä¸ªé»˜è®¤è´¦æˆ·ï¼Œåˆ«åä¸ç”¨æ›´æ”¹</span><br><span class="line">HostName github.com</span><br><span class="line">User git</span><br><span class="line">IdentityFile ~/.ssh/id_rsa    # å¯¹åº”å…¶ç”Ÿæˆçš„å¯†é’¥</span><br><span class="line"></span><br><span class="line">#new github</span><br><span class="line">Host github-alias           # å¦ä¸€ä¸ªè´¦æˆ·çš„åˆ«å</span><br><span class="line">HostName github.com</span><br><span class="line">User git</span><br><span class="line">IdentityFile ~/.ssh/id_rsa1   # å¦ä¸€ä¸ªè´¦æˆ·æ‰€å¯¹åº”çš„å¯†é’¥</span><br></pre></td></tr></table></figure>
å‡è®¾ç°åœ¨æœ‰ä¸€ä¸ªä»“åº“ï¼Œæ˜¯å±äºå¦ä¸€ä¸ª Github è´¦æˆ·çš„ï¼Œé‚£ä¹ˆéœ€è¦æ›´æ”¹å…¶è¿œç¨‹ä»“åº“é“¾æ¥ä¸ºåˆ«åå³å¯ï¼š</li>
</ul>
<p>æ¯”å¦‚ï¼Œå°†<code>git@github.com:Jindu-Chen/Jindu-Chen.github.io.git</code>æ”¹ä¸º<code>github-alias:Jindu-Chen/Jindu-Chen.github.io.git</code></p>
<h3 id="æœ¬åœ°gité…ç½®-1"><a href="#æœ¬åœ°gité…ç½®-1" class="headerlink" title="æœ¬åœ°gité…ç½®"></a>æœ¬åœ°gité…ç½®</h3><br>

<p><strong>é…ç½®æœ¬åœ°ä¸è¿œç«¯çš„SSHå¯†é’¥è¿æ¥æµç¨‹ï¼š</strong></p>
<ul>
<li>æœ¬åœ°ç”ŸæˆSSHå…¬é’¥å’Œç§é’¥(å¦‚æœæ²¡æœ‰çš„è¯ï¼Œå¦ï¼Œlinuxä¸‹å…¬é’¥é€šå¸¸å­˜æ”¾äº<code>~/.ssh/*.pub</code>)<ul>
<li><code>ssh-keygen -t rsa -b 4096 -C xxx@xxx.com</code></li>
</ul>
</li>
<li>å¤åˆ¶å…¬é’¥ï¼Œæ·»åŠ è‡³è¿œç«¯å¹³å°çš„SSHè®¾ç½®ä¸Š<br></li>
</ul>
<p><strong>æŸ¥çœ‹æœ¬åœ°é…ç½®ï¼š</strong></p>
<ul>
<li><code>git config --list</code>æŸ¥çœ‹å½“å‰é¡¹ç›®çš„æ‰€æœ‰é…ç½®</li>
<li><code>git config --global --list</code>æŸ¥çœ‹å…¨å±€é…ç½®<br></li>
</ul>
<p><strong>ä¿®æ”¹ç”¨æˆ·å(å…¨å±€&#x2F;å½“å‰é¡¹ç›®)</strong></p>
<p>æ­¤ç”¨æˆ·åå³æäº¤æ—¥å¿—ä¸Šæ‰€å±•ç¤ºçš„ç”¨æˆ·åç§°</p>
<ul>
<li>ä¿®æ”¹å…¨å±€ç”¨æˆ·åï¼š<code>git config --global user.name &quot;xxx&quot;</code>ï¼Œå½±å“ç”¨æˆ·çš„æ‰€æœ‰ä»“åº“</li>
<li>ä¿®æ”¹å½“å‰è·¯å¾„é¡¹ç›®çš„ç”¨æˆ·åï¼š<code>git config user.name &quot;xxx&quot;</code></li>
<li>æŸ¥çœ‹å…¨å±€ç”¨æˆ·åï¼š<code>git config user.name</code></li>
</ul>
<br>

<p><strong>åˆå§‹åŒ–æœ¬åœ°å·¥ç¨‹å¹¶ä¸è¿œç«¯å·²æœ‰ä»“åº“çš„mainåˆ†æ”¯å…³è”ï¼š</strong></p>
<ul>
<li>è¿›å…¥å·¥ç¨‹æ ¹ç›®å½•ï¼Œ<code>git init</code>åˆå§‹åŒ–æœ¬åœ°ä»“åº“</li>
<li>æ·»åŠ è¿œç¨‹ä»“åº“ï¼š<code>git remote add origin &lt;è¿œç¨‹ä»“åº“åœ°å€&gt;</code></li>
<li><code>git branch -M main</code>å°†å½“å‰åˆ†æ”¯é‡å‘½åä¸º<code>main</code>ï¼ŒMå³<code>--move --force</code>çš„ç¼©å†™ã€‚ï¼ˆå¯ä»¥åˆ†åˆ«è¾“å…¥<code>git add --all</code>ï¼Œ<code>git commit -m &quot;first commit&quot;</code>å®Œæˆå¯¹æœ¬åœ°åˆ†æ”¯çš„é¦–æ¬¡æäº¤ï¼‰</li>
<li>ä½¿ç”¨<code>git pull origin main</code>ï¼Œå°†è¿œç¨‹ä»“åº“çš„mainåˆ†æ”¯æ‹‰å–åˆ°æœ¬åœ°ï¼Œæˆ–è€…<code>git push -u origin main -f</code>å°†æœ¬åœ°çš„xxxåˆ†æ”¯å¼ºåˆ¶æ¨é€åˆ°è¿œç«¯mainåˆ†æ”¯ï¼Œå…¶ä¸­-uæ˜¯<code>--set-upstream</code>çš„ç¼©å†™ï¼Œåç»­ä¼šä¿æŒè¿™ä¸ªè·Ÿè¸ªå…³ç³»</li>
</ul>
<br>

<h3 id="åˆ†æ”¯åˆå¹¶åˆ°main"><a href="#åˆ†æ”¯åˆå¹¶åˆ°main" class="headerlink" title="åˆ†æ”¯åˆå¹¶åˆ°main"></a>åˆ†æ”¯åˆå¹¶åˆ°main</h3><p>ä»¥ä¸‹æ˜¯å®Œæ•´çš„å‘½ä»¤æµç¨‹ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ç¡®ä¿ä½ çš„åˆ†æ”¯æ˜¯æœ€æ–°çš„</span></span><br><span class="line">git checkout your-branch</span><br><span class="line">git pull origin your-branch</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">åˆ‡æ¢åˆ° main åˆ†æ”¯å¹¶æ‹‰å–æœ€æ–°æ›´æ”¹</span></span><br><span class="line">git checkout main</span><br><span class="line">git pull origin main</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å°†ä½ çš„åˆ†æ”¯çš„æ›´æ”¹åˆå¹¶åˆ° main åˆ†æ”¯</span></span><br><span class="line">git merge your-branch</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è§£å†³å†²çªï¼ˆå¦‚æœéœ€è¦ï¼‰</span></span><br><span class="line">git add &lt;conflicted-files&gt;</span><br><span class="line">git commit</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ¨é€æ›´æ”¹åˆ°è¿œç¨‹ main åˆ†æ”¯</span></span><br><span class="line">git push origin main</span><br></pre></td></tr></table></figure>

<p>å¦‚æœä½ å¸Œæœ›ä½¿ç”¨ <code>git rebase</code> ä¿æŒæäº¤å†å²æ•´æ´ï¼Œå¯ä»¥å‚è€ƒä»¥ä¸‹æµç¨‹ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ç¡®ä¿ä½ çš„åˆ†æ”¯æ˜¯æœ€æ–°çš„</span></span><br><span class="line">git checkout your-branch</span><br><span class="line">git pull origin your-branch</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">åŸºäº main åˆ†æ”¯é‡æ–°åº”ç”¨ä½ çš„åˆ†æ”¯çš„æ›´æ”¹</span></span><br><span class="line">git rebase main</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è§£å†³å†²çªï¼ˆå¦‚æœéœ€è¦ï¼‰</span></span><br><span class="line">git add &lt;conflicted-files&gt;</span><br><span class="line">git rebase --continue</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">åˆ‡æ¢åˆ° main åˆ†æ”¯å¹¶æ‹‰å–æœ€æ–°æ›´æ”¹</span></span><br><span class="line">git checkout main</span><br><span class="line">git pull origin main</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å°†ä½ çš„åˆ†æ”¯çš„æ›´æ”¹åˆå¹¶åˆ° main åˆ†æ”¯</span></span><br><span class="line">git merge your-branch</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ¨é€æ›´æ”¹åˆ°è¿œç¨‹ main åˆ†æ”¯</span></span><br><span class="line">git push origin main</span><br></pre></td></tr></table></figure>

<h3 id="mainåˆå¹¶åˆ°åˆ†æ”¯"><a href="#mainåˆå¹¶åˆ°åˆ†æ”¯" class="headerlink" title="mainåˆå¹¶åˆ°åˆ†æ”¯"></a>mainåˆå¹¶åˆ°åˆ†æ”¯</h3><p>ä½¿ç”¨ <code>git merge</code>ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ç¡®ä¿æœ¬åœ° main åˆ†æ”¯æ˜¯æœ€æ–°çš„</span></span><br><span class="line">git checkout main</span><br><span class="line">git pull origin main</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">åˆ‡æ¢åˆ°ç›®æ ‡åˆ†æ”¯</span></span><br><span class="line">git checkout your-branch</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å°† main åˆ†æ”¯çš„æ›´æ”¹åˆå¹¶åˆ°ç›®æ ‡åˆ†æ”¯</span></span><br><span class="line">git merge main</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è§£å†³å†²çªï¼ˆå¦‚æœéœ€è¦ï¼‰</span></span><br><span class="line">git add &lt;conflicted-files&gt;</span><br><span class="line">git commit</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ¨é€æ›´æ”¹åˆ°è¿œç¨‹ç›®æ ‡åˆ†æ”¯</span></span><br><span class="line">git push origin your-branch</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨ <code>git rebase</code>:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ç¡®ä¿æœ¬åœ° main åˆ†æ”¯æ˜¯æœ€æ–°çš„</span></span><br><span class="line">git checkout main</span><br><span class="line">git pull origin main</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">åˆ‡æ¢åˆ°ç›®æ ‡åˆ†æ”¯</span></span><br><span class="line">git checkout your-branch</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å°†ç›®æ ‡åˆ†æ”¯åŸºäº main åˆ†æ”¯é‡æ–°åº”ç”¨æ›´æ”¹</span></span><br><span class="line">git rebase main</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è§£å†³å†²çªï¼ˆå¦‚æœéœ€è¦ï¼‰</span></span><br><span class="line">git add &lt;conflicted-files&gt;</span><br><span class="line">git rebase --continue</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ¨é€æ›´æ”¹åˆ°è¿œç¨‹ç›®æ ‡åˆ†æ”¯ï¼ˆå¯èƒ½éœ€è¦å¼ºåˆ¶æ¨é€ï¼‰</span></span><br><span class="line">git push origin your-branch --force</span><br></pre></td></tr></table></figure>

<h3 id="æ¨é€è¢«æ‹’ç»ï¼Œè¿œç¨‹å†²çªæ—¶"><a href="#æ¨é€è¢«æ‹’ç»ï¼Œè¿œç¨‹å†²çªæ—¶" class="headerlink" title="æ¨é€è¢«æ‹’ç»ï¼Œè¿œç¨‹å†²çªæ—¶"></a>æ¨é€è¢«æ‹’ç»ï¼Œè¿œç¨‹å†²çªæ—¶</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git fetch origin <span class="comment"># è·å–è¿œç¨‹æ›´æ–°</span></span><br><span class="line"></span><br><span class="line">git diff HEAD origin/ä½ çš„åˆ†æ”¯å <span class="comment"># æŸ¥çœ‹å½“å‰åˆ†æ”¯ä¸è¿œç¨‹åˆ†æ”¯çš„è¯¦ç»†å·®å¼‚</span></span><br><span class="line">git <span class="built_in">log</span> --oneline HEAD..origin/ä½ çš„åˆ†æ”¯å <span class="comment"># æˆ–æŸ¥çœ‹ç®€è¦çš„æäº¤å†å²å·®å¼‚</span></span><br><span class="line"></span><br><span class="line">git stash        <span class="comment"># æš‚å­˜æœªæäº¤çš„æ›´æ”¹</span></span><br><span class="line">git pull origin ä½ çš„åˆ†æ”¯å --rebase  <span class="comment"># å»ºè®®ä½¿ç”¨ --rebase é€‰é¡¹å˜åŸºå¼æ‹‰å–ï¼Œä¿æŒå†å²çº¿æ€§</span></span><br><span class="line">git stash pop    <span class="comment"># æ¢å¤æš‚å­˜çš„æ›´æ”¹ï¼Œæ­¤æ—¶å¯èƒ½éœ€è¦è§£å†³å†²çª</span></span><br><span class="line"></span><br><span class="line">git pull origin ä½ çš„åˆ†æ”¯å --rebase  <span class="comment"># ä¼˜å…ˆä½¿ç”¨ rebase</span></span><br><span class="line"><span class="comment"># å¦‚æœ rebase å‡ºç°é—®é¢˜ï¼Œå¯ä»¥å›é€€å¹¶å°è¯•æ™®é€š merge</span></span><br><span class="line"><span class="comment"># git rebase --abort</span></span><br><span class="line"><span class="comment"># git pull origin ä½ çš„åˆ†æ”¯å        # è¿™é»˜è®¤ä¼šä½¿ç”¨ merge</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># git status æŸ¥çœ‹å“ªäº›æ–‡ä»¶æœ‰å†²çªã€‚æ‰¾åˆ° &lt;&lt;&lt;&lt;&lt;&lt;&lt;, =======, &gt;&gt;&gt;&gt;&gt;&gt;&gt; æ ‡è®°çš„åŒºåŸŸè§£å†³å†²çªã€‚</span></span><br><span class="line"></span><br><span class="line">git add .  <span class="comment"># æˆ–æ·»åŠ ç‰¹å®šå·²è§£å†³å†²çªçš„æ–‡ä»¶ï¼Œå¦‚ git add æ–‡ä»¶å</span></span><br><span class="line"></span><br><span class="line">git rebase --<span class="built_in">continue</span> 		<span class="comment"># å¦‚æœä½ ä¹‹å‰ç”¨çš„æ˜¯ rebase</span></span><br><span class="line">git commit -m <span class="string">&quot;è§£å†³åˆå¹¶å†²çª&quot;</span> <span class="comment"># å¦‚æœæ™®é€šçš„ merge</span></span><br><span class="line"></span><br><span class="line">git push origin ä½ çš„åˆ†æ”¯å</span><br></pre></td></tr></table></figure>


<h2 id="git-tagå°è´´å£«"><a href="#git-tagå°è´´å£«" class="headerlink" title="git tagå°è´´å£«"></a>git tagå°è´´å£«</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git log                             // æˆ–è€… git log --onelineï¼ˆè¿‘æœŸæäº¤ï¼‰</span><br><span class="line">git tag -a v1.0.0 &lt;commit-hash&gt;     // è¿™é‡Œçš„ v1.0.0 æ˜¯æ ‡ç­¾åï¼Œ&lt;commit-hash&gt; æ˜¯ä½ æƒ³è¦æ ‡è®°çš„æäº¤çš„å“ˆå¸Œã€‚-a è¡¨ç¤ºåˆ›å»ºä¸€ä¸ªå¸¦æ³¨é‡Šçš„æ ‡ç­¾ï¼ˆannotated tagï¼‰ï¼Œä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ -s åˆ›å»ºä¸€ä¸ªç­¾åæ ‡ç­¾ï¼Œæˆ–è€…ä¸ä½¿ç”¨ -a æ¥åˆ›å»ºä¸€ä¸ªè½»é‡çº§æ ‡ç­¾ï¼ˆlightweight tagï¼‰ã€‚</span><br><span class="line">git tag                             // æŸ¥çœ‹æ‰€æœ‰æ ‡ç­¾</span><br><span class="line">git push origin v1.0.0              // git push origin --tagsæ¨é€æ‰€æœ‰æ ‡ç­¾</span><br></pre></td></tr></table></figure>

<br>

<h2 id="å‚è€ƒç«™ç‚¹"><a href="#å‚è€ƒç«™ç‚¹" class="headerlink" title="å‚è€ƒç«™ç‚¹"></a>å‚è€ƒç«™ç‚¹</h2><ul>
<li><a href="https://stackoverflow.com/questions/68277661/what-does-the-m-mean-in-git-branch-m-main">What does the -M mean in git branch -M main?</a></li>
<li><a href="https://stackoverflow.com/questions/47465644/github-remote-permission-denied">Github remote permission denied</a></li>
</ul>
]]></content>
      <categories>
        <category>Git</category>
      </categories>
  </entry>
</search>
